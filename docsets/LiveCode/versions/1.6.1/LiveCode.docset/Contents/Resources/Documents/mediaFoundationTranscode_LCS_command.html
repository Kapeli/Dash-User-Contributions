<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>mediaFoundationTranscode</title><link rel="stylesheet" type="text/css" href="userguide.css" /></head><body><table><tr><td colspan="2"><h1>mediaFoundationTranscode</h1></td></tr><tr><td><b>Type</b></td><td>command</td></tr><tr><td><b>Dictionary</b></td><td>LCS</td></tr><tr><td><b>Library</b></td><td>mediafoundation</td></tr><tr><td><b>Syntax</b></td><td><pre>mediaFoundationTranscode &lt;pReaderFilePath&gt;, &lt;pWriterFilePath&gt;, &lt;pVideoProcessorID&gt;, [&lt;pOffset&gt;], [&lt;pFrom&gt;], [&lt;pDuration&gt;]</pre></td></tr><tr><td><b>Associations</b></td><td>mediafoundation</td></tr><tr><td><b>Summary</b></td><td><p>Transcode part or all of the media from from a reader to a writerPlatform:desktop</p></td></tr><tr><td><b>Edition</b></td><td>Indy</td></tr><tr><td><b>OS</b></td><td>windows</td></tr><tr><td><b>Parameters</b></td><td><table class="inner"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>pReaderFilePath</td><td></td><td><p>The path to a media file</p></td></tr><tr><td>pWriterFilePath</td><td></td><td><p>The path to a media file</p></td></tr><tr><td>pVideoProcessorID</td><td></td><td><p>The ide of a video processor</p></td></tr><tr><td>pOffset</td><td></td><td><p>An offset to write to a writer that already has content up to the offset. 100 nanosecond units</p></td></tr><tr><td>pFrom</td><td></td><td><p>Seek to this time before starting to transcode. 100 nanosecond units</p></td></tr><tr><td>pDuration</td><td></td><td><p>The duration to trancode where 0 means the entire file from pFrom. 100 nanosecond units</p><p>The result (c-string):An error string if an error occurred</p></td></tr></table></td></tr><tr><td><b>Example</b></td><td><pre>constant kMFVideoInterlace_Progressive = 2constant kMFVideoInterlace_FieldInterleavedUpperFirst = 3constant kMFVideoInterlace_FieldInterleavedLowerFirst = 4constant kMFVideoInterlace_FieldSingleUpper = 5constant kMFVideoInterlace_FieldSingleLower = 6constant kMFVideoInterlace_MixedInterlaceOrProgressive = 7<p></p>command Transcode pReaderFilePath, pWriterFilePath   mediaFoundationCreateReader pReaderFilePath   mediaFoundationCreateWriter pWriterFilePath<p></p>   mediaFoundationCreateMediaType   local tVideoMediaType   put the result into tVideoMediaType<p></p>   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "major type", "media type video"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "subtype", "video format H264"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video frame size", "400,300"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video frame rate", "20000,1000"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video avg bitrate", 100000   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video interlace mode", kMFVideoInterlace_Progressive   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video aspect ratio", "1,1"<p></p>   mediaFoundationCreateMediaType   local tAudioMediaType   put the result into tAudioMediaType<p></p>   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "major type", "media type audio"   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "subtype", "audio format AAC"   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio bits per sample", 16   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio samples per second", 44100   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio num channels", 2   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio avg bytes per second", 16000   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio block alignment", 1<p></p>   local tStreamCount   put mediaFoundationReaderNumberOfStreams(pReaderFilePath) into tStreamCount<p></p>   local tVideoProcessor   mediaFoundationCreateVideoProcessor   put the result into tVideoProcessor<p></p>   repeat with tIndex = 1 to tStreamCount      local tMajorType      local tNativeMediaType      put mediaFoundationReaderStreamGetNativeMediaType(pReaderFilePath, tIndex) into tNativeMediaType      put mediaFoundationMediaTypeGetAttribute(tNativeMediaType, "major type") into tMajorType<p></p>      mediaFoundationCreateMediaType      local tPartialMediaType      put the result into tPartialMediaType<p></p>      mediaFoundationMediaTypeSetAttribute tPartialMediaType, "major type", tMajorType<p></p>      local tFoundMatch      switch tMajorType         case "media type video"            local tSize            put mediaFoundationMediaTypeGetAttribute(tNativeMediaType, "video frame size") into tSize            mediaFoundationVideoProcessorSetSourceRect tVideoProcessor, 0,0,400,300            mediaFoundationVideoProcessorSetDestinationRect tVideoProcessor, 0,0,item 1 of tSize, item 2 of tSize<p></p>            mediaFoundationAddStreamToWriter pWriterFilePath, tVideoMediaType            mediaFoundationDeleteMediaType tVideoMediaType<p></p>            put false into tFoundMatch<p></p>            local tInputMediaTypeIndex            put 0 into tInputMediaTypeIndex<p></p>            local tAvailableInputMediaType            local tCurrentMediaType            repeat               add 1 to tInputMediaTypeIndex               put mediaFoundationVideoProcessorGetInputAvailableMediaType(tVideoProcessor, tInputMediaTypeIndex) \                     into tAvailableInputMediaType               if tAvailableInputMediaType is 0 then                  exit repeat               end if<p></p>               local tResult               mediaFoundationReaderStreamSetCurrentMediaType pReaderFilePath, tIndex, tAvailableInputMediaType               put the result into tResult               if tResult then                  put mediaFoundationReaderStreamGetCurrentMediaType(pReaderFilePath, tIndex) into tCurrentMediaType                  mediaFoundationVideoProcessorSetInputMediaType tVideoProcessor, tCurrentMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tCurrentMediaType                     next repeat                  end if                  mediaFoundationMediaTypeSetAttribute tCurrentMediaType, "video frame size", "400,300"<p></p>                  mediaFoundationVideoProcessorSetOutputMediaType tVideoProcessor, tCurrentMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tCurrentMediaType                     next repeat                  end if<p></p>                  mediaFoundationWriterStreamSetInputMediaType pWriterFilePath, tIndex, tCurrentMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tCurrentMediaType                     next repeat                  end if<p></p>                  mediaFoundationDeleteMediaType tCurrentMediaType                  put true into tFoundMatch<p></p>               end if<p></p>               mediaFoundationDeleteMediaType tAvailableInputMediaType               if tFoundMatch then                  exit repeat               end if            end repeat<p></p>            if not tFoundMatch then               exit repeat            end if            break         case "media type audio"            mediaFoundationAddStreamToWriter pWriterFilePath, tAudioMediaType            mediaFoundationDeleteMediaType tAudioMediaType<p></p>            put false into tFoundMatch            repeat for each item tIntermediateFormat in \                  "audio format Float,audio format PCM"               mediaFoundationMediaTypeSetAttribute tPartialMediaType, "subtype", tIntermediateFormat               mediaFoundationReaderStreamSetCurrentMediaType pReaderFilePath, tIndex, tPartialMediaType               if the result then                  put mediaFoundationReaderStreamGetCurrentMediaType(pReaderFilePath, tIndex) into tCurrentMediaType                  mediaFoundationWriterStreamSetInputMediaType pWriterFilePath, tIndex, tCurrentMediaType                  put the result into tResult                  mediaFoundationDeleteMediaType tCurrentMediaType                  if tResult then                     put true into tFoundMatch                     exit repeat                  end if               end if            end repeat            if not tFoundMatch then               exit repeat            end if            break         default<p></p>      end switch<p></p>      mediaFoundationDeleteMediaType tPartialMediaType      mediaFoundationDeleteMediaType tNativeMediaType   end repeat<p></p>   if tFoundMatch then      mediaFoundationWriterBeginWriting pWriterFilePath      mediaFoundationTranscode pReaderFilePath, pWriterFilePath, tVideoProcessor, 0,0,0      mediaFoundationWriterFinalizeWriting pWriterFilePath   end if<p></p>   mediaFoundationDeleteReader pReaderFilePath   mediaFoundationDeleteWriter pWriterFilePath   mediaFoundationDeleteVideoProcessor tVideoProcessorend Transcode<p></p>on mediaFoundationTranscoding pTimestamp   put pTimestampend mediaFoundationTranscoding</pre><pre>constant kMFVideoInterlace_Progressive = 2constant kMFVideoInterlace_FieldInterleavedUpperFirst = 3constant kMFVideoInterlace_FieldInterleavedLowerFirst = 4constant kMFVideoInterlace_FieldSingleUpper = 5constant kMFVideoInterlace_FieldSingleLower = 6constant kMFVideoInterlace_MixedInterlaceOrProgressive = 7<p></p>command Concatenate pReader1FilePath, pReader2FilePAth, pWriterFilePath   mediaFoundationCreateReader pReader1FilePath   mediaFoundationCreateReader pReader2FilePath   mediaFoundationCreateWriter pWriterFilePath<p></p>   mediaFoundationCreateMediaType   local tVideoMediaType   put the result into tVideoMediaType<p></p>   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "major type", "media type video"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "subtype", "video format H264"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video frame size", "400,300"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video frame rate", "20000,1000"   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video avg bitrate", 100000   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video interlace mode", kMFVideoInterlace_Progressive   mediaFoundationMediaTypeSetAttribute tVideoMediaType, "video aspect ratio", "1,1"<p></p>   mediaFoundationCreateMediaType   local tAudioMediaType   put the result into tAudioMediaType<p></p>   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "major type", "media type audio"   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "subtype", "audio format AAC"   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio bits per sample", 16   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio samples per second", 44100   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio num channels", 2   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio avg bytes per second", 16000   mediaFoundationMediaTypeSetAttribute tAudioMediaType, "audio block alignment", 1<p></p>   local tStreamCount   put mediaFoundationReaderNumberOfStreams(pReader1FilePath) into tStreamCount<p></p>   local tVideoProcessor   mediaFoundationCreateVideoProcessor   put the result into tVideoProcessor<p></p>   repeat with tIndex = 1 to tStreamCount      local tMajorType      local tNativeMediaType      put mediaFoundationReaderStreamGetNativeMediaType(pReader1FilePath, tIndex) into tNativeMediaType      put mediaFoundationMediaTypeGetAttribute(tNativeMediaType, "major type") into tMajorType<p></p>      mediaFoundationCreateMediaType      local tPartialMediaType      put the result into tPartialMediaType<p></p>      mediaFoundationMediaTypeSetAttribute tPartialMediaType, "major type", tMajorType<p></p>      local tFoundMatch      switch tMajorType         case "media type video"            local tSize            put mediaFoundationMediaTypeGetAttribute(tNativeMediaType, "video frame size") into tSize            mediaFoundationVideoProcessorSetSourceRect tVideoProcessor, 0,0,400,300            mediaFoundationVideoProcessorSetDestinationRect tVideoProcessor, 0,0,item 1 of tSize, item 2 of tSize<p></p>            mediaFoundationAddStreamToWriter pWriterFilePath, tVideoMediaType            mediaFoundationDeleteMediaType tVideoMediaType<p></p>            put false into tFoundMatch<p></p>            local tInputMediaTypeIndex            put 0 into tInputMediaTypeIndex<p></p>            local tAvailableInputMediaType            local tCurrentMediaType            repeat               add 1 to tInputMediaTypeIndex               put mediaFoundationVideoProcessorGetInputAvailableMediaType(tVideoProcessor, tInputMediaTypeIndex) \                     into tAvailableInputMediaType               if tAvailableInputMediaType is 0 then                  exit repeat               end if<p></p>               local tResult               mediaFoundationReaderStreamSetCurrentMediaType pReader1FilePath, tIndex, tAvailableInputMediaType               put the result into tResult               if tResult then                  mediaFoundationReaderStreamSetCurrentMediaType pReader2FilePath, tIndex, tAvailableInputMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tAvailableInputMediaType                     next repeat                  end if                  put mediaFoundationReaderStreamGetCurrentMediaType(pReader1FilePath, tIndex) into tCurrentMediaType                  mediaFoundationVideoProcessorSetInputMediaType tVideoProcessor, tCurrentMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tAvailableInputMediaType                     mediaFoundationDeleteMediaType tCurrentMediaType                     next repeat                  end if                  mediaFoundationMediaTypeSetAttribute tCurrentMediaType, "video frame size", "400,300"<p></p>                  mediaFoundationVideoProcessorSetOutputMediaType tVideoProcessor, tCurrentMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tAvailableInputMediaType                     mediaFoundationDeleteMediaType tCurrentMediaType                     next repeat                  end if<p></p>                  mediaFoundationWriterStreamSetInputMediaType pWriterFilePath, tIndex, tCurrentMediaType                  put the result into tResult                  if not tResult then                     mediaFoundationDeleteMediaType tAvailableInputMediaType                     mediaFoundationDeleteMediaType tCurrentMediaType                     next repeat                  end if<p></p>                  mediaFoundationDeleteMediaType tCurrentMediaType                  put true into tFoundMatch<p></p>               end if<p></p>               mediaFoundationDeleteMediaType tAvailableInputMediaType               if tFoundMatch then                  exit repeat               end if            end repeat<p></p>            if not tFoundMatch then               exit repeat            end if            break         case "media type audio"            mediaFoundationAddStreamToWriter pWriterFilePath, tAudioMediaType            mediaFoundationDeleteMediaType tAudioMediaType<p></p>            put false into tFoundMatch            repeat for each item tIntermediateFormat in \                  "audio format Float,audio format PCM"               mediaFoundationMediaTypeSetAttribute tPartialMediaType, "subtype", tIntermediateFormat               mediaFoundationReaderStreamSetCurrentMediaType pReader1FilePath, tIndex, tPartialMediaType               mediaFoundationReaderStreamSetCurrentMediaType pReader2FilePath, tIndex, tPartialMediaType               if the result then                  put mediaFoundationReaderStreamGetCurrentMediaType(pReader1FilePath, tIndex) into tCurrentMediaType                  mediaFoundationWriterStreamSetInputMediaType pWriterFilePath, tIndex, tCurrentMediaType                  put the result into tResult                  mediaFoundationDeleteMediaType tCurrentMediaType                  if tResult then                     put true into tFoundMatch                     exit repeat                  end if               end if            end repeat            if not tFoundMatch then               exit repeat            end if            break         default<p></p>      end switch<p></p>      mediaFoundationDeleteMediaType tPartialMediaType      mediaFoundationDeleteMediaType tNativeMediaType   end repeat<p></p>   local tDuration   put mediaFoundationReaderDuration(pReader1FilePath) into tDuration<p></p>   if tFoundMatch then      mediaFoundationWriterBeginWriting pWriterFilePath      mediaFoundationTranscode pReader1FilePath, pWriterFilePath, tVideoProcessor, 0,0,0      mediaFoundationTranscode pReader2FilePath, pWriterFilePath, tVideoProcessor, tDuration, 0, 0      mediaFoundationWriterFinalizeWriting pWriterFilePath   end if<p></p>   mediaFoundationDeleteReader pReader1FilePath   mediaFoundationDeleteReader pReader2FilePath   mediaFoundationDeleteWriter pWriterFilePath   mediaFoundationDeleteVideoProcessor tVideoProcessorend Concatenate</pre></td></tr><tr><td><b>Related</b></td><td><b>Command</b>: <a href="mediaFoundationCreateWriter_LCS_command.html">mediaFoundationCreateWriter</a>, <a href="mediaFoundationCreateReader_LCS_command.html">mediaFoundationCreateReader</a>, <a href="mediaFoundationCreateVideoProcessor_LCS_command.html">mediaFoundationCreateVideoProcessor</a><br></td></tr><tr><td><b>Description</b></td><td><p>The reader and writer must already be created with <a href="mediaFoundationCreateReader_LCS_command.html">mediaFoundationCreateReader</a> and<a href="mediaFoundationCreateWriter_LCS_command.html">mediaFoundationCreateWriter</a>. If a video stream is to be transcoded then the videoprocessor must already be created.</p><p>While transcoding the <a href="mediaFoundationTranscode_LCS_command.html">mediaFoundationTranscode</a> command will wait with messages and aprogress message mediaFoundationTranscoding will be sent to the caller with a singleparameter of the timestamp of the current sample being processed.</p></td></tr></table></body></html>