<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>LiveCode Data Grid</title><link rel="stylesheet" type="text/css" href="userguide.css" /></head><body><hr/><h2>group: intermediate</h2><h1>LiveCode Data Grid</h1><h2><a name="//apple_ref/cpp/Guide/Introduction" class="dashAnchor"></a>Introduction</h2><h3>What is the Data Grid?</h3><p>The LiveCode Data Grid enables you to integrate powerful tables andforms into your projects. Data grids combine LiveCode groups andbehaviors to provide you with a simple, yet flexible means of displayingyour data in just about any way you want.</p><h4>A Data Grid Table</h4><p><img src="images/datagrid-table.gif" alt=""/></p><p>The table style of a data grid allows you to display your data in amodern looking table complete with headers, sorting, column alignmentand more. By default a data grid table will use a LiveCode field toeach column of each row. If you need to customize a column with graphicsyou can define your own templates for each column. A custom template canbe any LiveCode control such as a graphic or group.</p><h4>A Data Grid Form</h4><p><img src="images/datagrid-form.gif" alt=""/></p><p>The form style of a data grid (1) is similar to a list field (2) inLiveCode in that it allows you to display records from a data source(text file, database, XML, etc.) that the user can select.</p><p>The difference is that the data grid uses a group as a template for eachrecord. This means that for each record you display you can create richuser interfaces using menus, images, etc.</p><p>The data grid form is also very fast as it only draws the records thatare currently visible on the screen. This means you can display largerecords sets without slow performance.</p><p>Because the data grid form is so easy to use it is not only limited todisplaying lots of records. Any list where you want a rich UI andcomplete control over layout and processing of engine events can benefitfrom being displayed using a data grid form.</p><h3>Can You Show Me Some Examples?</h3><p>Of course we can! The areas of the screenshots highlighted in blue are instances of the data grid control.</p><h4>Data Grid Table</h4><p><img src="images/datagrid-table-display-1.png" alt=""/></p><h4>Data Grid Forms</h4><p><img src="images/datagrid-form-display-1.png" alt=""/></p><p><img src="images/datagrid-form-display-2.png" alt=""/></p><p><img src="images/datagrid-form-display-3.png" alt=""/></p><p><img src="images/datagrid-form-display-4.png" alt=""/></p><p><img src="images/datagrid-form-display-5.png" alt=""/></p><p><img src="images/datagrid-form-display-6.png" alt=""/></p><h3>How Do I Create My First Data Grid Table?</h3><p>This lesson will show you how to create a bare bones data grid table.Data grid tables are useful when you need to display rows of data instructured columns.</p><h4>Locate Data Grid on Tools Palette</h4><p><img src="images/datagrid-tools-palette.png" alt=""/></p><h4>Drag Data Grid Onto Card</h4><p><img src="images/datagrid-drag-onto-card.png" alt=""/></p><h4>Populate Data Grid Using The Property Inspector</h4><p>Data Grid tables display data in columns that you can customize the lookof. You don&#39;t have to worry about customization right now though becausea Data Grid table can display plain text just fine. Let&#39;s test it out.</p><p>As with all controls in LiveCode you can open the Data Grid&#39;s <strong>Property Inspector</strong> three ways.</p><p>Select the data grid in question and then:</p><ol><li>Go to the <strong>Object</strong> menu and select the <strong>Object Inspector</strong> item</li><li>Right (central) click on the data grid and select <strong>Property Inspector</strong> from the popup</li><li>Double click on the data grid itself.</li></ol><p>So, open the <strong>Property Inspector</strong> for the data grid you have just dragged onto the card.</p><ol><li>Switch to the <strong>Contents</strong> pane of the <strong>Property Inspector</strong>. </li><li>Type or paste some tab delimited text into the field. Click out of the field or press <strong><em>cntrl-return</em></strong> to save the text you entered.</li></ol><p><img src="images/datagrid-table-inspector-text.png" alt=""/></p><p>The tab delimited text you entered in the field will appear as columnsin the data grid (1). The <strong>Property Inspector</strong> automatically creates acolumn in the Data Grid for each column in the text you provide (2).</p><p><img src="images/datagrid-table-inspector-columns-1.png" alt=""/></p><h4>Customizing Columns</h4><p>Now that you&#39;ve populated a Data Grid Table with some data let&#39;s look atthe columns in the Data Grid.</p><p><img src="images/datagrid-table-inspector-columns-2.png" alt=""/></p><p>Normally when you work with a Data Grid Table you will create columns inthe <strong>Property Inspector</strong> in advance using the &quot;+&quot; button (1). Seeing asthe columns needed already exist you can go through and rename <em>Col 1</em> to <em>state</em> and <em>Col 2</em> to <em>code</em> (2).</p><p>Note that a label for the columns (3) has also been assigned . Labels are usefulfor customizing the column labels in the Data Grid Table.</p><h4>Populate Data Grid Using dgText Property</h4><p>Now that you have defined your columns let&#39;s look at how to populate aData Grid Table by setting the <strong>dgText</strong> property. Here is an examplehandler (with comments) that you can place in a button.</p><blockquote><p><strong>Note:</strong> Verify that the name of your data grid matches the name used in the code below otherwise an error will occur when you try to run it.</p></blockquote><pre><code>on mouseUp  ### Create tab delimited data.  ### Note that first line has name of columns.  ### Providing names tells Data Grid how to map  ### data to appropriate columns.  put &quot;state&quot; &amp; tab &amp; &quot;code&quot; &amp; cr &amp; \  &quot;ALABAMA&quot; &amp; tab &amp; &quot;AL&quot; &amp; cr &amp; \  &quot;ALASKA&quot; &amp; tab &amp; &quot;AK&quot; into theText  ### Let Data Grid know that first line has column names  put true into firstLineContainsColumnNames  set the dgText [ firstLineContainsColumnNames ] of group &quot;DataGrid&quot; to theTextend mouseUp</code></pre><p>Executing the above code would give you the following result in the Data Grid table.</p><p><img src="images/datagrid-table-with-dgtext.png" alt=""/></p><h4>Populating the Data Grid Using dgData Property</h4><p>Here is an example of populating the Data Grid Table by setting the<strong>dgData</strong> property to an array. The end result is the same as the previousstep.</p><blockquote><p><strong>Note:</strong> Verify that the name of your data grid matches the name used in the code below otherwise an error will occur when you try to run it.</p></blockquote><pre><code>on mouseup  ### Create a nested array.  ### Array key names in the 2nd dimension  ### dictate values for individual columns  put &quot;ALABAMA&quot; into theDataA[1][&quot;state&quot;]  put &quot;AL&quot; into theDataA[1][&quot;code&quot;]  put &quot;ALASKA&quot; into theDataA[2][&quot;state&quot;]  put &quot;AK&quot; into theDataA[2][&quot;code&quot;]  set the dgData of group &quot;DataGrid&quot; to theDataAend mouseUp</code></pre><h3>How Do I Create My First Data Grid Form?</h3><p>This lesson will show you how to create a bare bones data grid form.Data grid forms are useful when you need a less rigid layout thancolumns in a table provide. A data grid form gives you complete controlover the look and feel of each record you display.</p><h4>Locate Data Grid on Tools Palette</h4><p><img src="images/datagrid-tools-palette.png" alt=""/></p><h4>Drag Data Grid Onto Card</h4><p><img src="images/datagrid-drag-onto-card.png" alt=""/></p><h4>Change Style to &quot;Form&quot;</h4><p>Select the Data Grid and open the LiveCode <strong>Property Inspector</strong>. Changethe style to <strong>form</strong>.</p><p><img src="images/datagrid-form-inspector-style.png" alt=""/></p><h4>Add Some Text</h4><p>Now you can assign some text to the data grid. By default a data gridwill render some basic data without you having to customize the rowtemplate. To assign some text:</p><p><img src="images/datagrid-form-inspector-text.png" alt=""/></p><ol><li><p>Switch to the Contents pane of the <strong>Property Inspector</strong>. (1)</p></li><li><p>Type or paste some line delimited text into the field. (2)</p></li></ol><h4>Result</h4><p>That&#39;s it! The data you entered in the field will appear in the datagrid. Now you are ready to customize the look and feel of your recordsby modifying the row template.</p><p><img src="images/datagrid-form-with-text.png" alt=""/></p><p>You should note that while you can assign line delimited text to a datagrid form, the data grid really works with multi-dimensional arraysunder the hood. By using arrays you can store and display all differentkinds of data in a data grid. Being able to assign the <strong>Contents</strong> property ismerely a convenience.</p><h3>Example: Creating a List of People</h3><p>This lesson provides a low level detail, step-by-step example of creating acustom data grid form. Download the attached sample stack to seethe scripts.</p><h4>Attached Files</h4><p><a href="http://lessons.livecode.com/s/lessons/files/13?lesson_id=7305">datagrid_sampler.zip</a></p><h4>What You Will Create</h4><p><img src="images/media_1278008632464_display.png" alt=""/></p><p>This is the data grid that you will create. Each row displays a name, atitle and an image.</p><h4>Add Data Grid to Card</h4><p><img src="images/datagrid-drag-onto-card.png" alt=""/></p><p>To begin, drag a data grid from the <strong>Tools palette</strong> onto your card.</p><h4>Change Data Grid Style</h4><p><img src="images/media_1278011173914_display.png" alt=""/></p><p>Select the data grid and from the <strong>Basic Properties</strong> pane of the<strong>Property Inspector</strong> change the style of the data grid to <strong>Form.</strong></p><h4>The Data That Is Going to Be Displayed in Each Row</h4><p>Now you are going to design the row template for the data grid form. Therow template dictates how each record in the data grid will bedisplayed.</p><p><img src="images/media_1278009398991_display.png" alt=""/></p><p>Before you start editing the row template you need to know about thedata that will be displayed each row. This screenshot shows an excerptfrom the code that populates the data grid using a multi-dimensionalarray (look in the card script of the example stack). Each row will haveaccess to the data stored in the <em>FirstName</em>, <em>LastName</em>, <em>Title</em> and<em>ImageURL</em> keys of the array.</p><p>You are now going to add UI controls to the row template in order todisplay the data for each of these keys.</p><h4>Edit the Row Template</h4><p>With the data grid selected, click on the <strong>Row Template</strong> button in the<strong>Property Inspector</strong> to open the card containing row template controls.</p><p><img src="images/media_1278011265770_display.png" alt=""/></p><h4>Edit the Row Template Group</h4><p>In order to customize the look you need to edit the contents of thetemplate group.</p><p><img src="images/media_1278009877026_display.png" alt=""/></p><ol><li>Make sure the <strong>Edit</strong> tool is selected.</li><li>Make sure that <strong>Select Grouped</strong> IS NOT active.</li><li>Select the row template group.</li><li>Click <strong>Edit Group</strong> in the LiveCode toolbar.</li></ol><h4>Rename Label Field</h4><p>The default template group has a field named <em>Label</em>. Click on the leftside of the gray rectangle to select it.(1)</p><p><img src="images/media_1278010330080_display.png" alt=""/></p><p>Open the <strong>Property Inspector</strong> for this field and from the <strong>Basic</strong> pane (2) changethe name of the field to <em>Name</em> (2). Switch to the <strong>Contents</strong> pane and assign <em>Name</em> as the content (3).</p><p><img src="images/media_1278010330080_display_1.png" alt=""/></p><h4>Make Name Field Bold</h4><p>With the <em>Name</em> field still selected go the <strong>Text Formatting</strong> pane of the <strong>Property Inspector</strong> (1) and  change the <strong>Style</strong> to <strong>Bold</strong>(2).</p><p><img src="images/media_1278010452322_display.png" alt=""/></p><h4>Add Title Field</h4><p>Drag a label field from the Tools palette (1).</p><p><img src="images/media_1278010622403_display.png" alt=""/></p><p>Name it <em>Title</em> (2) and assign <em>Title</em> to the content (3).</p><p><img src="images/media_1278010622403_display_1.png" alt=""/></p><h4>Change Text Alignment</h4><p>Change the text alignment of the field to the left side using the <strong>TextFormatting</strong> pane of the <strong>Property Inspector</strong>.</p><p><img src="images/media_1278010671679_display.png" alt=""/></p><h4>Add an Image and Resize the Background Graphic</h4><p><img src="images/Add_An_Image_and_Resize_The_Background_Graphic_display.png" alt=""/></p><p>Now drag an image object into the group using the <strong>Tools palette</strong> (1).With the image selected, select the <strong>Position</strong> pane on the <strong>Property Inspector</strong> (2) and set the <strong>width</strong> and <strong>height</strong> of the image to 48 pixels (3). Also check the <strong>Lock size and position</strong> checkbox (4) so that any image is scaled to fit within these bounds.</p><p>Finally, select the <strong>Background</strong> graphic (5) and resize it so that it frames the other controls. In the example stack the <strong>width</strong> of the graphic is 214 and the <strong>height</strong> is 56.</p><h4>Stop Editing the Row Template Group</h4><p><img src="images/media_1278011030380_display.png" alt=""/></p><p>You are now done adding the UI objects to the row template group. Fromthe <strong>Object</strong> menu (1), select <strong>Stop Editing Group</strong>. You can then <strong>Close</strong> and <strong>Save</strong> the <strong>row template</strong></p><h4>Edit the Row Behavior</h4><p>Now that you have designed the controls for each row you need to writethe script that will move data into the controls and position them onthe screen.</p><p><img src="images/media_1278011291637_display.png" alt=""/></p><p>Click on the <strong>Edit Script</strong> button in the <strong>Property Inspector</strong> under <strong>Row Behavior</strong>to begin editing the row behavior script.</p><h4>The FillInData Message</h4><p>In the script that opens when you click the Row Behavior button you willfind a command named <strong>FillInData</strong>. This is where you move data fromthe pDataArray parameter into the controls you created.</p><p><img src="images/media_1278011422961_display.png" alt=""/></p><p><em>pDataArray</em> is an array with the keys <em>FirstName</em>, <em>LastName</em>, <em>Name</em> and<em>Title</em>. The code that moves the values from the array into the UIcontrols is pretty straightforward.</p><ol><li>Assign the values of the <em>FirstName</em> and <em>LastName</em> keys to the <em>Name</em> field.</li><li>Assign the value of the <em>Title</em> key to the <em>Title</em> field.</li><li>Assign the value of the <em>Image URL</em> key to the <strong>filename</strong> property of the image control.</li></ol><p>You don&#39;t need to worry about positioning any of your controls in the<strong>FillInData</strong> command. You just need to write the code that assigns thedata to the UI controls.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on FillInData pDataArray--This message is sent when the Data Grid needs to populate-- this template with the data from a record. pDataArray is an-- an array containing the records data.-- You do not need to resize any of your template&#39;s controls in-- this message. All resizing should be handled in resizeControl.-- Example:set the text of field &quot;Name&quot; of me to pDataArray[&quot;LastName&quot;] &amp; \    comma &amp; space &amp; pDataArray[&quot;FirstName&quot;]set the text of field &quot;Title&quot; of me to pDataArray[&quot;Title&quot;]set the filename of image &quot;image&quot; of me to pDataArray[&quot;Image URL&quot;]end FillInData</code></pre><h4>The LayoutControl Message</h4><p>The <strong>LayoutControl</strong> message is where you position all of yourcontrols. For this template you begin by positioning the image (1). Nextyou extend the <em>Name</em> and <em>Title</em> fields to the edge of the image (2).Finally you resize the <em>Background</em> graphic to fill the entire rowrectangle.</p><p><img src="images/media_1278011761854_display.png" alt=""/></p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on LayoutControl pControlRect  local theFieldRect,theRect  -- This message is sent when you should layout your template&#39;s controls.  -- This is where you resize the &#39;Background&#39; graphic, resize fields and  -- position objects.  -- The first thing you should do is capture &#39;the rect of me&#39;.  -- For fixed height data grid forms you can use items 1 through 4 of the rect as  -- boundaries for laying out your controls.  -- For variable height data grid forms you can use items 1 through 3 of the rect as  -- boundaries.  -- Example:  set the right of image &quot;image&quot; of me to item 3 of pControlRect - 5  put the left of image &quot;image&quot; of me into theLeft  put the rect of field &quot;name&quot; of me into theRect  put theLeft - 10 into item 3 of theRect  set the rect of field &quot;Name&quot; of me to theRect  put the rect of field &quot;title&quot; of me into theRect  put theLeft - 10 into item 3 of theRect  set the rect of field &quot;Title&quot; of me to theRect  set the rect of graphic &quot;Background&quot; of me to pControlRectend LayoutControl</code></pre><h4>Set the Data of the Control</h4><p>This is an example of a handler that populates the data grid with databy setting the <strong>dgData</strong> property. The <strong>dgData</strong> property accepts amulti-dimensional array. The first dimensions is an integer representingthe row. The second dimension are the key/values you want to pass toeach row.</p><p>You can find this handler in the card script of the example stack.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>command uiPopulatePeople  put &quot;images/&quot; into theImageFolder  put &quot;Lucky&quot; into theDataA[1][&quot;FirstName&quot;]  put &quot;Day&quot; into theDataA[1][&quot;LastName&quot;]  put &quot;Three Amigo&quot; into theDataA[1][&quot;Title&quot;]  put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[1][&quot;Image URL&quot;]  put &quot;Dusty&quot; into theDataA[2][&quot;FirstName&quot;]  put &quot;Bottoms&quot; into theDataA[2][&quot;LastName&quot;]  put &quot;Three Amigo&quot; into theDataA[2][&quot;Title&quot;]  put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[2][&quot;Image URL&quot;]  put &quot;Ned&quot; into theDataA[3][&quot;FirstName&quot;]  put &quot;Nederlander&quot; into theDataA[3][&quot;LastName&quot;]  put &quot;Three Amigo&quot; into theDataA[3][&quot;Title&quot;]  put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[3][&quot;Image URL&quot;]  put &quot;Jane&quot; into theDataA[4][&quot;FirstName&quot;]  put &quot;Blue&quot; into theDataA[4][&quot;LastName&quot;]  put &quot;Secret Agent&quot; into theDataA[4][&quot;Title&quot;]  put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[4][&quot;Image URL&quot;]  put &quot;Jefferson&quot; into theDataA[5][&quot;FirstName&quot;]  put &quot;Blue&quot; into theDataA[5][&quot;LastName&quot;]  put &quot;Secret Agent&quot; into theDataA[5][&quot;Title&quot;]  put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[5][&quot;Image URL&quot;]  lock screen  set the dgData of group &quot;DataGrid 1&quot; to theDataA  ### Hilite first row  set the dgHilitedLines of group &quot;DataGrid 1&quot; to 1  unlock screenend uiPopulatePeople</code></pre><p>It is called by a button placed on the card <strong>Populate Data Grid</strong> with script</p><pre><code>on Mouseup  uiPopulatePeopleend Mouseup</code></pre><h4>The Result</h4><p>After calling the <strong>uiPopulatePeople</strong> command the Data Grid should looksomething like this (1).</p><p><img src="images/media_1278012099805_display.png" alt=""/></p><p>Once you have set the <strong>dgData</strong> property you can refresh the data grid tosee any of the changes made to the row template. You can send the<strong>ResetList</strong> message to the data grid, or press the <strong>Refresh DataGrid</strong> button on the Basic Properties pane of the <strong>Property Inspector</strong> (2)to redraw the data using the updated template.</p><h4>Troubleshooting: Row Height</h4><p>By default a data grid uses a fixed height for each row. If you have notset the row height the first time you populate the data grid with datathen the value that is current for the data grid may not be suitable. </p><p><img src="images/media_1237547039021_display.png" alt=""/></p><p>You can change the height of the row template by updating the <strong>row height</strong> in the <strong>Property Inspector</strong>.(1)</p><p><img src="images/media_1237547039021_display_1.png" alt=""/></p><p>Alternatively you could also simply uncheck the <strong>Empty row height</strong> property.(2)</p><p><img src="images/media_1237547039021_display_2.png" alt=""/></p><h2><a name="//apple_ref/cpp/Guide/Data Grid Fundamentals" class="dashAnchor"></a>Data Grid Fundamentals</h2><h3>What Is This &quot;Data Grid Templates&quot; Stack That Appeared in My Project?</h3><p>A data grid relies on record templates (forms) and column templates(tables) to display data. These templates are merely LiveCode controlsthat will be used to visualize your data. In order to manage thesecontrols the LiveCode IDE creates a stack named Data Grid Templates thefirst time you add a data grid to a card in your stack.</p><h4>Data Grid Templates Stack</h4><p>Open the <strong>Project Browser</strong> (from the <strong>Tools</strong> menu) and expand your stack by clicking on the &quot;+&quot; sign. Here you will see the newly created <strong>Data Grid Templates</strong> stack.</p><p><img src="images/Data_Grid_Templates_Stack_display.png" alt=""/></p><p>This stack (1) contains a single card (2) for each data grid you add to a stack.Each card contains the template(s) and behaviors that the data grid willuse to display the data.</p><h4>Data Grid Templates Card Contents</h4><p>This screenshot shows some controls that might appear on a Data GridTemplates card. The <strong>Row Template</strong> (1) is the group that contains eitherall of the controls for a form or the <strong>column templates</strong> for atable. The IDE assigns the <strong>Row Template</strong> group to the <strong>dgProps[&quot;row template&quot;]</strong> property of the data grid.</p><p><img src="images/Data_Grid_Templates_Card_Contents_display.png" alt=""/></p><p>The <strong>Behavior Script</strong> button is assigned as the behavior to the <strong>RowTemplate</strong> group and is used for data grid forms. This script controlshow data is inserted into the <strong>Row Template</strong> controls and how thosecontrols are positioned.</p><h4>Opening the Data Grid Templates Stack</h4><p>The LiveCode IDE makes it easy to locate your templates in the Data GridTemplates stack. Simply select the data grid control and click the <strong>RowTemplate...</strong> button (1) in the <strong>Data Grid</strong> (2) pane of theinspector.<img src="images/Opening_The_Data_Grid_Templates_Stack_display.png" alt=""/></p><p>The card containing the template(s) for the selected data grid will open.</p><p><img src="images/media_1236056276168_display.png" alt=""/></p><h3>What Is a Row Template?</h3><p>The reason a data grid can be customized is because it uses &quot;templates&quot;to represent data. A template is merely a Livecode group that will becopied and used to draw your data on the screen. When working with datagrid forms we refer to this group as a &quot;Row Template&quot;.  </p><h4>Row Template</h4><p><img src="images/Row_Template_display.png" alt=""/></p><p>The <strong>Row Template</strong> is a Livecode group control. This group representsa single record in the data that you are displaying in a data grid form.This group can contain any Livecode control and the look and layout areentirely controlled by you.</p><h4>How a Record Template Is Used</h4><p><img src="images/How_A_Record_Template_Is_Used_display.png" alt=""/></p><p>When the data grid form displays your data it copies the <strong>RowTemplate</strong> into itself. It makes just enough copies to cover the visiblearea and then inserts data into these copies of the <strong>Row Template</strong>. Asthe user uses the scrollbar to scroll through the data the same copiesare used but new data is inserted. This means that the data grid form isnever drawing more records than the user can actually see which meansthe data grid is fast.</p><h3>What Is a Column Template?</h3><p>Like data grid forms, data grid tables also use templates. Thedifference is that when working with a table you create a template torepresent each column rather than a template to represent each row. Werefer to these templates as <strong>Column Templates</strong>. A <strong>column template</strong> issimilar to a <strong>row template</strong>. One difference is that a <strong>column template</strong>is not limited to being a group. You can use a field for a template, agraphic, a button, etc.</p><h4>How a Column Template Is Used</h4><p><img src="images/How_A_Column_Template_Is_Used_display.png" alt=""/></p><p>When your data is drawn into a data grid table each <strong>column template</strong> iscopied into the data grid as many times as necessary in order to fillthe visible area. Data is then inserted into these templates as the userscrolls.</p><h3>How Do I Populate a Data Grid With Data?</h3><p>There are a couple of ways you can assign data to a data grid. This lessonwill show you how.</p><h4>Use The Property Inspector</h4><p><img src="images/datagrid-form-inspector-text.png" alt=""/></p><p>You can use the Contents pane of the <strong>Property Inspector</strong> to quicklyassign data to a data grid. This does not provide as many options assetting the properties mentioned below but it will get you up andrunning quickly.</p><ol><li>Switch to the <strong>Contents</strong> pane of the <strong>Property Inspector</strong>.</li><li>Enter some tab delimited text into the field.</li></ol><p>When you use the <strong>Property Inspector</strong> to assign data to the data grid the<strong>Property Inspector</strong> sets the <strong>dgText</strong> property of the data grid.</p><h4>Set the dgText Property</h4><p><img src="images/media_1239244946023_display.png" alt=""/></p><p>The data grid works with arrays behind the scenes but in the interest ofmaking life easier there is a <strong>dgText</strong> property. The syntax is as follows:</p><pre><code>set the dgText [ pFirstLineContainsHeaders ] of group &quot;Data Grid&quot; to pText</code></pre><p><em>pText</em> is assumed to be a collection of data where each row isdelimited by the return character and each item is delimited by a tab.You can map each item of each line in <em>pText</em> to a particular key in anarray (and thus a table column) by passing in true for<strong>pFirstLineContainsHeaders</strong>. If true then the data grid will extract thefirst line of <em>pText</em> and match the values for existing internal key/columnnames. The default value for <strong>pFirstLineContainsHeaders</strong> is false.</p><p>If you set the <strong>dgText</strong> of a <strong>data grid table</strong> then all data will beimported and assigned to the appropriate column depending on the valueof <strong>pFirstLineContainsHeaders</strong>. Normally you should set this property to<strong>true</strong> and provide the header that maps each item of each line to aspecific column. </p><blockquote><p><strong>Note:</strong> that if <strong>pFirstLineContainsHeaders</strong> is true then the named columns must <strong><em>already</em></strong> exist in your data grid table in order to be displayed. Setting <strong>pFirstLineContainsHeaders</strong> to <strong>true</strong> does not create the headers for you.</p></blockquote><p>If <strong>pFirstLineContainsHeaders</strong> is false then the <strong>columns</strong> property of thedata grid is used for mapping. For example, the first item of a line of<em>pText</em> would be assigned to the column that appears on the first linein the <strong>columns</strong> property of the data grid. If line 1 of <em>pText</em>contains more items than there are columns in the table then new columnsare added. Any new columns are named &quot;Col 1&quot;, &quot;Col 2&quot;, etc.</p><p>If you set the <strong>dgText</strong> property of a <strong>data grid form</strong> then the datawill be imported but it is up to you to modify your <strong>Row TemplateBehavior</strong> to display the imported data correctly. If<strong>pFirstLineContainsHeaders</strong> is <strong>false</strong> then each item of each line in<em>pText</em> will be named &quot;Label X&quot; (where X is the item number) in thearray that is passed to <strong>FillInData</strong>.</p><h4>Set the dgData Property</h4><p><img src="images/media_1238000479771_display.png" alt=""/></p><p>The <strong>dgData</strong> property of a data grid is a multi-dimensional array and isthe actual format that the data grid works with under the hood. The datagrid expects the first dimension of the array to be integers. The numberof keys in the first dimension represents the number of records beingdisplayed in the data grid. Here is an example with five records:</p><pre><code>theDataA[1]theDataA[2]theDataA[3]theDataA[4]theDataA[5]</code></pre><p>You then store all of your custom data in the second dimension. Thefollowing is how you would display five records, each with a <strong>Name</strong>property:</p><pre><code>theDataA[1][&quot;Name&quot;]theDataA[2][&quot;Name&quot;]theDataA[3][&quot;Name&quot;]theDataA[4][&quot;Name&quot;]theDataA[5][&quot;Name&quot;]</code></pre><p>In the example code above there are 5 records, each with a <strong>FirstName</strong>,<strong>LastName</strong> and <strong>Title</strong> property. Your templates will have access tothese properties when the time comes to draw the data on the screen.</p><blockquote><p><strong>Important:</strong> if you are using a data grid table then a key in thearray must match the name of a column in the table in order for that variable (column)to be displayed. So if you have a column named <em>Image URL</em> in your table youmust have a corresponding key named <em>Image URL</em>:</p></blockquote><pre><code>theDataA[1][&quot;Image URL&quot;]</code></pre><h3>How Do I Customize a Form&#39;s Row Template?</h3><p>When you drop a data grid from the <strong>Tools palette</strong> onto a card a recordtemplate is created for you automatically.  This template will displayline delimited text but you will most likely want to customize thetemplate. This lesson will show you how to begin customizing thetemplate to meet your needs.</p><h4>Reveal the Row Template</h4><p><img src="images/media_1238098827623_display.png" alt=""/></p><p>Select the data grid (1) and open the <strong>Property Inspector</strong> (2). Click on the <strong>RowTemplate...</strong> button (3) to open the card that the data grid&#39;s template ison.</p><p><img src="images/media_1238098894025_display.png" alt=""/></p><p>The template for the data grid will open. You can now edit the controlswithin the <strong>Row Template</strong> group in order to customize the look andfeel according to your needs.</p><h4>Example of a Customized Template</h4><p><img src="images/media_1238098972256_display.png" alt=""/></p><p>Here is an example of a customized template. A <em>Name</em> (1) and <em>Title</em>field (2) have been added as well as a control for displaying a picture of the person(3).</p><h4>Edit Behavior</h4><p><img src="images/media_1278011291637_display.png" alt=""/></p><p>After customizing the controls in your template you need to update the<strong>behavior</strong> associated with the template. The behavior script is whereyou tell the data grid what data goes in which controls as well as howto position the controls.</p><p>Click the <strong>Edit Script...</strong> button to open the behavior script.</p><h4>Edit the Behavior Script</h4><p><img src="images/media_1238099074165_display.png" alt=""/></p><p>The default behavior script contains comments explaining what to do ineach handler. The <strong>FillInData</strong> message is where you will move data from arecord into a LiveCode control. To do this you assign keys of <em>pDataArray</em>(1) to a control (2).</p><p>Note that the first parameter passed to <strong>FillInData</strong> is an arrayrepresenting the current row being displayed. Also note how this isdifferent than the first parameter passed to <strong>FillInData</strong> for a<strong>column template</strong> which is the value of the column.</p><blockquote><p><strong>Important:</strong> Make sure that you always refer to controls in thetemplate using <strong><em>of me</em></strong> (3). Since multiple copies of the template willbe made you will have multiple controls with the same names. Using <strong><em>of me</em></strong> removes any ambiguity and ensures that data is displayed in thecorrect control.</p></blockquote><h4>An Example of a Customized Behavior</h4><p><img src="images/media_1238100174053_display.png" alt=""/></p><p>This is an example of a behavior that has been customized. The <strong>dgData</strong> ofthe data grid this template is associated with looks like this:</p><pre><code>theDataA[1][&quot;FirstName&quot;]theDataA[1][&quot;LastName&quot;]theDataA[1][&quot;Title&quot;]theDataA[2][&quot;FirstName&quot;]theDataA[2][&quot;LastName&quot;]theDataA[2][&quot;Title&quot;]</code></pre><p>When filling in the data the <em>FirstName</em> and <em>LastName</em> values are placed into a <em>Name</em> field (1) and the <em>Title</em> value into a <em>Title</em> field (2).</p><p>This example also shows how to use <strong>LayoutControl</strong> to layout your <strong>rowtemplate</strong>. Notice how the rectangle of the <strong>row template</strong> is captured at thebeginning (3) and then used to position all of the other elements (4).</p><h3>How Do I Customize a Table&#39;s Columns?</h3><p>A <strong>column template</strong> is nothing more than a LiveCode control that is namedafter a column in your table. This control is located in the <strong>rowtemplate</strong> group for your data grid. This lesson will discuss how tocreate templates for columns in a data grid table.</p><h4>Use Property Inspector to Create a Column Template</h4><p><img src="images/media_1238002014733_display.png" alt=""/></p><p>In the <strong>Property Inspector</strong>, select the column you would like to customize(1). Click the &quot;+&quot; button at the bottom of the pane to create a <strong>columntemplate</strong> (2).</p><p><img src="images/media_1238002031307_display.png" alt=""/></p><h4>Edit the Row Template Group</h4><p><img src="images/media_1238002170294_display.png" alt=""/></p><p>In order to customize the look you need to edit the contents of thetemplate group. Select it (1) and click <strong>Edit Group</strong> (2) in the LiveCodetoolbar.</p><h4>Edit Column Group</h4><p><img src="images/media_1238002156173_display.png" alt=""/></p><p>Now select the column group (1) and click <strong>Edit Group</strong> again (2). Atthis point you can customize what controls appear in the column template.</p><h4>A Column Template</h4><p><img src="images/media_1236271024680_display.png" alt=""/></p><p>In this example there are three controls for three differentcolumns in the data grid table.</p><p>** A field named <em>Time</em> that formats data into a time format (1) (Just rename the field that is included in the row template by default).** A group named <em>My Rating</em>. This group has some widgets that display images of a star. (2)** A button named <em>Genre</em> that offers different Genre selections. (3)</p><p>Here is what those controls look like in the <strong>Project Browser</strong>. Noticehow all of the controls are located in the <strong>Row Template</strong> group.</p><h4>Supporting Controls</h4><p><img src="images/media_1238002344589_display.png" alt=""/></p><p>The controls created (*Time* field, <em>Genre</em> button and <em>My Rating</em>group) each have behaviors associated with them. These were created automatically and are stored in appropriately named buttons.</p><h4>Behavior Example</h4><p><img src="images/media_1238002391039_display.png" alt=""/></p><p>Here is what the <strong>FillInData</strong> handler looks like for the <em>My Rating</em> column (as stored in the <strong>My Rating Behaviour</strong> button). <em>pData</em> (1) contains the value of the <em>My Rating</em> column for the row being displayed. </p><p>Note how this parameter differs than the parameter sent to <strong>FillInData</strong> for a <strong>row template</strong>. For a <strong>row template</strong> the parameter passed in is an array.</p><p>You then use that value to determine how many stars to display (2).</p><h4>Result</h4><p><img src="images/media_1236272022940_display.png" alt=""/></p><p>Here is what the table looks like now that the custom column templates have been defined. The table found controls named <em>Genre</em>, <em>Time</em> and <em>MyRating</em> in the record template group so those were used to render thedata for those three columns.</p><h2><a name="//apple_ref/cpp/Guide/Working With Data Grids (Forms &amp; Tables)" class="dashAnchor"></a>Working With Data Grids (Forms &amp; Tables)</h2><h3>How Do I Determine the Selected Line?</h3><h4>The dgHilitedLines Property</h4><p><img src="images/media_1238000737113_display.png" alt=""/></p><p>You can get the selected line or lines of a data grid using the <strong>dgHilitedLines</strong> property.</p><h4>Determining the Line in a Row&#39;s Behavior</h4><p>If we need to determine the line number of a row&#39;s behavior script wecan access the <strong>dgLine</strong> property of the row template. The data gridautomatically assigns the <strong>dgLine</strong> and the <strong>dgIndex</strong> property whendisplaying the row.</p><p><img src="images/media_1238000671040_display.png" alt=""/></p><blockquote><p><strong>Note:</strong> that the use of <strong><em>of me</em></strong> (1) can be used because the <strong>mouseDown</strong>handler is in the <strong>row template</strong> group behavior script (which is as if thescript were in the <strong>row template</strong> group itself). If you were to put the<strong>mouseDown</strong> handler in the script of a button that was located in the rowtemplate group then you would have to use <strong><em>of the dgControl of me</em></strong>instead.</p></blockquote><h3>How Do I Get Data Associated With a Row or Column?</h3><p>This lesson will show you how to get the array of data associated with arow in a Data Grid form as well as how to get the data associated with arow&#39;s column in a Data Grid table.</p><p>To get the array of data from a Data Grid you can use one of thefollowing properties:</p><p>• the <strong>dgDataOfIndex</strong></p><p>• the <strong>dgDataOfLine</strong></p><p>Both properties return the array associated with a row in the Data Grid,they just allow you to target the row differently. <strong>dgDataOfLine</strong> allowsyou to target the row in the order it appears visually in the Data Grid.<strong>dgDataOfIndex</strong> allows you to target a row based on the internal indexnumber that the Data Grid uses to identify the row. This value does notchange, even if you change the sort order for the Data Grid.</p><p>If you just need a particular column from a row then you can use one ofthe following functions:</p><p>• <strong>GetDataOfIndex</strong>()</p><p>• <strong>GetDataOfLine</strong>()</p><p>Both of these functions return the value associated with a particularkey, or column, for a row.</p><p>Let&#39;s look at some examples of how to use these properties andfunctions.</p><h4>Getting Data Associated With the Selected Row</h4><p><img src="images/media_1247571008922_display.png" alt=""/></p><p>If you want to get the data associated with the selected row use the<strong>dgHilitedLines</strong> property. The value of that property can be used inconjunction with the <strong>dgDataOfLine</strong> property. Here is an example of ascript that could be placed in a button. The Data Grid group script isNOT in the message path for this example:</p><pre><code>on mouseUp pBtnNum  if pBtnNum is 1 then    put the dgHilitedLines of group &quot;DataGrid 1&quot; into theLine    put the dgDataOfLine[theLine] of group &quot;DataGrid 1&quot; into theDataA    ## theDataA is now an array variable.    ## In the case of the Data Grid pictured above the keys of the     ## array are id, FirstName, LastName and Title.    ## This answer dialog will display: Dusty Bottoms    answer theDataA[&quot;FirstName&quot;] &amp;&amp; theDataA[&quot;LastName&quot;]  end ifend mouseUp</code></pre><p>Now let&#39;s assume that you only want to get the <strong>id</strong> value for theselected row without fetching the entire array. You can use<strong>GetDataOfLine</strong> to accomplish this. You need to keep in mind that<strong>GetDataOfLine</strong> (and <strong>GetDataOfIndex</strong>) is a function defined for a DataGrid. That means that the Data Grid group <strong><em>MUST</em></strong> be in the message path.If the Data Grid group is not in the message path you would need to usethe <strong>call</strong> command.</p><p>To illustrate how to use <strong>GetDataOfLine</strong> let&#39;s look at how you coulddefine your own custom property for a Data Grid. The following codedefines a <strong>uSelectedID</strong> custom property that returns the <strong>id</strong> of theselected row. This code would be placed in the Data Grid group script.</p><pre><code>getProp uSelectedID  put the dgHilitedLines of me into theLine  return GetDataOfLine(theLine, &quot;id&quot;)end uSelectedID</code></pre><p>You can now access this custom property from any script in yourapplication:</p><pre><code>put the uSelectedID of group &quot;DataGrid&quot; into theSelectedID</code></pre><h4>Getting Data When the Selection Changes</h4><p>When the user makes a new selection in a Data Grid the <strong>selectionChanged</strong>message is sent to the Data Grid. The following <strong>selectionChanged</strong> messagecould appear in the script of your Data Grid group:</p><pre><code>-- example that would be placed in the data grid script.on selectionChanged pHilitedIndex, pPrevHilitedIndex  put the dgDataOfIndex [ pHilitedIndex ] of me into theDataA  ## Now call handler in card script that loads info for selected person.  uiViewRecordOfID theDataA[&quot;id&quot;]end selectionChanged</code></pre><h4>Getting Data in a Row Behavior</h4><p><img src="images/media_1237839849843_display.png" alt=""/></p><p>If you want to get the data in a <strong>row behavior</strong> script you can use the<strong>dgIndex</strong> or <strong>dgLine</strong> custom properties of the row control. Here is anexample that could be used in a Data Grid&#39;s <strong>form</strong> behavior script:</p><pre><code>##Data Grid Row behavior scripton mouseUp pMouseBtnNum  if pMouseBtnNum is 1 then    ## the dgIndex is a custom property of this row.    ## the dgControl is a custom property of the data grid itself.    put the dgDataOfIndex[ the dgIndex of me] of the dgControl of me into theDataA    uiViewRecordOfID theDataA[&quot;id&quot;]  end ifend mouseUp</code></pre><p>If you wanted to move this same <strong>mouseUp</strong> code into the Data Grid scriptitself then you would change the <strong><em>me</em></strong> references to <strong><em>target</em></strong> and add acheck to ensure that the user clicked on a row. This example also uses<strong>GetDataOfIndex</strong> rather than <strong>dgDataOfIndex</strong> to show an alternative.</p><pre><code>##Data Grid Form Example: Data Grid Scripton mouseUp pMouseBtnNum  if pMouseBtnNum is 1 then    ## the dgIndex is a custom property of the row.    put the dgIndex of the target into theIndexThatWasClickedOn    if theIndexThatWasClickedOn is not empty then      put GetDataOfIndex(theIndexThatWasClickedOn, &quot;id&quot;) into theID      uiViewRecordOfID theID    end if  end ifend mouseUp</code></pre><h4>Getting Data in a Column Behavior</h4><p><img src="images/media_1262102060634_display.png" alt=""/></p><p>If you want to get the data in a column behavior script you can use the<strong>dgIndex</strong> or <strong>dgLine</strong> and <strong>dgColumn</strong> custom properties of the column control.Here is an example that could be used in a Data Grid column behaviorscript:</p><p><strong><em>Data Grid Table Example: Column Behavior</em></strong></p><pre><code>on mouseUp pMouseBtnNum  if pMouseBtnNum is 1 then  ## the dgIndex is a custom property of the row.  ## the dgColumn is a custom property of the column.    put GetDataOfIndex(the dgIndex of me, the dgColumn of me) into theColumnValue    ## Do something with column value..  end ifend mouseUp</code></pre><p>If you wanted to move this same <strong>mouseUp</strong> code into the Data Grid scriptitself then you would change the <strong><em>me</em></strong> references to <strong><em>target</em></strong> and add acheck to ensure that the user clicked on a column:</p><p><strong><em>Data Grid Table Example: Data Grid Script</em></strong></p><pre><code>on mouseUp pMouseBtnNum  if pMouseBtnNum is 1 then    ## the dgIndex is a custom property of the row.    ## the dgColumn is a custom property of the column.    put the dgColumn of the target into theColumn    if theColumn is not empty then ## User clicked on a column      put GetDataOfIndex(the dgIndex of the target, theColumn) into theColumnValue      ## Do something with column value..    end if  end ifend mouseUp</code></pre><h3>How Do I Add a Row of Data to an Existing Data Grid?</h3><p>Sometimes you may want to add a row of data to a Data Grid withouthaving to set the <strong>dgData</strong> or <strong>dgText</strong> property. You can add a single row ofdata by calling the <strong>AddData</strong> or <strong>AddLine</strong> commands of a Data Grid.</p><h4>Using AddData</h4><p>To use <strong>AddData</strong> you create an array containing the values for the newrow. Here is an example of how to add a new row and have it appear asline 1 in a Data Grid. </p><blockquote><p><strong>Note:</strong> This example script resides outside of the DataGrid group script so <strong>AddData</strong> is not in the message path. This is why thedispatch command is used.</p></blockquote><pre><code>put &quot;First Name&quot; into theDataA[&quot;FirstName&quot;]put &quot;Last Name&quot; into theDataA[&quot;LastName&quot;]put &quot;Title&quot; into theDataA[&quot;Title&quot;]put  1 into theLineNodispatch &quot;AddData&quot; to group &quot;DataGrid&quot; with theDataA, theLineNoput the result into theNewIndex -- integer if successful, error string otherwise</code></pre><p><img src="images/media_1256565520707_display.png" alt=""/></p><h4>Using AddLine</h4><p>To use <strong>AddLine</strong> you create a tab delimited string of text containingthe values for the new row. You also need to tell the Data Grid thenames of the columns that the data should map to. Here is an example ofhow to add a new row and have it appear as the last line in a Data Grid.</p><pre><code>put &quot;First Name&quot; &amp; tab &amp; &quot;Last Name&quot; &amp; tab &amp; &quot;Title&quot; into theRowDataput &quot;FirstName&quot; &amp; cr &amp; &quot;LastName&quot; &amp; cr &amp; &quot;Title&quot; into theDataColumnsput the dgNumberOfLines of me + 1 into theLineNoAddLine theRowData, theDataColumns, theLineNo</code></pre><blockquote><p><strong>Note:</strong> This example script resides inside the Data Grid group script so <strong>AddLine</strong> is in the message path.</p></blockquote><p><img src="images/using_addLine_display.png" alt=""/></p><h4>Scrolling Data Into View and Getting the Data Control</h4><p>After you add the data to the Data Grid you may want to scroll the newrow into view. You can call <strong>ScrollIndexIntoView</strong> or<strong>ScrollLineIntoView</strong> to do this.</p><pre><code>ScrollIndexIntoView theNewIndex</code></pre><p>or</p><pre><code>ScrollLineIntoView theLineNo</code></pre><h3>How Do I Update Data in a Row?</h3><p>This lesson will show you how to update data in a row.</p><h4>Updating a Row&#39;s Data and Refresh Data Grid Automatically</h4><p>You can update data in a row by setting the <strong>dgDataOfIndex</strong> or<strong>dgDataOfLine</strong> properties. You can set either property to an arraycontaining the values for the row.</p><pre><code>put &quot;New First Name&quot; into theDataA[&quot;FirstName&quot;]put &quot;New Last Name&quot; into theDataA[&quot;LastName&quot;]put &quot;New Title&quot; into theDataA[&quot;Title&quot;]set the dgDataOfIndex[ the dgHilitedIndex of group &quot;DataGrid&quot; ] \     of group &quot;DataGrid&quot; to theDataA</code></pre><p><img src="images/datagrid_row_update_display.png" alt=""/></p><p>The data grid will now refresh with the new data you assigned to thehighlighted index.</p><h4>Updating a Row&#39;s Data Without Refreshing the Data Grid</h4><p>If you want to update the data in a row without automatically refreshingthe data grid then you can use <strong>SetDataOfIndex</strong>. You can then use the<strong>RefreshList</strong> command to redraw the data grid.</p><p>Example that sets all values at once:</p><pre><code>put &quot;New First Name&quot; into theDataA[&quot;FirstName&quot;]put &quot;New Last Name&quot; into theDataA[&quot;LastName&quot;]put &quot;New Title&quot; into theDataA[&quot;Title&quot;]dispatch &quot;SetDataOfIndex&quot; to group &quot;DataGrid&quot; \with the dgHilitedIndex of group &quot;DataGrid&quot;, empty, theDataAdispatch &quot;RefreshIndex&quot; to group &quot;DataGrid&quot; with the \    dgHilitedIndex of group &quot;DataGrid&quot;</code></pre><p>Example that sets individual keys of the row one at a time:</p><pre><code>dispatch &quot;SetDataOfIndex&quot; to group &quot;DataGrid&quot; with the \    dgHilitedIndex of group &quot;DataGrid&quot;, &quot;FirstName&quot;, &quot;New First Name&quot;dispatch &quot;SetDataOfIndex&quot; to group &quot;DataGrid&quot; with the \    dgHilitedIndex of group &quot;DataGrid&quot;, &quot;LastName&quot;, &quot;New Last Name&quot;dispatch &quot;SetDataOfIndex&quot; to group &quot;DataGrid&quot; with the \    dgHilitedIndex of group &quot;DataGrid&quot;, &quot;Title&quot;, &quot;New Title&quot;dispatch &quot;RefreshIndex&quot; to group &quot;DataGrid&quot; with the \    dgHilitedIndex of group &quot;DataGrid&quot;</code></pre><h3>How Do I Clear Data From a Data Grid?</h3><p>Clearing the data out of a Data Grid is as easy as setting the <strong>dgData</strong>(or <strong>dgText</strong>) of the Data Grid to <strong>empty</strong>.</p><pre><code>set the dgData of group &quot;DataGrid&quot; to empty</code></pre><h3>How Do I Add a mouseDown Event to the Data Grid Without Breaking It?</h3><p>This lesson will show you how you to write your own <strong>mouseDown</strong> event in aData Grid without breaking the default Data Grid behavior. You need toknow how to do this when showing a contextual menu or if during the<strong>mouseDown</strong> event you want to use the data in the row the user clicked on.</p><p>When you add a <strong>mouseDown</strong> handler to a Data Grid you are intercepting amessage that the Data Grid normally handles. Doing so changes thebehavior of the Data Grid and you need to take that into account whencoding your <strong>mouseDown</strong> handler.</p><h4>What Doesn&#39;t Work</h4><p>If you were to place the following code in your Data Grid script youwould not get the result you were expecting. The reason is that theline that was clicked on would not be selected until after your popupmenu was displayed. Why? Because the Data Grid behavior script processes<strong>mouseDown</strong> AFTER the <strong>mouseDown</strong> handler you have defined in the Data Grid script itself.</p><pre><code>on mouseDown pMouseBtnNum  if pMouseBtnNum is 3 then    ## Oops! Line that user clicked on has not been selected since    ## Data Grid has not processed mouseDown yet. Contextual    ## menu won&#39;t target proper line.    popup button &quot;MyContextualMenu&quot;  end if  pass mouseDownend mouseDown</code></pre><h4>What Does Work: dgMouseDown</h4><p>In order to work around this the Data Grid wraps all <strong>mouseDown</strong>functionality in a handler named <strong>dgMouseDown</strong>. You can call thishandler in your code in order to get the expected results.</p><p>The following examples show how you can define a <strong>mouseDown</strong> handler in aData Grid script.  In the examples the line the user clicks on will beselected before the custom <strong>mouseDown</strong> code executes. Note that the <strong>mouseDown</strong> message is not passed after calling <strong>dgMouseDown</strong>. This would only repeat thecall to <strong>dgMouseDown</strong> which is not the desired behavior.</p><p><strong><em>Example: Contextual Menu</em></strong></p><pre><code>on mouseDown pMouseBtnNum  ## Let Data Grid process mouseDown and select row that was clicked on  dgMouseDown pMouseBtnNum  ## Now contextual menu will act on the proper line.  if pMouseBtnNum is 3 then    popup button &quot;MyContextualMenu&quot;  end if  ## Don&#39;t pass mouseDownend mouseDown</code></pre><p><strong><em>Example: Getting Value From Cell Clicked On (Data Grid table)</em></strong></p><pre><code>on mouseDown pMouseBtnNum  ## Let Data Grid process mouseDown and select row that was clicked on  dgMouseDown pMouseBtnNum  ## Get value of column clicked on. The column name can be accessed in the  ## dgColumn custom property of the column control (the target).  put GetDataOfIndex(the dgHilitedIndexes of me, the dgColumn of the target) into \      theColumnValue  ## Don&#39;t pass mouseDownend mouseDown</code></pre><h3>How Can I Store an Option Menu Value When the User Makes a Selection?</h3><p>This lesson will demonstrate how to update the data associated with arow in a data grid when the user makes a selection from an option menu.</p><h4>Example Data Grid</h4><p><img src="images/media_1239422115316_display.png" alt=""/></p><p>Here is the data grid we will be working with. <em>Col 2</em> has been given the name <em>Rating</em> and has been customized with an <strong>option menu</strong>. What we are going to do is update thedata associated with a row to reflect the selection the user makes inthe <strong>option menu</strong>.</p><h4>Edit Column Behavior</h4><p><img src="images/media_1239422153707_display.png" alt=""/></p><p>We need to customize the column behavior. From the <strong>Columns</strong> pane (1)in the <strong>Property Inspector</strong> select the <em>Rating</em> column (2) and then click the <strong>ColumnBehavior</strong> button (3).</p><h4>FillInData</h4><p><img src="images/media_1239422182841_display.png" alt=""/></p><p>In the <strong>FillInData</strong> handler we are setting the <strong>menuhistory</strong> based onthe value of <em>pData</em> that is passed in. As there is only a single button in the <em>Rating</em> column template, it can be referreed to as <strong><em>button 1 of me</em></strong>.</p><h4>menuPick</h4><p><img src="images/media_1239422596775_display.png" alt=""/></p><p>A <strong>menuPick</strong> handler needs to be added to the column behavior script inorder to accomplish the goal. When the user makes a selection from theoption menu the <strong>menuPick</strong> message is sent by the engine. The <strong>SetDataOfIndex</strong> command to can then update the value for the column.The parameters for <strong>SetDataOfIndex</strong> are the <strong>index</strong>, the <strong>column name</strong> andthe <strong>new value</strong>. Since the above script is in a column behavior we can usethe <strong>dgIndex of me</strong> (1) for the <strong>index</strong> and the <strong>dgColumn of me</strong> (2) for the<strong>column name</strong>.</p><h4>The Behavior in Action</h4><p>Here is what the data grid&#39;s internal array looks like before making amenu selection.</p><p><img src="images/media_1239422249334_display.png" alt=""/></p><p>After making a selection for row 2 (1) the internal value was updated (2).</p><p><img src="images/media_1239422260513_display.png" alt=""/></p><h3>How Do I Refresh a Data Grid After Making Changes to a Template Through Script?</h3><p>The command <strong>ResetList</strong> redraws a data grid after having copied in fresh copies of any templates. Here is an example of how you might use it.</p><pre><code>## Get reference to group that serves as row template for data gridput the dgProps[&quot;row template&quot;] of group &quot;DataGrid&quot; into theRowTemplate## For tables get reference to custom template for columnput the long id of group &quot;My Column&quot; of theRowTemplate into theColTemplate## Make any updates to templateset the text of button 1 of theColTemplate to &quot;New Option1&quot; &amp; cr &amp; &quot;New Option 2&quot;## Refresh the data griddispatch &quot;ResetList&quot; to group &quot;DataGrid&quot;</code></pre><p>Or you can simply issue it from the message box.</p><p><img src="images/datagrid_send_refresh_list.png" alt=""/></p><h3>How Do I Use a Template in Multiple Data Grids?</h3><p>If your application needs to use the same style of data grid in multipleplaces in your project then you can easily share the same row templatebetween multiple data grids. This lesson will show you how.</p><h4>Create First Data Grid</h4><p><img src="images/media_1240455722959_display.png" alt=""/></p><p>The first step is to create your first data grid and customize thetemplate (1). The data grid property that determines the <strong>RowTemplate</strong> that is used to draw the data grid is <strong>dgProps[&quot;rowtemplate&quot;]</strong>. The message box shows a query for this propertyin order to get a reference to the data grids row template (2).</p><h4>Create Other Data Grids</h4><p>Now you can add other data grids to your project. Here the second data grid is added to the same stack as the first. After adding the data grid you can set the <strong>dgProps[&quot;row template&quot;]</strong> property to the <strong>long id</strong> of the first data grid&#39;s <strong>row template</strong>. </p><p><img src="images/media_1240455973755_display.png" alt=""/></p><blockquote><p>You can also see that the <strong>Row Behavior</strong> for <em>datagrid 2</em> is listed as coming from the same template card as for the original <em>DataGrid 1</em> which was obtained in the previous step.</p></blockquote><p>Alternatively you could also do the following: (here we are setting the properties of a data grid in a second stack)</p><pre><code>set the dgProps[&quot;row template&quot;] of group &quot;DataGrid 1&quot; of stack &quot;Untitled 1&quot;\ to the dgProps[&quot;row template&quot;] of group &quot;DataGrid 1&quot; of stack &quot;my program&quot;</code></pre><blockquote><p><strong>Note:</strong> The LiveCode IDE creates a card in the <strong>Data Grid Template XXX</strong>stack with a <strong>row template</strong> every time you drag a data grid on to a card.You may want to delete this card if you aren&#39;t going to be using thattemplate.</p></blockquote><h4>Result</h4><p><img src="images/datagrid_setprops_two_stacks_1.png" alt=""/></p><p>See how the <strong>Row Behavior</strong> script (1) correctly identifies the template from the first stack (**Data Grid Sampler**) and how this indeed does contain the <strong>Row Template</strong> (2) being used in the second stack.</p><p><img src="images/datagrid_setprops_two_stacks_2.png" alt=""/></p><h3>How Can I See What the Data Grid&#39;s Internal Array Currently Looks Like?</h3><h4>Using PrintKeys</h4><p><img src="images/media_1239422249334_display.png" alt=""/></p><p>A data grid has a helper command that will print off the first line ofeach key in the internal data array. If you need to quickly see what theinternal array looks like just send <strong>PrintKeys</strong> to the data grid.This will print the array in the message box.</p><blockquote><p><strong>Note:</strong> You should not rely on <strong>PrintKeys</strong> for anything other than taking a quick peek at the array. It only prints the first line of each key so it is not a 100% accurate view of the data.</p></blockquote><h3>How Do I Get Aggregate Values for Columns?</h3><p>This lesson will show you how to add a custom property to a data gridthat returns the aggregate value of a column. Usually this would be usedwith data grid tables but works equally as well with data grid forms.</p><h4>Add a getProp to Your Data Grid Script</h4><p><img src="images/Add_A_getProp_To_Your_Data_Grid_Script_display.png" alt=""/></p><p>The simplest way to calculate aggregate values is to add a <strong>getProp</strong>handler to your data grid script. In this example a customproperty called <strong>uSumOfColumn</strong> (1) has been defined. Passing it a column name (2)returns the sum of all rows of that column (3).</p><h4>Using the Custom Property</h4><p><img src="images/Using_the_Custom_Property_display.png" alt=""/></p><p>Here is an example of using the custom property. When clicking on thebutton (1) the text of another field (in this case &quot;sum&quot;) is set to the <strong>uSumOfColumn</strong>custom property (2).</p><h4>The Result</h4><p><img src="images/The_Result_display.png" alt=""/></p><p>Here the result has been put into the <em>Sum</em> field.</p><h3>How Do I Determine if the Data Grid Has Focus?</h3><p>You can determine if the data grid has focus by performing the followingcheck:</p><pre><code>if the long id of group &quot;DataGrid&quot; is in the long id of the focusedobject then## Data grid has focusend if</code></pre><h3>How Do I Export Data From a Data Grid?</h3><p>This lesson will show you how to get data out of a data grid.</p><h4>The Example Data Grid</h4><p><img src="images/DataGrid_Sampler_Stack.png" alt=""/></p><p>The data will be exported from a data grid that looks like this.</p><h4>The Handler for Populating Data Grid</h4><pre><code>command uiPopulatePeople   put &quot;images/&quot; into theImageFolder   put &quot;Lucky&quot; into theDataA[1][&quot;FirstName&quot;]   put &quot;Day&quot; into theDataA[1][&quot;LastName&quot;]   put &quot;Three Amigo&quot; into theDataA[1][&quot;Title&quot;]   put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[1][&quot;Image URL&quot;]   put &quot;Dusty&quot; into theDataA[2][&quot;FirstName&quot;]   put &quot;Bottoms&quot; into theDataA[2][&quot;LastName&quot;]   put &quot;Three Amigo&quot; into theDataA[2][&quot;Title&quot;]   put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[2][&quot;Image URL&quot;]   put &quot;Ned&quot; into theDataA[3][&quot;FirstName&quot;]   put &quot;Nederlander&quot; into theDataA[3][&quot;LastName&quot;]   put &quot;Three Amigo&quot; into theDataA[3][&quot;Title&quot;]   put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[3][&quot;Image URL&quot;]   put &quot;Jane&quot; into theDataA[4][&quot;FirstName&quot;]   put &quot;Blue&quot; into theDataA[4][&quot;LastName&quot;]   put &quot;Secret Agent&quot; into theDataA[4][&quot;Title&quot;]   put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[4][&quot;Image URL&quot;]   put &quot;Jefferson&quot; into theDataA[5][&quot;FirstName&quot;]   put &quot;Blue&quot; into theDataA[5][&quot;LastName&quot;]   put &quot;Secret Agent&quot; into theDataA[5][&quot;Title&quot;]   put theImageFolder &amp; &quot;monkey.jpg&quot; into theDataA[5][&quot;Image URL&quot;]  lock screen  set the dgData of group &quot;DataGrid 1&quot; to theData  ## Hilite first row  set the dgHilitedLines of group &quot;DataGrid 1&quot; to 1  unlock screenend uiPopulatePeople</code></pre><p>This is the code that was used to populate the data grid. This shows youthe keys that each record has (*FirstName*, <em>LastName</em>, <em>Title</em> and <em>Image URL</em>).</p><h4>Export Handler</h4><pre><code> command uiExportData   ## Export data to XML   ## Get Data Grid Array   put the dgData of group &quot;DataGrid 1&quot; into theDataA   ## Get indexes in proper order   put the dgIndexes of group &quot;DataGrid 1&quot; into theIndexes   ## Prefix XML   put &quot;&lt;people&gt;&quot; &amp; cr into theXML   ## Loop through data, putting into XML format   repeat for each item theIndex in theIndexes      put &quot;&lt;person&gt;&quot; &amp; cr after theXML      put &quot;&lt;first_name&gt;&quot; &amp; theDataA[theIndex][&quot;FirstName&quot;] &amp; &quot;&lt;/first_name&gt;&quot; &amp; cr after theXML      put &quot;&lt;last_name&gt;&quot; &amp; theDataA[theIndex][&quot;LastName&quot;] &amp; &quot;&lt;/last_name&gt;&quot; &amp; cr after theXML      put &quot;&lt;title&gt;&quot; &amp; theDataA[theIndex][&quot;Title&quot;] &amp; &quot;&lt;/title&gt;&quot; &amp; cr after theXML      put &quot;&lt;/person&gt;&quot; &amp; cr after theXML    end repeat    ## Close root XML tag    put &quot;&lt;/people&gt;&quot; after theXML    put theXML end uiExportData</code></pre><p>This is an example of how to get data out of a data grid. Begin bygetting the <strong>dgData</strong> array and the <strong>dgIndexes</strong>. The indexes are a commadelimited list of the keys of the <strong>dgData</strong> in the proper order.</p><p>After you have the array and the ordered list of indexes you can loopthrough each record in the array. In this example the data is just wrapped in XML tags.</p><h4>Example Output</h4><p>This is what the output for this example looks like in the message box.</p><p><img src="images/media_1247315800246_display.png" alt=""/></p><h3>How Do I Work With Checkboxes in a Data Grid?</h3><p>This lesson will demonstrate how to associate the hilite state of acheckbox in a data grid with a row value in the data grid.</p><p><strong><em>Attached Files</em></strong></p><p><a href="http://lessons.livecode.com/s/lessons/files/303?lesson_id=26382">Checkbox_Example.livecode</a></p><h4>Adding a Checkbox to a Form</h4><p><img src="images/media_1278011173914_display.png" alt=""/></p><p>Before you begin, drag a data grid onto a stack and set the style to <strong>Form</strong> using the <strong>Property Inspector</strong>.</p><p>Click the <strong>Row Template</strong> button to open the template for the data grid.</p><h4>Edit Row Template Group</h4><p>Now that the card with the data grid row template is visible, open the<strong>Project Browser</strong> selecting the <strong>Tools &gt; Project Browser</strong>menu option.</p><p>Select the card with your template (it should be the second card underthe Data Grid Templates stack) (1). Next, double-click  the <strong>Row Template</strong>group on the card (2). Doing so will select the group on the card (3).</p><p><img src="images/media_1296743464605_display.png" alt=""/></p><p>Now select the <strong>Object &gt; Edit Group</strong> menu option. This will put thegroup in edit mode which will allow you to drag controls from the toolspalette into the group.</p><p><img src="images/media_1296743472921_display.png" alt=""/></p><h4>Add a Checkbox</h4><p>From the <strong>tools palette</strong>, drag a <strong>checkbox</strong> onto the card and place it inthe upper-left corner. The button will appear in the list of controls inthe <strong>Project Browser</strong>.</p><p><img src="images/media_1296743517047_display.png" alt=""/></p><h4>Edit Checkbox Properties</h4><p>Open the button&#39;s Property Inspector, select the <strong>Position</strong> pane and change the <strong>height</strong> to 21. Set the <strong>left</strong> and <strong>top</strong> properties to 0.</p><p><img src="images/media_1296743535342_display.png" alt=""/></p><h4>Delete the Label Field</h4><p>Now that you have added the checkbox button you no longer need the<em>Label</em> field in the row template. We will do this using the <strong>Project Browser</strong></p><blockquote><p><strong>Note:</strong> You need to stop editing the group before returning to the <strong>Project Browser</strong> in order for it to correctly update. Click on the card area under the <strong>checkbox</strong> and then click the <strong>Stop Editing</strong> button on the <strong>Toolbar</strong>. </p></blockquote><p><img src="images/datagrid_stop_editing_btn.png" alt=""/></p><blockquote><p>You may also need to <strong>collapse</strong> the card <strong>tree</strong> in the <strong>Project Browser</strong> window and reopen it to force the update to the <strong>Project Browser</strong> display.</p></blockquote><p>In the <strong>Project Browser</strong> select the <em>Label</em> field and delete it by pressing the <strong><em>delete</em></strong>  key on the keyboard.</p><p><img src="images/media_1296743546298_display.png" alt=""/></p><p>You will be asked to confirm you wish to delete this object. Check that it is identifying the correct object to delete, and then click <strong>OK</strong>.</p><p><img src="images/media_1296743555165_display_0.png" alt=""/></p><p>After deleting the field you should have only the <em>Background</em> graphic and the<em>Check</em> checkbox in the <strong>Row Template</strong> group.</p><p><img src="images/media_1296743555165_display.png" alt=""/></p><h4>Edit Row Behavior</h4><p>Next you need to edit the <strong>Row Behavior</strong> in order to take into accountthe new checkbox control.</p><p><img src="images/media_1278011291637_display.png" alt=""/></p><p>Click the <strong>Edit Script</strong> button.</p><h4>Edit the FillInData Handler</h4><p><img src="images/media_1296825944670_display.png" alt=""/></p><p>In the <strong>FillInData</strong> Handler you need to remove references to the <em>Label</em>field and add code for the <em>Check</em> button. The code will set the<strong>label</strong> of the checkbox to the <strong>label</strong> property of the data grid row.It will set the <strong>hilited</strong> property to the <strong>checked</strong> property of therow.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on FillInData pDataArray  -- This message is sent when the Data Grid needs to populate  -- this template with the data from a record. pDataArray is an  -- an array containing the records data.  -- You do not need to resize any of your template&#39;s controls in  -- this message. All resizing should be handled in resizeControl.  set the label of button &quot;Check&quot; of me to pDataArray[&quot;label&quot;]  set the hilited of button &quot;Check&quot; of me to pDataArray[&quot;checked&quot;]end FillInData</code></pre><h4>Update LayoutControl and ResetData</h4><p>The <strong>LayoutControl</strong> and <strong>ResetData</strong> handlers also have references to the <em>Label</em> field which no longer exists. Update both of those handlers with references to the <em>Check</em> button.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on LayoutControl pControlRect  local theFieldRect  -- This message is sent when you should layout your   -- template&#39;s controls.  -- This is where you resize the &#39;Background&#39; graphic,   -- resize fields and position objects.  -- For fixed height data grid forms you can use items 1   -- through 4 of pControlRect as boundaries for laying   -- out your controls.  -- For variable height data grid forms you can use   -- items 1 through 3 of pControlRect as boundaries,  -- expanding the height of your control as needed.  -- Example:  put the rect of button &quot;Check&quot; of me into theFieldRect  put item 3 of pControlRect - 5 into item 3 of theFieldRect  set the rect of button &quot;Check&quot; of me to theFieldRect  set the rect of graphic &quot;Background&quot; of me to pControlRectend LayoutControlon ResetData  -- Sent when data is being emptied because the control is   -- no longer being used to display data  set the text of button &quot;Check&quot; of me to empty  set the hilite of button &quot;Check&quot; of me to falseend ResetData</code></pre><h4>Update Data Grid Row Value When User Changes Checkbox State</h4><p>When the user clicks on the checkbox the hilited state will change. Youneed to update the row data in the data grid when this happens so thatthe <strong>dgData</strong> array properly represents what is being seen in theinterface. You can do this in the <strong>mouseUp</strong> handler of the behaviorscript.</p><p><img src="images/media_1296762637136_display.png" alt=""/></p><p>During <strong>mouseUp</strong> the hilited state of the checkbox has been changed and soit is safe to save the value. You just need to call <strong>SetDataOfLine</strong> andpass in <strong>the hilite of the target</strong> (the target being the checkboxbutton).</p><p>Add the following to the behavior script. Make sure and compile thescript afterwards.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on mouseUp pMouseBtnNum  if pMouseBtnNum is 1 then  ## did they click on the checkbox?    if the short name of the target is &quot;Check&quot; then      ## Update internal value in data grid      SetDataOfLine the dgLine of me, &quot;checked&quot;, the hilite \           of the target    end if  end ifend mouseUp</code></pre><h4>Populate the Data Grid</h4><p>You have now finished configuring the Data Grid so it is time to test.Add a button to the stack and name it <strong>Populate grid</strong>.</p><p><img src="images/media_1296743746869_display.png" alt=""/></p><p>With the <strong>Edit tool</strong> active, <strong><em>right-click</em></strong> on the button and select <strong>EditScript.</strong></p><p><img src="images/media_1296743753028_display.png" alt=""/></p><p>Add a simple script that will populate the data grid with two rows. Eachhas the <strong>label</strong> and <strong>checked</strong> properties that were referenced in thebehavior script earlier.</p><p><img src="images/media_1296743812938_display.png" alt=""/></p><p>Paste this script to the button script.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on mouseUp  put &quot;Line 1&quot; into theDataA[1][&quot;label&quot;]  put &quot;true&quot; into theDataA[1][&quot;checked&quot;]  put &quot;Line 2&quot; into theDataA[2][&quot;label&quot;]  put &quot;false&quot; into theDataA[2][&quot;checked&quot;]  set the dgData of group &quot;DataGrid 1&quot; to theDataAend mouseUp</code></pre><h4>Test</h4><p>After compiling the script, click on the <strong>Populate Grid</strong> button. Thecard should now look similar to this.</p><p><img src="images/media_1296743823448_display.png" alt=""/></p><p>Try it out. If you click on a checkbox in line 1 it should uncheck. Click on it again to check it.</p><h4>Checking/Unchecking All Checkboxes in a Data Grid</h4><p>When working with lists that have checkboxes it is nice to include theoption to check or uncheck all of the items in the list. Let&#39;s look athow to do that.</p><p>Add a button to the card and name it <strong>Check/Uncheck</strong>.</p><p><img src="images/media_1296744299512_display.png" alt=""/></p><p>Edit the script of the button.</p><p><img src="images/media_1296745339768_display.png" alt=""/></p><p>The code for checking/unchecking all items in the list isn&#39;t toocomplicated. Here is how the logic is broken up:</p><ol><li>Use the <em>checked</em> value of row 1 to decide what to set all of the other rows to. Get the current value of row 1 and toggle it.</li><li>Loop through all lines of the data grid, setting the value of the <strong>checked</strong> property of each row to the new value. Use <strong>SetDataOfLine</strong> as this command will not redraw the data grid each time it is called.</li><li>Finally refresh the data grid so that the new row values are used to display each row.</li></ol><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on mouseUp## Get Checked Value for 1st Row ##  dispatch function &quot;GetDataOfLine&quot; to group &quot;DataGrid 1&quot; with \      1,&quot;checked&quot;  put the result into theCheckedValue## Get inverse value of 1st row  put not theCheckedValue into theCheckedValue## Update all rows## SetDataOfLine does not redraw data grid  repeat with theLineNo = 1 to the dgNumberOfLines of \      group &quot;DataGrid 1&quot;    dispatch &quot;SetDataOfLine&quot; to group &quot;DataGrid 1&quot; with \          theLineNo, &quot;checked&quot;, theCheckedValue  end repeat## Update datagrid display  dispatch &quot;RefreshList&quot; to group &quot;DataGrid 1&quot;end mouseUp</code></pre><h4>Test</h4><p>Click the <strong>Check/Uncheck</strong> button to test. You should see thecheckboxes toggle between the checked and unchecked state.</p><p><img src="images/media_1296745349667_display.png" alt=""/></p><p>If you get the <strong>dgData</strong> or <strong>dgText</strong> property of the data grid then you willsee the proper values for the <em>checked</em> state of each row.</p><p><img src="images/media_1296745354985_display.png" alt=""/></p><h2><a name="//apple_ref/cpp/Guide/Working With Data Grid Tables" class="dashAnchor"></a>Working With Data Grid Tables</h2><h3>How Do I Change Column Alignment?</h3><h4>Using the Property Inspector</h4><p>Select the data grid and open the <strong>Property Inspector</strong>. Navigate to the<strong>Columns</strong> pane (1), select the column you want to modify (2), andchange the <strong>alignment</strong> (3).</p><p><img src="images/Using_the_Property_Inspector_display.png" alt=""/></p><h4>Using Script</h4><p><img src="images/media_1238000788633_display.png" alt=""/></p><p>You can change the <strong>alignment</strong> by setting the <strong>dgColumnAlignment</strong> for a column.</p><pre><code>set the dgColumnAlignment[&quot;Name&quot;] of group &quot;DataGrid&quot; to &quot;left&quot;</code></pre><h3>How Do I Sort by a Column?</h3><h4>Using the Property Inspector</h4><p>Select the data grid and open the <strong>Property Inspector</strong>. Navigate to the<strong>Columns</strong> pane (1), select the column you want to modify (2), andcheck the <strong>Sort by column</strong> checkbox (3). You can then adjust the sort options as you see fit.</p><p><img src="images/media_1236355926146_display.png" alt=""/></p><h4>Using Script</h4><p>You can sort by column setting the <strong>dgProp[&quot;sort by column&quot;]</strong> property ofthe data grid to the name of the column you want to sort by.</p><pre><code>set the dgProps[&quot;sort by column&quot;] of group &quot;DataGrid&quot; to &quot;Name&quot;</code></pre><p><img src="images/media_1238000827781_display.png" alt=""/></p><p>Similarly you can change other properties related to the sort by script too.</p><p><img src="images/media_1238000827781_display_0.png" alt=""/></p><p><img src="images/media_1238000827781_display_1.png" alt=""/></p><h3>How Do I Resize Columns?</h3><h4>Using the Property Inspector</h4><p><img src="images/media_1236356044111_display.png" alt=""/></p><p>Select the data grid and open the <strong>Property Inspector</strong>. Navigate to the<strong>Columns</strong> pane (1), select the column you want to modify (2), and set the<strong>width</strong> of the column using the <strong>Width</strong> text entry field (3).</p><h4>Using Script</h4><p>You can set the size of a column by setting the <strong>dgColumnWidth</strong> propertyfor the column to an integer.</p><pre><code>set the dgColumnWidth[&quot;Name&quot;] of group &quot;DataGrid&quot; to 150</code></pre><p><img src="images/media_1238000855537_display.png" alt=""/></p><h3>How Do I Override the Default Behavior for Rendering Data to a Cell?</h3><p>By default, a data grid table uses a single field object for each cellin a table and assigns the <strong>text</strong> property of that field to the cell&#39;sdata. This lesson will show you how to quickly create your own scriptthat determines how data is rendered in the default table cell. This canbe useful for rendering HTML and unicode text, trailing off text that istoo wide for a column or for coloring particular cells.</p><h4>Begin With a Data Grid Table</h4><p><img src="images/media_1239940153040_display.png" alt=""/></p><h4>Create a Button</h4><p>The <strong>default column behavior</strong> property can be set to a button. Thescript of the button will be used to fill in each cell in the table.</p><p>Drag a button onto the card and name it <strong>My Default Column Behavior.</strong></p><p><img src="images/My_Default_Column_Behavior.png" alt=""/></p><h4>Set the Script of the Button</h4><p><img src="images/media_1239940350693_display.png" alt=""/></p><p>When creating your own <strong>default column behavior</strong> it is a good idea tostart with the script that the data grid itself uses as the default. You can copythe data grid default script easily enough by selecting the button (1)and executing the following statement in the <strong>Message Box</strong> (2):</p><blockquote><p>Careful of continuation character &quot; \&quot;</p></blockquote><pre><code>set the script of selobj() to the script of button &quot;Default Column&quot; \    of stack &quot;revDataGridLibrary&quot;</code></pre><h4>Customize Behavior</h4><p><img src="images/media_1239940253589_display.png" alt=""/></p><p>Now this behavior can be customized. Here is what the default behavior looks like.</p><blockquote><p><strong>Important:</strong> If you decide to write a default behaviour script from scratch make sure to include the <strong>dgDataControl</strong> getProp handler. This is required in order for the data grid to work properly.</p></blockquote><pre><code>getprop dgDataControl   -- Required by library so that it can locate the control.   return the long ID of meend dgDataControl</code></pre><h4>Set &#39;Default Column Behavior&#39; Property</h4><p><img src="images/media_1239945029745_display.png" alt=""/></p><p>Now you can set the <strong>default column behavior</strong> property of the datagrid. Select the button (1) and execute the following in the <strong>Message Box</strong>(2):</p><blockquote><p><strong>Note:</strong> Careful of continuation character &quot; \&quot;</p></blockquote><pre><code>set the dgProps[&quot;default column behavior&quot;] of group &quot;DataGrid 1&quot; \   to the long id of selobj()</code></pre><p>Now it is time to customize your script!</p><h4>Example: Truncate Tail</h4><p><img src="images/media_1240836642399_display.png" alt=""/></p><p>The following example will show you how to truncate the tail end of everycell whose content is too wide to fit. The data grid provides a helpercommand named <strong>TruncateTail</strong> that takes the <strong>short id</strong> of a field and astring that signifies the text is being truncated. A call to<strong>TruncateTail</strong> has been added to the <strong>FillInData</strong> and <strong>LayoutControl</strong> handlers sothat cell contents are truncated when drawn or when a column is resized.</p><blockquote><p><strong>Note:</strong> <strong>TruncateTail</strong> works fairly well for most cases but can causevisual lag if there are lots of cells being displayed that use<strong>TruncateTail</strong>. You should test your data and table to make sure itperforms adequately for your needs.</p><p><strong>Quick Tip:</strong> You can determine the name of the column that is beingrendered by checking the <strong>dgColumn</strong> property. You could use thisproperty if you only wanted to truncate the text in certain columns:</p></blockquote><pre><code>switch the dgColumn of me  case &quot;Col 1&quot;  case &quot;Col 2&quot;  TruncateTail the short id of me, &quot;...&quot;  breakend switch</code></pre><h4>Refresh</h4><p>To see the results, click the <strong>Refresh Data Grid</strong> button in theProperty Inspector (1). Notice how cell contents are no truncated asneeded (2).</p><p><img src="images/media_1239945061329_display.png" alt=""/></p><h4>Example: Coloring Cells</h4><p><img src="images/media_1240836750153_display.png" alt=""/></p><p>This example will dim any cell that is empty. Since thedefault cell consists of a single field object this can be accomplished by setting the field&#39;s <strong>opaque</strong> to <strong>true</strong>, setting the <strong>backgroundcolor</strong> and changing the <strong>blendlevel</strong>.</p><h4>Result</h4><p>Deleting some entries in the data and click on the <strong>Refresh Data Grid</strong> button to see the result</p><p><img src="images/media_1240836803830_display.png" alt=""/></p><h3>How Do I Determine if a User Clicks in the Table Header?</h3><p>This lesson will show you how to determine if the user clicked in theheader of a Data Grid table by showing you how to use the<strong>dgHeaderControl</strong> and <strong>dgHeader</strong> properties of the target control that wasclicked on.</p><h4>The Table Header</h4><p><img src="images/media_1262013649551_display.png" alt=""/></p><p>A Data Grid table has a header where the column names are displayed (1).When a user clicks in the header with the mouse the <strong>dgHeader</strong> of thetarget returns the <strong>long id</strong> of the group control that contains all of theheader controls.</p><p>When the user clicks on a column header (2) the <strong>dgHeaderControl</strong> of thetarget returns the <strong>long id</strong> of the group control that contains all of thecolumn header controls.</p><p>####Example####</p><p><img src="images/media_1262013897208_display.png" alt=""/></p><p>Here is some sample code that prints off the <strong>dgHeaderControl</strong> and<strong>dgHeader</strong> properties when the user clicks on a Data Grid. Placethis script in the Data Grid script.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on mouseDown pBtnNum  put &quot;Column header control:&quot; &amp;&amp; the dgHeaderControl of the target \  &amp; cr &amp; cr &amp; &quot;Header control:&quot; &amp;&amp; the dgHeader of the targetend mouseDown</code></pre><p>After adding the script to the Data Grid the value of the<strong>dgHeaderControl</strong> and <strong>dgHeader</strong> properties are displayed in the <strong>Messagebox</strong>. In this example both properties return the <strong>long id</strong> of a control (1)because the click was on a column header (2) (*State* in this case.)</p><p><img src="images/media_1262013913672_display.png" alt=""/></p><p>In the following example only the <strong>dgHeader</strong> property returns the <strong>long id</strong> of acontrol (1) because even though the click was in the table header it was not on a columnheader (2).</p><p><img src="images/media_1262013925910_display.png" alt=""/></p><h3>How Do I Display a Contextual Menu When the User Clicks on a Column Header?</h3><p>####Overview####</p><p><img src="images/media_1262014965604_display.png" alt=""/></p><p>This lesson will show you how to display a contextual menu (1) when theuser clicks on a column header in a Data Grid table (2).</p><p>####The Code####</p><p><img src="images/media_1262015011787_display.png" alt=""/></p><p>Here is some LiveScript code that will display a contextual menu.The code is located in the Data Grid&#39;s script.</p><p>A contextual menu is displayed when during the <strong>mouseDown</strong> message whenthe user clicks with the right mouse button (1).</p><p>To determine if the user clicked on a column header you can checkwhether or not the <strong>dgHeaderControl</strong> property of the control that wasclicked on (**the target**) is empty (2). If the property is not empty thenyou know that the user clicked on a column header.</p><p>Once you know that the user clicked on a column header you can displaythe contextual menu. In this example the name of the column thatwas clicked on (3) is appended to &quot;Popup&quot; in order to get the name (*State Popup*) ofthe popup button to display (4).</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on mouseDown pBtnNum  ## Let Data Grid process mouseDown  dgMouseDown pBtnNum  if pBtnNum is 3 then    if the dgHeaderControl of the target is not empty then      ## the user clicked on a column header      ## Get column name      put the dgColumn of the target into theColumn      ## Get name of contextual button to use      put theColumn &amp;&amp; &quot;Popup&quot; into theContextualButtonName      ## Display contextual if exists      if there is a button theContextualButtonName then        popup button theContextualButtonName      end if    end if  end ifend mouseDown</code></pre><p>####The Result####</p><p><img src="images/media_1262015029410_display.png" alt=""/></p><p>Now when a <strong><em>right-click</em></strong> occurs on the State column the <em>State Popup</em> popupbutton is displayed as a contextual menu.</p><h3>What if I Need to Work With htmlText or rtfText?</h3><p>By default all table columns will have their <strong>text</strong> property assigned. Ifyou need to work with htmltext or rtftext then you need to provide your ownbehavior for the table columns.</p><h4>Option 1: Set the dgProp[&quot;Default Column Behavior&quot;] Property</h4><p>The simplest way to change the default behavior of table columns is toset the <strong>dgProp[&quot;default column behavior&quot;]</strong> property of the data grid. Youset this property to a <strong>button id</strong> whose script contains the behavior youwould like the columns to have. Doing this overrides the defaultbehavior provided by a button on the <strong>revDataGridLibrary</strong> stack.</p><pre><code>set the dgProp[&quot;default column behavior&quot;] of group &quot;DataGrid&quot; to the long id\ of button &quot;My Custom Column Behavior&quot; of stack &quot;MyStack&quot;</code></pre><p>Here is an example of a <strong>FillInData</strong> command that takes a column valueencoded as UTF-8 and sets the <strong>unicodetext</strong> of the column field.</p><p><img src="images/media_1236355544113_display.png" alt=""/></p><blockquote><p><strong>Important:</strong> If you decide to write your own default behaviour script make sure to include the <strong>dgDataControl</strong> getProp handler. This is required in order for the data grid to work properly.</p></blockquote><pre><code>getprop dgDataControl   -- Required by library so that it can locate the control.   return the long ID of meend dgDataControl</code></pre><p>To see the default column script the data grid uses enter the followingin the <strong>Message box</strong>:</p><pre><code>edit script of button &quot;Default Column&quot; of stack &quot;revDataGridLibrary&quot;</code></pre><h4>Option 2: Create a Custom Column Template</h4><p>Alternatively you can create your own custom column template for aparticular column. This allows you complete control over the look andfeel of the column. See section <a href="#how-do-i-customize-a-table&#x27;s-columns">How Do I Customize A Table&#39;s Columns?</a></p><h3>How Do I Display Line Numbers in a Table?</h3><p>This lesson will show you how to dynamically display line numbers inyour data grid table.</p><p>####The Table####</p><p><img src="images/media_1236794497421_display.png" alt=""/></p><p>Here is the table to display line numbers in.</p><p>####Add Line Number Column####</p><p><img src="images/media_1237998926249_display.png" alt=""/></p><p>Select the data grid and open its <strong>Property Inspector</strong>. Select the <strong>Columns</strong>pane (1) and add a column using the &quot;+&quot; button (2). Rename the column<strong>Line Number</strong> (3).</p><p>####Reorder and Create Column Template####</p><p><img src="images/media_1237999008350_display.png" alt=""/></p><p>Use the up arrow (1) to move the <strong>Line Number</strong> column to the top of thelist.</p><p>Create a template for this column by clicking on the &quot;+&quot; button at thebottom of the <strong>Property Inspector</strong> (2).</p><p>####Edit Line Number Group####</p><p><img src="images/media_1237999096660_display.png" alt=""/></p><p>After creating the column template the card with the template group willopen. As you can see a group called <strong>Line Number</strong>, corresponding to the column&#39;s name, has been created and within that group is a single field object.</p><p>We do not need to actually do anything to the template so simply <strong>close</strong> and <strong>save</strong> it when prompted.</p><p>####Edit Column Behavior####</p><p>Now all that is left is to define the behavior for this column. Go back tothe <strong>Columns</strong> pane of the data grid&#39;s <strong>Property Inspector</strong> and click the <strong>Column Behavior...</strong> button (1) to open its script editor.</p><p><img src="images/media_1237998709031_display.png" alt=""/></p><p>####Edit Behavior Script####</p><p><img src="images/media_1239247015389_display.png" alt=""/></p><p>There isn&#39;t much to do here. In <strong>FillInData</strong> you just want to (1):</p><pre><code>set the text of field 1 of me to the dgLine of me . </code></pre><p>The <strong>dgLine</strong> is a property of a <strong>row template</strong> and this will display the line number for the current line. In <strong>LayoutControl</strong> you just need to ensure the rect of the field fills the entire cell (2).</p><p>####Refresh Data Grid####</p><p><img src="images/media_1237998627031_display.png" alt=""/></p><p>In the <strong>Property Inspector</strong> click the Refresh Data Grid button.</p><p>####The Result####</p><p><img src="images/media_1236795107846_display.png" alt=""/></p><p>Now the line numbers appear in the table.</p><p>####But How Do I Set the dgText Then?####</p><p>You may be wondering how you would set the <strong>dgText</strong> property of this datagrid since we have added a <strong>Line Number</strong> column as the first column inthe table.</p><p>When you set the <strong>dgText</strong> of a data grid you can pass a parameterspecifying whether or not the first line of text contains the names ofthe columns that the data should map to. Just pass in true and prependthe column names to your data like this:</p><pre><code>put &quot;State&quot; &amp; tab &amp; &quot;State Code&quot; into theColNamesset the dgText [true] of group &quot;Data Grid&quot; to theColNames &amp; cr &amp; theData</code></pre><h3>How Do I Customize Column Sorting?</h3><p>This lesson will demonstrate how to customize sorting for columns byhandling the <strong>SortDataGridColumn</strong> message that is sent when the userclicks on a column.</p><p>####A Data Grid Table####</p><p><img src="images/media_1239310236534_display.png" alt=""/></p><p>The goal is to customize when happens when this table is sorted by the<strong>Line Number</strong> column.</p><p>####The Data Grid Group Script####</p><p>A Data Grid calls a built in handler <strong>SortDataGridColumn</strong> whenever the <strong>dgProps[&quot;sort by column&quot;]</strong> property is set. This includes when the user clicks on a column headerto sort that column. By placing a modified version of the <strong>SortDataGridColumn</strong> in the data grid&#39;s script this message can be captured and the behavior modified.</p><p>Place the following in the script for the data grid.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on SortDataGridColumn pColumn  switch pColumn  case &quot;Line Number&quot;     ## ReverseSort is a helper provided by the Data Grid.     ## It merely reverses the current sort.     ReverseSort pColumn ## pass in column so header is hilited     break  case &quot;State Code&quot;     ## Just provided as an example of how to prevent the user     ## sorting on a column. In this case the &quot;State Code&quot; column.     ## We accomplish this by NOT passing the message.     break  default     ## For all other cases, pass the message  so that the data grid     ## will be sorted based on column settings.     pass sortDataGridColumn  end switchend SortDataGridColumn</code></pre><p>The way the custom <strong>SortDataGridColumn</strong> handler works is simple. Passing the message willcause the data grid to use its default column sorting routines. (1) Set this as the <strong>Default</strong> case.</p><p>Not passing the message prevents the data grid from performing it own sorting(2) and (3).</p><p>In this example, clicking on the <strong>Line Number</strong> column will just reverse whatever current sort exists. This is done by calling <strong>ReverseSort</strong>, a built-in data grid helper that reverses whatever the current sort order is. (2)</p><p><img src="images/media_1239647097509_display.png" alt=""/></p><p>####The Result####</p><p>Clicking on the <strong>Line Number</strong> column (1) now reverses the sort.</p><p><img src="images/media_1239310720274_display.png" alt=""/></p><p>####Custom Sort Example####</p><p>Here is another example of a custom sort. Try it out and see if you can determine what it does.</p><pre><code>## Place in Data Grid script.## This example shows how to perform a custom sort of data. This is similar## to the internal routine that the data grid uses.on SortDataGridColumn pColumn  ## Begin by building a list of lines with two items (tab delimited)  ## The first item is the index of each record stored in the data grid.  ## The second item is the key you are going to sort on.  put the dgData of me into theDataA  repeat for each key theIndex in theDataA    put theIndex &amp; tab &amp; theDataA[theIndex][pColumn] &amp; cr after theData  end repeat  delete the last char of theData  set the itemdelimiter to tab  ## perform sort. Lookup the current sort direction for this column  ## and use that as sort direction  put the dgColumnSortDirection[pColumn] of me into theSortDirection  if theSortDirection is &quot;ascending&quot; then    sort lines of theData ascending by item 2 to -1 of each #  else    sort lines of theData descending by item 2 to -1 of each  end if  ## Rebuild the order of indexes in the data grid  put empty into theIndexSequencing  repeat for each line theLine in theData    put item 1 of theLine &amp; comma after theIndexSequencing  end repeat  delete the last char of theIndexSequencing  ## Set the dgIndexes property to new order  set the dgIndexes of me to theIndexSequencing  ## Tell data grid to hilite column  HiliteAndStoreSortByColumn pColumnend SortDataGridColumn</code></pre><h3>How Do I Disable Column Sorting?</h3><p>This lesson will show you how to disable column sorting in a Data Gridtable.</p><p>####Sort By No Column####</p><p>Notice in our example, the <strong>State</strong> column header is hilighted and there is a sorting arrow indicating an ascending sort.</p><p><img src="images/media_1264520254003_display.png" alt=""/></p><p>To begin, set the <strong>sort by column</strong> property to empty.This will remove any column sorting that might be active.</p><pre><code>set the dgProp[&quot;sort by column&quot;] of group &quot;DataGrid 1&quot; to empty</code></pre><p>Just copy and paste the above into the <strong>Message box</strong> to execute it.</p><p><img src="images/media_1264520291468_display.png" alt=""/></p><p>Your table headers should now appear the same, with no highlights orsorting arrow.</p><p>####Edit Data Grid Script####</p><p>Edit the Data Grid group script by <strong><em>right clicking</em></strong> on the Data Grid andselecting <strong>Edit Script.</strong></p><p><img src="images/media_1264520303976_display.png" alt=""/></p><p>####Add SortDataGridColumn Handler####</p><p><img src="images/media_1264520327900_display.png" alt=""/></p><p>When the user clicks on a table column header the <strong>SortDataGridColumn</strong>message is sent to the Data Grid. Intercepting this message and notpassing it effectively disables sorting. For more informationabout how <strong>SortDataGridColumn</strong> works see <a href="#how-do-i-customize-column-sorting">How Do I Customize Column Sorting?</a>.</p><p>Add the following code to your Data Grid group script and compile.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>on SortDataGridColumn pColumnend SortDataGridColumn</code></pre><p>Now when you click on the table header the data will not be sorted.</p><p><img src="images/media_1264520358754_display.png" alt=""/></p><blockquote><p><strong>Note:</strong> Once you add the <strong>SortDataGridColumn</strong> handler to a Data Grid settingthe <strong>dgProp[&quot;sort by column&quot;]</strong> property will no longer do anything. If youneed to set the <strong>sort by column</strong> property later on you would need toremove the <strong>SortDataGridColumn</strong> handler from the script, or at least <strong>pass</strong>the message.</p></blockquote><h3>How Do I Perform an Action After the User Sorts a Data Grid?</h3><p>This lesson will show you how to modify a data grid script so that youcan perform an action whenever a data grid is sorted.</p><p>####Add SortDataGridColumn To Data Grid Group Script####</p><p>You can customize what happens when a data grid is sort by adding a<strong>SortDataGridColumn</strong> handler to your data grid&#39;s script. For moreinformation about howSortDataGridColum works please see the lesson<a href="#how-do-i-customize-column-sorting">How Do I Customize Column Sorting?</a>.</p><p>In order to perform an action AFTER the sort has been applied you simplyneed to call the handler the Data Grid behavior uses to sort but NOTpass the <strong>SortDataGridColumn</strong> handler. Doing so sorts the data just likethe Data Grid would and then perform any additional actions you wouldlike.</p><pre><code>## Place in Data Grid script.   on SortDataGridColumn pColumn## Call Data Grid sort routine by hand  SortByColumn pColumn   ## Now data has been sorted, do whatever you need to do.    -- my code    .....    .....   ## DON&#39;T PASS the &quot;SortDataGridColumn&quot; message!end SortDataGridColumn</code></pre><h3>How Do I Align Decimals in a Column?</h3><p>This lesson will show you how to create a custom column template thatprovides decimal alignment. You can <a href="%5Bhttp://www.bluemangolearning.com/download/revolution/tools/datagrid_decimal_align.zip%5D">download the stack</a> used to create this lesson.</p><p>####Create a Data Grid Table####</p><p><img src="images/media_1240457118727_display.png" alt=""/></p><p>####Add Some Data####</p><p><img src="images/media_1240457166121_display.png" alt=""/></p><p>Here a couple of rows of decimal numbers have been added to experiment with.</p><p>####Create Column Template####</p><p>Select the <strong>Columns</strong> pane (1) in the <strong>Property Inspector</strong> and click the<strong>Add custom column behavior</strong> button (2). This will create a customcolumn template and behavior script.</p><p><img src="images/media_1240457183522_display.png" alt=""/></p><p>Notice how the <strong>Column Behavior...</strong> button has become enabled.</p><p><img src="images/media_1240457183522_display_0.png" alt=""/></p><p>####Edit Column Template####</p><p>When you create a custom template for a column a new group, named afterthe column, is added to the data grid&#39;s <strong>row template</strong>.</p><p><img src="images/media_1240457365695_display.png" alt=""/></p><p>Here you see the <strong>Project Browser</strong> with the template for the Data Grid expandedshowing the group for this column (*Col 1*) with a field <em>_ColumnData_</em> to hold the column&#39;s data.</p><p>####Edit Column Template Group####</p><p>Double-click on the column group in the <strong>Project Browser</strong> (1). This will select it on the template card (2) and then click the <strong>Edit Group</strong> button (3) to edit the contents of the column group.</p><p><img src="images/media_1240457393171_display.png" alt=""/></p><p>Be sure to double-click on the <strong>group</strong> icon and not the group&#39;s name. Double-clicking on the object&#39;s name will simply allow you to edit the name, which is not what is wanted.</p><p>####Create 3 Fields####</p><p>A column that aligns decimals in the center of the column, and iseditable if the user double-clicks on the cell, is achieved by creatingthree fields.</p><p><img src="images/media_1240457498750_display.png" alt=""/></p><p>Since the column template group already had a field named<em>_ColumnData_</em> double-click this name (in the <strong>Project Browser</strong>) and rename it to <em>Leftvalue</em> (1). Open the <strong>Property Inspector</strong> for this field and set its <strong>textalign</strong> to <strong>right</strong>. <strong>Duplicate</strong> the <em>Leftvalue</em> field and name it <em>Rightvalue</em> (2). Set the its <strong>textalign</strong> to <strong>right</strong> too. Finally <strong>Duplicate</strong> thisfield and <strong>rename</strong> the duplicate to <strong>ForEditing</strong> (3). The text ofthis field should be empty. Make sure that the <strong>ForEditing</strong> field has ahigher layer than <em>Leftvalue</em> or <em>Rightvalue</em>.</p><p>Don&#39;t worry too much about positioning as the fields will be resized andrepositioned when drawn in the data grid.</p><p>Click on the card background of the editing template and then the <strong>Stop Editing</strong> button and <strong>close</strong> and <strong>save</strong> the window.</p><p>####Edit Column Behavior####</p><p><img src="images/media_1240457537950_display.png" alt=""/></p><p>Now that the objects we need to display the column data have been created its time to tell the column what to do when it is drawn. Return to the<strong>Property Inspector</strong> for the data grid and from the <strong>Columns</strong> pane (1) click the **Column Behavior   ** button (2). This will open the behavior script for the column.</p><p>####Update FillInData####</p><p><img src="images/media_1240457590402_display.png" alt=""/></p><p>The decimal number is going to be displayed by assigning the left sideof the decimal to the <em>Leftvalue</em> field and the right side of thedecimal to the <em>Rightvalue</em> field.</p><pre><code>set the itemdelimiter to &quot;.&quot;   set the text of field &quot;Leftvalue&quot; of me to max(0, item 1 of pData)&amp;&quot;.&quot;set the text of field &quot;Rightvalue&quot; of me to max(0, item 2 of pData)</code></pre><p>####Update LayoutControl####</p><p><img src="images/media_1240457650342_display.png" alt=""/></p><p>The left and right fields are now resized so that each takes up half of the availablewidth to align the decimal in the center of the cell(1). Finally we resize the <strong>ForEditing</strong> field to take up the entire cell width(2). This is the field that the user can double-click on to edit the cell contents.</p><pre><code>put the rect of field &quot;Leftvalue&quot; of me into theRect   put item 1 of pControlRect into item 1 of theRectput item 1 of pControlRect + \  round((item 3 of pcontrolRect - item 1 of pControlRect) / 2) \  into item 3 of theRectset the rect of field &quot;Leftvalue&quot; of me to theRectput the rect of field &quot;Rightvalue&quot; of me into theRect2put item 3 of theRect into item 1 of theRect2put item 3 of pControlRect into item 3 of theRect2set the rect of field &quot;Rightvalue&quot; of me to theRect2set the rect of field &quot;ForEditing&quot; of me to pControlRect</code></pre><p>####Update EditValue####</p><p><strong>EditValue</strong> is the handler that is called by the data grid to edita cell value. Usually this is because the user double-clicked on thecell or tabbed into the cell.</p><p><img src="images/media_1240457831245_display.png" alt=""/></p><p><strong>EditFieldText</strong> displays, by default, the <strong>htmltext</strong> of the field you are editing. This default can be overriden by setting the <strong>dgTemplateFieldEditor[text|htmltext|rtftext|unicodetext|utf8text]</strong> of the data grid. Here the dgTemplateFieldEditor[&quot;text&quot;] of the data grid is set to <strong>text</strong>(1). Of course the <em>ForEditing</em> field has no text in it by default and the &quot;left&quot; and &quot;right&quot; field values need to be combined as documented in the handler.</p><p>Also, if the user double-clicks on this cell they actually double-click on the <strong>ForEditing</strong> field (as it has the higher layer) and it is thus <strong><em>the target</em></strong> (2)</p><pre><code>command EditValue  ## Assign text the the editor will have when it opens  ## We combine the left and right field values.   Set the dgTemplateFieldEditor[&quot;text&quot;] of the dgControl of me to \     the text of field &quot;Leftvalue&quot; of me &amp; the text of field &quot;Rightvalue&quot; of me  ## The &quot;ForEditing&quot; field is what the user actually clicked on.   ## This is the &quot;target&quot;  EditFieldText the long ID of field 1 of the target, the \      dgIndex of me, the dgColumn of meend EditValue</code></pre><p>####Refresh Data Grid####</p><p><img src="images/media_1240457946816_display.png" alt=""/></p><p>Now that the necessary changes have been made refresh the data grid so that it redraws with the new template controls. From the <strong>Basic Properties</strong> pane of the inspector paletteclick the <strong>Refresh Data Grid</strong> button. Alternatively you can send<strong>ResetList</strong> to the data grid.</p><pre><code>send &quot;resetList&quot; to group &quot;datagrid 1&quot;</code></pre><p>####Test####</p><p><img src="images/media_1240458424026_display.png" alt=""/></p><p>The decimals all appear in the center of the cell.Double-clicking brings up an editing field as shown here.Finally the decimal remains in the center of the cell if the column is resized.</p><h3>How Can I Colorize Individual Lines in a Table?</h3><p>This lesson will show you how to change the color of individual lines ina Data Grid table. Before you begin this lesson you will need to readthe lesson <a href="#how-do-i-override-the-default-behavior-for-rendering-data-to-a-cell">How Do I Override the Default Behavior for Rendering Datato a Cell?</a></p><p>####Attached Files####</p><p><a href="http://lessons.livecode.com/s/lessons/files/101?lesson_id=7332">Color_Individual_Line_in_Table.rev</a></p><h4>Coloring a Single Line</h4><p><img src="images/media_1249058487860_display.png" alt=""/></p><p>In this example we are going to modify the basic example created in the lesson mentioned above so that it colors a row red if the row&#39;s <strong>line has error property</strong> is <strong>true</strong>.</p><p><img src="images/media_1249058497115_display.png" alt=""/></p><p>By clicking on the <strong>Toggle Line 3 Color</strong> button the color of line 3turns red. The code in the button extracts the data for line 3 from thedata grid, toggles the <strong>line has error</strong> property and reassigns the newdata to line 3.</p><pre><code>on mouseUp pMouseBtnNo  put the dgDataOfLine[3] of group &quot;DataGrid 1&quot; into theDataA  put not theDataA[&quot;line has error&quot;] into theDataA[&quot;line has error&quot;]  set the dgDataOfLine[3] of group &quot;DataGrid 1&quot; to theDataAend mouseUp</code></pre><p>Now let&#39;s look at what the default custom column behavior looks like forthis data grid.</p><p>####The Default Custom Column Behavior####</p><p><img src="images/media_1249059040297_display.png" alt=""/></p><p>Here is the relevant code from the default custom column behavior for thisdata grid. The key addition to the code is the <strong>SetForeGroundColor</strong>handler. This handler checks the value of the  <strong>line has error</strong> columnfor this row (using <strong>GetDataOfIndex</strong>) and if it is true then changes thecell to red. Since each cell in this row has the same value for <strong>linehas error</strong> the entire row appears red.</p><pre><code>on FillInData pData  -- This message is sent when the Data Grid needs to populate  -- this template with the column data. pData is the value to be displayed.  set the text of me to pData  SetForeGroundColorend FillInDataon LayoutControl pControlRect  -- A default column is just a field.end LayoutControlsetprop dgHilite pBoolean  -- This custom property is set when the highlight of your column template has  -- changed. You only add script here if you want to customize the highlight.  if pBoolean then    set the foregroundcolor of me to the dgProp[&quot;hilited text color&quot;] of the dgControl of me  else    SetForeGroundColor  end ifend dgHiliteprivate command SetForeGroundColor  if GetDataOfIndex(the dgIndex of me, &quot;line has error&quot;) then    set the textcolor of me to red  else    set the textcolor of me to black  end ifend SetForeGroundColor</code></pre><h2><a name="//apple_ref/cpp/Guide/Working With Data Grid Forms" class="dashAnchor"></a>Working With Data Grid Forms</h2><h3>How Do I Create a Form With Variable Line Heights?</h3><p>This lesson will show you how to create a data grid form with variableheight lines by modifying the default data grid <strong>Row Template</strong> and<strong>Row Behavior</strong>.</p><h4>Turn Off &quot;Empty row height&quot;</h4><p><img src="images/media_1239376378384_display.png" alt=""/></p><p>To begin, turn off <strong>Empty row height</strong> for your data grid form inthe <strong>Property Inspector</strong>.</p><p>####Edit Row Template####</p><p><img src="images/media_1239375695284_display.png" alt=""/></p><p>Open the card that has the row template group by clicking the <strong>RowTemplate</strong> button.</p><p>####Turn Off dontWrap Property####</p><p><img src="images/media_1239375899522_display.png" alt=""/></p><p>The default row template for a data grid has a single field thatdisplays data. With <strong>Select Grouped</strong> turned on (1) select the field(2). Using the <strong>Property Inspector</strong> turn off <strong>dontWrap</strong> (3). You can nowclose the stack.</p><p>####Edit Row Behavior####</p><p><img src="images/media_1239375899522_display_x.png" alt=""/></p><p>Return to the Property Inspector for your data grid. Edit the <strong>RowBehavior</strong> by clicking on <strong>Edit Script</strong> button.</p><p>####Script Field to Resize to Fit Height####</p><p>Only a few modifications are needed to make to the default<strong>LayoutControl</strong> handler resize the field to fit the height.</p><p><img src="images/media_1239376187810_display.png" alt=""/></p><p>The default <strong>LayoutControl</strong> handler resizes the field to fill theavailable width (1). After that is done you then need to resize thefield to fill the <strong>formattedHeight</strong> (2). Finally, adjust the rectof the Background graphic to take into account the new field height (3).</p><pre><code> on LayoutControl pControlRect  local theFieldRect   ## Expand the field to fill the available width   put the rect of field &quot;Label&quot; of me into theFieldRect   put item 3 of pControlRect - 5 into item 3 of theFieldRect   set the rect of field &quot;Label&quot; of me to theFieldRect   ## Now resize the field to fit its content   put item 2 of theFieldRect \        + the formattedheight of field &quot;Label&quot; of me - \        the bottommargin  of field &quot;Label&quot; of me \        into item 4 of theFieldRect   set the rect of field &quot;Label&quot; of me to theFieldRect   ## Now update the bounding rect to match total the height   ## you want this row to have (note there is an additional 4   ## pixels added to the bottom   put item 4 of theFieldRect + 4 into item 4 of pControlRect  set the rect of graphic &quot;Background&quot; of me to pControlRectend LayoutControl</code></pre><p>####Refresh Data Grid Contents####</p><p>You can now refresh the data grid contents to see the new behavior.</p><p><img src="images/media_1239375593026_display.png" alt=""/></p><p>Notice how each line is resized to fit all of the text.</p><h3>How Do I Sort Records by a Specific Key&#39;s Values?</h3><p>You can sort the rows of a data grid form using the <strong>SortDataByKey</strong> command. </p><p>Let&#39;s look at an example.</p><p>####Example####</p><p><img src="images/media_1242529496945_display.png" alt=""/></p><p>This card has a data grid and an option menu. The option menu containsthree values that you can sort by: <em>First Name</em>, <em>Last Name</em> and<em>Title</em>.</p><p>####Option Menu Code####</p><p>The code to perform the sort is pretty straight forward.</p><p><img src="images/media_1242529389673_display.png" alt=""/></p><ol><li>Determine which array key of the data grid form to sort by. This will be one the keys created when the data was assigned to the <strong>dgData</strong>. If you used the <strong>dgText</strong> property then the key will be &quot;Label 1&quot; or &quot;Label 2&quot;, etc.</li><li>Determine the sort type, direction and whether or not the sort is case sensitive.</li><li>Call the <strong>SortDataByKey</strong> command.</li></ol><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code> on menuPick pItemName  switch pItemName    case &quot;First Name&quot;      put  &quot;FirstName&quot; into theKey      break    case &quot;Last Name&quot;      put  &quot;LastName&quot; into theKey      break    case &quot;Title&quot;      put  &quot;Title&quot; into theKey      break  end switch  put &quot;international&quot; into theSortType  put &quot;ascending&quot; into theDirection  put &quot;false&quot; into isCaseSensitive  dispatch &quot;SortDataByKey&quot; to group &quot;Datagrid 1&quot; with \       theKey, theSortType, theDirection, isCaseSensitiveend menuPick</code></pre><p>####The Result####</p><p><img src="images/media_1242529778033_display.png" alt=""/></p><p>Here is what the sort looks like after selecting <em>First Name</em> and after selecting <em>Last Name</em>.</p><h3>How Do I Create Rows That Can Expand/Contract?</h3><p>This lesson will show you how to make a Data Grid form with rows thatexpand and contract when clicking on an arrow.</p><h4>Attached Files</h4><p><a href="http://lessons.livecode.com/s/lessons/files/45?lesson_id=9850">ExpandingRow.rev</a></p><p>####Expanding and Contracting Rows####</p><p><img src="images/media_1265663660291_display.png" alt=""/></p><p>This is what the example stack looks like. By default all of the rowsare contracted and only show names.</p><p><img src="images/media_1265663682253_display.png" alt=""/></p><p>Clicking on the arrow next to a name expands the row to show thedescription of the person.</p><p>####Setting the Data Grid Properties####</p><p>To create a Data Grid form with rows that expand/contact you need toturn off <strong>fixed control height</strong> in the data grid&#39;s <strong>Property Inspector</strong>.</p><p><img src="images/media_1265663694402_display.png" alt=""/></p><blockquote><p><strong>Note</strong>: To turn off the property using script you set the<strong>dgProp[&quot;fixed row height&quot;]</strong> property to <strong>false</strong>.</p></blockquote><p>####Updating the Row Behavior Script####</p><p>In order to get expanding rows working a couple ofthings need to be taken into account in the <strong>Row Behavior Script.</strong></p><p><img src="images/media_1265663721696_display.png" alt=""/></p><p>The <strong>FillInData</strong> handler should show or hide controls asnecessary. The example stack stores the expanded state of each row inthe <strong>expanded</strong> key.</p><p><img src="images/media_1265663726190_display.png" alt=""/></p><p>In the <strong>LayoutControl</strong> handler the position ofthe controls and background graphic based on whether or not the row isexpanded or contracted are adjusted . Since the <strong>fixed row height</strong> property is set to<strong>false</strong> the Data Grid computes the total height of the data based on theheight of each row after calling <strong>LayoutControl</strong>.</p><p><img src="images/media_1265663745407_display.png" alt=""/></p><p>When the user clicks on the arrow the example stack updates the<strong>expanded</strong> key in the row&#39;s data and then redraws the row. Using <strong>SetDataOfIndex</strong> in conjunction with <strong>RefreshIndex</strong> is the most efficientway to do this.</p><p><strong>pDataArray[&quot;expanded&quot;]</strong> is a boolean which determines the state of the row.</p><pre><code>the short name of the target is &quot;ArrowContracted&quot;</code></pre><p>is an expression that evaluates to <strong>true</strong> or <strong>false</strong> depending on the target. If the <em>ArrowContracted</em> graphic is visible and thus clicked on, the expression evaluates to <strong>true</strong> which in turn sets the row to be in its <strong>expanded</strong> state as per the <strong>FillnData</strong> handler.</p><p>Thus this little snippet effectively toggles the state of the row.</p><h3>How Can I Speed Up Drawing When &quot;Fixed Row Height&quot; Is False?</h3><p>When you set the <strong>dgProp[&quot;fixed row height&quot;]</strong> property of a Data Grid to<strong>false</strong> the Data Grid must draw all records in order to determine thetotal height. That means that <strong>FillInData</strong> and <strong>LayoutControl</strong> are calledfor every record in the Data Grid. This can be time intensive dependingon the amount of data.</p><p>This lesson will show you a technique that can speed up the calculationof the total height of the data in situations where the rows can onlyhave heights of <strong><em>known</em></strong> values.</p><h4>CalculateFormattedHeight</h4><p>When the Data Grid loops through the data to calculate the height themessage <strong>CalculateFormattedHeight</strong> will be sent to the <strong>Row Template</strong>.If your Row Behavior handles this message then the Data Grid will usethe integer value that you return rather than calling <strong>FillInData</strong> and<strong>LayoutControl</strong>.</p><p>Here is an example that uses <strong>CalculateFormattedHeight</strong> to return theheight of a row based on whether or not the row is expanded. Just placethe <strong>CalculateFormattedHeight</strong> handler in your Row Behavior script.</p><pre><code>on CalculateFormattedHeight pDataArray  if pDataArray[&quot;expanded&quot;] then    return 74  else    return 20  end ifend CalculateFormattedHeighton FillInData pDataArray...end FillInData</code></pre><h2><a name="//apple_ref/cpp/Guide/Using the Built-in Field Editor" class="dashAnchor"></a>Using the Built-in Field Editor</h2><h3>How Do I Open a Table Cell for Editing?</h3><p>By default a table cell can be edited if the user double-clicks on thecell. This tutorial explains what goes on in the default column behaviorso you can customize behavior if you would like.</p><blockquote><p><strong>Note:</strong> The default column behavior is stored in button &quot;Default Column&quot;of stack &quot;**revDataGridLibrary**&quot;. See <a href="#how-do-i-override-the-default-behavior-for-rendering-data-to-a-cell">How Do I Override the Default Behavior for Rendering Data to a Cell?</a></p></blockquote><h4>What You Need to Know</h4><p>In order to edit the columns of a data grid table you need to know aboutthe following:</p><ol><li>The <strong>EditFieldText</strong> command</li><li>The <strong>EditValue</strong> message</li><li>The <strong>EditKey</strong> and <strong>EditKeyOfIndex</strong> commands</li><li>The <strong>CloseFieldEditor</strong> command which can be sent as a result of calling <strong>EditFieldText</strong>.</li></ol><p>Read up on the entries for <strong>EditFieldText</strong>, <strong>EditValue</strong>,<strong>EditCell</strong>/**EditCellOfIndex** in the API section of the Dictionary.</p><p>####EditFieldText####</p><p>The <strong>EditFieldText</strong> command will create an editor for a field that youspecify. The default column behavior calls this command with threeparameters so that data is automatically saved after the user finishesediting.</p><p>####EditValue####</p><p><strong>EditValue</strong> is the message that is sent to a row when a request to edit afield&#39;s contents has been made. The default column behavior calls<strong>EditFieldText</strong> when this message is received.</p><p>####EditCell and EditCellOfIndex####</p><p>There are two commands that will open a cell for editing. They are<strong>EditCell</strong> and <strong>EditCellOfIndex</strong>. Each takes the name of the columnyou want to edit and the line or index you want to edit. Here are twoexample scripts showing how you could use these commands in the scriptof a data grid.</p><pre><code>put &quot;FirstName&quot; into theColumnput the dgHilitedLine of me into theLineNoEditCell theColumn, theLineNoput &quot;FirstName&quot; into theColumnput the dgHilitedIndex of me into theIndexEditCellOfIndex theColumn, theIndex</code></pre><p>Either of the above calls will trigger the <strong>EditValue</strong> message.</p><pre><code>on EditValue  ## Example of opening a field editor for the targeted column.  ## Since I&#39;m passing in parameters 2 and 3 any changes will   ## automatically be saved to the dgData.  EditFieldText the long id of me, the dgIndex of me, the dgColumn of meend EditValue</code></pre><h4>CloseFieldEditor</h4><p>If the user changes any content in the field editor this message will besent to the field targeted in the first parameter sent to <strong>EditFieldText</strong>.Read the API docs for <strong>EditFieldText</strong> which discusses this message.</p><p>Example of storing value in <strong>dgData</strong> in <strong>CloseFieldEditor</strong>. This would berequired if you only passed in one parameter to <strong>EditFieldText</strong>.</p><pre><code>on CloseFieldEditor pFieldEditor  put the dgIndex of me into theIndex  put the dgDataOfIndex[theIndex] of the dgControl of me into theDataA  put the text of pFieldEditor into theDataA[the dgColumn of me]  set the dgDataOfIndex[theIndex] of the dgControl of me to theDataAend CloseFieldEditor</code></pre><h3>How Can the User Edit Field Content in a Data Grid Form?</h3><p>The data grid commands for creating an editor for a particular field ina row template. This lesson will show you how to use them.</p><p>####What You Need to Know####</p><p>In order to edit field contents in a data grid form you need to knowabout the following:</p><ol><li>The <strong>EditFieldText</strong> command</li><li>The <strong>EditValue</strong> message</li><li>The <strong>EditKey</strong> and <strong>EditKeyOfIndex</strong> commands</li></ol><p>Read up on the entries for <strong>EditFieldText</strong>, <strong>EditValue</strong> and<strong>EditKey</strong>/**EditKeyOfIndex** in the API documentation.</p><p>####EditFieldText####</p><p>The <strong>EditFieldText</strong> command will create an editor for a field that youspecify. You can use this command to create a field editor for a field inyour row template.</p><p>####EditValue####</p><p><strong>EditValue</strong> is the message that is sent to a row when a request to edit afields contents has been made. You can call <strong>EditFieldText</strong> from withina handler for this message to begin an editing operation.</p><p>####EditKey and EditKeyOfIndex####</p><p><strong>EditKey</strong> and <strong>EditKeyOfIndex</strong> will trigger the <strong>EditValue</strong> message in a row.Each takes the name of the key you want to edit and the line or indexyou want to edit. Here are two example scripts showing how you could usethese commands in the script of a data grid.</p><p>Placed in script of row template behavior</p><pre><code>on mouseDown pBtnNum  if pBtnNum is 1 then  ## Did the user click on the FirstName field?    if the short name of the target is &quot;FirstName&quot; then      put &quot;FirstName&quot; into theKey      put the dgHilitedLine of me into theLineNo      EditKey theKey, theLineNo    end if  end ifend mouseDownon mouseDown pBtnNum  if pBtnNum is 1 then  ## Did the user click on the FirstName field?    if the short name of the target is &quot;FirstName&quot; then      put &quot;FirstName&quot; into theKey      put the dgHilitedIndex of me into theIndex      EditKeyOfIndex theKey, theIndex    end if  end ifend mouseDown</code></pre><p>Either of the above calls will trigger the <strong>EditValue</strong> message. The<strong>EditValue</strong> can be thought of as a central message where you can open afield for editing text. A handler for this message is where you will callEditFieldText.</p><pre><code>on EditValue pKey  ## Example of opening a field editor for the field displaying   ## the value for pKey  ## Since we are passing in parameters 2 and 3 any changes   ## will automatically be saved to the dgData.  ## &#39;me&#39; is the Data Grid in this case.  EditFieldText the long id of field pKey of me, the \     dgHilitedIndex of me, pKeyend EditValue</code></pre><h4>CloseFieldEditor</h4><p>If the user changes any content in the field editor this message will besent to the field targeted in the first parameter sent to <strong>EditFieldText</strong>.Read the API docs for <strong>EditFieldText</strong> which discusses this message.</p><p>Here is an example of storing the new value in the <strong>dgData</strong> of the DataGrid in the <strong>CloseFieldEditor</strong> handler. Manually storing the value wouldbe required if you only passed in one parameter to <strong>EditFieldText</strong>.</p><p>This example script would be in the <strong>Row Behavior</strong> script as it uses the<strong>dgIndex of me</strong> property.</p><pre><code>on CloseFieldEditor pFieldEditor  ## &#39;me&#39; is the row control  put the dgIndex of me into theIndex  put the dgDataOfIndex[theIndex] of the dgControl of me into theDataA  put the text of pFieldEditor into theDataA[the dgColumn] of me  set the dgDataOfIndex[theIndex] of the dgControl of me to theDataAend CloseFieldEditor</code></pre><h3>How Can I Edit the Text as UTF-8, UTF-16 or HTML?</h3><p>The default Data Grid behavior when editing cell contents is to use the<strong>text</strong> property of the cell as the default value to be edited. Thislesson will show you how to provide a specific value for the Data Gridto use as the value to edit.</p><p>The technique described requires that you create a custom columnbehavior as outlined in the lesson <a href="#how-do-i-override-the-default-behavior-for-rendering-data-to-a-cell">How Do I Override the Default Behavior For Rendering Data to a Cell </a>.</p><p>####The Default Behavior####</p><p>Assume you have a column in your table that displays text with somestyling. In this example the last name in column 2 for <strong>some</strong> entries is italic.</p><p><img src="images/media_1266461595205_display.png" alt=""/></p><p>We can accomplish this by using the formatting information contained in the data.</p><p><img src="images/media_1266461595205_display_0.png" alt=""/></p><p>However, when you edit the content of the cell the formatting is lost.This is because the Data Grid edits the <strong>text</strong> property of the field bydefault.</p><p><img src="images/media_1266461620275_display.png" alt=""/></p><p>####Changing the Default Value For the Editor####</p><p>You can change the default value of that the field editor uses bysetting a value of the <strong>dgTemplateFieldEditor</strong> property of the Data Grid.You set the property before calling <strong>EditFieldText</strong>.</p><p>For example, if you wanted to display the <strong>italic</strong> text for editing youcould set the dgTemplateFieldEditor[&quot;htmltext&quot;] property to the htmltextof the column being edited:</p><pre><code>set the dgTemplateFieldEditor[&quot;htmltext&quot;] of the dgControl of me to the htmltext of me</code></pre><p><img src="images/media_1266461478465_display.png" alt=""/></p><p>Other properties you can set include <strong>rtftext</strong>, <strong>text</strong>, <strong>unicodetext</strong>and <strong>utf8text</strong>.</p><h4>The Result</h4><p><img src="images/media_1266461633668_display.png" alt=""/></p><p>Here is the result of using the example code above in the custom columnbehavior. Notice how the text being edited is bold.</p><h3>How Can I Select the Text in the Edit Field When It Opens?</h3><p>The default Data Grid behavior when editing cell contents is to put thecursor at the end of the field. This lesson will show how to tellthe Data Grid that all of the cell text should be selected.</p><p>The technique described requires a custom columnbehavior as outlined in the lesson <a href="#how-do-i-override-the-default-behavior-for-rendering-data-to-a-cell">How Do I Override the Default Behavior For Rendering Data to a Cell </a>.</p><h4>The Default Behavior####</h4><p><img src="images/media_1266460565476_display.png" alt=""/></p><p>By default the Data Grid will place the insertion point at the end of the text of a cell when you start editing a value.</p><h4>Selecting The Text####</h4><p><img src="images/media_1266460771838_display.png" alt=""/></p><p>You can tell the Data Grid to select all of the text by setting aspecial custom property called <strong>dgTemplateFieldEditor</strong>. If you set the<strong>dgTemplateFieldEditor[&quot;select text&quot;]</strong> of the Data Grid to <strong>true</strong> then thedata Grid will select the cell text.</p><h4>An Example Script####</h4><pre><code>## Select all text before openingset the dgTemplateFieldEditor[&quot;select text&quot;] of the dgControl of me to true</code></pre><p>Add this line of text to the <strong>EditValue</strong> handler in a customcolumn behavior. Just place the code right before the call to<strong>EditFieldText</strong>.</p><p><img src="images/media_1266460876219_display.png" alt=""/></p><h3>How Do I Save Changes the User Makes in an Editor Field to an External Data Source?</h3><h4>When Calling EditFieldText With 3 Parameters (Simpler)</h4><p>When calling <strong>EditFieldText</strong> with all three parameters (which is what adata grid column does by default) the data grid will automatically savethe text that the user enters in the <strong>dgData</strong> array. That means that allyou need to do is save the text of the editor field to your externaldata source in the <strong>CloseFieldEditor</strong> handler. Note that if you saveanything other than the text of <strong>pFieldEditor</strong> then your data source willnot match the <strong>dgData</strong> value.</p><p>Here is an example script that goes in the Data Grid group script. </p><pre><code>## An example that saveson CloseFieldEditor pFieldEditor  put the dgColumn of the target into theColumnBeingEdited  put the text of pFieldEditor into theNewText  ## Save data to database using command I defined  put &quot;Person&quot; into theTable  ## Get the unique id of the row in the database we want to edit  put GetDataOfIndex(the dgIndex of the target, &quot;id&quot;) into theRowID  SaveDataToDatabase theTable, theRowID, theColumnBeingEdited, theNewTextend CloseFieldEditor</code></pre><h4>When Calling EditFieldText With 1 Parameter (More Flexible)</h4><p>If you are working with data grid forms or decide to override thedefault behavior for data grid columns then you will make the call to<strong>EditFieldText</strong> yourself. For complete control over what gets savedyou only pass in 1 parameter to <strong>EditFieldText</strong>. By passing in 1parameter you are responsible for saving any changes to <strong>dgData</strong>.</p><p>Assume you made the following call in a data grid form:</p><pre><code>EditFieldText the long id of field &quot;Name&quot; of me</code></pre><p>A <strong>CloseFieldEditor</strong> message would still be sent when the user changes the contentsof the field but would need to contain code for saving the changes tothe <strong>dgData</strong> array.</p><p>Here is an example script that goes in the Data Grid group script.</p><pre><code>## CloseFieldEditor placed in data grid scripton CloseFieldEditor pFieldEditor  put the dgColumn of the target into theColumnBeingEdited  ## Store UTF8 text  put unidecode(the unicodetext of pFieldEditor, &quot;UTF8&quot;) into theNewText  ## Save data to database using command I defined  put &quot;Person&quot; into theTable  ## Get the unique id of the row in the database we want to edit  put GetDataOfIndex(the dgIndex of the target, &quot;id&quot;) into theRowID  SaveDataToDatabase theTable, theRowID, theColumnBeingEdited, theNewText  ## Update dgData.  ## Setting dgDataOfIndex will refresh the data grid display as well as update dgData  put the dgDataOfIndex[ the dgIndex of the target] of me into theDataA  put theNewText into theDataA[theColumnBeingEdited]  set the dgDataOfIndex[the dgIndex of the target] of me to theDataAend CloseFieldEditor</code></pre><h3>How Can I Customize the Field Editor Behavior?</h3><p>By default the Data Grid field editor allows users to enter data andsave it back to the Data Grid. If you need data entry to behavedifferently you can assign your own behavior script to the field editorbefore it opens. This lesson will show you how.</p><p>####Create Your Behavior Script####</p><p><img src="images/media_1251992093862_display.png" alt=""/></p><ol><li>Create a button (1) to hold the behavior script you want to use with the Data Grid field editor. Here it is placed on the same card as the data grid.</li><li>Set the script of the button (2) to the script of button &quot;Field Editor&quot; of stack &quot;revDataGridLibrary&quot;. This is the behavior script that Data Grid uses by default and is a good place to start when customizing the behavior.</li></ol><p>####Customize Your Script####</p><p>Open the button&#39;s script...</p><p><img src="images/media_1251992150655_display.png" alt=""/></p><p>Make any customizations you need to make.</p><p>####Assign Your Custom Behavior to Field Editor####</p><p>Whenever the Data Grid displays the field editor (e.g. the userdouble-clicks on a cell in a table) a <strong>preOpenFieldEditor</strong> message issent to the Data Grid. The first parameter is a reference to the fieldeditor control. This is where a behavior script can be assigned to thefield.</p><p><img src="images/media_1251992186932_display.png" alt=""/></p><h2><a name="//apple_ref/cpp/Guide/Building Standalones With the Data Grid" class="dashAnchor"></a>Building Standalones With the Data Grid</h2><h3>What Do I Need to Do to Deploy a Standalone With a Data Grid?</h3><p>A data grid relies on the stack <strong>revDataGridLibrary</strong> in order to functionproperly. This lesson will describe how to include this stack in yourstandalone applications.</p><p>####How The Standalone Builder Adds The Necessary Files####When you add a data grid to a stack, a substack is created whose name begins with &quot;Data Grid Templates&quot;.</p><p><img src="images/media_1237996891751_display.png" alt=""/></p><p>When you build a standalone application LiveCode uses the settings you have set for your application. These are on the <strong>General</strong> tab of the <strong>Standalone Applications Settings</strong>. By default LiveCode will look for a substackwhose name begins with &quot;Data Grid Templates&quot;. If it finds one then the<strong>revDataGridLibrary</strong> stack is added to your standalone application.</p><p><img src="images/media_1237996920279_display.png" alt=""/></p><p>####But What About Launcher Stacks (Splash Stacks)?####</p><p>Some developers prefer to use a launcher (or splash) stack technique.This technique builds a standalone using a stack with very little codein it that in turn opens the main stack that would contain the data grid templates. In this case the stack used to build the standalone will not havea substack whose name begins with &quot;Data Grid Templates&quot; as no data gridshave been added to it.</p><p>In this case you will need to tell LiveCode that you require the inclusion of the Data Grid Library. As of version LC 8, the DataGrid library <strong>DataGrid</strong> has been added to the list of <strong>Script Libraries</strong> in the <strong>Standalone Settings</strong> dialog. You can now force the inclusion of the <strong>DataGrid</strong> library, to ensure that any stack loaded by the standalone can use Data Grids.</p><p>Open the <strong>General</strong> tab of the <strong>Standalone Applications Settings</strong> (1) and select <strong>Select inclusions for the standalone application</strong> (2)</p><p><img src="images/media_1237996920279_display_0.png" alt=""/></p><p>Now open the <strong>Inclusions</strong> tab (1), locate the <strong>DataGrid</strong> library, and then click the checkbox (2) to include it.</p><p><img src="images/media_1237996920279_display_1.png" alt=""/></p><p>##Useful Things to Know ##</p><h3>What Sorts of Things Should I Not Do in Order to Avoid Needless</h3><h3>Suffering?</h3><p>There are some things that you could do that will cause you to scratchyour head when things go wrong. Since knowing is half the battle we willshare the issues we are aware of.</p><h4>Don&#39;t Call a Handler That Redraws the Data Grid From Within a</h4><h4>Control in the Data Grid</h4><p>This will generate an error since you are deleting a control that iscurrently executing code. This is a no-no and the LiveCode engine willcomplain and stop executing. You can avoid calling a handler thatrefreshes the data grid from within a control by a) using <strong>send</strong> <strong>in time</strong>or b) placing the code in the data grid script itself.</p><p><strong>Example A</strong></p><pre><code>## Script that is in the row behavior for a data grid.send &quot;DeleteIndex theIndex&quot; to the dgControl of me in 0 seconds</code></pre><p><strong>Example B</strong></p><pre><code>## Script that deletes hilited index on mouseUp.## Place in the data grid script.on mouseUp pMouseBtnNum  if pMouseBtnNum is 1 then    put the dgHilitedIndex of me into theIndex    DeleteIndex theIndex  end ifend mouseUp</code></pre><p>####Don&#39;t try to draw a Data Grid on a card that Is not open####</p><p>When a Data Grid renders, it dynamically creates fields and accessescertain properties. Some of these properties can not be properlyreported by the LiveCode engine unless the field is on an open card.</p><p>####Do not lock messages when accessing data grid properties.####</p><p>If messages are <strong>locked</strong> when you try to access a data grid property, for example</p><pre><code>set the dgProps[&quot;alternate row color&quot;]** of group &quot;DataGrid</code></pre><p>the correct value will not be returned/set. A Data Grid relies on getProp/setProp handlers to function. When messages are locked these are not triggered.</p><p>####Do not password protect the Data Grid Templates Stack####</p><p>The data grid copies the templates from the <strong>Data Grid Templates xxxx</strong>stack. If you password protect this stack then the data grid will beunable to copy the templates.</p><p>####Don&#39;t Rename the &quot;Data Grid Templates&quot; Stack####</p><p>If you rename this stack then all of your data grids with templatesstored in the stack will stop working. Since the data grid can no longerlocate the custom templates they will fail to draw properly.</p><p>####Don&#39;t Try to Search When Data is Being Loaded From an External Source####</p><p>####Stop Editing the Template Group Before Drawing Your Data Grid####</p><p>When you <strong>edit</strong> a group in LiveCode the engine no longer knows that thegroup exists. If you try to draw a data grid while editing it&#39;s templategroup then the data grid will fail to draw. Make sure you have selected<strong>Stop Editing</strong> from the <strong>Object</strong> menu or clicked on the <strong>Stop Editing</strong> icon on the <strong>Toolbar.</strong></p><h2><a name="//apple_ref/cpp/Guide/Advanced Options" class="dashAnchor"></a>Advanced Options</h2><h3>Displaying Large Amounts of Data</h3><p>Setting the <strong>dgText</strong> property or creating an array and setting the <strong>dgData</strong>property of a data grid is the easiest way to display your data. Butwhat about situations where creating an array is too time intensive andyou already have the data in another format? A data grid can handlethese situations for you as well using a feature called callbacks.</p><p>Download the attached sample stack and database that shows how to usethe techniques described in this lesson to display data from a SQLitedatabase.</p><p>####Attached Files####</p><p><a href="http://lessons.livecode.com/s/lessons/files/%0A1077?lesson_id=7341">datagrid_databases.zip</a></p><p>####The dgNumberOfRecords Property####</p><p>Normally a data grid reports the number of records based on the numberof numeric indexes in the first dimension of the <strong>dgData</strong> array. If youset the <strong>dgNumberOfRecords</strong> property, however, the data grid stops usingan internal array and issues a callback message whenever it needs todisplay data in a line.</p><blockquote><p><strong>Important</strong>: When using this technique properties like <strong>dgData</strong>, <strong>dgText</strong>,<strong>dgDataOfIndex</strong>, etc. will no longer return values. The data grid is justdisplaying records from your data source. It does not store any of thatdata internally.</p></blockquote><p>####GetDataForLine Callback####</p><p><img src="images/GetDataForLine_Callback_display.png" alt=""/></p><p>This diagram demonstrates how this works. If you were to set the<strong>dgNumberOfRecords</strong> to 10000 then the data grid would start sending the<strong>GetDataForLine</strong> message whenever it needed to display a row. Yourresponsibility is to fill in the data that the data grid needs byhandling the <strong>GetDataForLine</strong> message. To do that you define<strong>GetDataForLine</strong> as follows:</p><pre><code>command GetDataForLine pLine, @pDataAend GetDataForLine</code></pre><p>You can define this handler in the data grid script or anywhere else inthe message path. Just fill in pDataA with the appropriate data and thedata grid will display it.</p><h3>Creating a Data Grid by Hand</h3><p>This lesson will show you how to create a data grid through script.</p><p>####Copy Data Grid From revDataGridLibrary####</p><p>The data grid template is stored in the <strong>revDataGridLibrary</strong> stack and canbe copied using some code similar to this:</p><pre><code>copy group &quot;DataGrid&quot; of group &quot;Templates&quot; of stack &quot;revDataGridLibrary&quot; \ to card &quot;MyCard&quot; of stack &quot;MyStack&quot;put it into theDataGridRef</code></pre><p>####Set The &quot;style&quot; Property####</p><pre><code>set the dgProp[&quot;style&quot;] of theDataGridRef to &quot;table&quot; or &quot;form&quot;</code></pre><p>####Assign a Row Template####</p><pre><code>set the dgProp[&quot;row template&quot;] of theDataGridRef \ to the long id of group &quot;MyRowTemplate&quot; of stack &quot;MyStack&quot;</code></pre><p>You should probably create this ahead of time using the IDE. Forexample, you could create a data grid and then delete it while leavingthe row template behind (it will exist on a card in &quot;Data Grid Templatesxxx&quot; stack).</p><h3>How Do I Create a Datagrid Dynamically From Tab Delimited Data</h3><p>Most of the lessons show how to use and change previously created datagrids, and assume you want to create them in the IDE. This lesson willexplain how to create a table data grid by script.</p><h4>Prepare Your Data</h4><p>To make sure that the data grid can accept your tabular data, you shouldprepare it with these points in mind:</p><p>This example works with tab delimited data. The first row of the datashould include the names of the columns (this makes it easier to createcolumns later on) each name should be unique, no empty names are allowed.One way to create tab delimited data is to choose &quot;save as...&quot; in Excel,and then select &quot;text  file (tab delimited)&quot;. It is simple to load datainto Livecode from such a file:</p><pre><code>answer file &quot;&quot;put url (&quot;file:&quot; &amp; it) into theData</code></pre><h4>Create a data grid####</h4><p>Each data grid consists of a group with lots of scripts and objects.Luckily, you do not need to recreate all that from scratch. Instead youcan simply copy a template data grid from the data grid library. Becausethis library is neccesary for all data grid functionality, it will beadded to standalones by the IDE automatically. Please also see <a href="#what-do-i-need-to-do-to-deploy-a-standalone-with-a-data-grid">What Do I Need to Do To Deploy a Standalone With A Data Grid?</a> for an explanation when and how you need to add the library tostandalones yourself.</p><p>The code to copy a datagrid:</p><pre><code>--copy the template groupcopy group &quot;DataGrid&quot; of group &quot;Templates&quot; of stack &quot;revDataGridLibrary&quot; to this cardset the name of it to &quot;my Datagrid&quot;set the dgProp[&quot;style&quot;] of group &quot;my Datagrid&quot; to &quot;table&quot;</code></pre><h4>Create the Row template####</h4><p>In theory, your data grid is already ready for use. But for the IDE tointeract correctly with the new data grid, you also need to add asubstack with the row template, just as the IDE would. On the secondcard of that stack, you will need to add a group called <strong>Row Template</strong>,and you need to point your data grid to that group.</p><p>Here is how you could do that:</p><pre><code>--create row templateput the name of this stack into theMainstackput &quot;Data Grid Templates&quot; &amp;&amp; the seconds into theNamecreate invisible stack theNameset the mainStack of stack theName to theMainstackgo stack theNamecreate cardcreate field &quot;label&quot;create graphic &quot;Background&quot;group field 1 and graphic 1set the name of last group to &quot;Row Template&quot;go stack theMainstack--point datagrid to templateset the dgProp[&quot;Row Template&quot;] of group &quot;my Datagrid&quot; to the \ long id of group &quot;Row Template&quot; of stack theName</code></pre><h4>Fill in Your Data</h4><p>As a last step, you will want to insert the prepared data into the datagrid. Again, this assumes that the first row of your data contains anunique description for each column:</p><pre><code>--add dataput true into firstLineIsNamesset the dgText[firstLineIsNames] of group &quot;my DataGrid&quot; to theData</code></pre><h4>Prepare the Columns of the Data Grid</h4><p>Because you are creating the datagrid from arbitrary data, you will alsoneed to <strong><em>dynamically create</em></strong> all necessary columns. To do that youneed to set the <strong>dgProp[&quot;columns&quot;]</strong>. Note that it accepts the names onlyas a return delimited list.</p><p>If your data includes the column names in it&#39;s first row, you can simplytake this and replace tab with return:</p><pre><code>--create columnsput line 1 of theData into theColumnsreplace tab with return in theColumnsset the dgProp[&quot;columns&quot;] of group &quot;my DataGrid&quot; to theColumns</code></pre><h4>Everything together####</h4><p>To test out the example scripts, simply copy the following <strong>mouseUp</strong>handler into a button of an empty stack, and click on it with the<strong>browse</strong> tool.</p><pre><code>on mouseUp  answer file &quot;tab delimited&quot; with type &quot;any file&quot; or \   type &quot;tab file|tab|TEXT&quot; or type &quot;txt file|txt|TEXT&quot;  --in case the user cancels the file dialogue, the script does not proceed  if it = &quot;&quot; then     exit mouseUp  end if  put url (&quot;file:&quot; &amp; it) into theData  lock screen --when doing visual stuff, this helps to speed things up  --make sure the group does not exist already  if there is a group &quot;my Datagrid&quot; then       delete group &quot;my Datagrid&quot;  end if  --copy the template group  copy group &quot;DataGrid&quot; of group &quot;Templates&quot; of stack &quot;revDataGridLibrary&quot; \   to this card  set the name of it to &quot;my Datagrid&quot;  set the dgProp[&quot;style&quot;] of group &quot;my Datagrid&quot; to &quot;table&quot;  --position it nicely  set the rectangle of group &quot;my Datagrid&quot; to 0,the bottom \   of me + 16,the width of this card, the height of this card  --create row template  put the name of this stack into theMainstack  put &quot;Data Grid Templates&quot; &amp;&amp; the seconds into theName  create invisible stack theName  set the mainStack of stack theName to theMainstack  go stack theName  create card  create field &quot;label&quot;  create graphic &quot;Background&quot;  group field 1 and graphic 1  set the name of last group to &quot;Row Template&quot;  go stack theMainstack  --point datagrid to template  set the dgProp[&quot;Row Template&quot;] of group &quot;my Datagrid&quot; to the \   long id of group &quot;Row Template&quot; of stack theName  --create columns  put line 1 of theData into theColumns  --no empty column names are allowed, so insert a space when \   that happens  replace tab &amp; tab with tab &amp; &quot; &quot; &amp; tab in theColumns  replace tab with return in theColumns  set the dgProp[&quot;columns&quot;] of group &quot;my DataGrid&quot; to theColumns  --add data  put true into firstLineAreNames  set the dgText[firstLineAreNames] of group &quot;my DataGrid&quot; to theDataend mouseUp</code></pre><h2><a name="//apple_ref/cpp/Guide/Data Grid Tips &amp; Tricks" class="dashAnchor"></a>Data Grid Tips &amp; Tricks</h2><h3>How Do I Scroll a Row to the Top of the Data Grid Form?</h3><p>This lesson will show you how to scroll a particular row to the top of the Data Grid form using the <strong>dgRectOfIndex</strong> (or <strong>dgRectOfLine</strong>) property. This technique is useful when your rows are not a fixed height.</p><p><img src="images/media_1245508384568_display.png" alt=""/></p><p>Here is selected row in a data grid (1). The goal is to scroll that row to the top of the data grid (2).</p><p>####How To Do It####</p><p>Here is the code that will scroll the selected line to the top of the data grid.</p><p><strong><em>Copy &amp; Paste</em></strong></p><pre><code>put the dgHilitedIndex of group &quot;DataGrid&quot; into theIndexput the dgRectOfIndex [theIndex] of group &quot;DataGrid&quot; into theControlRectput the rect of group &quot;DataGrid&quot; into theGridRectput item 2 of theGridRect - item 2 of theControlRect into theOffsetset the dgVScroll of group &quot;DataGrid&quot; to the dgVScroll of group &quot;DataGrid&quot; - theOffset</code></pre><h4>The Result</h4><p><img src="images/media_1245509169836_display.png" alt=""/></p><p>After executing the code the row will have been moved to the top of the data grid.</p><h3>How Do I Find Out Which Line the Mouse Is Over?</h3><p>Each data grid row has a <strong>dgDataControl</strong> property that returns the <strong>long id</strong> of the control. Each control also has a <strong>dgLine</strong> and <strong>dgIndex</strong> property. You can combine the two in order to identify the control the mouse is over.</p><pre><code>put the dgDataControl of the mousecontrol into theControlif theControl is not empty then  put the dgLine of theControl into theLineNo end if</code></pre><h3>Converting a Database Cursor to a Data Grid Array</h3><p>This lesson demonstrates a handler that will convert a database cursor into an array that you can use to set the <strong>dgData</strong> property of a data grid.</p><p>####The Handler####</p><pre><code>command ConvertSQLCursorToArray pCursor, @pOutArrayA  local i,j  local theFields  local theError    put revDatabaseColumnNames(pCursor) into theFields    if theFields begins with &quot;revdberr,&quot; then      put item 2 to -1 of theFields into theError    end if    if theError is empty then      put 0 into i      repeat until revQueryIsAtEnd(pCursor)        add 1 to i        repeat for each item theField in theFields          put revDatabaseColumnNamed(pCursor, theField) into \              pOutArrayA[i][theField]        end repeat      revMoveToNextRecord pCursor    end repeat  end if  return theErrorend ConvertSQLCursorToArray</code></pre><p>The Handler first checks that no errors have been returned. If there are any, the error data is returned.</p><p>The handler then steps through the database cursor restructuring the data into an indexed multidimensional array that can be used by the data grid.</p><p>####How to use####</p><p>You can call this command as follows. </p><p>In this example theCursor is a database cursor that you have opened using revQueryDatabase.</p><pre><code>local theDataAConvertSQLCursorToArray theCursor, theDataAput the result into theError</code></pre><p>If theError is empty then dimension 1 of <em>theDataA</em> will contain integers from 1 to the number of records in the cursor (**revNumberOfRecords**). Each 1st dimension, in turn, has a key for each column in the cursor (**revDatabaseColumnNames**).</p><p>####Example####</p><p>Here is what the array might look like if your cursor had 2 columns (id and name) and 3 rows.</p><p>theDataA [1] [&quot;id&quot;]</p><p>theDataA [1] [&quot;name&quot;]</p><p>theDataA [2] [&quot;id&quot;]</p><p>theDataA [2] [&quot;name&quot;]</p><p>theDataA [3][&quot;id&quot;]</p><p>theDataA [3] [&quot;name&quot;]</p><p>You can use this array to set the <strong><em>dgData</em></strong> property of a data grid.</p><pre><code>set the dgData of group &quot;DataGrid 1&quot; to theDataA</code></pre></body></html>