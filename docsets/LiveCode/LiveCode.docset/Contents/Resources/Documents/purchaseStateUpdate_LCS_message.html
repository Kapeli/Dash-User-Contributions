<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>purchaseStateUpdate</title><link rel="stylesheet" type="text/css" href="userguide.css" /></head><body><table><tr><td colspan="2"><h1>purchaseStateUpdate</h1></td></tr><tr><td><b>Type</b></td><td>message</td></tr><tr><td><b>Dictionary</b></td><td>LCS</td></tr><tr><td><b>Library</b></td><td>LiveCode Script</td></tr><tr><td><b>Syntax</b></td><td><pre><span class="normal">purchaseStateUpdate &lt;pPurchaseID&gt;, &lt;pProductID&gt;, &lt;pState&gt;</span></pre></td></tr><tr><td><b>Summary</b></td><td><p>Sent by the store to notify the app of any changes in state to thepurchase request.</p></td></tr><tr><td><b>Edition</b></td><td>Community</td></tr><tr><td><b>Introduced</b></td><td>6.7</td></tr><tr><td><b>OS</b></td><td>ios, android</td></tr><tr><td><b>Platforms</b></td><td>mobile</td></tr><tr><td><b>Parameters</b></td><td><table class="inner"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>pPurchaseID</td><td></td><td><p>The identifier of the purchase request</p></td></tr><tr><td>pProductID</td><td></td><td><p>The product identifier for which the purchase request was made</p></td></tr><tr><td>pState</td><td></td><td><p>The state of the purchase request</p><b>"initialized": </b>the purchase request has been created but not sent<br><b>"sendingRequest": </b>the purchase request is being sent to the store<br><b>"paymentReceived": </b>the requested item has been paid for. The item should now be delivered to the user and confirmed via the <mobileStoreConfirmPurchase> command<br><b>"alreadyEntitled": </b>the requested product is already owned and cannot be purchased again<br><b>"invalidSKU": </b>the requested item does not exist in the store listing<br><b>"complete": </b>the purchase has now been paid for and delivered<br><b>"restored": </b>the purchase has been restored after a call to <mobileStoreRestorePurchases>. The purchase should now be delivered to the user and confirmed via the <mobileStoreConfirmPurchase> command<br><b>"cancelled": </b>the purchase was cancelled by the user before payment was received<br><b>"error": </b>an error occurred during the payment request. More detailed information is available from the <mobileStorePurchaseError> function<br></td></tr></table></td></tr><tr><td><b>Example</b></td><td><pre><b><span class="normal">on</span></b><span class="normal"> purchaseStateUpdate pPurchaseID, pProductID, pState</span><span class="normal"> <b>switch</b> pState</span><span class="normal">  <b>case</b> </span><span class="normal">"paymentReceived"</span><span class="normal">   </span><b><span class="command">answer</span></b><span class="normal"> </span><span class="normal">"payment received!"</span><span class="normal">   offerPurchasedProduct pProductID      </span><span class="normal">   mobileStoreConfirmPurchase pProductID</span><span class="normal">   mobileStoreDisablePurchaseUpdates</span><p></p><span class="normal">  <b>case</b> </span><span class="normal">"error"</span><span class="normal">   </span><b><span class="command">answer</span></b><span class="normal"> </span><span class="normal">"Error occurred during purchase handling:"</span><span class="normal"> \</span><span class="normal">         && mobileStorePurchaseError(pPurchaseID)</span><span class="normal">   mobileStoreDisablePurchaseUpdates</span><p></p><span class="normal">  <b>case</b> </span><span class="normal">"invalidSKU"</span><span class="normal">   </span><b><span class="command">answer</span></b><span class="normal"> </span><span class="normal">"Invalid SKU."</span><span class="normal">   mobileStoreDisablePurchaseUpdates</span><p></p><span class="normal">  <b>case</b> </span><span class="normal">"alreadyEntitled"</span><span class="normal">   </span><b><span class="command">answer</span></b><span class="normal"> </span><span class="normal">"Already Owned."</span><span class="normal">   mobileStoreDisablePurchaseUpdates</span><p></p><span class="normal">  <b>case</b> </span><span class="normal">"restored"</span><span class="normal">   </span><b><span class="command">answer</span></b><span class="normal"> </span><span class="normal">"restored!"</span><span class="normal">   offerPurchasedProduct pProductID         </span><span class="normal">   mobileStoreConfirmPurchase pProductID</span><span class="normal">   mobileStoreDisablePurchaseUpdates</span><p></p><span class="normal">  <b>case</b> </span><span class="normal">"cancelled"</span><span class="normal">   </span><b><span class="command">answer</span></b><span class="normal"> </span><span class="normal">"Purchase Cancelled:"</span><span class="normal"> && pProductID</span><span class="normal">   mobileStoreDisablePurchaseUpdates</span><p></p><span class="normal"> <b>end</b> <b>switch</b></span><b><span class="normal">end</span></b><span class="normal"> purchaseStateUpdate</span></pre></td></tr><tr><td><b>Related</b></td><td><b>Command</b>: <a href="mobileStoreRestorePurchases_LCS_command.html">mobileStoreRestorePurchases</a>, <a href="mobileStoreDisablePurchaseUpdates_LCS_command.html">mobileStoreDisablePurchaseUpdates</a>, <a href="mobileStoreEnablePurchaseUpdates_LCS_command.html">mobileStoreEnablePurchaseUpdates</a>, <a href="mobileStoreRequestProductDetails_LCS_command.html">mobileStoreRequestProductDetails</a>, <a href="mobileStoreMakePurchase_LCS_command.html">mobileStoreMakePurchase</a>, <a href="mobileStoreSetProductType_LCS_command.html">mobileStoreSetProductType</a>, <a href="mobileStoreConsumePurchase_LCS_command.html">mobileStoreConsumePurchase</a>, <a href="mobileStoreConfirmPurchase_LCS_command.html">mobileStoreConfirmPurchase</a>, <a href="mobileStoreVerifyPurchase_LCS_command.html">mobileStoreVerifyPurchase</a><br><b>Function</b>: <a href="mobileStoreProductProperty_LCS_function.html">mobileStoreProductProperty</a>, <a href="mobileStorePurchasedProducts_LCS_function.html">mobileStorePurchasedProducts</a>, <a href="mobileStorePurchaseError_LCS_function.html">mobileStorePurchaseError</a>, <a href="mobileStoreCanMakePurchase_LCS_function.html">mobileStoreCanMakePurchase</a><br><b>Message</b>: <a href="productRequestError_LCS_message.html">productRequestError</a>, <a href="productDetailsReceived_LCS_message.html">productDetailsReceived</a><br></td></tr><tr><td><b>Description</b></td><td><p>Use the <a href="purchaseStateUpdate_LCS_message.html">purchaseStateUpdate</a> message to notify the app of any changesin state to the purchase request.</p><p>The message <a href="purchaseStateUpdate_LCS_message.html">purchaseStateUpdate</a> is used to notify the app of anychanges in state to the purchase request. It is sent by the store inresponse to new purchase requests or restore completed purchasesrequests. </p></td></tr></table></body></html>