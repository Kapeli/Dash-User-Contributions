

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Designing networks &#8212; Nengo 3.1.0.dev0 docs</title>
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,400i,600|Rajdhani:700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<link rel="stylesheet" href="https://www.nengo.ai/css/bootstrap.css" type="text/css">
<style>
  body .title-bar,
  body .documentation-source h1:after {
    background-color: #a8acaf;
  }
</style>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41658423-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-41658423-2');
</script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://unpkg.com/scrollreveal"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stickyfill/2.1.0/stickyfill.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<!-- From basic/layout.html -->
<script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
  
  
<script src="../../_static/underscore.js"></script>
  
  
<script src="../../_static/doctools.js"></script>
  
  
<script src="../../_static/language_data.js"></script>
  
  
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
  
  
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Additional tips and tricks for designing networks" href="network-design-advanced.html" />
    <link rel="prev" title="Reusable networks" href="../../networks.html" />
<link rel="stylesheet" type="text/css" href="../../_static/custom.css">


<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  </head><body class="bg-dark">

<header class="fixed-top header-top shadow-sm">
  <nav class="navbar navbar-expand-md navbar-light bg-white">
    <a class="navbar-brand" href="https://www.nengo.ai/">
      <img
        src="https://www.nengo.ai/design/_images/general-full-light.svg"
        alt="Nengo"
        class="logo"
      />
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbar-collapse"
      aria-controls="navbar-collapse"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://www.nengo.ai/">What is Nengo?</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.nengo.ai/examples/">Examples</a>
        </li>
        <li class="nav-item dropdown active">
          <a
            class="nav-link dropdown-toggle"
            id="navbar-dropdown-docs"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            href="#"
            >Documentation</a
          >
          <div
            class="dropdown-menu shadow-lg border-0"
            aria-labelledby="navbar-dropdown-docs"
          >
            
            <a class="dropdown-item" href="https://www.nengo.ai/nengo/">Nengo Core</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-gui/">Nengo GUI</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-dl/">Nengo DL</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-spa/">Nengo SPA</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-extras/">Nengo Extras</a>
            <a class="dropdown-item" href="https://arvoelke.github.io/nengolib-docs/">Nengolib</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-fpga/">Nengo FPGA</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-loihi/">Nengo Loihi</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-ocl">Nengo OpenCL</a>
            <a class="dropdown-item" href="https://github.com/project-rig/nengo_spinnaker">Nengo SpiNNaker</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-mpi">Nengo MPI</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/documentation/"
              >All documentation</a
            >
          </div>
        </li>
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            id="navbar-dropdown-community"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            href="#"
            >Community</a
          >
          <div
            class="dropdown-menu shadow-lg border-0"
            aria-labelledby="navbar-dropdown-community"
          >
            <a class="dropdown-item" href="https://forum.nengo.ai">Forum</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/people/"
              >People</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/summer-school/"
              >Summer school</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/contributing/"
              >Contributing</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/publications/"
              >Publications</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/videos/"
              >Videos</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/conduct/"
              >Code of conduct</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/caa/">CAA</a>
          </div>
        </li>
        <li class="nav-item">
          <a
            class="nav-link btn btn-success btn-sm text-white"
            href="https://www.nengo.ai/getting-started/"
            >Getting started</a
          >
        </li>
      </ul>
    </div>
  </nav>
</header>
<div class="main-content gradient-top">
  <div class="container-fluid">
    <div class="row"><a class="toggle-sidenav d-block d-md-none" href="#"
  ><i class="icon-close fa fa-fw fa-arrow-left"></i
  ><i class="icon-open fa fa-fw fa-arrow-right"></i
></a>
<div role="complementary" class="sidenav col-4 col-xl-3 p-0 border-right">
  <h3 class="pt-5 px-5">
    <a href="../../index.html">
      <img
        class="img-fluid documentation-image"
        src="https://www.nengo.ai/design/_images/general-full-light.svg"
        alt="Nengo"
      />
    </a>
  </h3>
  
  <div class="p-5 toctree">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../user-guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../frontend-api.html">Nengo frontend API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../backend-api.html">Nengo backend API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html">Setting parameters with Configs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../networks.html">Reusable networks</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Designing networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="network-design-advanced.html">Additional tips and tricks for designing networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../networks.html#built-in-networks">Built-in networks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../spa.html">Semantic Pointer Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced.html">Advanced topics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to Nengo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project.html">Project information</a></li>
</ul>

  </div>
<form class="p-5 my-0 border-top" action="../../search.html" method="get">
  <div class="form-group form-group-single">
    <input type="text" name="q" class="form-control" placeholder="Search" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
    <button type="submit" class="btn btn-link">
      <img src="https://www.nengo.ai/img/icon-search.svg" alt="Go" />
    </button>
  </div>
</form></div>
      

      <div class="col-12 col-md-8 col-xl-9">
        <div class="container">
          <div class="row">
            <div class="col-10 offset-1 pb-5 documentation-source" role="main">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Designing-networks">
<h1>Designing networks<a class="headerlink" href="#Designing-networks" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Networks</span></code> are how Nengo encapsulates functionally complementary objects. Networks can contain ensembles, nodes, connection, even other networks. Models are often made much more readable my grouping objects into networks. Tools for visualizing networks will often use the network structure to produce cleaner images.</p>
<p>Here, we will go over some general principles of network design. In the first section, we will go over these principles with a simple example. In the second section, we will apply these principles to a more complicated example.</p>
<p>Briefly, the general principles we will go over in this tutorial are</p>
<ol class="arabic simple" start="0">
<li><p>Group related objects in networks with <code class="docutils literal notranslate"><span class="pre">with</span></code></p></li>
<li><p>Reuse networks by defining functions</p></li>
<li><p>Parameterize functions for more flexible reuse</p></li>
</ol>
<p>We will demonstrate these principles with a network consisting of two connected integrators as an example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">nengo</span>
<span class="kn">from</span> <span class="nn">nengo.dists</span> <span class="kn">import</span> <span class="n">Choice</span>
<span class="kn">from</span> <span class="nn">nengo.processes</span> <span class="kn">import</span> <span class="n">Piecewise</span>
<span class="kn">from</span> <span class="nn">nengo.utils.ipython</span> <span class="kn">import</span> <span class="n">hide_input</span>


<span class="k">def</span> <span class="nf">test_integrators</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">net</span><span class="p">:</span>
        <span class="n">piecewise</span> <span class="o">=</span> <span class="n">Piecewise</span><span class="p">({</span>
            <span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mf">0.2</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">})</span>
        <span class="n">piecewise_inp</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">piecewise</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">piecewise_inp</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="n">input_probe</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">piecewise_inp</span><span class="p">)</span>
        <span class="n">pre_probe</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">post_probe</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">input_probe</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pre_probe</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">post_probe</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>


<span class="n">hide_input</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<a id="1971709344" href="javascript:toggle_input_1971709344()"
  >Show Input</a>

<script type="text/javascript">
var toggle_input_1971709344;
(function() {
    if (typeof jQuery == 'undefined') {
        // no jQuery
        var link_1971709344 = document.getElementById("1971709344");
        var cell = link_1971709344;
        while (cell.className.split(' ')[0] != "cell"
               && cell.className.split(' ')[0] != "nboutput") {
            cell = cell.parentNode;
        }
        var input_1971709344;
        if (cell.className.split(' ')[0] == "cell") {
            for (var i = 0; i < cell.children.length; i++) {
                if (cell.children[i].className.split(' ')[0]
                    == "input") {
                    input_1971709344 = cell.children[i];
                }
            }
        } else {
            input_1971709344 = cell.previousElementSibling;
        }
        input_1971709344.style.display = "none"; // hide

        toggle_input_1971709344 = function() {
            if (input_1971709344.style.display == "none") {
                input_1971709344.style.display = ""; // show
                link_1971709344.innerHTML = "Hide Input";
            } else {
                input_1971709344.style.display = "none"; // hide
                link_1971709344.innerHTML = "Show Input";
            }
        }

    } else {
        // jQuery
        var link_1971709344 = $("a[id='1971709344']");
        var cell_1971709344 = link_1971709344.parents("div.cell:first");
        if (cell_1971709344.length == 0) {
            cell_1971709344 = link_1971709344.parents(
                "div.nboutput:first");
        }
        var input_1971709344 = cell_1971709344.children("div.input");
        if (input_1971709344.length == 0) {
            input_1971709344 = cell_1971709344.prev("div.nbinput");
        }
        input_1971709344.hide();

        toggle_input_1971709344 = function() {
            if (input_1971709344.is(':hidden')) {
                input_1971709344.slideDown();
                link_1971709344[0].innerHTML = "Hide Input";
            } else {
                input_1971709344.slideUp();
                link_1971709344[0].innerHTML = "Show Input";
            }
        }
    }
}());
</script></div>
</div>
<div class="section" id="1.-Group-related-objects-in-networks-with-with">
<h2>1. Group related objects in networks with <code class="docutils literal notranslate"><span class="pre">with</span></code><a class="headerlink" href="#1.-Group-related-objects-in-networks-with-with" title="Permalink to this headline">¶</a></h2>
<p>All Nengo objects must be created in the context of some network. We use the <code class="docutils literal notranslate"><span class="pre">with</span></code> keyword to denote the network context in which a Nengo object is created.</p>
<p>These <code class="docutils literal notranslate"><span class="pre">with</span></code> statements can be nested to group objects in appropriately named networks.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Example: two connected integrators</span>
<span class="c1">#  (See integrator example network for more details)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Two integrators&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">net</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">pre_integrator</span><span class="p">:</span>
        <span class="n">pre_input</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">size_in</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pre_ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">pre_ensemble</span><span class="p">,</span> <span class="n">pre_ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">pre_input</span><span class="p">,</span> <span class="n">pre_ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">post_integrator</span><span class="p">:</span>
        <span class="n">post_input</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">size_in</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">post_ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">post_ensemble</span><span class="p">,</span> <span class="n">post_ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">post_input</span><span class="p">,</span> <span class="n">post_ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">pre_ensemble</span><span class="p">,</span> <span class="n">post_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Test the integrators by giving piecewise input and plotting</span>
<span class="k">with</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">piecewise</span> <span class="o">=</span> <span class="n">Piecewise</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
    <span class="n">piecewise_inp</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">piecewise</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">piecewise_inp</span><span class="p">,</span> <span class="n">pre_input</span><span class="p">)</span>
    <span class="n">input_probe</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">piecewise_inp</span><span class="p">)</span>
    <span class="n">pre_probe</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">pre_ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">post_probe</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">post_ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">input_probe</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pre_probe</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;pre integrator&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">post_probe</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;post integrator&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fe155ecf250&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_4_1.png" src="../../_images/examples_usage_network-design_4_1.png" />
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">with</span></code> statements are not just cosmetic; Nengo objects are stored in the network that they’re constructed in.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="n">pre_input</span> <span class="ow">in</span> <span class="n">pre_integrator</span>
<span class="k">assert</span> <span class="n">pre_input</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">net</span>
<span class="k">assert</span> <span class="n">pre_integrator</span> <span class="ow">in</span> <span class="n">net</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.-Reuse-networks-by-defining-functions">
<h2>2. Reuse networks by defining functions<a class="headerlink" href="#2.-Reuse-networks-by-defining-functions" title="Permalink to this headline">¶</a></h2>
<p>Often, the same network is constructed more than once, resulting in duplicated code. We can reduce this code duplication by defining a function that creates the network and returns it.</p>
<p>Even if you only use the network once, it can be helpful to define all of your subnetworks in functions to keep your code cleaner. Determining when a network should be defined in a function is informed by experience designing large networks and personal preference.</p>
<div class="section" id="Store-useful-objects-on-the-network">
<h3>Store useful objects on the network<a class="headerlink" href="#Store-useful-objects-on-the-network" title="Permalink to this headline">¶</a></h3>
<p>A corollary to putting networks in functions is that any objects that you might want access to outside of that function should be stored on the network. Functions that create networks should only return that network. While all objects in that network are stored somewhere (e.g., ensembles are stored in a <code class="docutils literal notranslate"><span class="pre">net.ensembles</span></code> list), that list can be large and difficult to search. Therefore, we recommend storing objects on the network itself to make them accessible outside of the function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Example: two connected integrators. Now with functions!</span>
<span class="k">def</span> <span class="nf">Integrator1</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">integrator</span><span class="p">:</span>
        <span class="n">integrator</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">size_in</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">integrator</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">integrator</span>


<span class="n">net</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Two integrators&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span> <span class="o">=</span> <span class="n">Integrator1</span><span class="p">()</span>
    <span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span> <span class="o">=</span> <span class="n">Integrator1</span><span class="p">()</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This function does the same as the previous example</span>
<span class="n">test_integrators</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_9_0.png" src="../../_images/examples_usage_network-design_9_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="3.-Parameterize-functions-for-more-flexible-reuse">
<h2>3. Parameterize functions for more flexible reuse<a class="headerlink" href="#3.-Parameterize-functions-for-more-flexible-reuse" title="Permalink to this headline">¶</a></h2>
<p>Now that your network is created in a function, you can add parameters to your function to change how your network is constructed. This could be a huge change, allowing you to compare two different approaches to some component of your model, or it could something straightforward like changing the number of neurons in the ensembles in the network.</p>
<p>Unlike other languages, Python allows you to add two different types of parameters: <strong>positional</strong> and <strong>keyword</strong> arguments. Positional arguments must be passed to your function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_network</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_network</span><span class="p">()</span>
<span class="go">TypeError: my_network() takes exactly 2 arguments (0 given)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_network</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;0 0&#39;</span>
</pre></div>
</div>
<p>Keyword arguments are assigned a default value, and so do not have to be passed to your function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_network</span><span class="p">(</span><span class="n">arg1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_network</span><span class="p">()</span>
<span class="go">&#39;0 0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_network</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;1 0&#39;</span>
</pre></div>
</div>
<p>Order does not matter if you explicitly label the argument in your function call.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_network</span><span class="p">(</span><span class="n">arg2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;1 2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_network</span><span class="p">(</span><span class="n">arg2</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&#39;0 2&#39;</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Example: two connected integrators. Functions have parameters!</span>
<span class="k">def</span> <span class="nf">Integrator2</span><span class="p">(</span><span class="n">n_neurons</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">integrator</span><span class="p">:</span>
        <span class="n">integrator</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">size_in</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">n_neurons</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">integrator</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">integrator</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Try 50 neuron ensembles</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Two integrators&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span> <span class="o">=</span> <span class="n">Integrator2</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span> <span class="o">=</span> <span class="n">Integrator2</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
<span class="n">test_integrators</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_12_0.png" src="../../_images/examples_usage_network-design_12_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Try shorter tau (spoiler: it fails to integrate well)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Two integrators&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span> <span class="o">=</span> <span class="n">Integrator2</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span> <span class="o">=</span> <span class="n">Integrator2</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">pre_integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">post_integrator</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
<span class="n">test_integrators</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_13_0.png" src="../../_images/examples_usage_network-design_13_0.png" />
</div>
</div>
</div>
<div class="section" id="Longer-example:-double-integrator-network">
<h2>Longer example: double integrator network<a class="headerlink" href="#Longer-example:-double-integrator-network" title="Permalink to this headline">¶</a></h2>
<p>While the coupled integrator model above seems like a toy example, it is in fact a critical component of many models that capture neurophysiological and behavioral data. Let’s looks at a more complicated network that uses coupled integrators, and show how the network design principles discussed above improve model organization. We will look at a simplified version of the network described in <a class="reference external" href="http://compneuro.uwaterloo.ca/files/publications/bekolay.2014a.pdf">Bekolay et al., 2014</a>.</p>
<p>This network uses two coupled integrators in the context of a simple reaction time task. The subject presses down a lever, and should release that lever between 0.6 and 1.0 seconds later. In order to time the interval, the lever press starts the coupled integrators, which are tuned such that the second integrator should reach a high point by around 0.6 seconds. The second integrator effects the lever release.</p>
<p>We’ll start with a completely disorganized network. Even if you’ve read the paper, the code is quite hard to follow.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="n">pre_integrator</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
        <span class="n">pre_integrator</span><span class="p">,</span>
        <span class="n">pre_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">synapse</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
    <span class="n">post_integrator</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
        <span class="n">post_integrator</span><span class="p">,</span>
        <span class="n">post_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">synapse</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">pre_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">post_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="mf">0.16</span><span class="p">)</span>
    <span class="n">press</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span>
        <span class="mi">30</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">encoders</span><span class="o">=</span><span class="n">Choice</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">intercepts</span><span class="o">=</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.85</span><span class="p">]))</span>
    <span class="n">release</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span>
        <span class="mi">30</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">encoders</span><span class="o">=</span><span class="n">Choice</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">intercepts</span><span class="o">=</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.85</span><span class="p">]))</span>

    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">pre_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">tau</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">post_integrator</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">post_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">release</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> <span class="n">press</span><span class="p">)</span>

    <span class="n">pr_press</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">pr_release</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">pr_pre_int</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">pre_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">pr_post_int</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">post_integrator</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_doubleintegrator</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_press</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Press&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_release</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Release&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_pre_int</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pre Integrator&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_post_int</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Post Integrator&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>


<span class="n">test_doubleintegrator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_15_0.png" src="../../_images/examples_usage_network-design_15_0.png" />
</div>
</div>
<p>Recall that the goal is to release the lever 0.6-1.0 seconds after the press. The blue “Press” line in the upper plot represents the activity of neurons in motor cortex which effect the lever press. If we assume that the press occurs at 0.2 seconds, then the release window is between 0.8 and 1.2 seconds (shown in green). This will occur if the “Post Integrator” (see lower plot) is sufficiently high during this window. If you rerun the cell above several times, you can see that it usually
achieves this, but not all of the time.</p>
<p>Looking at the code, it’s difficult to tell how we achieve this result. It’s also difficult to see what parameters needed tweaking. Rather than just showing one parameter set that works, we should investigate reasonable ranges for each parameter. It would be easy to think that there is only one parameter, <code class="docutils literal notranslate"><span class="pre">tau</span></code>, in the model as presented, but this is not the case.</p>
<p>Let’s start with the first network design principle: group objects into networks with <code class="docutils literal notranslate"><span class="pre">with</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">mpfc</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">pre_integrator</span><span class="p">:</span>
            <span class="n">pre_ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
                <span class="n">pre_ensemble</span><span class="p">,</span>
                <span class="n">pre_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">synapse</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">post_integrator</span><span class="p">:</span>
            <span class="n">post_ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
                <span class="n">post_ensemble</span><span class="p">,</span>
                <span class="n">post_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">synapse</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">pre_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">post_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="mf">0.16</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">motor</span><span class="p">:</span>
        <span class="n">press</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span>
            <span class="mi">30</span><span class="p">,</span>
            <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">encoders</span><span class="o">=</span><span class="n">Choice</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]),</span>
            <span class="n">intercepts</span><span class="o">=</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.85</span><span class="p">]))</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span>
            <span class="mi">30</span><span class="p">,</span>
            <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">encoders</span><span class="o">=</span><span class="n">Choice</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]),</span>
            <span class="n">intercepts</span><span class="o">=</span><span class="n">Choice</span><span class="p">([</span><span class="mf">0.85</span><span class="p">]))</span>

    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">pre_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">tau</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">post_ensemble</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">post_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">release</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> <span class="n">press</span><span class="p">)</span>

    <span class="n">pr_press</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">pr_release</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">release</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">pr_pre_int</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">pre_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">pr_post_int</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">post_ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">test_doubleintegrator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_17_0.png" src="../../_images/examples_usage_network-design_17_0.png" />
</div>
</div>
<p>This exhibits some of the hypotheses of this model; specifically, that the medial prefrontal cortex contains these integrators, and that they can be involved in control of motor actions.</p>
<p>Let’s do both of the remaining principles by making some parameterized functions to get a sense of all of the knobs that be be tweaked in this model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">controlled_integrator</span><span class="p">(</span><span class="n">n_neurons</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">integrator</span><span class="p">:</span>
        <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span>
            <span class="n">n_neurons</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">,</span>
            <span class="n">integrator</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[:</span><span class="n">dimensions</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">synapse</span><span class="o">=</span><span class="n">tau</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">integrator</span>


<span class="k">def</span> <span class="nf">medial_pfc</span><span class="p">(</span><span class="n">coupling_strength</span><span class="p">,</span> <span class="n">n_neurons_per_integrator</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">medial_pfc</span><span class="p">:</span>
        <span class="n">medial_pfc</span><span class="o">.</span><span class="n">pre</span> <span class="o">=</span> <span class="n">controlled_integrator</span><span class="p">(</span><span class="n">n_neurons_per_integrator</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="n">tau</span><span class="p">)</span>
        <span class="n">medial_pfc</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">controlled_integrator</span><span class="p">(</span><span class="n">n_neurons_per_integrator</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                <span class="n">tau</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">medial_pfc</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">medial_pfc</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">coupling_strength</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">medial_pfc</span>


<span class="k">def</span> <span class="nf">motor_cortex</span><span class="p">(</span><span class="n">command_threshold</span><span class="p">,</span> <span class="n">n_neurons_per_command</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">motor_cortex</span><span class="p">:</span>
        <span class="n">ens_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;encoders&#39;</span><span class="p">:</span> <span class="n">Choice</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]),</span>
            <span class="s1">&#39;intercepts&#39;</span><span class="p">:</span> <span class="n">Choice</span><span class="p">([</span><span class="n">command_threshold</span><span class="p">])</span>
        <span class="p">}</span>
        <span class="n">motor_cortex</span><span class="o">.</span><span class="n">press</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">n_neurons_per_command</span><span class="p">,</span> <span class="o">**</span><span class="n">ens_args</span><span class="p">)</span>
        <span class="n">motor_cortex</span><span class="o">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">n_neurons_per_command</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">ens_args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">motor_cortex</span>


<span class="k">def</span> <span class="nf">double_integrator</span><span class="p">(</span><span class="n">mpfc_coupling_strength</span><span class="p">,</span>
                      <span class="n">command_threshold</span><span class="p">,</span>
                      <span class="n">press_to_pre_gain</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">press_to_post_control</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span>
                      <span class="n">recurrent_tau</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="k">as</span> <span class="n">net</span><span class="p">:</span>
        <span class="n">net</span><span class="o">.</span><span class="n">mpfc</span> <span class="o">=</span> <span class="n">medial_pfc</span><span class="p">(</span><span class="n">mpfc_coupling_strength</span><span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">motor</span> <span class="o">=</span> <span class="n">motor_cortex</span><span class="p">(</span><span class="n">command_threshold</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">net</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">press</span><span class="p">,</span>
            <span class="n">net</span><span class="o">.</span><span class="n">mpfc</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">recurrent_tau</span> <span class="o">*</span> <span class="n">press_to_pre_gain</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">net</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">press</span><span class="p">,</span>
            <span class="n">net</span><span class="o">.</span><span class="n">mpfc</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">press_to_post_control</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">mpfc</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">net</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">net</span>


<span class="k">def</span> <span class="nf">test_doubleintegrator_wprobes</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
    <span class="c1"># Provide input and probe outside of network construction,</span>
    <span class="c1"># for more flexibility</span>
    <span class="k">with</span> <span class="n">net</span><span class="p">:</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> <span class="n">net</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">press</span><span class="p">)</span>
        <span class="n">pr_press</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">press</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">pr_release</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">release</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">pr_pre_int</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">mpfc</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">pr_post_int</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">mpfc</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">synapse</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_press</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Press&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_release</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Release&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_pre_int</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pre Integrator&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pr_post_int</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Post Integrator&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>


<span class="n">net</span> <span class="o">=</span> <span class="n">double_integrator</span><span class="p">(</span><span class="n">mpfc_coupling_strength</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">command_threshold</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">test_doubleintegrator_wprobes</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_19_0.png" src="../../_images/examples_usage_network-design_19_0.png" />
</div>
</div>
<p>While this does add some complexity and length, the effort is worth it, as we can now do simple parameters sweeps to investigate the effects of changing various parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">coupling_strength</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">):</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">double_integrator</span><span class="p">(</span>
        <span class="n">mpfc_coupling_strength</span><span class="o">=</span><span class="n">coupling_strength</span><span class="p">,</span>
        <span class="n">command_threshold</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">test_doubleintegrator_wprobes</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_21_0.png" src="../../_images/examples_usage_network-design_21_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_21_1.png" src="../../_images/examples_usage_network-design_21_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_usage_network-design_21_2.png" src="../../_images/examples_usage_network-design_21_2.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">coupling_strength</span></code> changes how quickly the “Post Integrator” rises, which causes the release to occur at different times. Of the values tested, only a coupling strength of 0.16 effects the release during the release window (for this particular network seed).</p>
<p>We will looks at some more techniques for cleaning up this network code and making it more flexible in “Additional tips and tricks for designing networks”.</p>
</div>
</div>


            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div><footer class="text-light footer-main gradient-bottom">
  <p class="small text-center mb-0">
    <a class="no-hover-line" href="https://appliedbrainresearch.com">
      <img
        src="https://appliedbrainresearch.com/img/logo-blue-notext.svg"
        height="48"
      />
    </a>
    <a href="https://www.nengo.ai/">What is Nengo?</a>
    <a href="https://www.nengo.ai/examples/">Examples</a>
    <a href="https://www.nengo.ai/documentation/">Documentation</a>
    <a href="https://www.nengo.ai/getting-started/">Getting started</a>
    <a href="https://www.nengo.ai/privacy/">Privacy</a>
  </p>
  <p class="small text-center mb-0">&copy; Applied Brain Research</p>
</footer>
<script>
  var elements = document.querySelectorAll('.sidenav');
  Stickyfill.add(elements);
</script>
<script>
  ScrollReveal().reveal(".fade-in", {
      scale: 0.85,
      duration: 1000,
      delay: 250,
      interval: 50
  });
</script>
<script>
  $('a.toggle-sidenav').on('click', function(e) {
    e.preventDefault();
    if ( $(this).hasClass('active') ) {
      $(this).removeClass('active');
      $('.sidenav').removeClass('open');
    } else {
      $(this).addClass('active');
      $('.sidenav').addClass('open');
    }
  });
</script>
<script>
  var lists = document.querySelectorAll('.toctree ul');
  lists.forEach((ul) => {
      ul.classList.add("nav");
  });
  var links = document.querySelectorAll('.toctree a');
  links.forEach((link) => {
      link.classList.add("nav-link");
  });
  $("body").scrollspy({target: ".sidenav"});
</script>
  </body>
</html>