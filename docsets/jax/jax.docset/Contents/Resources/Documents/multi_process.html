
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Using JAX in multi-host and multi-process environments — JAX  documentation</title>
<!-- Loaded before other Sphinx assets -->
<link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="_static/pygments.css" rel="stylesheet" type="text/css">
<link href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="_static/plot_directive.css" rel="stylesheet" type="text/css">
<link href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="_static/style.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/clipboard.min.js"></script>
<script src="_static/copybutton.js"></script>
<script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<link href="_static/favicon.png" rel="shortcut icon">
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="api_compatibility.html" rel="next" title="API compatibility"/>
<link href="notebooks/xmap_tutorial.html" rel="prev" title="Named axes and easy-to-revise parallelism"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="_static/jax_logo_250px.png"/>
</a>
</div><form action="search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="installation.html">
   Installing JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/quickstart.html">
   JAX Quickstart
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/thinking_in_jax.html">
   How to Think in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Common_Gotchas_in_JAX.html">
   🔪 JAX - The Sharp Bits 🔪
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="jax-101/index.html">
   Tutorial: JAX 101
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/01-jax-basics.html">
     JAX As Accelerated NumPy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/02-jitting.html">
     Just In Time Compilation with JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/03-vectorization.html">
     Automatic Vectorization in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/04-advanced-autodiff.html">
     Advanced Automatic Differentiation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/05-random-numbers.html">
     Pseudo Random Numbers in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/05.1-pytrees.html">
     Working with Pytrees
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/06-parallelism.html">
     Parallel Evaluation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/07-state.html">
     Stateful Computations in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/08-pjit.html">
     Introduction to pjit
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="debugging/index.html">
   Runtime value debugging in JAX
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="debugging/print_breakpoint.html">
<code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
     and
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.breakpoint
      </span>
</code>
</a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="debugging/checkify_guide.html">
     The
     <code class="docutils literal notranslate">
<span class="pre">
       checkify
      </span>
</code>
     transformation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="debugging/flags.html">
     JAX debugging flags
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Reference Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="faq.html">
   JAX Frequently Asked Questions (FAQ)
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="async_dispatch.html">
   Asynchronous dispatch
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="aot.html">
   Ahead-of-time lowering and compilation
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="jaxpr.html">
   Understanding Jaxprs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/convolutions.html">
   Convolutions in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="pytrees.html">
   Pytrees
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="type_promotion.html">
   Type promotion semantics
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="errors.html">
   JAX Errors
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="transfer_guard.html">
   Transfer guard
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="glossary.html">
   JAX Glossary of Terms
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="changelog.html">
   Change log
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Advanced JAX Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="notebooks/autodiff_cookbook.html">
   The Autodiff Cookbook
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/vmapped_log_probs.html">
   Autobatching log-densities example
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/neural_network_with_tfds_data.html">
   Training a Simple Neural Network, with tensorflow/datasets Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Custom_derivative_rules_for_Python_code.html">
   Custom derivative rules for JAX-transformable Python functions
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/How_JAX_primitives_work.html">
   How JAX primitives work
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Writing_custom_interpreters_in_Jax.html">
   Writing custom Jaxpr interpreters in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Neural_Network_and_Data_Loading.html">
   Training a Simple Neural Network, with PyTorch Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/xmap_tutorial.html">
   Named axes and easy-to-revise parallelism
  </a>
</li>
<li class="toctree-l1 current active">
<a class="current reference internal" href="#">
   Using JAX in multi-host and multi-process environments
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Notes
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="api_compatibility.html">
   API compatibility
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="deprecation.html">
   Python and NumPy version support policy
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="concurrency.html">
   Concurrency
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="gpu_memory_allocation.html">
   GPU memory allocation
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="profiling.html">
   Profiling JAX programs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="device_memory_profiling.html">
   Device Memory Profiling
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="rank_promotion_warning.html">
   Rank promotion warning
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="contributing.html">
   Contributing to JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="developer.html">
   Building from source
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="jax_internal_api.html">
   Internal APIs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="autodidax.html">
   Autodidax: JAX core from scratch
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="jep/index.html">
   JAX Enhancement Proposals (JEPs)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jep/263-prng.html">
     263: JAX PRNG Design
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/2026-custom-derivatives.html">
     2026: Custom JVP/VJP rules for JAX-transformable functions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/4008-custom-vjp-update.html">
     4008: Custom VJP and `nondiff_argnums` update
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/4410-omnistaging.html">
     4410: Omnistaging
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/9407-type-promotion.html">
     9407: Design of Type Promotion Semantics for JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/9419-jax-versioning.html">
     9419: Jax and Jaxlib versioning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/10657-sequencing-effects.html">
     10657: Sequencing side-effects in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/11830-new-remat-checkpoint.html">
     11830: `jax.remat` / `jax.checkpoint` new implementation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/12049-type-annotations.html">
     12049: Type Annotation Roadmap for JAX
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  API documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="jax.html">
   Public API: jax package
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jax.numpy.html">
     jax.numpy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.scipy.html">
     jax.scipy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.config.html">
     JAX configuration
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.debug.html">
     jax.debug package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.dlpack.html">
     jax.dlpack module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.distributed.html">
     jax.distributed module
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.example_libraries.html">
     jax.example_libraries package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.example_libraries.optimizers.html">
       jax.example_libraries.optimizers module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.example_libraries.stax.html">
       jax.example_libraries.stax module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.experimental.html">
     jax.experimental package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.checkify.html">
       jax.experimental.checkify module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.global_device_array.html">
       jax.experimental.global_device_array module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.host_callback.html">
       jax.experimental.host_callback module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.maps.html">
       jax.experimental.maps module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.pjit.html">
       jax.experimental.pjit module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.sparse.html">
       jax.experimental.sparse module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.jet.html">
       jax.experimental.jet module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.flatten_util.html">
     jax.flatten_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.image.html">
     jax.image package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.lax.html">
     jax.lax package
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.nn.html">
     jax.nn package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.nn.initializers.html">
       jax.nn.initializers package
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.ops.html">
     jax.ops package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.profiler.html">
     jax.profiler module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.random.html">
     jax.random package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.stages.html">
     jax.stages package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.tree_util.html">
     jax.tree_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.lib.html">
     jax.lib package
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<a class="headerbtn" data-placement="bottom" data-toggle="tooltip" href="https://github.com/google/jax" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
</a>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="_sources/multi_process.md.txt" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.md</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-process-programming-model">
   Multi-process programming model
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#launching-jax-processes">
     Launching JAX processes
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#initializing-the-cluster">
     Initializing the cluster
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#local-vs-global-devices">
     Local vs. global devices
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#running-multi-process-computations">
     Running multi-process computations
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Using JAX in multi-host and multi-process environments</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-process-programming-model">
   Multi-process programming model
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#launching-jax-processes">
     Launching JAX processes
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#initializing-the-cluster">
     Initializing the cluster
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#local-vs-global-devices">
     Local vs. global devices
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#running-multi-process-computations">
     Running multi-process computations
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Using JAX in multi-host and multi-process environments"></a><section class="tex2jax_ignore mathjax_ignore" id="using-jax-in-multi-host-and-multi-process-environments">
<h1>Using JAX in multi-host and multi-process environments<a class="headerlink" href="#using-jax-in-multi-host-and-multi-process-environments" title="Permalink to this headline">#</a></h1>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Introduction"></a><section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>This guide explains how to use JAX in environments such as
GPU clusters and <a class="reference external" href="https://cloud.google.com/tpu">Cloud TPU</a> pods where
accelerators are spread across multiple CPU hosts or JAX processes. We’ll refer
to these as “multi-process” environments.</p>
<p>This guide specifically focuses on how to use collective communication
operations (e.g. <a class="reference internal" href="_autosummary/jax.lax.psum.html#jax.lax.psum" title="jax.lax.psum"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.psum()</span></code></a> ) in multi-process settings, although
other communication methods may be useful too depending on your use case (e.g.
RPC, <a class="reference external" href="https://github.com/mpi4jax/mpi4jax">mpi4jax</a>). If you’re not already
familiar with JAX’s collective operations, we recommend starting with the
<a class="reference internal" href="jax-101/06-parallelism.html"><span class="doc">Parallel Evaluation in JAX</span></a> notebook. An important requirement of
multi-process environments in JAX is direct communication links between
accelerators, e.g. the high-speed interconnects for Cloud TPUs or
<a class="reference external" href="https://developer.nvidia.com/nccl">NCCL</a> for GPUs. These links allow
collective operations to run across multiple processes’ worth of accelerators
with high performance.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Multi-process programming model"></a><section id="multi-process-programming-model">
<h2>Multi-process programming model<a class="headerlink" href="#multi-process-programming-model" title="Permalink to this headline">#</a></h2>
<p>Key concepts:</p>
<ul class="simple">
<li><p>You must run at least one JAX process per host.</p></li>
<li><p>You should initialize the cluster with <a class="reference internal" href="_autosummary/jax.distributed.initialize.html#jax.distributed.initialize" title="jax.distributed.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.distributed.initialize()</span></code></a>.</p></li>
<li><p>Each process has a
distinct set of <em>local</em> devices it can address. The <em>global</em> devices are the set
of all devices across all processes.</p></li>
<li><p>Use standard JAX parallelism APIs like <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">pmap()</span></code></a> and
<a class="reference internal" href="_autosummary/jax.experimental.maps.xmap.html#jax.experimental.maps.xmap" title="jax.experimental.maps.xmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">xmap()</span></code></a> . Each process “sees” <em>local</em> input and
output to parallelized functions, but communication inside the computations
is <em>global</em>.</p></li>
<li><p>Make sure all processes run the same parallel computations in the same
order.</p></li>
</ul>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Launching JAX processes"></a><section id="launching-jax-processes">
<h3>Launching JAX processes<a class="headerlink" href="#launching-jax-processes" title="Permalink to this headline">#</a></h3>
<p>Unlike other distributed systems where a single controller node manages many
worker nodes, JAX uses a “multi-controller” programming model where each JAX
Python process runs independently, sometimes referred to as a <a class="reference internal" href="glossary.html#term-SPMD"><span class="xref std std-term">Single Program, Multiple Data (SPMD)</span></a> model. Generally, the same JAX Python
program is run in each process, with only slight differences between each
process’s execution (e.g. different processes will load different input data).
Furthermore, <strong>you must manually run your JAX program on each host!</strong> JAX
doesn’t automatically start multiple processes from a single program invocation.</p>
<p>(The requirement for multiple processes is why this guide isn’t offered as a
notebook – we don’t currently have a good way to manage multiple Python
processes from a single notebook.)</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Initializing the cluster"></a><section id="initializing-the-cluster">
<h3>Initializing the cluster<a class="headerlink" href="#initializing-the-cluster" title="Permalink to this headline">#</a></h3>
<p>To initialize the cluster, you should call <a class="reference internal" href="_autosummary/jax.distributed.initialize.html#jax.distributed.initialize" title="jax.distributed.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.distributed.initialize()</span></code></a> at
the start of each process. <a class="reference internal" href="_autosummary/jax.distributed.initialize.html#jax.distributed.initialize" title="jax.distributed.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.distributed.initialize()</span></code></a> must be called
early in the program, before any JAX computations are executed.</p>
<p>The API <a class="reference internal" href="_autosummary/jax.distributed.initialize.html#jax.distributed.initialize" title="jax.distributed.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.distributed.initialize()</span></code></a> takes several arguments, namely:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">coordinator_address</span></code>: the IP address of process 0 in your cluster, together
with a port available on that process. Process 0 will start a JAX service
exposed via that IP address and port, to which the other processes in the
cluster will connect.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_processes</span></code>: the number of processes in the cluster</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">process_id</span></code>: the ID number of this process, in the range <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">..</span> <span class="pre">num_processes)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">local_device_ids</span></code>: Restricts the visible devices of the current process to
<code class="docutils literal notranslate"><span class="pre">local_device_ids</span></code>.</p></li>
</ul>
<p>For example on GPU, a typical usage is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>

<span class="n">jax</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">coordinator_address</span><span class="o">=</span><span class="s2">"192.168.0.1:1234"</span><span class="p">,</span>
                           <span class="n">num_processes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">process_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>On Cloud TPU and Slurm environments, you can simply call <a class="reference internal" href="_autosummary/jax.distributed.initialize.html#jax.distributed.initialize" title="jax.distributed.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.distributed.initialize()</span></code></a> with no
arguments. Default values for the arguments will be chosen automatically.
When running on GPUs with Slurm, it is assumed that one process is started per GPU, i.e. each process will
be assigned only one visible local device. Otherwise it is assumed that one process is started per host,
i.e. each process will be assigned all local devices.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>

<span class="n">jax</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
<p>On TPU at present calling <a class="reference internal" href="_autosummary/jax.distributed.initialize.html#jax.distributed.initialize" title="jax.distributed.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.distributed.initialize()</span></code></a> is optional, but
recommanded since it enables additional checkpointing and health checking features.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Local vs. global devices"></a><section id="local-vs-global-devices">
<h3>Local vs. global devices<a class="headerlink" href="#local-vs-global-devices" title="Permalink to this headline">#</a></h3>
<p>Before we get to running multi-process computations from your program, it’s
important to understand the distinction between <em>local</em> and <em>global</em> devices.</p>
<p><strong>A process’s <em>local</em> devices are those that it can directly address and launch
computations on.</strong> For example, on a GPU cluster, each host can only launch
computations on the directly attached GPUs. On a Cloud TPU pod, each host can
only launch computations on the 8 TPU cores attached directly to that host (see
the
<a class="reference external" href="https://cloud.google.com/tpu/docs/system-architecture">Cloud TPU System Architecture</a>
documentation for more details). You can see a process’s local devices via
<a class="reference internal" href="_autosummary/jax.local_devices.html#jax.local_devices" title="jax.local_devices"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.local_devices()</span></code></a> .</p>
<p><strong>The <em>global</em> devices are the devices across all processes.</strong> A computation can
span devices across processes and perform collective operations via the direct
communication links between devices, as long as each process launches the
computation on its local devices. You can see all available global devices via
<a class="reference internal" href="_autosummary/jax.devices.html#jax.devices" title="jax.devices"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.devices()</span></code></a> . A process’s local devices are always a subset of the
global devices.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Running multi-process computations"></a><section id="running-multi-process-computations">
<h3>Running multi-process computations<a class="headerlink" href="#running-multi-process-computations" title="Permalink to this headline">#</a></h3>
<p>So how do you actually run a computation involving cross-process communication?
<strong>Use the same parallel evaluation APIs that you would in a single process!</strong></p>
<p>For example, <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">pmap()</span></code></a> can be used to run a parallel computation across
multiple processes. (If you’re not already familiar with how to use
<a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">pmap()</span></code></a> to run across multiple devices within a single process, check
out the <a class="reference internal" href="jax-101/06-parallelism.html"><span class="doc">Parallel Evaluation in JAX</span></a> notebook.) Each process should call the
same pmapped function and pass in arguments to be mapped across its <em>local</em>
devices (i.e., the pmapped axis size is equal to the number of local devices).
Similarly, the function will return outputs sharded across <em>local</em> devices only.
Inside the function, however, collective communication operations are run across
all <em>global</em> devices, across all processes. Conceptually, this can be thought of
as running a pmap over a single array sharded across hosts, where each host
“sees” only its local shard of the input and output.</p>
<p>Here’s an example of multi-process pmap in action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The following is run in parallel on each host on a GPU cluster or TPU pod slice.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">jax</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>  <span class="c1"># On GPU, see above for the necessary arguments.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">device_count</span><span class="p">()</span>  <span class="c1"># total number of accelerator devices in the cluster</span>
<span class="mi">32</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">local_device_count</span><span class="p">()</span>  <span class="c1"># number of accelerator devices attached to this host</span>
<span class="mi">8</span>
<span class="c1"># The psum is performed over all mapped devices across the pod slice</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">local_device_count</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">pmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">psum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">),</span> <span class="n">axis_name</span><span class="o">=</span><span class="s1">'i'</span><span class="p">)(</span><span class="n">xs</span><span class="p">)</span>
<span class="n">ShardedDeviceArray</span><span class="p">([</span><span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">,</span> <span class="mf">32.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="_autosummary/jax.experimental.maps.xmap.html#jax.experimental.maps.xmap" title="jax.experimental.maps.xmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">xmap()</span></code></a> works similarly when using a physical
hardware mesh (see the <a class="reference internal" href="notebooks/xmap_tutorial.html"><span class="doc">xmap tutorial</span></a> if you’re
not familiar with the single-process version). Like <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">pmap()</span></code></a> , the
inputs and outputs are local and any parallel communication inside the xmapped
function is global. The mesh is also global.</p>
<p><strong>It’s very important that all processes run the same cross-process computations
in the same order.</strong> Running the same JAX Python program in each process is
usually sufficient. Some common pitfalls to look out for that may cause
differently-ordered computations despite running the same program:</p>
<ul class="simple">
<li><p>Processes passing differently-shaped inputs to the same parallel function
can cause hangs or incorrect return values. Differently-shaped inputs are
safe so long as they result in identically-shaped per-device data shards
across processes; e.g. passing in different leading batch sizes in order to
run on different numbers of local devices per process is ok, but having each
process pad its batch to a different max example length is not.</p></li>
<li><p>“Last batch” issues where a parallel function is called in a (training)
loop, and one or more processes exit the loop earlier than the rest. This
will cause the rest to hang waiting for the already-finished processes to
start the computation.</p></li>
</ul>
</section>
</section>
</section>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="notebooks/xmap_tutorial.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Named axes and easy-to-revise parallelism</p>
</div>
</a>
<a class="right-next" href="api_compatibility.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">API compatibility</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By The JAX authors<br/>
  
      © Copyright 2020, The JAX Authors. NumPy and SciPy documentation are copyright the respective authors..<br/>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>