
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Understanding Jaxprs ‚Äî JAX  documentation</title>
<!-- Loaded before other Sphinx assets -->
<link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="_static/pygments.css" rel="stylesheet" type="text/css">
<link href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="_static/plot_directive.css" rel="stylesheet" type="text/css">
<link href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="_static/style.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/clipboard.min.js"></script>
<script src="_static/copybutton.js"></script>
<script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<link href="_static/favicon.png" rel="shortcut icon">
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="notebooks/convolutions.html" rel="next" title="Convolutions in JAX"/>
<link href="aot.html" rel="prev" title="Ahead-of-time lowering and compilation"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="_static/jax_logo_250px.png"/>
</a>
</div><form action="search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="installation.html">
   Installing JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/quickstart.html">
   JAX Quickstart
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/thinking_in_jax.html">
   How to Think in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Common_Gotchas_in_JAX.html">
   üî™ JAX - The Sharp Bits üî™
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="jax-101/index.html">
   Tutorial: JAX 101
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/01-jax-basics.html">
     JAX As Accelerated NumPy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/02-jitting.html">
     Just In Time Compilation with JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/03-vectorization.html">
     Automatic Vectorization in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/04-advanced-autodiff.html">
     Advanced Automatic Differentiation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/05-random-numbers.html">
     Pseudo Random Numbers in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/05.1-pytrees.html">
     Working with Pytrees
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/06-parallelism.html">
     Parallel Evaluation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/07-state.html">
     Stateful Computations in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/08-pjit.html">
     Introduction to pjit
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="debugging/index.html">
   Runtime value debugging in JAX
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="debugging/print_breakpoint.html">
<code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
     and
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.breakpoint
      </span>
</code>
</a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="debugging/checkify_guide.html">
     The
     <code class="docutils literal notranslate">
<span class="pre">
       checkify
      </span>
</code>
     transformation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="debugging/flags.html">
     JAX debugging flags
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Reference Documentation
 </span>
</p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="faq.html">
   JAX Frequently Asked Questions (FAQ)
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="async_dispatch.html">
   Asynchronous dispatch
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="aot.html">
   Ahead-of-time lowering and compilation
  </a>
</li>
<li class="toctree-l1 current active">
<a class="current reference internal" href="#">
   Understanding Jaxprs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/convolutions.html">
   Convolutions in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="pytrees.html">
   Pytrees
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="type_promotion.html">
   Type promotion semantics
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="errors.html">
   JAX Errors
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="transfer_guard.html">
   Transfer guard
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="glossary.html">
   JAX Glossary of Terms
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="changelog.html">
   Change log
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Advanced JAX Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="notebooks/autodiff_cookbook.html">
   The Autodiff Cookbook
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/vmapped_log_probs.html">
   Autobatching log-densities example
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/neural_network_with_tfds_data.html">
   Training a Simple Neural Network, with tensorflow/datasets Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Custom_derivative_rules_for_Python_code.html">
   Custom derivative rules for JAX-transformable Python functions
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/How_JAX_primitives_work.html">
   How JAX primitives work
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Writing_custom_interpreters_in_Jax.html">
   Writing custom Jaxpr interpreters in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Neural_Network_and_Data_Loading.html">
   Training a Simple Neural Network, with PyTorch Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/xmap_tutorial.html">
   Named axes and easy-to-revise parallelism
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="multi_process.html">
   Using JAX in multi-host and multi-process environments
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Notes
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="api_compatibility.html">
   API compatibility
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="deprecation.html">
   Python and NumPy version support policy
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="concurrency.html">
   Concurrency
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="gpu_memory_allocation.html">
   GPU memory allocation
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="profiling.html">
   Profiling JAX programs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="device_memory_profiling.html">
   Device Memory Profiling
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="rank_promotion_warning.html">
   Rank promotion warning
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="contributing.html">
   Contributing to JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="developer.html">
   Building from source
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="jax_internal_api.html">
   Internal APIs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="autodidax.html">
   Autodidax: JAX core from scratch
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="jep/index.html">
   JAX Enhancement Proposals (JEPs)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jep/263-prng.html">
     263: JAX PRNG Design
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/2026-custom-derivatives.html">
     2026: Custom JVP/VJP rules for JAX-transformable functions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/4008-custom-vjp-update.html">
     4008: Custom VJP and `nondiff_argnums` update
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/4410-omnistaging.html">
     4410: Omnistaging
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/9407-type-promotion.html">
     9407: Design of Type Promotion Semantics for JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/9419-jax-versioning.html">
     9419: Jax and Jaxlib versioning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/10657-sequencing-effects.html">
     10657: Sequencing side-effects in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/11830-new-remat-checkpoint.html">
     11830: `jax.remat` / `jax.checkpoint` new implementation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/12049-type-annotations.html">
     12049: Type Annotation Roadmap for JAX
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  API documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="jax.html">
   Public API: jax package
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jax.numpy.html">
     jax.numpy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.scipy.html">
     jax.scipy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.config.html">
     JAX configuration
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.debug.html">
     jax.debug package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.dlpack.html">
     jax.dlpack module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.distributed.html">
     jax.distributed module
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.example_libraries.html">
     jax.example_libraries package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.example_libraries.optimizers.html">
       jax.example_libraries.optimizers module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.example_libraries.stax.html">
       jax.example_libraries.stax module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.experimental.html">
     jax.experimental package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.checkify.html">
       jax.experimental.checkify module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.global_device_array.html">
       jax.experimental.global_device_array module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.host_callback.html">
       jax.experimental.host_callback module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.maps.html">
       jax.experimental.maps module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.pjit.html">
       jax.experimental.pjit module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.sparse.html">
       jax.experimental.sparse module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.jet.html">
       jax.experimental.jet module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.flatten_util.html">
     jax.flatten_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.image.html">
     jax.image package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.lax.html">
     jax.lax package
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.nn.html">
     jax.nn package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.nn.initializers.html">
       jax.nn.initializers package
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.ops.html">
     jax.ops package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.profiler.html">
     jax.profiler module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.random.html">
     jax.random package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.stages.html">
     jax.stages package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.tree_util.html">
     jax.tree_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.lib.html">
     jax.lib package
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<a class="headerbtn" data-placement="bottom" data-toggle="tooltip" href="https://github.com/google/jax" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
</a>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="_sources/jaxpr.rst.txt" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.rst</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#handling-pytrees">
   Handling PyTrees
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#constant-vars">
   Constant Vars
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#higher-order-primitives">
   Higher-order primitives
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#conditionals">
     Conditionals
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#while">
     While
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#scan">
     Scan
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#xla-call">
     XLA_call
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#xla-pmap">
     XLA_pmap
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Understanding Jaxprs</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#handling-pytrees">
   Handling PyTrees
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#constant-vars">
   Constant Vars
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#higher-order-primitives">
   Higher-order primitives
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#conditionals">
     Conditionals
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#while">
     While
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#scan">
     Scan
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#xla-call">
     XLA_call
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#xla-pmap">
     XLA_pmap
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Understanding Jaxprs"></a><section id="understanding-jaxprs">
<span id="id1"></span><h1>Understanding Jaxprs<a class="headerlink" href="#understanding-jaxprs" title="Permalink to this headline">#</a></h1>
<p>Updated: May 3, 2020 (for commit f1a46fe).</p>
<p>Conceptually, one can think of JAX transformations as first trace-specializing
the Python function to be transformed into a small and well-behaved
intermediate form that is then interpreted with transformation-specific
interpretation rules. One of the reasons JAX can pack so much power into such a
small software package is that it starts with a familiar and flexible
programming interface (Python with NumPy) and it uses the actual Python
interpreter to do most of the heavy lifting to distill the essence of the
computation into a simple statically-typed expression language with limited
higher-order features. That language is the jaxpr language.</p>
<p>Not all Python programs can be processed this way, but it turns out that many
scientific computing and machine learning programs can.</p>
<p>Before we proceed, it is important to point out that not all JAX
transformations literally materialize a jaxpr as described above; some, e.g.,
differentiation or batching, will apply transformations incrementally during
tracing. Nevertheless, if one wants to understand how JAX works internally, or
to make use of the result of JAX tracing, it is useful to understand jaxprs.</p>
<p>A jaxpr instance represents a function with one or more typed parameters (input
variables) and one or more typed results. The results depend only on the input
variables; there are no free variables captured from enclosing scopes. The
inputs and outputs have types, which in JAX are represented as abstract values.
There are two related representations in the code for jaxprs,
<a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a> and <a class="reference internal" href="_autosummary/jax.core.ClosedJaxpr.html#jax.core.ClosedJaxpr" title="jax.core.ClosedJaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.ClosedJaxpr</span></code></a>. A
<a class="reference internal" href="_autosummary/jax.core.ClosedJaxpr.html#jax.core.ClosedJaxpr" title="jax.core.ClosedJaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.ClosedJaxpr</span></code></a> represents a partially-applied
<a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a>, and is what you obtain when you use
<a class="reference internal" href="_autosummary/jax.make_jaxpr.html#jax.make_jaxpr" title="jax.make_jaxpr"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.make_jaxpr()</span></code></a> to inspect jaxprs. It has the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jaxpr</span></code>: is a <a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a> representing the actual
computation content of the function (described below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consts</span></code> is a list of constants.</p></li>
</ul>
</div></blockquote>
<p>The most interesting part of the ClosedJaxpr is the actual execution content,
represented as a <a class="reference internal" href="_autosummary/jax.core.Jaxpr.html#jax.core.Jaxpr" title="jax.core.Jaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.Jaxpr</span></code></a> as printed using the following
grammar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jaxpr</span> <span class="p">:</span><span class="o">:=</span> <span class="p">{</span> <span class="k">lambda</span> <span class="n">Var</span><span class="o">*</span> <span class="p">;</span> <span class="n">Var</span><span class="o">+.</span>
            <span class="n">let</span> <span class="n">Eqn</span><span class="o">*</span>
            <span class="ow">in</span>  <span class="p">[</span><span class="n">Expr</span><span class="o">+</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt>where:</dt><dd><ul class="simple">
<li><p>The parameters of the jaxpr are shown as two lists of variables separated by
<code class="docutils literal notranslate"><span class="pre">;</span></code>. The first set of variables are the ones that have been introduced
to stand for constants that have been hoisted out. These are called the
<code class="docutils literal notranslate"><span class="pre">constvars</span></code>, and in a <a class="reference internal" href="_autosummary/jax.core.ClosedJaxpr.html#jax.core.ClosedJaxpr" title="jax.core.ClosedJaxpr"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.core.ClosedJaxpr</span></code></a> the <code class="docutils literal notranslate"><span class="pre">consts</span></code>
field holds corresponding values. The second list of variables, called
<code class="docutils literal notranslate"><span class="pre">invars</span></code>, correspond to the inputs of the traced Python function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Eqn*</span></code> is a list of equations, defining intermediate variables referring to
intermediate expressions. Each equation defines one or more variables as the
result of applying a primitive on some atomic expressions. Each equation uses only
input variables and intermediate variables defined by previous equations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Expr+</span></code>: is a list of output atomic expressions (literals or variables)
for the jaxpr.</p></li>
</ul>
</dd>
</dl>
<p>Equations are printed as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Eqn</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">let</span> <span class="n">Var</span><span class="o">+</span> <span class="o">=</span> <span class="n">Primitive</span> <span class="p">[</span> <span class="n">Param</span><span class="o">*</span> <span class="p">]</span> <span class="n">Expr</span><span class="o">+</span>
</pre></div>
</div>
<dl class="simple">
<dt>where:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Var+</span></code> are one or more intermediate variables to be defined as the output
of a primitive invocation (some primitives can return multiple values).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Expr+</span></code> are one or more atomic expressions, each either a variable or a
literal constant. A special variable <code class="docutils literal notranslate"><span class="pre">unitvar</span></code> or literal <code class="docutils literal notranslate"><span class="pre">unit</span></code>,
printed as <code class="docutils literal notranslate"><span class="pre">*</span></code>, represents a value that is not needed
in the rest of the computation and has been elided. That is, units are just
placeholders.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Param*</span></code> are zero or more named parameters to the primitive, printed in
square brackets. Each parameter is shown as <code class="docutils literal notranslate"><span class="pre">Name</span> <span class="pre">=</span> <span class="pre">Value</span></code>.</p></li>
</ul>
</dd>
</dl>
<p>Most jaxpr primitives are first-order (they take just one or more Expr as arguments):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Primitive</span> <span class="o">:=</span> <span class="n">add</span> <span class="o">|</span> <span class="n">sub</span> <span class="o">|</span> <span class="n">sin</span> <span class="o">|</span> <span class="n">mul</span> <span class="o">|</span> <span class="o">...</span>
</pre></div>
</div>
<p>The jaxpr primitives are documented in the <a class="reference internal" href="jax.lax.html#module-jax.lax" title="jax.lax"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.lax</span></code></a> module.</p>
<p>For example, here is the jaxpr produced for the function <code class="docutils literal notranslate"><span class="pre">func1</span></code> below</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">make_jaxpr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">temp</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func1</span><span class="p">)(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="go">{ lambda ; a:f32[8] b:f32[8]. let</span>
<span class="go">    c:f32[8] = sin b</span>
<span class="go">    d:f32[8] = mul c 3.0</span>
<span class="go">    e:f32[8] = add a d</span>
<span class="go">    f:f32[] = reduce_sum[axes=(0,)] e</span>
<span class="go">  in (f,) }</span>
</pre></div>
</div>
<p>Here there are no constvars, <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are the input variables
and they correspond respectively to
<code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">second</span></code> function parameters. The scalar literal <code class="docutils literal notranslate"><span class="pre">3.0</span></code> is kept
inline.
The <code class="docutils literal notranslate"><span class="pre">reduce_sum</span></code> primitive has named parameters <code class="docutils literal notranslate"><span class="pre">axes</span></code> and <code class="docutils literal notranslate"><span class="pre">input_shape</span></code>, in
addition to the operand <code class="docutils literal notranslate"><span class="pre">e</span></code>.</p>
<p>Note that even though execution of a program that calls into JAX builds a jaxpr,
Python-level control-flow and Python-level functions execute normally.
This means that just because a Python program contains functions and control-flow,
the resulting jaxpr does not have to contain control-flow or higher-order features.</p>
<p>For example, when tracing the function <code class="docutils literal notranslate"><span class="pre">func3</span></code> JAX will inline the call to
<code class="docutils literal notranslate"><span class="pre">inner</span></code> and the conditional <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">second.shape[0]</span> <span class="pre">&gt;</span> <span class="pre">4</span></code>, and will produce the same
jaxpr as before</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">temp</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">inner</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">if</span> <span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="kc">False</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func3</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">func2</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func3</span><span class="p">)(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="go">{ lambda ; a:f32[8] b:f32[8]. let</span>
<span class="go">    c:f32[8] = sin b</span>
<span class="go">    d:f32[8] = mul c 3.0</span>
<span class="go">    e:f32[8] = add a d</span>
<span class="go">    f:f32[] = reduce_sum[axes=(0,)] e</span>
<span class="go">  in (f,) }</span>
</pre></div>
</div>
<section id="handling-pytrees">
<h2>Handling PyTrees<a class="headerlink" href="#handling-pytrees" title="Permalink to this headline">#</a></h2>
<p>In jaxpr there are no tuple types; instead primitives take multiple inputs
and produce multiple outputs. When processing a function that has structured
inputs or outputs, JAX will flatten those and in jaxpr they will appear as lists
of inputs and outputs. For more details, please see the documentation for
PyTrees (<a class="reference internal" href="pytrees.html#pytrees"><span class="std std-ref">Pytrees</span></a>).</p>
<p>For example, the following code produces an identical jaxpr to what we saw
before (with two input vars, one for each element of the input tuple)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func4</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>  <span class="c1"># Arg is a pair</span>
<span class="gp">... </span>  <span class="n">temp</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">3.</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func4</span><span class="p">)((</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">))))</span>
<span class="go">{ lambda ; a:f32[8] b:f32[8]. let</span>
<span class="go">    c:f32[8] = sin b</span>
<span class="go">    d:f32[8] = mul c 3.0</span>
<span class="go">    e:f32[8] = add a d</span>
<span class="go">    f:f32[] = reduce_sum[axes=(0,)] e</span>
<span class="go">  in (f,) }</span>
</pre></div>
</div>
</section>
<section id="constant-vars">
<h2>Constant Vars<a class="headerlink" href="#constant-vars" title="Permalink to this headline">#</a></h2>
<p>Some values in jaxprs are constants, in that their value does not depend on the
jaxpr‚Äôs arguments. When these values are scalars they are represented directly
in the jaxpr equations; non-scalar array constants are instead hoisted out to
the top-level jaxpr, where they correspond to constant variables (‚Äúconstvars‚Äù).
These constvars differ from the other jaxpr parameters (‚Äúinvars‚Äù) only as a
bookkeeping convention.</p>
</section>
<section id="higher-order-primitives">
<h2>Higher-order primitives<a class="headerlink" href="#higher-order-primitives" title="Permalink to this headline">#</a></h2>
<p>jaxpr includes several higher-order primitives. They are more complicated because
they include sub-jaxprs.</p>
<section id="conditionals">
<h3>Conditionals<a class="headerlink" href="#conditionals" title="Permalink to this headline">#</a></h3>
<p>JAX traces through normal Python conditionals. To capture a
conditional expression for dynamic execution, one must use the
<a class="reference internal" href="_autosummary/jax.lax.switch.html#jax.lax.switch" title="jax.lax.switch"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.switch()</span></code></a> and <a class="reference internal" href="_autosummary/jax.lax.cond.html#jax.lax.cond" title="jax.lax.cond"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.cond()</span></code></a> constructors,
which have the signatures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">branches</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">],</span> <span class="n">operand</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span>

<span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">pred</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">true_body</span><span class="p">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">,</span> <span class="n">false_body</span><span class="p">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">,</span> <span class="n">operand</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span>
</pre></div>
</div>
<p>Both of these will bind a primitive called <code class="docutils literal notranslate"><span class="pre">cond</span></code> internally. The
<code class="docutils literal notranslate"><span class="pre">cond</span></code> primitive in jaxprs reflects the more general signature of
<code class="xref py py-func docutils literal notranslate"><span class="pre">lax.switch()</span></code>: it takes an integer denoting the index of the branch
to execute (clamped into valid indexing range).</p>
<p>For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">one_of_three</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">3.</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="n">arg</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">one_of_three</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:i32[] b:f32[]. let</span>
<span class="go">    c:i32[] = convert_element_type[new_dtype=int32 weak_type=False] a</span>
<span class="go">    d:i32[] = clamp 0 c 2</span>
<span class="go">    e:f32[] = cond[</span>
<span class="go">      branches=(</span>
<span class="go">        { lambda ; f:f32[]. let g:f32[] = add f 1.0 in (g,) }</span>
<span class="go">        { lambda ; h:f32[]. let i:f32[] = sub h 2.0 in (i,) }</span>
<span class="go">        { lambda ; j:f32[]. let k:f32[] = add j 3.0 in (k,) }</span>
<span class="go">      )</span>
<span class="go">      linear=(False,)</span>
<span class="go">    ] d b</span>
<span class="go">  in (e,) }</span>
</pre></div>
</div>
<p>The cond primitive has a number of parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>branches</cite> are jaxprs that correspond to the branch
functionals. In this example, those functionals each take one
input variable, corresponding to <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p><cite>linear</cite> is a tuple of booleans that is used internally by the
auto-differentiation machinery to encode which of the input
parameters are used linearly in the conditional.</p></li>
</ul>
</div></blockquote>
<p>The above instance of the cond primitive takes two operands.  The first
one (<code class="docutils literal notranslate"><span class="pre">d</span></code>) is the branch index, then <code class="docutils literal notranslate"><span class="pre">b</span></code> is the operand (<code class="docutils literal notranslate"><span class="pre">arg</span></code>) to
be passed to whichever jaxpr in <code class="docutils literal notranslate"><span class="pre">branches</span></code> is selected by the branch
index.</p>
<p>Another example, using <code class="xref py py-func docutils literal notranslate"><span class="pre">lax.cond()</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func7</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xtrue</span><span class="p">:</span> <span class="n">xtrue</span> <span class="o">+</span> <span class="mf">3.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xfalse</span><span class="p">:</span> <span class="n">xfalse</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">arg</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func7</span><span class="p">)(</span><span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[]. let</span>
<span class="go">    b:bool[] = ge a 0.0</span>
<span class="go">    c:i32[] = convert_element_type[new_dtype=int32 weak_type=False] b</span>
<span class="go">    d:f32[] = cond[</span>
<span class="go">      branches=(</span>
<span class="go">        { lambda ; e:f32[]. let f:f32[] = sub e 3.0 in (f,) }</span>
<span class="go">        { lambda ; g:f32[]. let h:f32[] = add g 3.0 in (h,) }</span>
<span class="go">      )</span>
<span class="go">      linear=(False,)</span>
<span class="go">    ] c a</span>
<span class="go">  in (d,) }</span>
</pre></div>
</div>
<p>In this case, the boolean predicate is converted to an integer index
(0 or 1), and <code class="docutils literal notranslate"><span class="pre">branches</span></code> are jaxprs that correspond to the false and
true branch functionals, in that order. Again, each functional takes
one input variable, corresponding to <code class="docutils literal notranslate"><span class="pre">xfalse</span></code> and <code class="docutils literal notranslate"><span class="pre">xtrue</span></code>
respectively.</p>
<p>The following example shows a more complicated situation when the input
to the branch functionals is a tuple, and the <cite>false</cite> branch functional
contains a constant <code class="docutils literal notranslate"><span class="pre">jnp.ones(1)</span></code> that is hoisted as a <cite>constvar</cite></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func8</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>  <span class="c1"># arg2 is a pair</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">arg1</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xtrue</span><span class="p">:</span> <span class="n">xtrue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="k">lambda</span> <span class="n">xfalse</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">xfalse</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                  <span class="n">arg2</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func8</span><span class="p">)(</span><span class="mf">5.</span><span class="p">,</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mf">2.</span><span class="p">)))</span>
<span class="go">{ lambda a:i32[1]; b:f32[] c:f32[1] d:f32[]. let</span>
<span class="go">    e:bool[] = ge b 0.0</span>
<span class="go">    f:i32[] = convert_element_type[new_dtype=int32 weak_type=False] e</span>
<span class="go">    g:f32[1] = cond[</span>
<span class="go">      branches=(</span>
<span class="go">        { lambda ; h:i32[1] i:f32[1] j:f32[]. let</span>
<span class="go">            k:f32[1] = convert_element_type[new_dtype=float32 weak_type=True] h</span>
<span class="go">            l:f32[1] = add k j</span>
<span class="go">          in (l,) }</span>
<span class="go">        { lambda ; m_:i32[1] n:f32[1] o:f32[]. let  in (n,) }</span>
<span class="go">      )</span>
<span class="go">      linear=(False, False, False)</span>
<span class="go">    ] f a c d</span>
<span class="go">  in (g,) }</span>
</pre></div>
</div>
</section>
<section id="while">
<h3>While<a class="headerlink" href="#while" title="Permalink to this headline">#</a></h3>
<p>Just like for conditionals, Python loops are inlined during tracing.
If you want to capture a loop for dynamic execution, you must use one of several
special operations, <a class="reference internal" href="_autosummary/jax.lax.while_loop.html#jax.lax.while_loop" title="jax.lax.while_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.while_loop()</span></code></a> (a primitive)
and <a class="reference internal" href="_autosummary/jax.lax.fori_loop.html#jax.lax.fori_loop" title="jax.lax.fori_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.fori_loop()</span></code></a>
(a helper that generates a while_loop primitive):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="n">cond_fun</span><span class="p">:</span> <span class="p">(</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">body_fun</span><span class="p">:</span> <span class="p">(</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">),</span> <span class="n">init</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span>
<span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">),</span> <span class="n">init</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span>
</pre></div>
</div>
<p>In the above signature, ‚ÄúC‚Äù stands for the type of a the loop ‚Äúcarry‚Äù value.
For example, here is an example fori loop</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func10</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">ones</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># A constant</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">carry</span><span class="p">:</span> <span class="n">carry</span> <span class="o">+</span> <span class="n">ones</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">+</span> <span class="n">arg</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="n">arg</span> <span class="o">+</span> <span class="n">ones</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func10</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[16] b:i32[]. let</span>
<span class="go">    c:f32[16] = broadcast_in_dim[broadcast_dimensions=() shape=(16,)] 1.0</span>
<span class="go">    d:f32[16] = add a c</span>
<span class="go">    _:i32[] _:i32[] e:f32[16] = while[</span>
<span class="go">      body_jaxpr={ lambda ; f:f32[16] g:f32[16] h:i32[] i:i32[] j:f32[16]. let</span>
<span class="go">          k:i32[] = add h 1</span>
<span class="go">          l:f32[16] = mul f 3.0</span>
<span class="go">          m:f32[16] = add j l</span>
<span class="go">          n:f32[16] = add m g</span>
<span class="go">        in (k, i, n) }</span>
<span class="go">      body_nconsts=2</span>
<span class="go">      cond_jaxpr={ lambda ; o:i32[] p:i32[] q:f32[16]. let</span>
<span class="go">          r:bool[] = lt o p</span>
<span class="go">        in (r,) }</span>
<span class="go">      cond_nconsts=0</span>
<span class="go">    ] c a 0 b d</span>
<span class="go">  in (e,) }</span>
</pre></div>
</div>
<p>The while primitive takes 5 arguments: <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">a</span> <span class="pre">0</span> <span class="pre">b</span> <span class="pre">d</span></code>, as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>0 constants for <code class="docutils literal notranslate"><span class="pre">cond_jaxpr</span></code> (since <code class="docutils literal notranslate"><span class="pre">cond_nconsts</span></code> is 0)</p></li>
<li><p>2 constants for <code class="docutils literal notranslate"><span class="pre">body_jaxpr</span></code> (<code class="docutils literal notranslate"><span class="pre">c</span></code>, and <code class="docutils literal notranslate"><span class="pre">a</span></code>)</p></li>
<li><p>3 parameters for the initial value of carry</p></li>
</ul>
</div></blockquote>
</section>
<section id="scan">
<h3>Scan<a class="headerlink" href="#scan" title="Permalink to this headline">#</a></h3>
<p>JAX supports a special form of loop over the elements of an array (with
statically known shape). The fact that there are a fixed number of iterations
makes this form of looping easily reverse-differentiable. Such loops are
constructed with the <a class="reference internal" href="_autosummary/jax.lax.scan.html#jax.lax.scan" title="jax.lax.scan"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.lax.scan()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">body_fun</span><span class="p">:</span> <span class="p">(</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">)),</span> <span class="n">init_carry</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">in_arr</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">A</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">Array</span><span class="p">[</span><span class="n">B</span><span class="p">])</span>
</pre></div>
</div>
<p>This is written in terms of a <a class="reference external" href="https://wiki.haskell.org/Type_signature">Haskell Type Signature</a>:
<code class="docutils literal notranslate"><span class="pre">C</span></code> is the type of the scan carry, <code class="docutils literal notranslate"><span class="pre">A</span></code> is the element type of the
input array(s), and <code class="docutils literal notranslate"><span class="pre">B</span></code> is the element type of the output array(s).</p>
<p>For the example consider the function <code class="docutils literal notranslate"><span class="pre">func11</span></code> below</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func11</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">ones</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1">#  A constant</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">aelems</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># carry: running dot-product of the two arrays</span>
<span class="gp">... </span>    <span class="c1"># aelems: a pair with corresponding elements from the two arrays</span>
<span class="gp">... </span>    <span class="n">ae1</span><span class="p">,</span> <span class="n">ae2</span> <span class="o">=</span> <span class="n">aelems</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">carry</span> <span class="o">+</span> <span class="n">ae1</span> <span class="o">*</span> <span class="n">ae2</span> <span class="o">+</span> <span class="n">extra</span><span class="p">,</span> <span class="n">carry</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">ones</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func11</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[16] b:f32[]. let</span>
<span class="go">    c:f32[16] = broadcast_in_dim[broadcast_dimensions=() shape=(16,)] 1.0</span>
<span class="go">    d:f32[] e:f32[16] = scan[</span>
<span class="go">      jaxpr={ lambda ; f:f32[] g:f32[] h:f32[] i:f32[]. let</span>
<span class="go">          j:f32[] = mul h i</span>
<span class="go">          k:f32[] = convert_element_type[new_dtype=float32 weak_type=False] g</span>
<span class="go">          l:f32[] = add k j</span>
<span class="go">          m:f32[] = convert_element_type[new_dtype=float32 weak_type=False] f</span>
<span class="go">          n:f32[] = add l m</span>
<span class="go">        in (n, g) }</span>
<span class="go">      length=16</span>
<span class="go">      linear=(False, False, False, False)</span>
<span class="go">      num_carry=1</span>
<span class="go">      num_consts=1</span>
<span class="go">      reverse=False</span>
<span class="go">      unroll=1</span>
<span class="go">    ] b 0.0 a c</span>
<span class="go">  in (d, e) }</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">linear</span></code> parameter describes for each of the input variables whether they
are guaranteed to be used linearly in the body. Once the scan goes through
linearization, more arguments will be linear.</p>
<p>The scan primitive takes 4 arguments: <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">0.0</span> <span class="pre">a</span> <span class="pre">c</span></code>, of which:</p>
<blockquote>
<div><ul class="simple">
<li><p>one is the free variable for the body</p></li>
<li><p>one is the initial value of the carry</p></li>
<li><p>The next 2 are the arrays over which the scan operates.</p></li>
</ul>
</div></blockquote>
</section>
<section id="xla-call">
<h3>XLA_call<a class="headerlink" href="#xla-call" title="Permalink to this headline">#</a></h3>
<p>The call primitive arises from JIT compilation, and it encapsulates
a sub-jaxpr along with parameters that specify the backend and the device on
which the computation should run. For example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func12</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="gp">... </span>  <span class="nd">@jit</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Include a constant in the inner function</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">arg</span> <span class="o">+</span> <span class="n">inner</span><span class="p">(</span><span class="n">arg</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func12</span><span class="p">)(</span><span class="mf">1.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[]. let</span>
<span class="go">    b:f32[] = sub a 2.0</span>
<span class="go">    c:f32[1] = xla_call[</span>
<span class="go">      call_jaxpr={ lambda ; d:f32[] e:f32[]. let</span>
<span class="go">          f:f32[1] = broadcast_in_dim[broadcast_dimensions=() shape=(1,)] 1.0</span>
<span class="go">          g:f32[] = convert_element_type[new_dtype=float32 weak_type=False] d</span>
<span class="go">          h:f32[1] = mul g f</span>
<span class="go">          i:f32[] = convert_element_type[new_dtype=float32 weak_type=False] e</span>
<span class="go">          j:f32[1] = add i h</span>
<span class="go">        in (j,) }</span>
<span class="go">      name=inner</span>
<span class="go">    ] a b</span>
<span class="go">    k:f32[] = convert_element_type[new_dtype=float32 weak_type=False] a</span>
<span class="go">    l:f32[1] = add k c</span>
<span class="go">  in (l,) }</span>
</pre></div>
</div>
</section>
<section id="xla-pmap">
<h3>XLA_pmap<a class="headerlink" href="#xla-pmap" title="Permalink to this headline">#</a></h3>
<p>If you use the <a class="reference internal" href="_autosummary/jax.pmap.html#jax.pmap" title="jax.pmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.pmap()</span></code></a> transformation, the function to be mapped is
captured using the <code class="docutils literal notranslate"><span class="pre">xla_pmap</span></code> primitive. Consider this example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">pmap</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func13</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># use a free variable "extra" and a constant jnp.ones(1)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">extra</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">lax</span><span class="o">.</span><span class="n">psum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="s1">'rows'</span><span class="p">)</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">pmap</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">axis_name</span><span class="o">=</span><span class="s1">'rows'</span><span class="p">)(</span><span class="n">arr</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">make_jaxpr</span><span class="p">(</span><span class="n">func13</span><span class="p">)(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mf">5.</span><span class="p">))</span>
<span class="go">{ lambda ; a:f32[1,3] b:f32[]. let</span>
<span class="go">    c:f32[1,3] = xla_pmap[</span>
<span class="go">      axis_name=rows</span>
<span class="go">      axis_size=1</span>
<span class="go">      backend=None</span>
<span class="go">      call_jaxpr={ lambda ; d:f32[] e:f32[3]. let</span>
<span class="go">          f:f32[] = convert_element_type[new_dtype=float32 weak_type=False] d</span>
<span class="go">          g:f32[3] = add e f</span>
<span class="go">          h:f32[1] = broadcast_in_dim[broadcast_dimensions=() shape=(1,)] 1.0</span>
<span class="go">          i:f32[3] = add g h</span>
<span class="go">          j:f32[3] = psum[axes=('rows',) axis_index_groups=None] e</span>
<span class="go">          k:f32[3] = div i j</span>
<span class="go">        in (k,) }</span>
<span class="go">      devices=None</span>
<span class="go">      donated_invars=(False, False)</span>
<span class="go">      global_arg_shapes=(None,)</span>
<span class="go">      global_axis_size=None</span>
<span class="go">      in_axes=(None, 0)</span>
<span class="go">      name=inner</span>
<span class="go">      out_axes=(0,)</span>
<span class="go">    ] b a</span>
<span class="go">  in (c,) }</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">xla_pmap</span></code> primitive specifies the name of the axis (parameter
<code class="docutils literal notranslate"><span class="pre">axis_name</span></code>) and the body of the function to be mapped as the <code class="docutils literal notranslate"><span class="pre">call_jaxpr</span></code>
parameter. The value of this parameter is a Jaxpr with 2 input variables.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">in_axes</span></code> specifies which of the input variables should be
mapped and which should be broadcast. In our example, the value of <code class="docutils literal notranslate"><span class="pre">extra</span></code>
is broadcast and the value of <code class="docutils literal notranslate"><span class="pre">arr</span></code> is mapped.</p>
</section>
</section>
</section>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="aot.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Ahead-of-time lowering and compilation</p>
</div>
</a>
<a class="right-next" href="notebooks/convolutions.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Convolutions in JAX</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By The JAX authors<br/>
  
      ¬© Copyright 2020, The JAX Authors. NumPy and SciPy documentation are copyright the respective authors..<br/>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>