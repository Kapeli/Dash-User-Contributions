
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Profiling JAX programs — JAX  documentation</title>
<!-- Loaded before other Sphinx assets -->
<link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="_static/pygments.css" rel="stylesheet" type="text/css">
<link href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="_static/plot_directive.css" rel="stylesheet" type="text/css">
<link href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="_static/style.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/clipboard.min.js"></script>
<script src="_static/copybutton.js"></script>
<script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<link href="_static/favicon.png" rel="shortcut icon">
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="device_memory_profiling.html" rel="next" title="Device Memory Profiling"/>
<link href="gpu_memory_allocation.html" rel="prev" title="GPU memory allocation"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="_static/jax_logo_250px.png"/>
</a>
</div><form action="search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="installation.html">
   Installing JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/quickstart.html">
   JAX Quickstart
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/thinking_in_jax.html">
   How to Think in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Common_Gotchas_in_JAX.html">
   🔪 JAX - The Sharp Bits 🔪
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="jax-101/index.html">
   Tutorial: JAX 101
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/01-jax-basics.html">
     JAX As Accelerated NumPy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/02-jitting.html">
     Just In Time Compilation with JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/03-vectorization.html">
     Automatic Vectorization in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/04-advanced-autodiff.html">
     Advanced Automatic Differentiation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/05-random-numbers.html">
     Pseudo Random Numbers in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/05.1-pytrees.html">
     Working with Pytrees
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/06-parallelism.html">
     Parallel Evaluation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/07-state.html">
     Stateful Computations in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax-101/08-pjit.html">
     Introduction to pjit
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="debugging/index.html">
   Runtime value debugging in JAX
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="debugging/print_breakpoint.html">
<code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
     and
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.breakpoint
      </span>
</code>
</a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="debugging/checkify_guide.html">
     The
     <code class="docutils literal notranslate">
<span class="pre">
       checkify
      </span>
</code>
     transformation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="debugging/flags.html">
     JAX debugging flags
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Reference Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="faq.html">
   JAX Frequently Asked Questions (FAQ)
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="async_dispatch.html">
   Asynchronous dispatch
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="aot.html">
   Ahead-of-time lowering and compilation
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="jaxpr.html">
   Understanding Jaxprs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/convolutions.html">
   Convolutions in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="pytrees.html">
   Pytrees
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="type_promotion.html">
   Type promotion semantics
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="errors.html">
   JAX Errors
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="transfer_guard.html">
   Transfer guard
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="glossary.html">
   JAX Glossary of Terms
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="changelog.html">
   Change log
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Advanced JAX Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="notebooks/autodiff_cookbook.html">
   The Autodiff Cookbook
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/vmapped_log_probs.html">
   Autobatching log-densities example
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/neural_network_with_tfds_data.html">
   Training a Simple Neural Network, with tensorflow/datasets Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Custom_derivative_rules_for_Python_code.html">
   Custom derivative rules for JAX-transformable Python functions
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/How_JAX_primitives_work.html">
   How JAX primitives work
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Writing_custom_interpreters_in_Jax.html">
   Writing custom Jaxpr interpreters in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/Neural_Network_and_Data_Loading.html">
   Training a Simple Neural Network, with PyTorch Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="notebooks/xmap_tutorial.html">
   Named axes and easy-to-revise parallelism
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="multi_process.html">
   Using JAX in multi-host and multi-process environments
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Notes
 </span>
</p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="api_compatibility.html">
   API compatibility
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="deprecation.html">
   Python and NumPy version support policy
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="concurrency.html">
   Concurrency
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="gpu_memory_allocation.html">
   GPU memory allocation
  </a>
</li>
<li class="toctree-l1 current active">
<a class="current reference internal" href="#">
   Profiling JAX programs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="device_memory_profiling.html">
   Device Memory Profiling
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="rank_promotion_warning.html">
   Rank promotion warning
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="contributing.html">
   Contributing to JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="developer.html">
   Building from source
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="jax_internal_api.html">
   Internal APIs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="autodidax.html">
   Autodidax: JAX core from scratch
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="jep/index.html">
   JAX Enhancement Proposals (JEPs)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jep/263-prng.html">
     263: JAX PRNG Design
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/2026-custom-derivatives.html">
     2026: Custom JVP/VJP rules for JAX-transformable functions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/4008-custom-vjp-update.html">
     4008: Custom VJP and `nondiff_argnums` update
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/4410-omnistaging.html">
     4410: Omnistaging
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/9407-type-promotion.html">
     9407: Design of Type Promotion Semantics for JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/9419-jax-versioning.html">
     9419: Jax and Jaxlib versioning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/10657-sequencing-effects.html">
     10657: Sequencing side-effects in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/11830-new-remat-checkpoint.html">
     11830: `jax.remat` / `jax.checkpoint` new implementation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jep/12049-type-annotations.html">
     12049: Type Annotation Roadmap for JAX
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  API documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="jax.html">
   Public API: jax package
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="jax.numpy.html">
     jax.numpy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.scipy.html">
     jax.scipy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.config.html">
     JAX configuration
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.debug.html">
     jax.debug package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.dlpack.html">
     jax.dlpack module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.distributed.html">
     jax.distributed module
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.example_libraries.html">
     jax.example_libraries package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.example_libraries.optimizers.html">
       jax.example_libraries.optimizers module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.example_libraries.stax.html">
       jax.example_libraries.stax module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.experimental.html">
     jax.experimental package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.checkify.html">
       jax.experimental.checkify module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.global_device_array.html">
       jax.experimental.global_device_array module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.host_callback.html">
       jax.experimental.host_callback module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.maps.html">
       jax.experimental.maps module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.pjit.html">
       jax.experimental.pjit module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.sparse.html">
       jax.experimental.sparse module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="jax.experimental.jet.html">
       jax.experimental.jet module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.flatten_util.html">
     jax.flatten_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.image.html">
     jax.image package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.lax.html">
     jax.lax package
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="jax.nn.html">
     jax.nn package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="jax.nn.initializers.html">
       jax.nn.initializers package
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.ops.html">
     jax.ops package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.profiler.html">
     jax.profiler module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.random.html">
     jax.random package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.stages.html">
     jax.stages package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.tree_util.html">
     jax.tree_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="jax.lib.html">
     jax.lib package
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<a class="headerbtn" data-placement="bottom" data-toggle="tooltip" href="https://github.com/google/jax" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
</a>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="_sources/profiling.md.txt" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.md</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#viewing-program-traces-with-perfetto">
   Viewing program traces with Perfetto
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#remote-profiling">
     Remote profiling
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#manual-capture">
     Manual capture
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#tensorboard-profiling">
   TensorBoard profiling
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#installation">
     Installation
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#programmatic-capture">
     Programmatic capture
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#manual-capture-via-tensorboard">
     Manual capture via TensorBoard
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#adding-custom-trace-events">
     Adding custom trace events
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#troubleshooting">
     Troubleshooting
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#gpu-profiling">
       GPU profiling
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#profiling-on-a-remote-machine">
       Profiling on a remote machine
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#profiling-on-a-cloud-tpu-vm">
       Profiling on a Cloud TPU VM
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#multiple-tensorboard-installs">
       Multiple TensorBoard installs
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#nsight">
   Nsight
  </a>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Profiling JAX programs</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#viewing-program-traces-with-perfetto">
   Viewing program traces with Perfetto
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#remote-profiling">
     Remote profiling
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#manual-capture">
     Manual capture
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#tensorboard-profiling">
   TensorBoard profiling
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#installation">
     Installation
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#programmatic-capture">
     Programmatic capture
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#manual-capture-via-tensorboard">
     Manual capture via TensorBoard
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#adding-custom-trace-events">
     Adding custom trace events
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#troubleshooting">
     Troubleshooting
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#gpu-profiling">
       GPU profiling
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#profiling-on-a-remote-machine">
       Profiling on a remote machine
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#profiling-on-a-cloud-tpu-vm">
       Profiling on a Cloud TPU VM
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#multiple-tensorboard-installs">
       Multiple TensorBoard installs
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#nsight">
   Nsight
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Profiling JAX programs"></a><section class="tex2jax_ignore mathjax_ignore" id="profiling-jax-programs">
<h1>Profiling JAX programs<a class="headerlink" href="#profiling-jax-programs" title="Permalink to this headline">#</a></h1>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Viewing program traces with Perfetto"></a><section id="viewing-program-traces-with-perfetto">
<h2>Viewing program traces with Perfetto<a class="headerlink" href="#viewing-program-traces-with-perfetto" title="Permalink to this headline">#</a></h2>
<p>We can use the JAX profiler to generate traces of a JAX program that can be
visualized using the <a class="reference external" href="https://ui.perfetto.dev">Perfetto visualizer</a>. Currently,
this method blocks the program until a link is clicked and the Perfetto UI loads
the trace. If you wish to get profiling information without any interaction,
check out the Tensorboard profiler below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">"/tmp/jax-trace"</span><span class="p">,</span> <span class="n">create_perfetto_link</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
  <span class="c1"># Run the operations to be profiled</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">@</span> <span class="n">x</span>
  <span class="n">y</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>
</pre></div>
</div>
<p>After this computation is done, the program will prompt you to open a link to
<code class="docutils literal notranslate"><span class="pre">ui.perfetto.dev</span></code>. When you open the link, the Perfetto UI will load the trace
file and open a visualizer.</p>
<p><img alt="Perfetto trace viewer" src="_images/perfetto.png"/></p>
<p>Program execution will continue after loading the link. The link is no longer
valid after opening once, but it will redirect to a new URL that remains valid.
You can then click the “Share” button in the Perfetto UI to create a permalink
to the trace that can be shared with others.</p>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Remote profiling"></a><section id="remote-profiling">
<h3>Remote profiling<a class="headerlink" href="#remote-profiling" title="Permalink to this headline">#</a></h3>
<p>When profiling code that is running remotely (for example on a hosted VM),
you need to establish an SSH tunnel on port 9001 for the link to work. You can
do that with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ssh -L <span class="m">9001</span>:127.0.0.1:9001 &lt;user&gt;@&lt;host&gt;
</pre></div>
</div>
<p>or if you’re using Google Cloud:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gcloud compute ssh &lt;machine-name&gt; -- -L <span class="m">9001</span>:127.0.0.1:9001
</pre></div>
</div>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Manual capture"></a><section id="manual-capture">
<h3>Manual capture<a class="headerlink" href="#manual-capture" title="Permalink to this headline">#</a></h3>
<p>Instead of capturing traces programmatically using <code class="docutils literal notranslate"><span class="pre">jax.profiler.trace</span></code>, you can
instead start a profiling server in the script of interest by calling
<code class="docutils literal notranslate"><span class="pre">jax.profiler.start_server(&lt;port&gt;)</span></code>. If you only need the profiler server to be
active for a portion of your script, you can shut it down by calling
<code class="docutils literal notranslate"><span class="pre">jax.profiler.stop_server()</span></code>.</p>
<p>Once the script is running and after the profiler server has started, we can
manually capture an trace by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m jax.collect_profile &lt;port&gt; &lt;duration_in_ms&gt;
</pre></div>
</div>
<p>By default, the resulting trace information is dumped into a temporary directory
but this can be overridden by passing in <code class="docutils literal notranslate"><span class="pre">--log_dir=&lt;directory</span> <span class="pre">of</span> <span class="pre">choice&gt;</span></code>.
Also, by default, the program will prompt you to open a link to
<code class="docutils literal notranslate"><span class="pre">ui.perfetto.dev</span></code>. When you open the link, the Perfetto UI will load the trace
file and open a visualizer. This feature is disabled by passing in
<code class="docutils literal notranslate"><span class="pre">--no_perfetto_link</span></code> into the command. Alternatively, you can also point
Tensorboard to the <code class="docutils literal notranslate"><span class="pre">log_dir</span></code> to analyze the trace (see the
“Tensorboard Profiling” section below).</p>
</section>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/TensorBoard profiling"></a><section id="tensorboard-profiling">
<h2>TensorBoard profiling<a class="headerlink" href="#tensorboard-profiling" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://www.tensorflow.org/tensorboard/tensorboard_profiling_keras">TensorBoard’s
profiler</a>
can be used to profile JAX programs. Tensorboard is a great way to acquire and
visualize performance traces and profiles of your program, including activity on
GPU and TPU. The end result looks something like this:</p>
<p><img alt="TensorBoard profiler example" src="_images/tensorboard_profiler.png"/></p>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Installation"></a><section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h3>
<p>The TensorBoard profiler is only available with the version of TensorBoard
bundled with TensorFlow.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install tensorflow tbp-nightly
</pre></div>
</div>
<p>If you already have TensorFlow installed, you only need to install the
<code class="docutils literal notranslate"><span class="pre">tbp-nightly</span></code> pip package. Be careful to only install one version of TensorFlow
or TensorBoard, otherwise you may encounter the “duplicate plugins” error
described <a class="reference internal" href="#multiple-installs"><span class="std std-ref">below</span></a>.</p>
<p>(We recommend <code class="docutils literal notranslate"><span class="pre">tbp-nightly</span></code> because <code class="docutils literal notranslate"><span class="pre">tensorboard-plugin-profile==2.4.0</span></code> is
incompatible with TensorBoard’s experimental fast data loading logic. This
should be resolved with <code class="docutils literal notranslate"><span class="pre">tensorboard-plugin-profile==2.5.0</span></code> when it’s
released. These instructions were tested with <code class="docutils literal notranslate"><span class="pre">tensorflow==2.4.1</span></code> and
<code class="docutils literal notranslate"><span class="pre">tbp-nightly==2.5.0a20210428</span></code>.)</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Programmatic capture"></a><section id="programmatic-capture">
<h3>Programmatic capture<a class="headerlink" href="#programmatic-capture" title="Permalink to this headline">#</a></h3>
<p>You can instrument your code to capture a profiler trace via the
<a class="reference internal" href="_autosummary/jax.profiler.start_trace.html#jax.profiler.start_trace" title="jax.profiler.start_trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.profiler.start_trace()</span></code></a> and <a class="reference internal" href="_autosummary/jax.profiler.stop_trace.html#jax.profiler.stop_trace" title="jax.profiler.stop_trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.profiler.stop_trace()</span></code></a>
methods. Call <a class="reference internal" href="_autosummary/jax.profiler.start_trace.html#jax.profiler.start_trace" title="jax.profiler.start_trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">start_trace()</span></code></a> with the directory to write
trace files to. This should be the same <code class="docutils literal notranslate"><span class="pre">--logdir</span></code> directory used to start
TensorBoard. Then, you can use TensorBoard to view the traces.</p>
<p>For example, to take a profiler trace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>

<span class="n">jax</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_trace</span><span class="p">(</span><span class="s2">"/tmp/tensorboard"</span><span class="p">)</span>

<span class="c1"># Run the operations to be profiled</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">@</span> <span class="n">x</span>
<span class="n">y</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>

<span class="n">jax</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">stop_trace</span><span class="p">()</span>
</pre></div>
</div>
<p>Note the <code class="xref py py-func docutils literal notranslate"><span class="pre">block_until_ready()</span></code> call. We use this to make sure on-device
execution is captured by the trace. See <a class="reference internal" href="async_dispatch.html#async-dispatch"><span class="std std-ref">Asynchronous dispatch</span></a> for details on why
this is necessary.</p>
<p>You can also use the <a class="reference internal" href="_autosummary/jax.profiler.trace.html#jax.profiler.trace" title="jax.profiler.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.profiler.trace()</span></code></a> context manager as an
alternative to <code class="docutils literal notranslate"><span class="pre">start_trace</span></code> and <code class="docutils literal notranslate"><span class="pre">stop_trace</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>

<span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">trace</span><span class="p">():</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">))</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">@</span> <span class="n">x</span>
  <span class="n">y</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>
</pre></div>
</div>
<p>To view the trace, first start TensorBoard if you haven’t already:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ tensorboard --logdir<span class="o">=</span>/tmp/tensorboard
<span class="o">[</span>...<span class="o">]</span>
Serving TensorBoard on localhost<span class="p">;</span> to expose to the network, use a proxy or pass --bind_all
TensorBoard <span class="m">2</span>.5.0 at http://localhost:6006/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
</pre></div>
</div>
<p>You should be able to load TensorBoard at <a class="reference external" href="http://localhost:6006/">http://localhost:6006/</a> in this
example. You can specify a different port with the <code class="docutils literal notranslate"><span class="pre">--port</span></code> flag. See
<a class="reference internal" href="#id1"><span class="std std-ref">Profiling on a remote machine</span></a> below if running JAX on a remote server.</p>
<p>Then, either select “Profile” in the upper-right dropdown menu, or go directly
to <a class="reference external" href="http://localhost:6006/#profile">http://localhost:6006/#profile</a>. Available traces appear in the “Runs”
dropdown menu on the left. Select the run you’re interested in, and then under
“Tools”, select “trace_viewer”.  You should now see a timeline of the
execution. You can use the WASD keys to navigate the trace, and click or drag to
select events to see more details at the bottom. See <a class="reference external" href="https://www.tensorflow.org/tensorboard/tensorboard_profiling_keras#use_the_tensorflow_profiler_to_profile_model_training_performance">these TensorFlow
docs</a>
for more details on using the trace viewer.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Manual capture via TensorBoard"></a><section id="manual-capture-via-tensorboard">
<h3>Manual capture via TensorBoard<a class="headerlink" href="#manual-capture-via-tensorboard" title="Permalink to this headline">#</a></h3>
<p>The following are instructions for capturing a manually-triggered N-second trace
from a running program.</p>
<ol class="arabic">
<li><p>Start a TensorBoard server:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tensorboard --logdir /tmp/tensorboard/
</pre></div>
</div>
<p>You should be able to load TensorBoard at <a class="reference external" href="http://localhost:6006/">http://localhost:6006/</a>. You can
specify a different port with the <code class="docutils literal notranslate"><span class="pre">--port</span></code> flag. See <a class="reference internal" href="#id1"><span class="std std-ref">Profiling on a remote machine</span></a>
below if running JAX on a remote server.<br/><br/></p>
</li>
<li><p>In the Python program or process you’d like to profile, add the following
somewhere near the beginning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.profiler</span>
<span class="n">jax</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_server</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>
</pre></div>
</div>
<p>This starts the profiler server that TensorBoard connects to. The profiler
server must be running before you move on to the next step. When you’re done
using the server, you can call <code class="docutils literal notranslate"><span class="pre">jax.profiler.stop_server()</span></code> to shut it down.</p>
<p>If you’d like to profile a snippet of a long-running program (e.g. a long
training loop), you can put this at the beginning of the program and start
your program as usual. If you’d like to profile a short program (e.g. a
microbenchmark), one option is to start the profiler server in an IPython
shell, and run the short program with <code class="docutils literal notranslate"><span class="pre">%run</span></code> after starting the capture in
the next step. Another option is to start the profiler server at the
beginning of the program and use <code class="docutils literal notranslate"><span class="pre">time.sleep()</span></code> to give you enough time to
start the capture.<br/><br/></p>
</li>
<li><p>Open <a class="reference external" href="http://localhost:6006/#profile">http://localhost:6006/#profile</a>, and click the “CAPTURE PROFILE” button
in the upper left. Enter “localhost:9999” as the profile service URL (this is
the address of the profiler server you started in the previous step). Enter
the number of milliseconds you’d like to profile for, and click “CAPTURE”.<br/><br/></p></li>
<li><p>If the code you’d like to profile isn’t already running (e.g. if you started
the profiler server in a Python shell), run it while the capture is
running.<br/><br/></p></li>
<li><p>After the capture finishes, TensorBoard should automatically refresh. (Not
all of the TensorBoard profiling features are hooked up with JAX, so it may
initially look like nothing was captured.) On the left under “Tools”, select
“trace_viewer”.</p>
<p>You should now see a timeline of the execution. You can use the WASD keys to
navigate the trace, and click or drag to select events to see more details at
the bottom. See <a class="reference external" href="https://www.tensorflow.org/tensorboard/tensorboard_profiling_keras#use_the_tensorflow_profiler_to_profile_model_training_performance">these TensorFlow
docs</a>
for more details on using the trace viewer.<br/><br/></p>
</li>
</ol>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding custom trace events"></a><section id="adding-custom-trace-events">
<h3>Adding custom trace events<a class="headerlink" href="#adding-custom-trace-events" title="Permalink to this headline">#</a></h3>
<p>By default, the events in the trace viewer are mostly low-level internal JAX
functions. You can add your own events and functions by using
<a class="reference internal" href="_autosummary/jax.profiler.TraceAnnotation.html#jax.profiler.TraceAnnotation" title="jax.profiler.TraceAnnotation"><code class="xref py py-class docutils literal notranslate"><span class="pre">jax.profiler.TraceAnnotation</span></code></a> and <a class="reference internal" href="_autosummary/jax.profiler.annotate_function.html#jax.profiler.annotate_function" title="jax.profiler.annotate_function"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.profiler.annotate_function()</span></code></a> in
your code.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Troubleshooting"></a><section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">#</a></h3>
<section id="gpu-profiling">
<h4>GPU profiling<a class="headerlink" href="#gpu-profiling" title="Permalink to this headline">#</a></h4>
<p>Programs running on GPU should produce traces for the GPU streams near the top
of the trace viewer. If you’re only seeing the host traces, check your program
logs and/or output for the following error messages.</p>
<p><strong>If you get an error like: <code class="docutils literal notranslate"><span class="pre">Could</span> <span class="pre">not</span> <span class="pre">load</span> <span class="pre">dynamic</span> <span class="pre">library</span> <span class="pre">'libcupti.so.10.1'</span></code></strong><br/>
Full error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="n">external</span><span class="o">/</span><span class="n">org_tensorflow</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">55</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">load</span> <span class="n">dynamic</span> <span class="n">library</span> <span class="s1">'libcupti.so.10.1'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcupti</span><span class="o">.</span><span class="n">so</span><span class="mf">.10.1</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">12</span> <span class="mi">13</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mf">59.822799</span><span class="p">:</span> <span class="n">E</span> <span class="n">external</span><span class="o">/</span><span class="n">org_tensorflow</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">profiler</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">gpu</span><span class="o">/</span><span class="n">cupti_tracer</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">1422</span><span class="p">]</span> <span class="n">function</span> <span class="n">cupti_interface_</span><span class="o">-&gt;</span><span class="n">Subscribe</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">subscriber_</span><span class="p">,</span> <span class="p">(</span><span class="n">CUpti_CallbackFunc</span><span class="p">)</span><span class="n">ApiCallback</span><span class="p">,</span> <span class="n">this</span><span class="p">)</span><span class="n">failed</span> <span class="k">with</span> <span class="n">error</span> <span class="n">CUPTI</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">loaded</span> <span class="ow">or</span> <span class="n">symbol</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">found</span><span class="o">.</span>
</pre></div>
</div>
<p>Add the path to <code class="docutils literal notranslate"><span class="pre">libcupti.so</span></code> to the environment variable <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>.
(Try <code class="docutils literal notranslate"><span class="pre">locate</span> <span class="pre">libcupti.so</span></code> to find the path.) For example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/cuda-10.1/extras/CUPTI/lib64/:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
<p>If you still get the <code class="docutils literal notranslate"><span class="pre">Could</span> <span class="pre">not</span> <span class="pre">load</span> <span class="pre">dynamic</span> <span class="pre">library</span></code> message after doing this,
check if the GPU trace shows up in the trace viewer anyway. This message
sometimes occurs even when everything is working, since it looks for the
<code class="docutils literal notranslate"><span class="pre">libcupti</span></code> library in multiple places.</p>
<p><strong>If you get an error like: <code class="docutils literal notranslate"><span class="pre">failed</span> <span class="pre">with</span> <span class="pre">error</span> <span class="pre">CUPTI_ERROR_INSUFFICIENT_PRIVILEGES</span></code></strong><br/>
Full error:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>E external/org_tensorflow/tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1445<span class="o">]</span> <span class="k">function</span> cupti_interface_-&gt;EnableCallback<span class="o">(</span> <span class="m">0</span> , subscriber_, CUPTI_CB_DOMAIN_DRIVER_API, cbid<span class="o">)</span>failed with error CUPTI_ERROR_INSUFFICIENT_PRIVILEGES
<span class="m">2020</span>-06-12 <span class="m">14</span>:31:54.097791: E external/org_tensorflow/tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1487<span class="o">]</span> <span class="k">function</span> cupti_interface_-&gt;ActivityDisable<span class="o">(</span>activity<span class="o">)</span>failed with error CUPTI_ERROR_NOT_INITIALIZED
</pre></div>
</div>
<p>Run the following commands (note this requires a reboot):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">'options nvidia "NVreg_RestrictProfilingToAdminUsers=0"'</span> <span class="p">|</span> sudo tee -a /etc/modprobe.d/nvidia-kernel-common.conf
sudo update-initramfs -u
sudo reboot now
</pre></div>
</div>
<p>See <a class="reference external" href="https://developer.nvidia.com/nvidia-development-tools-solutions-err-nvgpuctrperm-cupti">NVIDIA’s documentation on this
error</a>
for more information.</p>
</section>
<section id="profiling-on-a-remote-machine">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Profiling on a remote machine"></a><span id="id1"></span><h4>Profiling on a remote machine<a class="headerlink" href="#profiling-on-a-remote-machine" title="Permalink to this headline">#</a></h4>
<p>If the JAX program you’d like to profile is running on a remote machine, one
option is to run all the instructions above on the remote machine (in
particular, start the TensorBoard server on the remote machine), then use SSH
local port forwarding to access the TensorBoard web UI from your local
machine. Use the following SSH command to forward the default TensorBoard port
6006 from the local to the remote machine:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ssh -L <span class="m">6006</span>:localhost:6006 &lt;remote server address&gt;
</pre></div>
</div>
</section>
<section id="profiling-on-a-cloud-tpu-vm">
<h4>Profiling on a Cloud TPU VM<a class="headerlink" href="#profiling-on-a-cloud-tpu-vm" title="Permalink to this headline">#</a></h4>
<p>Cloud TPU VMs come with a special version of TensorFlow pre-installed, so
there’s no need to explicitly install it, and doing so can cause TensorFlow to
stop working on TPU. Just <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">tbp-nightly</span></code>.</p>
</section>
<section id="multiple-tensorboard-installs">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Multiple TensorBoard installs"></a><span id="multiple-installs"></span><h4>Multiple TensorBoard installs<a class="headerlink" href="#multiple-tensorboard-installs" title="Permalink to this headline">#</a></h4>
<p><strong>If starting TensorBoard fails with an error like: <code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">Duplicate</span> <span class="pre">plugins</span> <span class="pre">for</span> <span class="pre">name</span> <span class="pre">projector</span></code></strong></p>
<p>It’s often because there are two versions of TensorBoard and/or TensorFlow
installed (e.g. the <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code>, <code class="docutils literal notranslate"><span class="pre">tf-nightly</span></code>, <code class="docutils literal notranslate"><span class="pre">tensorboard</span></code>, and <code class="docutils literal notranslate"><span class="pre">tb-nightly</span></code>
pip packages all include TensorBoard). Uninstalling a single pip package can
result in the <code class="docutils literal notranslate"><span class="pre">tensorboard</span></code> executable being removed which is then hard to
replace, so it may be necessary to uninstall everything and reinstall a single
version:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip uninstall tensorflow tf-nightly tensorboard tb-nightly
pip install tensorflow
</pre></div>
</div>
</section>
</section>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Nsight"></a><section id="nsight">
<h2>Nsight<a class="headerlink" href="#nsight" title="Permalink to this headline">#</a></h2>
<p>NVIDIA’s <code class="docutils literal notranslate"><span class="pre">Nsight</span></code> tools can be used to trace and profile JAX code on GPU. For
details, see the <a class="reference external" href="https://developer.nvidia.com/tools-overview"><code class="docutils literal notranslate"><span class="pre">Nsight</span></code>
documentation</a>.</p>
</section>
</section>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="gpu_memory_allocation.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">GPU memory allocation</p>
</div>
</a>
<a class="right-next" href="device_memory_profiling.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Device Memory Profiling</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By The JAX authors<br/>
  
      © Copyright 2020, The JAX Authors. NumPy and SciPy documentation are copyright the respective authors..<br/>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>