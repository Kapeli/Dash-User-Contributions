
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>jax.debug.print and jax.debug.breakpoint — JAX  documentation</title>
<!-- Loaded before other Sphinx assets -->
<link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="../_static/plot_directive.css" rel="stylesheet" type="text/css">
<link href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../_static/style.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/clipboard.min.js"></script>
<script src="../_static/copybutton.js"></script>
<script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<link href="../_static/favicon.png" rel="shortcut icon">
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="checkify_guide.html" rel="next" title="The checkify transformation"/>
<link href="index.html" rel="prev" title="Runtime value debugging in JAX"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="../_static/jax_logo_250px.png"/>
</a>
</div><form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../installation.html">
   Installing JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/quickstart.html">
   JAX Quickstart
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/thinking_in_jax.html">
   How to Think in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/Common_Gotchas_in_JAX.html">
   🔪 JAX - The Sharp Bits 🔪
  </a>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../jax-101/index.html">
   Tutorial: JAX 101
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/01-jax-basics.html">
     JAX As Accelerated NumPy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/02-jitting.html">
     Just In Time Compilation with JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/03-vectorization.html">
     Automatic Vectorization in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/04-advanced-autodiff.html">
     Advanced Automatic Differentiation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/05-random-numbers.html">
     Pseudo Random Numbers in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/05.1-pytrees.html">
     Working with Pytrees
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/06-parallelism.html">
     Parallel Evaluation in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/07-state.html">
     Stateful Computations in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax-101/08-pjit.html">
     Introduction to pjit
    </a>
</li>
</ul>
</input></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children">
<a class="reference internal" href="index.html">
   Runtime value debugging in JAX
  </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l2 current active">
<a class="current reference internal" href="#">
<code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
     and
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.breakpoint
      </span>
</code>
</a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="checkify_guide.html">
     The
     <code class="docutils literal notranslate">
<span class="pre">
       checkify
      </span>
</code>
     transformation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="flags.html">
     JAX debugging flags
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Reference Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../faq.html">
   JAX Frequently Asked Questions (FAQ)
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../async_dispatch.html">
   Asynchronous dispatch
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../aot.html">
   Ahead-of-time lowering and compilation
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../jaxpr.html">
   Understanding Jaxprs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/convolutions.html">
   Convolutions in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../pytrees.html">
   Pytrees
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../type_promotion.html">
   Type promotion semantics
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../errors.html">
   JAX Errors
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../transfer_guard.html">
   Transfer guard
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../glossary.html">
   JAX Glossary of Terms
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../changelog.html">
   Change log
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Advanced JAX Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/autodiff_cookbook.html">
   The Autodiff Cookbook
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/vmapped_log_probs.html">
   Autobatching log-densities example
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/neural_network_with_tfds_data.html">
   Training a Simple Neural Network, with tensorflow/datasets Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/Custom_derivative_rules_for_Python_code.html">
   Custom derivative rules for JAX-transformable Python functions
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/How_JAX_primitives_work.html">
   How JAX primitives work
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/Writing_custom_interpreters_in_Jax.html">
   Writing custom Jaxpr interpreters in JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/Neural_Network_and_Data_Loading.html">
   Training a Simple Neural Network, with PyTorch Data Loading
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../notebooks/xmap_tutorial.html">
   Named axes and easy-to-revise parallelism
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../multi_process.html">
   Using JAX in multi-host and multi-process environments
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Notes
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../api_compatibility.html">
   API compatibility
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../deprecation.html">
   Python and NumPy version support policy
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../concurrency.html">
   Concurrency
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../gpu_memory_allocation.html">
   GPU memory allocation
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../profiling.html">
   Profiling JAX programs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../device_memory_profiling.html">
   Device Memory Profiling
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../rank_promotion_warning.html">
   Rank promotion warning
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  Developer documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../contributing.html">
   Contributing to JAX
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../developer.html">
   Building from source
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../jax_internal_api.html">
   Internal APIs
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../autodidax.html">
   Autodidax: JAX core from scratch
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../jep/index.html">
   JAX Enhancement Proposals (JEPs)
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../jep/263-prng.html">
     263: JAX PRNG Design
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/2026-custom-derivatives.html">
     2026: Custom JVP/VJP rules for JAX-transformable functions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/4008-custom-vjp-update.html">
     4008: Custom VJP and `nondiff_argnums` update
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/4410-omnistaging.html">
     4410: Omnistaging
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/9407-type-promotion.html">
     9407: Design of Type Promotion Semantics for JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/9419-jax-versioning.html">
     9419: Jax and Jaxlib versioning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/10657-sequencing-effects.html">
     10657: Sequencing side-effects in JAX
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/11830-new-remat-checkpoint.html">
     11830: `jax.remat` / `jax.checkpoint` new implementation
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jep/12049-type-annotations.html">
     12049: Type Annotation Roadmap for JAX
    </a>
</li>
</ul>
</input></li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  API documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../jax.html">
   Public API: jax package
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../jax.numpy.html">
     jax.numpy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.scipy.html">
     jax.scipy package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.config.html">
     JAX configuration
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.debug.html">
     jax.debug package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.dlpack.html">
     jax.dlpack module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.distributed.html">
     jax.distributed module
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../jax.example_libraries.html">
     jax.example_libraries package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../jax.example_libraries.optimizers.html">
       jax.example_libraries.optimizers module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.example_libraries.stax.html">
       jax.example_libraries.stax module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../jax.experimental.html">
     jax.experimental package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.checkify.html">
       jax.experimental.checkify module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.global_device_array.html">
       jax.experimental.global_device_array module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.host_callback.html">
       jax.experimental.host_callback module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.maps.html">
       jax.experimental.maps module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.pjit.html">
       jax.experimental.pjit module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.sparse.html">
       jax.experimental.sparse module
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../jax.experimental.jet.html">
       jax.experimental.jet module
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.flatten_util.html">
     jax.flatten_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.image.html">
     jax.image package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.lax.html">
     jax.lax package
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../jax.nn.html">
     jax.nn package
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../jax.nn.initializers.html">
       jax.nn.initializers package
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.ops.html">
     jax.ops package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.profiler.html">
     jax.profiler module
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.random.html">
     jax.random package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.stages.html">
     jax.stages package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.tree_util.html">
     jax.tree_util package
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../jax.lib.html">
     jax.lib package
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<a class="headerbtn" data-placement="bottom" data-toggle="tooltip" href="https://github.com/google/jax" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
</a>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../_sources/debugging/print_breakpoint.md.txt" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.md</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#debugging-with-jax-debug-print-and-other-debugging-callbacks">
   Debugging with
   <code class="docutils literal notranslate">
<span class="pre">
     jax.debug.print
    </span>
</code>
   and other debugging callbacks
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#why-debug-print">
     Why “
     <em>
      debug
     </em>
     ” print?
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#more-examples-of-jax-debug-print">
     More examples of
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
</a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#printing-under-jax-pmap">
       Printing under
       <code class="docutils literal notranslate">
<span class="pre">
         jax.pmap
        </span>
</code>
</a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#printing-under-jax-grad">
       Printing under
       <code class="docutils literal notranslate">
<span class="pre">
         jax.grad
        </span>
</code>
</a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#printing-in-other-transformations">
       Printing in other transformations
      </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#more-control-with-jax-debug-callback">
     More control with
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.callback
      </span>
</code>
</a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#sharp-bits">
     Sharp bits
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#ordering-of-printed-results">
       Ordering of printed results
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#asynchronous-callbacks">
       Asynchronous callbacks
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#performance-impacts">
       Performance impacts
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry">
<a class="reference internal nav-link" href="#unnecessary-materialization">
         Unnecessary materialization
        </a>
</li>
<li class="toc-h5 nav-item toc-entry">
<a class="reference internal nav-link" href="#callback-overhead">
         Callback overhead
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#strengths-and-limitations-of-jax-debug-print">
     Strengths and limitations of
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
</a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#strengths">
       Strengths
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#limitations">
       Limitations
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-inspection-with-jax-debug-breakpoint">
   Interactive inspection with
   <code class="docutils literal notranslate">
<span class="pre">
     jax.debug.breakpoint()
    </span>
</code>
</a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#usage">
     Usage
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#examples">
     Examples
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#usage-with-jax-lax-cond">
       Usage with
       <code class="docutils literal notranslate">
<span class="pre">
         jax.lax.cond
        </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
     Sharp bits
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#strengths-and-limitations-of-jax-debug-breakpoint">
     Strengths and limitations of
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.breakpoint()
      </span>
</code>
</a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
       Strengths
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
       Limitations
      </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>jax.debug.print and jax.debug.breakpoint</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#debugging-with-jax-debug-print-and-other-debugging-callbacks">
   Debugging with
   <code class="docutils literal notranslate">
<span class="pre">
     jax.debug.print
    </span>
</code>
   and other debugging callbacks
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#why-debug-print">
     Why “
     <em>
      debug
     </em>
     ” print?
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#more-examples-of-jax-debug-print">
     More examples of
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
</a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#printing-under-jax-pmap">
       Printing under
       <code class="docutils literal notranslate">
<span class="pre">
         jax.pmap
        </span>
</code>
</a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#printing-under-jax-grad">
       Printing under
       <code class="docutils literal notranslate">
<span class="pre">
         jax.grad
        </span>
</code>
</a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#printing-in-other-transformations">
       Printing in other transformations
      </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#more-control-with-jax-debug-callback">
     More control with
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.callback
      </span>
</code>
</a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#sharp-bits">
     Sharp bits
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#ordering-of-printed-results">
       Ordering of printed results
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#asynchronous-callbacks">
       Asynchronous callbacks
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#performance-impacts">
       Performance impacts
      </a>
<ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry">
<a class="reference internal nav-link" href="#unnecessary-materialization">
         Unnecessary materialization
        </a>
</li>
<li class="toc-h5 nav-item toc-entry">
<a class="reference internal nav-link" href="#callback-overhead">
         Callback overhead
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#strengths-and-limitations-of-jax-debug-print">
     Strengths and limitations of
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.print
      </span>
</code>
</a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#strengths">
       Strengths
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#limitations">
       Limitations
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#interactive-inspection-with-jax-debug-breakpoint">
   Interactive inspection with
   <code class="docutils literal notranslate">
<span class="pre">
     jax.debug.breakpoint()
    </span>
</code>
</a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#usage">
     Usage
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#examples">
     Examples
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#usage-with-jax-lax-cond">
       Usage with
       <code class="docutils literal notranslate">
<span class="pre">
         jax.lax.cond
        </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
     Sharp bits
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#strengths-and-limitations-of-jax-debug-breakpoint">
     Strengths and limitations of
     <code class="docutils literal notranslate">
<span class="pre">
       jax.debug.breakpoint()
      </span>
</code>
</a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
       Strengths
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
       Limitations
      </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<a class="dashAnchor" name="//apple_ref/cpp/Section/jax.debug.print and jax.debug.breakpoint"></a><section class="tex2jax_ignore mathjax_ignore" id="jax-debug-print-and-jax-debug-breakpoint">
<h1><code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> and <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint</span></code><a class="headerlink" href="#jax-debug-print-and-jax-debug-breakpoint" title="Permalink to this headline">#</a></h1>
<p>The <a class="reference internal" href="../jax.debug.html#module-jax.debug" title="jax.debug"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jax.debug</span></code></a> package offers some useful tools for inspecting values
inside of JIT-ted functions.</p>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Debugging with jax.debug.print and other debugging callbacks"></a><section id="debugging-with-jax-debug-print-and-other-debugging-callbacks">
<h2>Debugging with <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> and other debugging callbacks<a class="headerlink" href="#debugging-with-jax-debug-print-and-other-debugging-callbacks" title="Permalink to this headline">#</a></h2>
<p><strong>TL;DR</strong> Use <a class="reference internal" href="../_autosummary/jax.debug.print.html#jax.debug.print" title="jax.debug.print"><code class="xref py py-func docutils literal notranslate"><span class="pre">jax.debug.print()</span></code></a> to print values to stdout in <code class="docutils literal notranslate"><span class="pre">jit</span></code>-,<code class="docutils literal notranslate"><span class="pre">pmap</span></code>-, and <code class="docutils literal notranslate"><span class="pre">pjit</span></code>-decorated functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"🤯 </span><span class="si">{x}</span><span class="s2"> 🤯"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"🤯 </span><span class="si">{y}</span><span class="s2"> 🤯"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">y</span>
  
<span class="n">f</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
<span class="c1"># Prints:</span>
<span class="c1"># 🤯 2.0 🤯</span>
<span class="c1"># 🤯 0.9092974662780762 🤯</span>
</pre></div>
</div>
<!-- mattjj added this line -->
<p>With some transformations, like <code class="docutils literal notranslate"><span class="pre">jax.grad</span></code> and <code class="docutils literal notranslate"><span class="pre">jax.vmap</span></code>, you can use Python’s builtin <code class="docutils literal notranslate"><span class="pre">print</span></code> function to print out numerical values. But <code class="docutils literal notranslate"><span class="pre">print</span></code> won’t work with <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> or <code class="docutils literal notranslate"><span class="pre">jax.pmap</span></code> because those transformations delay numerical evaluation. So use <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> instead!</p>
<p>Semantically, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> is roughly equivalent to the following Python function</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">PyTree</span><span class="p">[</span><span class="n">Array</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">PyTree</span><span class="p">[</span><span class="n">Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</pre></div>
</div>
<p>except that it can be staged out and transformed by JAX. See the <a class="reference internal" href="../_autosummary/jax.debug.print.html#jax.debug.print" title="jax.debug.print"><code class="xref py py-func docutils literal notranslate"><span class="pre">API</span> <span class="pre">reference</span></code></a> for more details.</p>
<a class="dashAnchor" name='//apple_ref/cpp/Section/Why "debug" print?'></a><section id="why-debug-print">
<h3>Why “<em>debug</em>” print?<a class="headerlink" href="#why-debug-print" title="Permalink to this headline">#</a></h3>
<p>In the name of debugging, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> can reveal information about <em>how</em> computations are evaluated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">3.</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"y: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">y</span>
<span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">xs</span><span class="p">)</span>
<span class="c1"># Prints: x: 0.0</span>
<span class="c1">#         x: 1.0</span>
<span class="c1">#         x: 2.0</span>
<span class="c1">#         y: 0.0</span>
<span class="c1">#         y: 0.841471</span>
<span class="c1">#         y: 0.9092974</span>
<span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
<span class="c1"># Prints: x: 0.0</span>
<span class="c1">#         y: 0.0</span>
<span class="c1">#         x: 1.0</span>
<span class="c1">#         y: 0.841471</span>
<span class="c1">#         x: 2.0</span>
<span class="c1">#         y: 0.9092974</span>
</pre></div>
</div>
<p>Notice that the printed results are in different orders!</p>
<p>By revealing these inner-workings, the output of <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> doesn’t respect JAX’s usual semantics guarantees, like that <code class="docutils literal notranslate"><span class="pre">jax.vmap(f)(xs)</span></code> and <code class="docutils literal notranslate"><span class="pre">jax.lax.map(f,</span> <span class="pre">xs)</span></code> compute the same thing (in different ways). Yet these evaluation order details are exactly what we might want to see when debugging!</p>
<p>So use <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> for debugging, and not when semantics guarantees are important.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/More examples of jax.debug.print"></a><section id="more-examples-of-jax-debug-print">
<h3>More examples of <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code><a class="headerlink" href="#more-examples-of-jax-debug-print" title="Permalink to this headline">#</a></h3>
<p>In addition to the above examples using <code class="docutils literal notranslate"><span class="pre">jit</span></code> and <code class="docutils literal notranslate"><span class="pre">vmap</span></code>, here are a few more to have in mind.</p>
<section id="printing-under-jax-pmap">
<h4>Printing under <code class="docutils literal notranslate"><span class="pre">jax.pmap</span></code><a class="headerlink" href="#printing-under-jax-pmap" title="Permalink to this headline">#</a></h4>
<p>When <code class="docutils literal notranslate"><span class="pre">jax.pmap</span></code>-ed, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code>s might be reordered!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span>
<span class="n">jax</span><span class="o">.</span><span class="n">pmap</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">xs</span><span class="p">)</span>
<span class="c1"># Prints: x: 1.0</span>
<span class="c1">#         x: 0.0</span>
<span class="c1"># OR</span>
<span class="c1"># Prints: x: 1.0</span>
<span class="c1">#         x: 0.0</span>
</pre></div>
</div>
</section>
<section id="printing-under-jax-grad">
<h4>Printing under <code class="docutils literal notranslate"><span class="pre">jax.grad</span></code><a class="headerlink" href="#printing-under-jax-grad" title="Permalink to this headline">#</a></h4>
<p>Under a <code class="docutils literal notranslate"><span class="pre">jax.grad</span></code>, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code>s will only print on the forward pass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">2.</span>

<span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="mf">1.</span><span class="p">)</span>
<span class="c1"># Prints: x: 1.0</span>
</pre></div>
</div>
<p>This behavior is similar to how Python’s builtin <code class="docutils literal notranslate"><span class="pre">print</span></code> works under a <code class="docutils literal notranslate"><span class="pre">jax.grad</span></code>. But by using <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> here, the behavior is the same even if the caller applies a <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code>.</p>
<p>To print on the backward pass, just use a <code class="docutils literal notranslate"><span class="pre">jax.custom_vjp</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@jax</span><span class="o">.</span><span class="n">custom_vjp</span>
<span class="k">def</span> <span class="nf">print_grad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">print_grad_fwd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">print_grad_bwd</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">x_grad</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x_grad: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x_grad</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">x_grad</span><span class="p">,)</span>

<span class="n">print_grad</span><span class="o">.</span><span class="n">defvjp</span><span class="p">(</span><span class="n">print_grad_fwd</span><span class="p">,</span> <span class="n">print_grad_bwd</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">print_grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">2.</span>
<span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="mf">1.</span><span class="p">)</span>
<span class="c1"># Prints: x_grad: 2.0</span>
</pre></div>
</div>
</section>
<section id="printing-in-other-transformations">
<h4>Printing in other transformations<a class="headerlink" href="#printing-in-other-transformations" title="Permalink to this headline">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> also works in other transformations like <code class="docutils literal notranslate"><span class="pre">xmap</span></code> and <code class="docutils literal notranslate"><span class="pre">pjit</span></code>.</p>
</section>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/More control with jax.debug.callback"></a><section id="more-control-with-jax-debug-callback">
<h3>More control with <code class="docutils literal notranslate"><span class="pre">jax.debug.callback</span></code><a class="headerlink" href="#more-control-with-jax-debug-callback" title="Permalink to this headline">#</a></h3>
<p>In fact, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> is a thin convenience wrapper around <code class="docutils literal notranslate"><span class="pre">jax.debug.callback</span></code>, which can be used directly for greater control over string formatting, or even the kind of output.</p>
<p>Semantically, <code class="docutils literal notranslate"><span class="pre">jax.debug.callback</span></code> is roughly equivalent to the following Python function</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">fun</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">PyTree</span><span class="p">[</span><span class="n">Array</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">PyTree</span><span class="p">[</span><span class="n">Array</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
  <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>As with <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code>, these callbacks should only be used for debugging output, like printing or plotting. Printing and plotting are pretty harmless, but if you use it for anything else its behavior might surprise you under transformations. For example, it’s not safe to use <code class="docutils literal notranslate"><span class="pre">jax.debug.callback</span></code> for timing operations, since callbacks might reordered and asynchronous (see below).</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Sharp bits"></a><section id="sharp-bits">
<h3>Sharp bits<a class="headerlink" href="#sharp-bits" title="Permalink to this headline">#</a></h3>
<p>Like most JAX APIs, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> can cut you if you’re not careful.</p>
<section id="ordering-of-printed-results">
<h4>Ordering of printed results<a class="headerlink" href="#ordering-of-printed-results" title="Permalink to this headline">#</a></h4>
<p>When distinct calls to <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> involve arguments which don’t depend on one another, they might be reordered when staged out, e.g. by <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"y: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">f</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">)</span>
<span class="c1"># Prints: x: 2.0</span>
<span class="c1">#         y: 3.0</span>
<span class="c1"># OR</span>
<span class="c1"># Prints: y: 3.0</span>
<span class="c1">#         x: 2.0</span>
</pre></div>
</div>
<p>Why? Under the hood, the compiler gets a functional representation of the staged-out computation, where the imperative order of the Python function is lost and only data dependence remains. This change is invisible to users with functionally pure code, but in the presence of side-effects like printing, it’s noticeable.</p>
<p>To preserve the original order of <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code>s as written in your Python function, you can use <code class="docutils literal notranslate"><span class="pre">jax.debug.print(...,</span> <span class="pre">ordered=True)</span></code>, which will ensure the relative order of prints is preserved. But using <code class="docutils literal notranslate"><span class="pre">ordered=True</span></code> will raise an error under <code class="docutils literal notranslate"><span class="pre">jax.pmap</span></code> and other JAX transformations involving parallelism, since ordering can’t be guaranteed under parallel execution.</p>
</section>
<section id="asynchronous-callbacks">
<h4>Asynchronous callbacks<a class="headerlink" href="#asynchronous-callbacks" title="Permalink to this headline">#</a></h4>
<p>Depending on the backend, <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code>s may happen asynchronously, i.e. not in your main program thread. This means that values could be printed to your screen even after your JAX function has returned a value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span>
<span class="n">f</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>
<span class="c1"># &lt;do something else&gt;</span>
<span class="c1"># Prints: x: 2.</span>
</pre></div>
</div>
<p>To block on the <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code>s in a function, you can call <code class="docutils literal notranslate"><span class="pre">jax.effects_barrier()</span></code>, which will wait until any remaining side-effects in the function have completed as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"x: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span>
<span class="n">f</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">.</span><span class="n">block_until_ready</span><span class="p">()</span>
<span class="n">jax</span><span class="o">.</span><span class="n">effects_barrier</span><span class="p">()</span>
<span class="c1"># Prints: x: 2.</span>
<span class="c1"># &lt;do something else&gt;</span>
</pre></div>
</div>
</section>
<section id="performance-impacts">
<h4>Performance impacts<a class="headerlink" href="#performance-impacts" title="Permalink to this headline">#</a></h4>
<section id="unnecessary-materialization">
<h5>Unnecessary materialization<a class="headerlink" href="#unnecessary-materialization" title="Permalink to this headline">#</a></h5>
<p>While <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> was designed to have a minimal performance footprint, it can interfere with compiler optimizations and potentially affect the memory profile of your JAX programs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
  <span class="n">logits</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">"logits: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, we are printing intermediate values in between a linear layer and the activation function. Compilers like XLA can perform fusion optimizations, which might avoid materializing <code class="docutils literal notranslate"><span class="pre">logits</span></code> in memory. But when we use <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> on <code class="docutils literal notranslate"><span class="pre">logits</span></code>, we are forcing those intermediates to be materialized, potentially slowing down the program and increasing memory usage.</p>
<p>Furthermore, when using <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> with <code class="docutils literal notranslate"><span class="pre">jax.pjit</span></code>, a global synchronization occurs that will materialize values on a single device.</p>
</section>
<section id="callback-overhead">
<h5>Callback overhead<a class="headerlink" href="#callback-overhead" title="Permalink to this headline">#</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> inherently incurs communication between an accelerator and its host. The underlying mechanism differs from backend to backend (e.g. GPU vs TPU) but in all cases, we’ll need to copy the printed values from device to host. In the CPU case, this overhead is smaller.</p>
<p>Furthermore, when using <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> with <code class="docutils literal notranslate"><span class="pre">jax.pjit</span></code>, a global synchronization occurs that adds some overhead.</p>
</section>
</section>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Strengths and limitations of jax.debug.print"></a><section id="strengths-and-limitations-of-jax-debug-print">
<h3>Strengths and limitations of <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code><a class="headerlink" href="#strengths-and-limitations-of-jax-debug-print" title="Permalink to this headline">#</a></h3>
<section id="strengths">
<h4>Strengths<a class="headerlink" href="#strengths" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Print debugging is simple and intuitive</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.debug.callback</span></code> can be used for other innocuous side-effects</p></li>
</ul>
</section>
<section id="limitations">
<h4>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Adding print statements is a manual process</p></li>
<li><p>Can have performance impacts</p></li>
</ul>
</section>
</section>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Interactive inspection with jax.debug.breakpoint()"></a><section id="interactive-inspection-with-jax-debug-breakpoint">
<h2>Interactive inspection with <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint()</span></code><a class="headerlink" href="#interactive-inspection-with-jax-debug-breakpoint" title="Permalink to this headline">#</a></h2>
<p><strong>TL;DR</strong> Use <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint()</span></code> to pause the execution of your JAX program to inspect values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">breakpoint</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
<span class="n">f</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span> <span class="c1"># ==&gt; Pauses during execution!</span>
</pre></div>
</div>
<p><img alt="JAX debugger" src="../_images/debugger.gif"/></p>
<p><code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint()</span></code> is actually just an application of <code class="docutils literal notranslate"><span class="pre">jax.debug.callback(...)</span></code> that captures information about the call stack. It has the same transformation behaviors as <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> as a result (e.g. <code class="docutils literal notranslate"><span class="pre">vmap</span></code>-ing <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint()</span></code> unrolls it across the mapped axis).</p>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Usage"></a><section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h3>
<p>Calling <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint()</span></code> in a compiled JAX function will pause your program when it hits the breakpoint. You’ll be presented with a <code class="docutils literal notranslate"><span class="pre">pdb</span></code>-like prompt that allows you to inspect the values in the call stack. Unlike <code class="docutils literal notranslate"><span class="pre">pdb</span></code>, you will not be able to step through the execution, but you are allowed to resume it.</p>
<p>Debugger commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">help</span></code> - prints out available commands</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code> - evaluates an expression and prints its result</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pp</span></code> - evaluates an expression and pretty-prints its result</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">u(p)</span></code> - go up a stack frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">d(own)</span></code> - go down a stack frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">w(here)/bt</span></code> - print out a backtrace</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l(ist)</span></code> - print out code context</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c(ont(inue))</span></code> - resumes the execution of the program</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q(uit)/exit</span></code> - exits the program (does not work on TPU)</p></li>
</ul>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Examples"></a><section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">#</a></h3>
<section id="usage-with-jax-lax-cond">
<h4>Usage with <code class="docutils literal notranslate"><span class="pre">jax.lax.cond</span></code><a class="headerlink" href="#usage-with-jax-lax-cond" title="Permalink to this headline">#</a></h4>
<p>When combined with <code class="docutils literal notranslate"><span class="pre">jax.lax.cond</span></code>, the debugger can become a useful tool for detecting <code class="docutils literal notranslate"><span class="pre">nan</span></code>s or <code class="docutils literal notranslate"><span class="pre">inf</span></code>s.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">breakpoint_if_nonfinite</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">is_finite</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
  <span class="k">def</span> <span class="nf">true_fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
  <span class="k">def</span> <span class="nf">false_fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">breakpoint</span><span class="p">()</span>
  <span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">is_finite</span><span class="p">,</span> <span class="n">true_fn</span><span class="p">,</span> <span class="n">false_fn</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
  <span class="n">breakpoint_if_nonfinite</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">z</span>
<span class="n">f</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="c1"># ==&gt; Pauses during execution!</span>
</pre></div>
</div>
</section>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Sharp bits"></a><section id="id1">
<h3>Sharp bits<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Because <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint</span></code> is a just an application of <code class="docutils literal notranslate"><span class="pre">jax.debug.callback</span></code>, it has the same <a class="reference internal" href="#sharp-bits"><span class="std std-doc">sharp bits as <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code></span></a>, with a few more caveats:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint</span></code> materializes <em>even more</em> intermediates than <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> because it forces materialization of all values in the call stack</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint</span></code> has more runtime overhead than a <code class="docutils literal notranslate"><span class="pre">jax.debug.print</span></code> because it has to potentially copy all the intermediate values in a JAX program from device to host.</p></li>
</ul>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Strengths and limitations of jax.debug.breakpoint()"></a><section id="strengths-and-limitations-of-jax-debug-breakpoint">
<h3>Strengths and limitations of <code class="docutils literal notranslate"><span class="pre">jax.debug.breakpoint()</span></code><a class="headerlink" href="#strengths-and-limitations-of-jax-debug-breakpoint" title="Permalink to this headline">#</a></h3>
<section id="id2">
<h4>Strengths<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Simple, intuitive and (somewhat) standard</p></li>
<li><p>Can inspect many values at the same time, up and down the call stack</p></li>
</ul>
</section>
<section id="id3">
<h4>Limitations<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Need to potentially use many breakpoints to pinpoint the source of an error</p></li>
<li><p>Materializes many intermediates</p></li>
</ul>
</section>
</section>
</section>
</section>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="index.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Runtime value debugging in JAX</p>
</div>
</a>
<a class="right-next" href="checkify_guide.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">The <code class="docutils literal notranslate"><span class="pre">checkify</span></code> transformation</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By The JAX authors<br/>
  
      © Copyright 2020, The JAX Authors. NumPy and SciPy documentation are copyright the respective authors..<br/>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>