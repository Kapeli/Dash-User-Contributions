<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://ogp.me/ns/fb#" charset="utf-8"><head><meta charset="UTF-8"><title></title>
<link rel="stylesheet" href="css/normalize.css">
<link rel="stylesheet" type="text/css" href="css/main.css">
<link rel="stylesheet" href="css/style.css">
<style>
html,body {
margin: 0px;
padding: 10px;
width: 210mm;
max-width: 210mm;
overflow-x: hidden;
}
pre {
	width: 100%;
	overflow-x: hidden;
}
</style></head><body><h1>Introduction</h1><div class="all-questions"><a name="welcome"></a><h2> <a name="welcome_welcome"><span class="mw-headline" id="Welcome"> Welcome</span></a></h2>
<p>The Module System exposes the core Splunk knowledge base for the purpose of building custom app customized for your application domain. A framework is inherently complex and requires suitable documentation and examples to be able to use it effectively.  Here, you'll find documentation that covers the key concepts and reference material needed to begin creating apps.</p><p>You'll find this documentation to be applicable to different phases of the development lifecycle and different levels of expertise. For example, <a href="#environmentsetup" class="external text">Getting Started</a> is most useful for initial familiarization with the framework and development process, while the reference API might be consulted frequently to refresh your memory about programming details.  Because examples and learn-by-doing provide the most effective techniques for learning complex topics, an example accompanies most discussion.  In particular, the <a href="#getthetutorialapp" class="external text">Cookbook</a> includes a complete set of examples, in the menu above, that you can actually run in the context of this app.</p><p>Become familiar with terminology.  If you are new to Module System development, read <a href="#environmentsetup" class="external text">Getting Started</a>.  Consult the <a href="#getthetutorialapp" class="external text">Cookbook</a> and its associated examples to learn how to implement common use cases.  You'll find the implementation details in the Reference useful after you've learned the basics of how to develop in the Module System environment.</p><p>	 The documentation set provides the various system views a developer needs to understand and use the Module System.</p>

<h1>Terminology</h1><a name="glossary"></a><h2> <a name="glossary_glossary"><span class="mw-headline" id="Glossary"> Glossary</span></a></h2>
<p> These terms are relevant to the Module System.  For general Splunk terms and definitions, see the   Splexicon.</p><p><a href="#-a-">  A - </a><a href="#-b-">  B - </a><a href="#-c-">  C - </a><a href="#-d-">  D - </a><a href="#-e-">  E - </a><a href="#-h-">  H - </a><a href="#-i-">  I - </a><a href="#-j-">  J - </a><a href="#-m-">  M - </a><a href="#-n-">  N - </a><a href="#-p-">  P - </a>
<a href="#-q-">  Q - </a><a href="#-r-">  R - </a><a href="#-s-">  S - </a><a href="#-t-">  T - </a><a href="#-v-">  V </a></p><h3> <a name="glossary_-a-"><span class="mw-headline" id="-A-"> -A-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_abstract_class"><span class="mw-headline" id="abstract_class"> abstract class</span></a></i></b></font></h4><p> Actually, an abstract base class which may define methods to be implemented by subclasses.       Abstract classes enforce inheritance hierarchy.</p><p> Module System uses the mechanism, in Python and JavaScript, for apps to hook into      the framework, by sub-classing.  The following are abstract classes:</p><ul><li>  Splunk.Module </li><li>  Splunk.Module.DispatchingModule </li><li>  ModuleController </li><li>  ModuleHandler </li><li>  BaseController </li></ul><p> See also: <a href="#base_class">  base class</a>, <a href="#extension_point">  extension point </a></p><h4><font size="3"><b><i> <a name="glossary_add-on"><span class="mw-headline" id="add-on"> add-on</span></a></i></b></font></h4><p> App implementations that have configurations, knowledge, inputs, outputs, and workflows      that classify, transform, or normalize data, and are intended to be used by one or      more apps are called add-ons.</p><p> An add-on provides a container for knowledge (event types, field extractions, lookups),      scripted inputs, and other extensions to core Splunk capabilities, which may or may      not be technology-, product-, or solution-specific.</p><p><i><b>   Note  </b> &nbsp;:  Add-ons should not depend on other apps or add-ons for correct operation. </i></p><p> Add-on packaging facilitates distribution to Splunk instances.</p><p> See also: <a href="#app">  app </a></p><h4><font size="3"><b><i> <a name="glossary_app"><span class="mw-headline" id="app">app</span></a></i></b></font></h4><p> An app is a redistributable package containing some or all of the following components:</p><ul><li>  Configurations </li><li>  Views </li><li>  Modules </li><li>  Controllers </li><li>  Templates </li><li>  Models </li><li>  JavaScript </li><li>  Static Content (HTML, CSS, Images) </li></ul><p> In general, apps create a compelling and enriching user experience for exploring data      produced by a particular,</p><ul><li>  Technology </li><li>  Product </li><li>  Solution </li></ul><p> Apps provide a container for custom workflows, views, and other extensions to SplunkWeb.      Apps also contain saved searches, macros, and other knowledge for working with domain-specific      data and objects.</p><p> App packaging is intended to facilitate distribution to Splunk instances. Apps are      commonly distributed using the app and add-on repository on Splunk Apps but can also      be distributed using Splunk Web or by extracting the package within the Splunk file      system.</p><p> Apps contain the ability to integrate with add-ons for advanced data collection.</p><p> See also: <a href="#add-on">  add-on </a></p><h4><font size="3"><b><i> <a name="glossary_application"><span class="mw-headline" id="application">application</span></a></i></b></font></h4><p> The term application refers to domain-specific software, independent of a particular      implementation.  Applications achieve significant reuse in the Splunk environment by being implemented      using the Module System.  Apps and add-ons are application implementations.</p><p> See also: <a href="#add-on">  add-on</a>, <a href="#app">  app </a></p><h3> <a name="glossary_-b-"><span class="mw-headline" id="-B-"> -B-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_base_class"><span class="mw-headline" id="base_class">base class</span></a></i></b></font></h4><p> The class from which another class inherits is a base class, providing structural      integrity.</p><p> Sub-classing a base class is the Module System mechanism for hooking an app into framework      functionality. Applications usually need to implement required base class methods      in a way that modifies Module System behavior to suit application requirements.</p><p> See also: <a href="#abstract_class">  abstract class </a></p><h4><font size="3"><b><i> <a name="glossary_bind_.28events.29"><span class="mw-headline" id="bind_.28events.29">bind (events)</span></a></i></b></font></h4><p> Web programming typically requires that a method or function is bound to a particular      user or program event to perform the desired action when the event occurs.  Binding, effectively, attaches a callback function to some event or action.</p><p> For example, AJAX request parameters include a completion function to be executed      when the request completes.</p><p> Also, see the jQuery <tt>  bind()</tt> method for binding browser events to DOM elements.</p><p> You can override default Splunk event handlers by implementing a custom handler in      the <tt>  application.js </tt> file. A number of API methods, such as <tt>dispatchJob()</tt>, also permit you to specify callback functions on success or failure of the operation.</p><h3> <a name="glossary_-c-"><span class="mw-headline" id="-C-"> -C-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_cherrypy"><span class="mw-headline" id="CherryPy">CherryPy</span></a></i></b></font></h4><p>CherryPy  is a Python framework for building web applications.  Module System uses CherryPy to handle HTTP requests, including session handling.</p><h4><font size="3"><b><i> <a name="glossary_child_.28module.29"><span class="mw-headline" id="child_.28module.29">child (module)</span></a></i></b></font></h4><p> In the hierarchical module relationship a child module is encapsulated by a <a href="#parent">parent</a> module.</p><h4><font size="3"><b><i> <a name="glossary_context"><span class="mw-headline" id="context">context</span></a></i></b></font></h4><p> A context is a set of name-value pairs shared among views, which are defined by and only meaningful to the application. The <tt>Splunk.Context</tt> class encapsulates context getter and setter operations.  Context is instantiated when a view is created and modules share context to communicate search and  event changes.  The <tt>Splunk.Module</tt> class provides mechanisms for sharing context, such as pushing context to child modules and receiving notification of a context change.</p><h4><font size="3"><b><i> <a name="glossary_controller_.28module.29"><span class="mw-headline" id="controller_.28module.29">controller (module)</span></a></i></b></font></h4><p> (See <a href="#module_controller">  module controller</a>)</p><h3> <a name="glossary_-d-"><span class="mw-headline" id="-D-"> -D-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_decorator"><span class="mw-headline" id="decorator">decorator</span></a></i></b></font></h4><p> Python syntactic sugar that wraps a function definition.  (See 7.6. Function definitions and decorator.)</p><h3> <a name="glossary_-e-"><span class="mw-headline" id="-E-"> -E-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_entity"><span class="mw-headline" id="entity">entity</span></a></i></b></font></h4><p> The MVC model consists of entities (configuration objects or similar artifacts), which      are REST resources accessed using the REST API. Entities are uniquely identified by <a href="#id">  ID </a> and have associated <a href="#metadata">  metadata </a> attributes, or model fields.  The <tt>  SplunkRESTManager </tt> class  usually represents a unique entity and provides a number of API methods to abstract      the REST interface for manipulating entities.  Entities can also be created and deleted.</p><h4><font size="3"><b><i> <a name="glossary_extension_point"><span class="mw-headline" id="extension_point">extension point</span></a></i></b></font></h4><p> Module System extension points are hooks for attaching custom code to extend framework functionality, for creating domain-specific applications.  Extension points are presented through the API and custom functionality is usually implemented by subclassing.  The API describes how and where framework functionality can be changed.</p><h3> <a name="glossary_-h-"><span class="mw-headline" id="-H-"> -H-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_hidden_module"><span class="mw-headline" id="hidden_module">hidden module</span></a></i></b></font></h4><p> A hidden module has no visible elements.  A hidden module typically does non-UI work whose results can be rendered by various UI child modules in the module hierarchy.  An example is the <tt>HiddenSearchSwapper</tt> module.</p><h3> <a name="glossary_-i-"><span class="mw-headline" id="-I-"> -I-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_id"><span class="mw-headline" id="ID">ID</span></a></i></b></font></h4><p> MVC model entities are uniquely referenced by ID, which is a string representing the      hierarchical REST API path to a configuration object or similar artifact.</p><p> Example:  /servicesNS/admin/search/saved/searches</p><h3> <a name="glossary_-j-"><span class="mw-headline" id="-J-"> -J-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_job_progress"><span class="mw-headline" id="job_progress">job progress</span></a></i></b></font></h4><p> Applications might perform different actions depending on job progress, the progression of a job from initiation through completion.  Job progress states are: </p><table cellpadding="6"><tr><td valign="center" align="left"><tt>jobCanceled</tt></td><td valign="center" align="left">Job has been canceled.</td></tr><tr><td valign="center" align="left"><tt>jobDispatched</tt></td><td valign="center" align="left">Job has been dispatched.</td></tr><tr><td valign="center" align="left"><tt>jobDone</tt></td><td valign="center" align="left">Job has completed.</td></tr><tr><td valign="center" align="left"><tt>jobFinalized</tt></td><td valign="center" align="left">Job has been stopped.</td></tr><tr><td valign="center" align="left"><tt>jobPaused</tt></td><td valign="center" align="left">Job has been paused.</td></tr><tr><td valign="center" align="left"><tt>jobProgress</tt></td><td valign="center" align="left">Job has made progress.</td></tr><tr><td valign="center" align="left"><tt>jobResurrected</tt></td><td valign="center" align="left">A search restarted the job poller.</td></tr><tr><td valign="center" align="left"><tt>jobStatusChanged</tt></td><td valign="center" align="left">Job status has changed.</td></tr></table><br>The <tt>Splunk.Job</tt> class provides methods for checking job progress. The <tt>Splunk.Module</tt> and <tt>Splunk.Module.DispatchingModule</tt> classes include callback methods for handling job progress changes.<h3> <a name="glossary_-m-"><span class="mw-headline" id="-M-"> -M-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_mako_templates"><span class="mw-headline" id="Mako_templates">Mako templates</span></a></i></b></font></h4><p><a href="#module">Module</a> views are implemented using Mako templates</p><h4><font size="3"><b><i> <a name="glossary_metadata"><span class="mw-headline" id="metadata">metadata</span></a></i></b></font></h4><p> Metadata are the ownership, access control, sharing, and mutability settings associated      with an <a href="#entity">  entity</a>. The <tt>  ObjectMetadataModel </tt> and <tt>  SplunkAppObjModel </tt> classes abstract operations on resource metadata contained in model fields.</p><h4><font size="3"><b><i> <a name="glossary_model"><span class="mw-headline" id="model">model</span></a></i></b></font></h4><p> Definition coming soon ...</p><h4><font size="3"><b><i> <a name="glossary_model_field"><span class="mw-headline" id="model_field">model field</span></a></i></b></font></h4><p> A model field is an attribute associated with a given <a href="#entity">  entity</a>, as defined by the model class.  Fields have the notion of mutability.</p><h4><font size="3"><b><i> <a name="glossary_module"><span class="mw-headline" id="module">module</span></a></i></b></font></h4><p> A module is a fundamental Module System artifact that implements application functionality, including UI artifacts; every item in a <a href="#view">view</a> is module.  The <a href="#view_xml">View XML</a> provides the structuring component that defines the relationship between application modules. A module implementation is required to have a configuration (<tt>.conf</tt>) file and client-side logic (<tt>&lt;file&gt;.js&lt;/file&gt;</tt>).  A module can also, optionally, include a template (<tt>.html</tt>) file, a <a href="#module_controller">module controller</a> (<tt>.py</tt>) file and static content, such as style sheets and images.</p><h4><font size="3"><b><i> <a name="glossary_module_controller"><span class="mw-headline" id="module_controller">module controller</span></a></i></b></font></h4><p> A module controller is the server-side component that responds to XMLHttpRequest AJAX calls, and is analagous to the controller part of the MVC pattern.  A module controller, unlike a basic Splunk controller, has the following limitations: </p><ul><li>Does not have access to <a href="#decorators">decorators</a>.</li><li>Only handles GET requests.</li><li>Cannot return a generator.</li></ul><h4><font size="3"><b><i> <a name="glossary_module_system"><span class="mw-headline" id="Module_System">Module System</span></a></i></b></font></h4><p> The Module System is a set of core Splunk software and architecture principles that      provides large-scale reuse in creating Splunk apps and add-ons.  Module System extension points provide hooks into framework module, AJAX, and MVC      components and patterns, facilitating custom application development.</p><p> See also: <a href="#app">  app</a>, <a href="#add-on">  add-on</a>, <a href="#module">  module </a></p><h3> <a name="glossary_-n-"><span class="mw-headline" id="-N-"> -N-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_namespace"><span class="mw-headline" id="namespace">namespace</span></a></i></b></font></h4><p> See Mako Namespaces</p><h3> <a name="glossary_-p-"><span class="mw-headline" id="-P-"> -P-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_parent"><span class="mw-headline" id="parent">parent</span></a></i></b></font></h4><p>  In the hierarchical module relationship a parent module encapsulates a <a href="#child">child</a> module.</p><h3> <a name="glossary_-q-"><span class="mw-headline" id="-Q-"> -Q-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_query_set"><span class="mw-headline" id="query_set">query set</span></a></i></b></font></h4><p> Definition coming soon ...</p><h3> <a name="glossary_-r-"><span class="mw-headline" id="-R-"> -R-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_resource"><span class="mw-headline" id="resource">resource</span></a></i></b></font></h4><p> A partial resource path used to build Entity Id's (e.g. "resource = 'saved/my_object'").</p><h4><font size="3"><b><i> <a name="glossary_result"><span class="mw-headline" id="result">result</span></a></i></b></font></h4><p> In the context of the Module System, the result is what is returned by a job.  For a search job, the result is search results.</p><h3> <a name="glossary_-s-"><span class="mw-headline" id="-S-"> -S-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_self"><span class="mw-headline" id="self">self</span></a></i></b></font></h4><p><tt>  Self </tt> is a Python keyword used in class instantiation that refers to the instantiated object,      itself. By convention, the keyword <tt>  cls </tt> may be used interchangeably with <tt>  self</tt>.</p><h3> <a name="glossary_-t-"><span class="mw-headline" id="-T-"> -T-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_template"><span class="mw-headline" id="template">template</span></a></i></b></font></h4><p> (See <a href="#mako_templates">  Mako templates </a> )</p><h3> <a name="glossary_-v-"><span class="mw-headline" id="-V-"> -V-</span></a></h3><h4><font size="3"><b><i> <a name="glossary_view"><span class="mw-headline" id="view">view</span></a></i></b></font></h4><p> A view is a collection and layout of modules that work together, hierarchically, to give an enhanced user experience when exploring or visualizing data in Splunk. Views are configured using <a href="#view_xml">view XML</a>.</p><h4><font size="3"><b><i> <a name="glossary_view_xml"><span class="mw-headline" id="View_XML">View XML</span></a></i></b></font></h4><p> The View XML provides the structuring component of the Module System that defines the relationship between application <a href="#module">modules</a>.</p>

<a name="abbreviations"></a><h2> <a name="abbreviations_abbreviations"><span class="mw-headline" id="Abbreviations"> Abbreviations</span></a></h2>
<p><a href="#-a-">  A - </a><a href="#-c-">  C - </a><a href="#-d-">  D - </a><a href="#-h-">  H - </a><a href="#-j-">  J - </a><a href="#-m-">  M - </a><a href="#-x-">  X </a></p><h4><font size="3"><b><i> <a name="abbreviations_-a-"><span class="mw-headline" id="-A-">  -A- </span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_ajax"><span class="mw-headline" id="AJAX">  AJAX </span></a></h4><p> Asynchronous JavaScript and XML</p><p> See: http://en.wikipedia.org/wiki/Ajax_(programming) </p><p><br> Module client code uses AJAX to make GET requests on server endpoints.  Modules usually override the <tt><a href="#splunk.module">   Splunk.Module  </a></tt> base class <tt>getResults()</tt> method to request and handle search results.  Most often, the data returned in the response is in JSON format.</p><h4><font size="3"><b><i> <a name="abbreviations_-c-"><span class="mw-headline" id="-C-"> -C-</span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_csrf"><span class="mw-headline" id="CSRF"> CSRF</span></a></h4><p> Cross-site request forgery</p><p> See: http://en.wikipedia.org/wiki/CSRF </p><p><br> It is important to guarantee that POST requests are authentic to protect against CSRF attacks.  The Module System provides the <tt><a href="#csrf_hidden_input.28.29">   csrf_hidden_input()  </a></tt> template utility to insert a hidden form used to verify the validity of the POST request.</p><h4 class="abbrev"> <a name="abbreviations_css"><span class="mw-headline" id="CSS"> CSS</span></a></h4><p> Cascading Style Sheets</p><p> See: http://en.wikipedia.org/wiki/Css </p><p><br> Default style sheets are located at <tt>  $SPLUNK_HOME/share/splunk/search_mrsparkle/exposed/css/ </tt> and <tt>  $SPLUNK_HOME/share/splunk/search_mrsparkle/exposed/css/skins</tt>.  You can do simple app customizations using custom style sheets.</p><h4><font size="3"><b><i> <a name="abbreviations_-d-"><span class="mw-headline" id="-D-"> -D-</span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_dom"><span class="mw-headline" id="DOM"> DOM</span></a></h4><p> Document Object Model</p><p> See: http://en.wikipedia.org/wiki/Document_Object_Model </p><p><br> As in common web programming, DOM is mostly used for binding handlers to DOM elements; preferably, using the jQuery <tt>  $(document).ready(function() {...}); </tt> method.  A number of Module System APIs also provide access to DOM properties.</p><h4><font size="3"><b><i> <a name="abbreviations_-h-"><span class="mw-headline" id="-H-"> -H-</span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_html"><span class="mw-headline" id="HTML"> HTML</span></a></h4><p> HyperText Markup Language</p><p> See: http://en.wikipedia.org/wiki/Html </p><p><br> Mako templates implement the app view component of the [MVC   MVC ] pattern using HTML and Python-like constructs.</p><h4 class="abbrev"> <a name="abbreviations_http"><span class="mw-headline" id="HTTP"> HTTP</span></a></h4><p> Hypertext Transfer Protocol</p><p> See: http://en.wikipedia.org/wiki/Http </p><p><br> Module System uses CherryPy  to implement the HTTP server.</p><h4><font size="3"><b><i> <a name="abbreviations_-j-"><span class="mw-headline" id="-J-"> -J-</span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_json"><span class="mw-headline" id="JSON"> JSON</span></a></h4><p> JavaScript Object Notation</p><p> See: http://en.wikipedia.org/wiki/Json </p><p><br> The JSON data format is one of the formats supported for transferring data from the server to client.  See <tt><a href="#render_json.28.29.28.29">   render_json()</a></tt>.  JSON is most often the format of the data returned in a module AJAX request.</p><h4><font size="3"><b><i> <a name="abbreviations_-m-"><span class="mw-headline" id="-M-"> -M-</span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_mvc"><span class="mw-headline" id="MVC"> MVC</span></a></h4><p> Model-view-controller</p><p> See: http://en.wikipedia.org/wiki/Model_view_controller </p><p><br> The Module System implements the MVC architecture pattern for functions that do not involve search, jobs, results, or events.  See the <u>Set up your app</u> recipe in the Cookbook.</p><h4><font size="3"><b><i> <a name="abbreviations_-x-"><span class="mw-headline" id="-X-"> -X-</span></a></i></b></font></h4><h4 class="abbrev"> <a name="abbreviations_xhr"><span class="mw-headline" id="XHR"> XHR</span></a></h4><p> XMLHttpRequest</p><p> See: http://en.wikipedia.org/wiki/XMLHttpRequest </p><p><br> Code and documentation occasionally use XHR to refer to an HTTP request.</p><h4 class="abbrev"> <a name="abbreviations_xml"><span class="mw-headline" id="XML"> XML</span></a></h4><p> Extensible Markup Language</p><p> See: http://en.wikipedia.org/wiki/Xml </p><p><br> App view layout and navigation are specified using XML notation.  Building apps using Module System mostly involves using Advanced XML to describe your app view.</p>

<h1>Getting started</h1><a name="environmentsetup"></a><h2> <a name="environmentsetup_environment_setup"><span class="mw-headline" id="Environment_setup"> Environment setup</span></a></h2>
<h3> <a name="environmentsetup_about_the_splunk_installation"><span class="mw-headline" id="About_the_Splunk_installation">About the Splunk installation</span></a></h3>
<p> To develop, test and run custom applications, you need to install Splunk. There are no special installation requirements for app development so, if this is your first exposure to Splunk, refer to the Installation Manual for installing and running Splunk.</p><p> You'll find the following Installation Manual sections helpful:</p><ul><li>List of supported hardware, operating systems, file systems, and browsers. </li><li>High-level description of the Splunk architecture and installed components. </li><li>Licensing information. </li><li>Installation procedures. </li><li>Starting Splunk. </li></ul><p> Developing custom applications that use the Module System requires little more than installing Splunk and using your favorite Web development tools to create and debug your application.</p><p>Module System applications are implemented using Python and Mako templates, which are packaged with the Splunk distribution, and JavaScript.  This toolset should be generally familiar to Web developers.  The following figure shows how the Module System abstracts Splunk core, showing component dependencies:</p><p><img alt="FworkLayersNew.png" src="images/2/28/FworkLayersNew.png" width="440" height="420"></p><p> The Module System layer API provides the abstractions needed to extend core Splunk functionality, and customize that functionality for your application domain.  The framework API provides access to the same libraries that power Splunk Web, including CherryPy application server access and Mako templating facilities.  The API also abstracts the REST interface.</p><p> Applications built on the Module System typically use the Splunk module pattern and the familiar MVC pattern.  These are described in more detail in the Cookbook.  For now, you'll learn the parts of an app by walking though a real-world example.</p>
<h3> <a name="environmentsetup_where_to_find_the_code"><span class="mw-headline" id="Where_to_find_the_code">Where to find the code</span></a></h3>
<p> After installing Splunk, you'll have access to the Module System API source code.  This will be useful for debugging and to review for an even better understanding of how the Module System works. The source files of interest are located in the following directories, where Python2.x is the Splunk Python distribution version:</p><p class="note"><i><b>Note: </b>The pathnames are shown for Linux and differ slightly for Windows.</i></p><table cellpadding="6"><tr><td valign="center" align="left">    Python controllers   </td><td valign="center" align="left"><tt>     $SPLUNK_HOME/lib/Python2.x/site-packages/splunk/appserver/mrsparkle/controllers    </tt></td></tr><tr><td valign="center" align="left">    Python libraries   </td><td valign="center" align="left"><tt>     $SPLUNK_HOME/lib/Python2.x/site-packages/splunk/appserver/mrsparkle/lib    </tt></td></tr><tr><td valign="center" align="left">    Python model   </td><td valign="center" align="left"><tt>     $SPLUNK_HOME/lib/Python2.x/site-packages/splunk/models    </tt></td></tr><tr><td valign="center" align="left">    Javascript libraries/utilities   </td><td valign="center" align="left"><tt>     $SPLUNK_HOME/share/splunk/search_mrsparkle/exposed/js    </tt></td></tr><tr><td valign="center" align="left">    Javascript module base classes   </td><td valign="center" align="left"><tt>     $SPLUNK_HOME/share/splunk/search_mrsparkle/modules    </tt></td></tr></table><p> Your custom app is located in the <tt>$SPLUNK_HOME/etc/apps/<i>&lt;yourAppName&gt;</i></tt> directory.</p><p>Review the  Examples code for the examples used in this document that demonstrate basic app components.</p><p>You can also download and install the full set of examples as an app to run the examples from the UI and browse the actual implementation.</p><ol><li>Download Dev_tutorial.zip.</li><li>Extract the file to your <code><font size="2">$SPLUNK_HOME/etc/apps</font></code> directory.</li><li>Restart Splunk.</li><li>Run the <b>Dev_tutorial</b> app.</li></ol><h3> <a name="environmentsetup_your_programming_environment"><span class="mw-headline" id="Your_programming_environment">Your programming environment</span></a></h3>
<h4><font size="3"><b><i> <a name="environmentsetup_creating_source_files"><span class="mw-headline" id="Creating_source_files"> Creating source files</span></a></i></b></font></h4><p> Use your favorite text editor or IDE for app development.</p><h4><font size="3"><b><i> <a name="environmentsetup_debugging_your_application"><span class="mw-headline" id="Debugging_your_application"> Debugging your application</span></a></i></b></font></h4><p> For client-side debugging of your HTML/CSS/JavaScript, you'll find browser plugins like FireBug to be useful.</p><p> Server-side debugging typically involves logging debug messages to the <tt>web_services.log</tt> file.</p>
<h3> <a name="environmentsetup_splunk_knowledge_prerequisites"><span class="mw-headline" id="Splunk_knowledge_prerequisites">Splunk knowledge prerequisites</span></a></h3>
<p> To successfully develop custom applications, it is helpful to have an understanding of the following topics:</p><h4><font size="3"><b><i> <a name="environmentsetup_web_programming"><span class="mw-headline" id="Web_programming"> Web programming</span></a></i></b></font></h4><ul><li>  HTML/CSS </li><li>  Python </li><li>  Javascript </li><li>  and eventually, Mako templates </li></ul><h4><font size="3"><b><i> <a name="environmentsetup_splunk"><span class="mw-headline" id="Splunk"> Splunk</span></a></i></b></font></h4><ul><li>  Understand Advanced XML, particularly, module hierarchy and how context is passed between modules. Download and run the UI Examples tutorial:  Splunk UI examples app for 4.1+)  <br></li><li>  Understand application UI behavior as implemented by the <tt>ViewController</tt> class in <tt>view.py</tt>:  <p>   Windows:  <code><font size="2">$SPLUNK_HOME\Python-2.x\Lib\site-packages\splunk\appserver\mrsparkle\controllers\view.py &nbsp;</font></code>Linux:  <code><font size="2">$SPLUNK_HOME/lib/Python2.x/site-packages/splunk/appserver/mrsparkle/controllers/view.py &nbsp;</font></code></p></li><li>  Understand structure and behavior of modules that make up a view, as implemented by: <tt>module.py</tt>:  <p>   Windows:<code><font size="2">$SPLUNK_HOME\Python-2.x\Lib\site-packages\splunk\appserver\mrsparkle\lib\module.py</font></code>Linux:<code><font size="2">$SPLUNK_HOME/lib/Python2.x/site-packages/splunk/appserver/mrsparkle/lib/module.py</font></code></p></li></ul><a name="anatomyofanapp"></a><h2> <a name="anatomyofanapp_anatomy_of_an_app"><span class="mw-headline" id="Anatomy_of_an_app"> Anatomy of an app</span></a></h2>
<h3> <a name="anatomyofanapp_about_the_example"><span class="mw-headline" id="About_the_example">About the example</span></a></h3>
<p> The Module System borrows many concepts from other application frameworks, like Django and TurboGears. If you're familiar with modern web application frameworks, you'll already have a basic understanding of how the Module System works.</p><p> Here, we use the simple custom application example to show the fundamental code and concepts underlying Module System apps. You'll be introduced to some Splunk-specific terminology, the structure and declaration of an application, and client- and server-side programming.</p><p><i><b>   Note:  </b>  You can view the  Source code, used in this example to follow along with the tutorial. You can also download and install the full set of examples as an app to run the examples from the UI and browse the actual implementation.<ol><li>Download Dev_tutorial.zip.</li><li>Extract the file to your <code><font size="2">$SPLUNK_HOME/etc/apps</font></code> directory.</li><li>Restart Splunk.</li><li>Run the <b>Dev_tutorial</b> app.</li></ol></i></p><p> This example app displays CPU utilization using readily available data, the metrics log. You can find a detailed description of the log in Troubleshooting inputs with metrics.log, Some details on metrics.log data, format, utility, and Metrics.log information. But, here, we're going to look at only the CPU utilization of various indexer pipeline stages:</p><p><img alt="Ex4 00.png" src="images/4/4d/Ex4_00.png" width="640" height="419"></p><p> A typical pipeline typing section log entry might look like this:</p><code><font size="2">
<p>group=pipeline, name=parsing, processor=utf8, cpu_seconds=2.118462, executes=306, cumulative_hits=112120
</p>
</font></code><p> So, because we want to extract and sum the CPU seconds for each pipeline stage, the search string we'll use is:</p><code><font size="2">
<p>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name
</p>
</font></code><p> We display the sum of CPU seconds over the specified timerange for each pipeline stage.</p><p> To get interesting data for this example, you'll need to run the indexer.</p><p> As a point of comparison, you might consider how this same application can be implemented using the <tt>  SimpleResultsTable </tt> module.</p>
<h3> <a name="anatomyofanapp_some_terminology"><span class="mw-headline" id="Some_terminology">Some terminology</span></a></h3>
<p> Here are some terms you'll encounter meaningful to Splunk application development:</p><table cellpadding="6"><tr><td valign="center" align="left">    advanced XML   </td><td valign="center" align="left">    Advanced XML are XML-formatted files used to define the visual layout and module data flow dependencies. Likely, you're creating a custom application because the simplified XML shipped with Splunk doesn't quite solve the unique problems of your application domain.   </td></tr><tr><td valign="center" align="left">    app   </td><td valign="center" align="left">    An app is a redistributable software package having presentation and programming logic for visualizing an application domain and responding to domain-specific events.   </td></tr><tr><td valign="center" align="left">    Mako template   </td><td valign="center" align="left">    Mako is a Python Server Page template library used to define the presentation layer. (See    Mako Templates for Python        )   </td></tr><tr><td valign="center" align="left">    module   </td><td valign="center" align="left">    Modules are components that implement the look-and-feel of a view, primarily client- and server-side code encapsulating the AJAX pattern.   </td></tr><tr><td valign="center" align="left">    view   </td><td valign="center" align="left">    A view is a collection and layout of modules that work together, hierarchically, to give an enhanced user experience when exploring or visualizing data in Splunk. Views are configured using view XML.   </td></tr></table><h3> <a name="anatomyofanapp_structural_overview"><span class="mw-headline" id="Structural_overview">Structural overview</span></a></h3>
<p> All apps have the same basic layout, which might be familiar to you, if you've developed apps using advanced XML:</p><p><img alt="ModuleStruct.png" src="images/b/b8/ModuleStruct.png" width="440" height="333"></p><p> XML files define app metadata; view components, including modules, which implement app behavior; and component hierarchical relationships.</p><p> In the diagram, the config and nav/views define the modules that compose an app and module parameters and  relationships.</p><p><i><b>   Note:  </b>  The shaded blocks in the diagram are those parts of an app covered in this Getting Started. </i></p><p> A module encapsulates all of the code that implements part of the application logic or view,      including client- and server-side code.  We discuss module implementation in more detail, later.  From a configuration point of view modules can be encapsulated in other modules, and      the figure shows a module encapsulated in a hidden module, inheriting  properties and context from the hidden module.</p><h4><font size="3"><b><i> <a name="anatomyofanapp_corresponding_directory_structure"><span class="mw-headline" id="Corresponding_directory_structure"> Corresponding directory structure</span></a></i></b></font></h4><p> App component relationships are implicit, relying on a directory structure and naming      convention, which the framework resolves.  All application code is located in a <tt>  $SPLUNK_HOME/etc/apps </tt> subdirectory for the app.  In this example, the <tt>  Dev_tutorial </tt> app is located in the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial </tt> directory.</p><p> A number of subdirectories are located in the application directory.  The  subdirectories we're interested in this example, minimally, are:</p><table cellpadding="6"><tr><td valign="center" align="left"><tt>     $SPLUNK_HOME/etc/apps/Dev_tutorial/default    </tt></td><td valign="center" align="left">    Configuration files that describe the view presentation components and app structure.   </td></tr><tr><td valign="center" align="left"><tt>     $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver    </tt></td><td valign="center" align="left">    Program and resource files that implement the application logic, including modules               and MVC components.   </td></tr></table><p> The default directory has the following structure:</p><p><img alt="DirStructUI.png" src="/images/b/b9/DirStructUI.png" width="114" height="151"><br></p><ul><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/default/app.conf  </tt>  defines your app metadata, such as the app name. </li><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/nav/default.xml  </tt>  defines your app navigation artifacts, such as the  <b>   Examples  </b>  drop-down menu. </li><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/views/Example.xml  </tt>  defines your app presentation layer hierarchy. </li></ul><p> The appserver directory has the following structure:</p><p><img alt="DirStructModule.png" src="/images/0/05/DirStructModule.png" width="171" height="171"><br></p><ul><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/controllers  </tt>  contains your app MVC controllers, which are not used in this example. </li><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/modules/  </tt>  contains your custom app modules.  For this example, you can see that  <tt>   CustomResultsTable  </tt>  is the only custom module included. </li><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/static  </tt>  contains any resources, such as images, used in your app. </li><li><tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/templates  </tt>  contains your app MVC Mako templates, which are not used in this example. </li></ul><p> By convention, your custom module subdirectory name and implementation files must      have the same base name. The&nbsp; <tt>  CustomResultsTable </tt> module directory contains the following files that implement your application logic:</p><table cellpadding="6"><tr><td valign="center" align="left"><tt>     CustomResultsTable.conf    </tt></td><td valign="center" align="left">    (required) Module class, parameters and metadata.   </td></tr><tr><td valign="center" align="left"><tt>     CustomResultsTable.css    </tt></td><td valign="center" align="left">    (optional) Custom CSS required by your module.   </td></tr><tr><td valign="center" align="left"><tt>     CustomResultsTable.html    </tt></td><td valign="center" align="left">    (optional) Module template of your presentation layer.   </td></tr><tr><td valign="center" align="left"><tt>     CustomResultsTable.js    </tt></td><td valign="center" align="left">    (required) Client-side logic.   </td></tr><tr><td valign="center" align="left"><tt>     CustomResultsTable.py    </tt></td><td valign="center" align="left">    (optional) Server-side logic.   </td></tr></table><p> We will now go into more detail about  how to implement your custom app.</p><h4><font size="3"><b><i> <a name="anatomyofanapp_app_definition"><span class="mw-headline" id="App_definition"> App definition</span></a></i></b></font></h4><p> The <tt>app.conf</tt> file defines your app structure at the highest level, which is the relationship between modules.</p><code><font size="2">
<p>[ui]
is_visible = true
label = Module System Tutorial
</p><p>[package]
id = Dev_tutorial
</p><p>[launcher]
author = Splunk, Inc.
description = Module System Tutorial App
version = 1.0
</p>
</font></code><p> It is important that the <tt>  id </tt> value in the <tt>  package </tt> stanza is unique for your Splunk instance.</p><p><i><b>   Note:  </b>  By convention, the  <tt>   id  </tt>  property is the same as the name of your app directory,  <tt>   /apps/Dev_tutorial</tt>. </i></p><h4><font size="3"><b><i> <a name="anatomyofanapp_view_navigation"><span class="mw-headline" id="View_navigation"> View navigation</span></a></i></b></font></h4><p> The <tt>  default.xml </tt> file defines your view navigation, which is your view entry point:</p><code><font size="2">
<p>&lt;nav&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;&lt;collection label="Examples"&gt;<br>&nbsp;&nbsp;&nbsp;&lt;view name="Example" /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;/collection&gt;<br></font></code>
<p>&lt;/nav&gt;
</p>
</font></code><p> This example provides the <tt>  Examples </tt> drop-down menu, in the upper left, with one <b>  Example </b> menu item. You might add variations of this example by adding to the menu, which      is what we show in the Cookbook.</p><h4><font size="3"><b><i> <a name="anatomyofanapp_presentation_layer"><span class="mw-headline" id="Presentation_layer"> Presentation layer</span></a></i></b></font></h4><p> The declarations in your <tt>  /views </tt> directory is where you define the look and behavior of your app.  Our Example.xml file has the following sections implemented, which includes      existing and custom module declarations.</p><p> The top section shows a typical application header layout:</p><code><font size="2">
<p>&lt;module name="AccountBar" layoutPanel="appHeader"/&gt;
&lt;module name="AppBar" layoutPanel="navigationHeader"/&gt;
&lt;module name="Message" layoutPanel="messaging"&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;&lt;param name="filter"&gt;*&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&lt;param name="clearOnJobDispatch"&gt;False&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&lt;param name="maxSize"&gt;1&lt;/param&gt;<br></font></code>
<p>&lt;/module&gt;
</p>
</font></code><p> We've provided some text explaining the example in the middle section:</p><code><font size="2">
<p>&lt;module name="StaticContentSample" layoutPanel="panel_row1_col1"&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;&lt;param name="text"&gt;&lt;![CDATA[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;Example: Using a Custom Module&lt;/h1&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;This simple application searches ...&lt;/p&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Search string: &nbsp;index=_internal ...&lt;/p&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Results are displayed using ...&lt;/p&gt;<br>&nbsp;&nbsp;&nbsp;]]&gt;&lt;/param&gt;<br></font></code>
<p>&lt;/module&gt;
</p>
</font></code><p> Finally, we've specified the <tt>  CustomResultsTable </tt> module to render the search results:</p><code><font size="2">
<p>&lt;module name="HiddenSearch" layoutPanel="panel_row2_col1" group="CPU Utilization" autoRun="True"&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;&lt;param name="search"&gt;index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&lt;param name="earliest"&gt;-7d&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&lt;module name="CustomResultsTable"&gt;&lt;/module&gt;<br></font></code>
<p>&lt;/module&gt;
</p>
</font></code><p> Notice that the <tt>  CustomResultsTable </tt> module is encapsulated in the <tt>  HiddenSearch </tt> module, which initiates the search job.  On context change or job status change, the <tt>  CustomResultsTable </tt> module inherits and displays the results from the <tt>  HiddenSearch </tt> module.</p><p> Also, for this example the search command is statically defined.</p>
<h3> <a name="anatomyofanapp_ajax_call"><span class="mw-headline" id="AJAX_call">AJAX call</span></a></h3>
<p> The AJAX call, shown in the diagram as the interface between <tt>  Request/Render Results </tt> and <tt>  Generate Results</tt>, is abstracted because your app client ultimately inherits from <tt>  Splunk.Module </tt> (see <tt>  $SPLUNK_HOME/share/splunk/search_mrsparkle/modules/AbstractModule.js</tt>).</p><p> All you need to do is provide server-side results and client-side  response handlers to render the results.  The Module System automatically makes the AJAX request on your behalf.</p>
<h3> <a name="anatomyofanapp_custom_module_definition"><span class="mw-headline" id="Custom_module_definition">Custom module definition</span></a></h3>
<p> This example demonstrates the fundamental way you can leverage the Module System to      create new applications. In addition to using configuration files, which you have      already seen, the primary way of extending framework functionality is by subclassing and      overriding module base class methods.  In your methods you have access to Module API utilities with their getter and setter functions for accessing Module System properties.</p><p> The module subsystem abstracts the MVC pattern through high-level interfaces.  In subsequent examples, you will use the MVC pattern more directly to setup and monitor      your application.  But you might find it useful to gain some understanding of how the Module System works by      looking at the following source code:</p><table cellpadding="6"><tr><td valign="center" align="left"><tt>     ModuleController    </tt>    and    <tt>     ModuleHandler    </tt><tt>     classes.    </tt></td><td valign="center" align="left"><tt>     $SPLUNK_HOME/lib/Python2.x/site-packages/splunk/appserver/mrsparkle/lib/module.py    </tt></td></tr><tr><td valign="center" align="left">    &nbsp;   </td><td valign="center" align="left">    &nbsp;   </td></tr><tr><td valign="center" align="left"><tt>     ViewController    </tt><tt>     class. View states are of special interest.    </tt></td><td valign="center" align="left"><tt>     $SPLUNK_HOME/lib/Python2.x/site-packages/splunk/appserver/mrsparkle/controllers/view.py    </tt></td></tr></table><p></p><p> We'll complete the discussion by looking at the client- and server-side logic, but      first let's see how to define and configure your app.  All of these files are located in the following directory:</p><code><font size="2">
<p>$SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/modules/CustomResultsTable
</p>
</font></code><h4><font size="3"><b><i> <a name="anatomyofanapp_customresultstable.conf"><span class="mw-headline" id="CustomResultsTable.conf"> CustomResultsTable.conf</span></a></i></b></font></h4><p> Use the <tt>  CustomResultsTable.conf </tt> file to define your module signature.</p><p> Module class name and base class from which your module inherits:</p><code><font size="2">
<p>[module]
className = Splunk.Module.CustomResultsTable
superClass = Splunk.Module.DispatchingModule
</p>
</font></code><p><i><b>   Note:  </b>  Parameters are not used in this example but you will learn how to use      parameters in subsequent examples. </i></p>
<h3> <a name="anatomyofanapp_client-side_code_walkthrough"><span class="mw-headline" id="Client-side_code_walkthrough">Client-side code walkthrough</span></a></h3>
<p> The client-side code includes:</p><ul><li>  HTML module template </li><li>  Style sheet (optional) </li><li>  JavaScript </li></ul><p> If the example used other static resources, such as images and other HTML      pages, they would be stored in the&nbsp; <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/static </tt> directory.</p><h4><font size="3"><b><i> <a name="anatomyofanapp_customresultstable.html"><span class="mw-headline" id="CustomResultsTable.html"> CustomResultsTable.html</span></a></i></b></font></h4><p> The main module HTML page is a Mako template.  Here, we have defined a <tt>  &lt;div&gt; </tt> tag where we will render the results of the search request.</p><code><font size="2">
<p>&lt;%page args="module"/&gt;
&lt;div class="CustomResultsTableResults"&gt;&lt;/div&gt;
</p>
</font></code><p> The template has a specifically defined argument signature, indicating this is a <i>  module </i> template.  See &lt;%page&gt;.</p><h4><font size="3"><b><i> <a name="anatomyofanapp_customresultstable.css"><span class="mw-headline" id="CustomResultsTable.css"> CustomResultsTable.css</span></a></i></b></font></h4><p> In this example, we use <tt>  CustomResultsTable.css </tt> for custom styling.  You have the option of whether or not to use custom styling.  You could use the default style sheet:</p><code><font size="2">
<p>$SPLUNK_HOME/share/splunk/search_mrsparkle/exposed/css/skins/default/default.css
</p>
</font></code><h4><font size="3"><b><i> <a name="anatomyofanapp_customresultstable.js"><span class="mw-headline" id="CustomResultsTable.js"> CustomResultsTable.js</span></a></i></b></font></h4><p> Client-side logic hooks into the framework by subclassing <tt>  Splunk.Module.DispatchingModule </tt> for attaching handlers to job progress events, overriding methods      to primarily handle context change, job progress events, and results rendering.</p><p> Define the <tt>  CustomResultsTable </tt> class using the <tt> klass</tt> construct.</p><code><font size="2">
<p>Splunk.Module.CustomResultsTable = $.klass(Splunk.Module.DispatchingModule, {})
</p>
</font></code><p> Next, initialize the class by calling the base class, and define a local container      variable for rendering the results.</p><code><font size="2">
<p>initialize: function($super, container) {
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.myParam = this.getParam("myParam");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.resultsContainer = this.container;<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
</font></code><p><i><b>   Note:  </b>  Module initialization always requires calling the base class constructor using  <tt>   $super</tt>. </i></p><h5> <a name="anatomyofanapp_onjobdone_method"><span class="mw-headline" id="onJobDone_method"> onJobDone method</span></a></h5><p> Your app can perform actions based on various job state functions, such as <tt>  onJobProgress()</tt>.  In this example, we only want to render the results after the job completes, so we      use a callback function to handle the job <tt>  done </tt> state change.</p><code><font size="2">
<p>onJobDone: function(event) {
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.getResults();<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
</font></code><p> The <tt>  Splunk.Module </tt> base class, in <tt>  AbstractModule.js</tt>, implements the <tt>  getResults()</tt> function, which handles the response to the AJAX request and calls the <tt>  renderResults()</tt> method.</p><p> Calling <tt>  getResults()</tt> causes the <tt>  getResultParams()</tt> and <tt>renderResults()</tt> functions to be called, in turn, to retrieve and render the response data.</p><h5> <a name="anatomyofanapp_getresultparams_method"><span class="mw-headline" id="getResultParams_method"> getResultParams method</span></a></h5><p> Implement the <tt>  getResultParams()</tt> method to get the results returned as a parameter, using the search ID for the active context.</p><code><font size="2">
<p>getResultParams: function($super) {
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var params = $super();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var context = this.getContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var search &nbsp;= context.get("search");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var sid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= search.job.getSearchId();<br></font></code>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!sid) this.logger.error(this.moduleType, "...");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.sid = sid;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return params;<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
</font></code><h5> <a name="anatomyofanapp_renderresults_method"><span class="mw-headline" id="renderResults_method"> renderResults method</span></a></h5><p> This method renders an HTML fragment formatted on the server, in the      browser.</p><code><font size="2">
<p>renderResults: function($super, htmlFragment) {
</p>
<code><font size="2"> &nbsp;&nbsp;if (!htmlFragment) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.resultsContainer.html('No content available.');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;this.resultsContainer.html(htmlFragment);<br></font></code>
<p>}
</p>
</font></code><p> The table of CPU utilization is rendered in the <tt>  &lt;div&gt; </tt> defined in <tt>  CustomResultsTable.html</tt>.</p><p> We could have sent raw results data to the client and had the client do the HTML formatting,      but we will save that for another example where we transfer JSON data.</p>
<h3> <a name="anatomyofanapp_server-side_code_walkthrough"><span class="mw-headline" id="Server-side_code_walkthrough">Server-side code walkthrough</span></a></h3>
<p> The server-side code implements the <tt>  generateResults()</tt> method of the <tt>  ModuleHandler </tt> class.  It formats the HTML code that will be transferred to and rendered in the client browser.</p><h4><font size="3"><b><i> <a name="anatomyofanapp_customresultstable.py"><span class="mw-headline" id="CustomResultsTable.py"> CustomResultsTable.py</span></a></i></b></font></h4><p> Almost all modules require the following imports:</p><code><font size="2">
<p>import controllers.module as module
import splunk
import splunk.search
import splunk.util
import splunk.entity
import lib.util as util
import lib.i18n as i18n
import logging
</p><p>logger = logging.getLogger('splunk.module.CustomResultsTable')
</p>
</font></code><p> For debugging server code, we advise using built-in logging feature:</p><p> We allocated a logger for the <tt>  CustomResultsTable </tt> class.</p><p> Define the <tt>  CustomResultsTable </tt> class, passing the <tt>  ModuleHandler </tt> base class as a parameter:</p><code><font size="2">
<p>class CustomResultsTable(module.ModuleHandler):
</p>
</font></code><p> The <tt>  generateResults()</tt> method is the only method we need to override to build the HTML results page.</p><code><font size="2">
<p>def generateResults(self, host_app, client_app, sid, count=1000, 
</p>
<code><font size="2"> &nbsp;&nbsp;offset=0, entity_name='results'):<br></font></code>
</font></code><p> This method is called by <tt>  ModuleController.renderModule() </tt> when the search completes, with the following possible arguments:</p><table cellpadding="6"><tr><td valign="center" align="left"><i>     host_app    </i></td><td valign="center" align="left"></td><td valign="center" align="left">    Where this module resides. (not used in this example)   </td></tr><tr><td valign="center" align="left"><i>     client_app    </i></td><td valign="center" align="left"></td><td valign="center" align="left">    Namespace of app context which made the request.  (not used in this example)   </td></tr><tr><td valign="center" align="left"><i>     sid    </i></td><td valign="center" align="left"></td><td valign="center" align="left">    Search ID, used to get information about the job.   </td></tr><tr><td valign="center" align="left"><i>     count    </i></td><td valign="center" align="left"><tt>     1000    </tt></td><td valign="center" align="left">    Together with    <i>     offset</i>, gives an index of the returned data.   </td></tr><tr><td valign="center" align="left"><i>     offset    </i></td><td valign="center" align="left"><tt>     0    </tt></td><td valign="center" align="left">    Together with    <i>     count</i>, gives an index of the returned data.   </td></tr><tr><td valign="center" align="left"><i>     entity_name    </i></td><td valign="center" align="left"><tt>     results    </tt></td><td valign="center" align="left">    Reference to the actual returned data.   </td></tr></table><p> Validate the parameters, which should always be valid for this example.</p><code><font size="2">
<p>count = max(int(count), 0)
offset = max(int(offset), 0)
if not sid:
</p>
<code><font size="2"> &nbsp;&nbsp;raise Exception('CustomResultsTable.generateResults - sid not passed!')<br></font></code>
</font></code><p> Get the job property for this search ID.  The job information is used to extract the field names, results data, and job progress      status for the search.</p><code><font size="2">
<p>try:
</p>
<code><font size="2"> &nbsp;&nbsp;job = splunk.search.getJob(sid)<br></font></code>
<p>except splunk.ResourceNotFound, e:
</p>
<code><font size="2"> &nbsp;&nbsp;logger.error('CustomResultsTable could not find job&nbsp;%s.'&nbsp;% sid)<br>&nbsp;&nbsp;&nbsp;return _('&lt;p class="resultStatusMessage"&gt;Could not retrieve data.&lt;/p&gt;')<br></font></code>
</font></code><p> At last, we are ready to do the work we set out to do, which is to build the results      page to be sent to the client.</p><code><font size="2">
<p>output = []
output.append('&lt;div class="CustomResultsTableWrapper"&gt;')
output.append('&lt;table class="CustomResultsTable splTable"&gt;')
</p>
</font></code><p> Inside the <tt>  CustomResultsTableResults </tt><tt>  &lt;div&gt; </tt> tag in our HTML template we're adding a table of CPU utilization results wrapped      in a <tt>  CustomResultsTableWrapper </tt><tt>  &lt;div&gt;</tt>.</p><p> Let's build the table by extracting the field names of interest and, for each field,      associate the field value.</p><code><font size="2">
<p>fieldNames =
</p>
<code><font size="2"> &nbsp;[x for x in getattr(job, entity_name).fieldOrder if (not x.startswith('_')]<br></font></code>
<p>offset_start = offset
if offset &lt; 0 and count &lt; abs(offset):
</p>
<code><font size="2"> &nbsp;&nbsp;offset_start = -count<br></font></code>
<p>dataset = getattr(job, entity_name)[offset_start: offset+count]
</p><p>for i, result in enumerate(dataset):
</p>
<code><font size="2"> &nbsp;&nbsp;output.append('&lt;tr&gt;')<br>&nbsp;&nbsp;&nbsp;for field in fieldNames:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&lt;td')<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValues = result.get(field, None)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if fieldValues:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&gt;%s&lt;/td&gt;'&nbsp;% fieldValues)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&gt;&lt;/td&gt;')<br>&nbsp;&nbsp;&nbsp;output.append('&lt;/tr&gt;')<br></font></code>
<p>output.append('&lt;/table&gt;&lt;/div&gt;')
</p>
</font></code><p> The results in the search dataset include all the pipeline <b>  name </b> fields because the search selected by name. From these data, we construct the table, populating each row with the pipeline name and summary value from <tt>  fieldValues</tt>.</p><p> The completed HTML-formatted table is returned and will subsequently be sent to the client.</p><code><font size="2">
<p>if (entity_name == 'results' and job.resultCount == 0):
</p>
<code><font size="2"> &nbsp;&nbsp;if job.isDone:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output = self.generateStatusMessage(entity_name, 'nodata', job.id)<br>&nbsp;&nbsp;&nbsp;else:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output = self.generateStatusMessage(entity_name, 'waiting', job.id)<br></font></code>
<p>else:
</p>
<code><font size="2"> &nbsp;&nbsp;output = <i>.join(output)</i><br></font></code>
<p>return output
</p></font></code>

<a name="testingyourapp"></a><h2> <a name="testingyourapp_testing_your_app"><span class="mw-headline" id="Testing_your_app"> Testing your app</span></a></h2>
<h3> <a name="testingyourapp_packaging_and_installing"><span class="mw-headline" id="Packaging_and_Installing">Packaging and Installing</span></a></h3>
<p> While creating your app, you'll want to test it.</p><p> You can either follow along by viewing the code in the <tt>/Dev_tutorial</tt> directory, or reate a new directory parallel and populate it with the Source code for a more hands-on experience.</p><p> Typically, you would download an app from Splunk Apps using the <b>  Manage apps </b> option of the <b>  App </b> menu or create a local <tt>  .spl </tt> file, where the app would be installed in the <tt>  $SPLUNK_HOME/etc/apps </tt> directory. For demonstration purposes and initial debugging before your app is available      on Splunk Apps, it is easier to manually install the app, as described in this section.</p><p> Your example app should have the following directory structure, located in the <tt>  $SPLUNK_HOME/etc/apps/&lt;yourApp&gt; </tt> directory:</p><p><img alt="DirStruct00.png" src="images/7/70/DirStruct00.png" width="108" height="87"><br></p><ol><li>  In <tt>$SPLUNK_HOME/etc/apps</tt> create a parallel directory to the  <tt>   Dev_tutorial  </tt>  directory, giving it the name of your app. </li><li>  For your new app, create the directories shown in the figure, above. </li><li>  Populate the directories with the example Source code files. Your app is now ready to run. </li><li>  Restart Splunk: <tt>./splunk restart</tt></li></ol><p><i><b>   Note:  </b>  You can also compress your app in a tarball file with a  <tt>   .spl  </tt>  extension and use the App Manager to install your app. </i></p>
<h3> <a name="testingyourapp_running_the_app"><span class="mw-headline" id="Running_the_app">Running the app</span></a></h3>
<p> Run the <b>  Dev_tutorial </b> app the same way you would run any other Splunk app:</p><ol><li>  Start splunkWeb and, if needed, login. </li><li>  Click the  <b>   App  </b>  drop-down menu and select the  <b>   Module System Tutorial  </b>  app. </li><li>  Click the  <b>   Examples  </b>  drop-down menu in the upper-left and select the example you want to run. For  <u>   Getting started</u>, select  <b>   Example: Using a Custom Module  </b></li></ol><p><i><b>   Note:  </b>  Make sure your app status is  <tt>enabled</tt>. </i></p>
<h3> <a name="testingyourapp_debugging"><span class="mw-headline" id="Debugging">Debugging</span></a></h3>
<p> Debugging on your local machine, you can conveniently change your app code, in <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial</tt>, and rerun your app.</p><p> The way you restart your app depends on what code you changed.  If you changed only client-side code, it is sufficient to upgrade the version number,      using <tt>  _bump</tt>, and re-run your app:</p><code><font size="2">
<p>http://localhost:8000/en-US/_bump
</p>
</font></code><p><i><b>   Note:  </b>  Make sure you clear the browser cache before re-running your app. </i></p><p> If you made changes to your XML files and need to reload configuration data, use <tt>  debug/refresh </tt> in addition to <tt>  _bump </tt> to refresh all EAI handlers that support reload:</p><code><font size="2">
<p>http://localhost:8000/en-US/debug/refresh
</p>
</font></code><p> If you changed server-side code, you need to restart Splunk and SplunkWeb:</p><ol><li>  On the command line, type  <tt>   splunk restart</tt>. </li><li>  Login to SplunkWeb. </li><li>  Start  <b>   Module System Tutorial  </b>  from the  <b>   App  </b>  menu. </li></ol><p class="note"><i><b>   Tip:  </b>  You can specify global settings in your  <tt>   web.conf  </tt>  file, in the  <tt>   /default  </tt>  directory, that can be helpful for testing and debugging.  For example, setting the JavaScript and CSS minify options.  (See  Admin Manual &gt; web.conf    ) </i></p><h4><font size="3"><b><i> <a name="testingyourapp_debugging_javascript"><span class="mw-headline" id="Debugging_JavaScript">  Debugging JavaScript </span></a></i></b></font></h4><p> You can use your favorite browser JavaScript debugger plugin, such as Firebug.</p><p> You'll notice that your JavaScript code is minified so you might want to expand it.</p><p><i><b>   Note:  </b>  Use  <tt>   console.debug("Your debug message");  </tt>  to log messages to your debugger console. </i></p><h4><font size="3"><b><i> <a name="testingyourapp_debugging_python"><span class="mw-headline" id="Debugging_Python"> Debugging Python</span></a></i></b></font></h4><p> On the server, you can use the built-in Python logging facilities for debugging.</p><code><font size="2">
<p>import logging
</p><p>logger = logging.getLogger('splunk.module.CustomResultsTable')
</p>
</font></code><p> You can enable debug logging, as described in Enable debug logging, and use the <tt>  debug </tt> logging level:</p><code><font size="2">
<code><font size="2">logger.debug('your debug message')<br></font></code>
</font></code><p> For simple printf-style debugging, you'll find it easier to use the <tt>  info </tt> logging level:</p><code><font size="2">
<code><font size="2">logger.info('your informative message')<br></font></code>
</font></code><p> Informative messages are logged in the <tt>  $SPLUNK_HOME/var/log/splunk/web_service.log </tt> file.</p><p> You'll find most error messages, including Python execution errors, in the log file:</p><p><tt>  $SPLUNK_HOME/var/log/splunk/web_service.log </tt></p>

<a name="checklist"></a><h2> <a name="checklist_checklist"><span class="mw-headline" id="Checklist"> Checklist</span></a></h2>
<table cellpadding="6"><tr><td valign="center" align="left"></td><td valign="center" align="left"><b>     Setup ...    </b></td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Install Splunk.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Install    firebug        or similar JavaScript debugger, depending on your browser.   </td></tr><tr><td valign="center" align="left"></td><td valign="center" align="left"><b>     Define your presentation layer ...    </b></td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Setup your app directory structure in a local directory.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Define your app in app.conf.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Define your app navigation in default.xml.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Define your app views in the     <tt>      /default/data/ui/views     </tt>     directory.   </td></tr><tr><td valign="center" align="left"></td><td valign="center" align="left"><b>     Implement your module(s) ...    </b></td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Define the module class, base class and parameters.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    (optional) Write your module HTML and stylesheet.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Write your client-side JavaScript code.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Write your server-side Python code.   </td></tr><tr><td valign="center" align="left"></td><td valign="center" align="left"><b>     Install and run your app ...    </b></td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Copy your app directory structure to the $SPLUNK_HOME/etc/apps directory.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">Start Splunk        and login.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Run the Module System Tutorial app.   </td></tr><tr><td valign="center" align="left"></td><td valign="center" align="left"><b>     Debug your app ...    </b></td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">Restart Splunk.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Edit your code using your favorite editor, modifying the target app code or copying your modified code to the target directory.   </td></tr><tr><td valign="center" align="left"><img alt="Chkbx1.png" src="/images/3/3e/Chkbx1.png" width="16" height="16"></td><td valign="center" align="left">    Restart Splunk and login, or <tt>_bump</tt> version and <tt>/debug/restart</tt>, as needed.   </td></tr></table><p></p>

<h1>Cookbook</h1><a name="getthetutorialapp"></a><h2> <a name="getthetutorialapp_get_the_tutorial_app"><span class="mw-headline" id="Get_the_tutorial_app"> Get the tutorial app</span></a></h2>
<p>The cookbook provides learn-by-doing recipes for building custom apps, using progressive, real-world examples.  We take a simple CPU resource utilization application and iterate on that example, building on what you already know toward gaining a more comprehensive understanding of the Module System.
</p><p>Download the Cookbook tutorial app to run the examples as a Splunk app.
</p><p>Cookbook examples are can be found in the <tt>$SPLUNK_HOME/etc/apps/dev_tutorial</tt> directory. You can follow along or try implementing the examples yourself.
</p>
Our data source is the readily available <tt>metrics.log</tt> file. We demonstrate various Module System customizations by rendering CPU utilization statistics, using the following search results:<blockquote><tt>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name</tt></blockquote>

<a name="simplecustomizations"></a><h2> <a name="simplecustomizations_simple_customizations"><span class="mw-headline" id="Simple_customizations"> Simple customizations</span></a></h2>
<a href="#to_use_custom_css_styling"> To use custom CSS styling</a><br><a href="#to_use_custom_javascript"> To use custom JavaScript</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32">Example 2 and Example 3</p><hr width="25%"><p> One of the first things you might want to do is use one of the following mechanisms to change the look or      behavior of an app:</p><ul><li>  Use custom CSS to change the look of your app. </li><li>  Use  <tt>   application.js  </tt>  to add custom JavaScript and change your app behavior. </li></ul><p> You might consider simple CSS or JavaScript changes instead of more involved mechanisms, if you need to:</p><ul><li>  Make changes to one point in your Splunk view. </li><li>  Change the style or behavior of a specific module or modules within         a Splunk view. </li><li>  Make changes across an entire app. (This is not recommended.) </li></ul><p><i><b>   Note:  </b>  It might be useful to recall from  Getting started  that default CSS files are located at  <tt>   $SPLUNK_HOME/share/splunk/search_mrsparkle/exposed/css  </tt>  and  <tt>   $SPLUNK_HOME/share/splunk/search_mrsparkle/exposed/css/skins</tt>.  For some modules distributed with Splunk, you can find their CSS files in the  <tt>   $SPLUNK_HOME/share/splunk/search_mrsparkle/modules  </tt>  directory for the module. </i></p><p> Because these kinds of customization should already be familiar to you and because minimal Module System knowledge is needed, these are the first examples presented.</p><h6> <a name="simplecustomizations_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  This recipe demonstrates simple customization using two examples.  Example2 changes app appearance using CSS customization.  Example3 changes app behavior by hooking in custom JavaScript.  Both build on our basic CPU utilization app. </p><p class="abstract">  Using  CSS styling, we enhance  the appearance of the results table, applying color to the cell background and highlighting         the active row: </p><p class="abstract"><img alt="Ex2 00.png" src="/images/f/f2/Ex2_00.png" width="640" height="419"><br>  CSS styling requires providing a custom CSS file and specifying the filename in the view. </p><p class="abstract">  To show some action when a row is clicked, our custom JavaScript displays an alert showing the indexer stage of clicked row: </p><p class="abstract"><img alt="Ex3 00.png" src="/images/3/39/Ex3_00.png" width="640" height="431"><br></p><p class="abstract">  All resources, including images, custom CSS, and custom JavaScript, are located in the  <tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/static  </tt>  directory. </p><p>It is useful to understand these simple customization techniques because you'll want to combine these with more advanced customizations you'll learn about to create increasingly sophisticated applications, targeted to your domain.</p><h4><font size="3"><b><i> <a name="simplecustomizations_to_use_custom_css_styling"><span class="mw-headline" id="To_use_custom_CSS_styling"> To use custom CSS styling</span></a></i></b></font></h4><ol><li>  Create your view specification file,  <tt>   Example2.xml</tt>, in the  <tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/views  </tt>  directory. </li><li>  Specify the custom CSS file as a  <tt>   &lt;view&gt;  </tt>  tag parameter.  The rest of the view specification is the same as  <tt>   Example1.xml</tt>.  <code><font size="2">
<p>&lt;view template="dashboard.html" stylesheet="example2Styles.css"&gt;
</p>
</font></code></li><li>  Create your custom CSS file,  <tt>   example2Styles.css</tt>, in the  <tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/static  </tt>  directory.  Our example changes the default cell background color and highlights a row on hover.  <code><font size="2">
<p>table.simpleResultsTable tbody{
</p>
<code><font size="2"> &nbsp;&nbsp;background: #ebf2e6;<br></font></code>
<p>}
table.simpleResultsTable td{
</p>
<code><font size="2"> &nbsp;&nbsp;color: #669;<br>&nbsp;&nbsp;&nbsp;border-top: 1px dashed #fff;<br></font></code>
<p>}
table.simpleResultsTable tbody tr:hover td{
</p>
<code><font size="2"> &nbsp;&nbsp;color: #339;<br>&nbsp;&nbsp;&nbsp;background: #b3d09f;<br></font></code>
<p>}
</p>
</font></code></li></ol><h4><font size="3"><b><i> <a name="simplecustomizations_to_use_custom_javascript"><span class="mw-headline" id="To_use_custom_JavaScript"> To use custom JavaScript</span></a></i></b></font></h4><p> The <tt>  application.js </tt> file is used, by convention, to override existing methods for a particular instance.       If you want SplunkWeb to do something specific on a user action, such as a click,      change, or mouse-over event,  use <tt>  application.js </tt> to override the default behavior, replacing the default action with      your custom handler.</p><p> In Example3, the <tt>  NullModule </tt> is a child of the <tt>  SimpleResultsTable </tt> module. A <tt>  NullModule</tt>, as you might expect, does nothing, but provides a container for custom module code.       As such, <tt>  application.js </tt> code can use <tt>  NullModule </tt> as a convenient entry point into the view context.</p><ol><li>  Create your view specification file,  <tt>   Example3.xml</tt>, in the  <tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/views  </tt>  directory. </li><li>  Add  <tt>   NullModule  </tt>  as a  <tt>   SimpleResultsTable  </tt>  child module.  The rest of the Example3 view specification is the same as Example2.  <code><font size="2">
<p>&lt;module name="SimpleResultsTable"&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;&lt;param name="drilldown"&gt;row&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&lt;param name="displayMenu"&gt;true&lt;/param&gt;<br>&nbsp;&nbsp;&nbsp;&lt;module name="NullModule"&gt;&lt;/module&gt;<br></font></code>
<p>&lt;/module&gt;
</p>
</font></code><p>   The   <tt>    NullModule   </tt>   module executes code attached to it when it is called by the   <tt>    SimpleResultsTable   </tt>   module.  </p></li><li>  Create the <tt>application.js</tt> file in the  <tt>   $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/static  </tt>  directory and add the following code.  <code><font size="2">
<p>switch (Splunk.util.getCurrentView()) {
</p>
<code><font size="2"> &nbsp;&nbsp;case "Example3":<br>&nbsp;&nbsp;&nbsp;if (Splunk.Module.NullModule) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Splunk.Module.NullModule =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$.klass(Splunk.Module.NullModule, {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getModifiedContext: function() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var context = this.getContext(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;click = context.getAll('click');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert (click.value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return context;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;break;}<br></font></code>
</font></code><p>   In the code above, we ensure the code is executed only if the current view is Example3      and we are in the   <tt>    NullModule   </tt>   namespace.  Use   <tt>    getCurrentView()</tt> to ensure you are operating on only the desired view.  </p><p>   We use the   <tt>    JQuery.klass()</tt> utility to instantiation a   <tt>    NullModule</tt> class to override the   <tt>    getModifiedContext()</tt> method.  All modules inherit from the   <tt>    AbstractModule</tt> base class.  </p><p>   We get the   <tt>    click</tt> property from the   <tt>    NullModule</tt> context to display in an alert message.  </p><p class="note"><i><b>     Tip:    </b>    Alternatively, to the style of specific elements in a Splunk view, use the JQuery    <tt>     ready()</tt> method,    <tt>     getCurrentView()</tt>, and a selector to scope your changes to the specific elements, usually using the    <tt>     id    </tt>    attribute.   </i></p><code><font size="2">
<p>if (Splunk.util.getCurrentView() == 'myview') {
</p>
<code><font size="2"> &nbsp;&nbsp;$(document).ready( function() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$('.SimpleResultsTable').parent().css('width', '100%');<br>&nbsp;&nbsp;&nbsp;});}<br></font></code>
</font></code></li></ol><h3> <a name="simplecustomizations_related_recipes"><span class="mw-headline" id="Related_recipes"> Related recipes</span></a></h3><p> Create a custom module shows the basics of creating a custom app, which you can enhance further by including CSS and <tt>  application.js </tt> customizations.</p>

<a name="createacustommodule"></a><h2> <a name="createacustommodule_create_a_custom_module"><span class="mw-headline" id="Create_a_custom_module"> Create a custom module</span></a></h2>
<a href="#to_add_your_module_code"> To add your module code</a><br><a href="#to_define_your_custom_module"> To define your custom module</a><br><a href="#to_implement_the_server-side_search_request_handler"> To implement the server-side search request handler</a><br><a href="#to_implement_the_client-side_results_renderer"> To implement the client-side results renderer</a><br><a href="#to_integrate_the_module_into_the_app_view"> To integrate the module into the app view</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32"> Example 4</p><hr width="25%"><p> Typically, applications are constructed from prebuilt modules distributed with Splunk.  You can list modules available in your Splunk distribution by logging in to Splunkweb and entering <tt>  http://&lt;host&gt;:&lt;port&gt;/en-US/modules</tt>.  For example, <tt>  http://localhost:8000/en-US/modules</tt>. This also provides basic documentation about how to use a module.</p><p> For your application domain, you may need to create a custom module to present your data in a more meaningful way. Modules are at the core of Splunk apps, where the UI view is constructed from a hierarchy of modules.  Data returned from your search is passed between modules and handled, or rendered, according to module functionality.  The following figure introduces you to the module components:</p><p><img alt="ModuleStruct.png" src="/images/b/b8/ModuleStruct.png" width="440" height="333"></p><p> Modules are nested and search results are typically passed from parent to child modules for processing. The figure depicts a <tt>  HiddenModule</tt>, because it has no UI, which initiates the search request in our recipes.  Using the AJAX pattern, modules pend on search results generated by the module controller on the host.  The module client templating mechanism renders the results.</p><h6> <a name="createacustommodule_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  This recipe demonstrates the basic steps needed to create a module: </p><ol><li>   Create the example source files in the correct directory.  </li><li>   Define the module so it is recognized by the Module System.  </li><li>   On the server, handle the search request and return the requested data.  </li><li>   On the client, render the response data.  </li><li>   Integrate the module into the app view.  </li></ol><p class="abstract">  These steps are common to all modules, and demonstrated in this recipe using the  <tt>   CustomResultsTable  </tt>  module. </p><p class="abstract">  The  <tt>   CustomResultsTable  </tt>  module extracts CPU utilization data from the indexed  <tt>   metrics.log  </tt>  file using the following search string:  <br><br><tt>   index=_internal source=*metrics.log group=pipeline |   <br>   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  stats sum(cpu_seconds) as totalCPU by name  </tt><br><br>  and displays results in tabular format: </p><p class="abstract"><img alt="Ex4 01.png" src="/images/9/9f/Ex4_01.png" width="428" height="154"></p><p class="abstract">  &nbsp; </p><p> Creating custom modules is the foundation of most of the recipes in this cookbook.</p><h4><font size="3"><b><i> <a name="createacustommodule_to_add_your_module_code"><span class="mw-headline" id="To_add_your_module_code"> To add your module code</span></a></i></b></font></h4><p> Create the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/modules/CustomResultsTable </tt> directory and add the following files:</p><ul><li><tt>   CustomResultsTable.conf  </tt></li><li><tt>   CustomResultsTable.js  </tt></li><li><tt>   CustomResultsTable.py  </tt></li></ul><p> You can copy and paste the file contents from the sample code.  Experiment with modifying the code to better understand how Module System works.</p><p><i><b>   Note:  </b>  Remember that modules minimally require a <tt>.conf  </tt>  and a <tt>.js  </tt>  file. </i></p><h4><font size="3"><b><i> <a name="createacustommodule_to_define_your_custom_module"><span class="mw-headline" id="To_define_your_custom_module"> To define your custom module</span></a></i></b></font></h4><ol><li>  In the  <tt>   CustomResultsTable.conf  </tt>  file, give the module a class name and specify the base class from which it inherits.  <code><font size="2">
<p>[module]
className = Splunk.Module.CustomResultsTable
superClass = Splunk.Module.DispatchingModule
description = This is my first custom module.
</p>
</font></code></li><li>  In the same file, define module parameters to customize your view.  For simplicity, this module does not have parameters so none are specified.  <code><font size="2">
<p>[param:myParam]required = False
default = none
</p>
</font></code></li></ol><p> The configuration file hooks your module into the Module System. The <tt>Splunk.Module.DispatchingModule</tt> abstract base class, itself a subclass of the root <tt>Splunk.Module</tt> abstract class, handles the attachment of <tt>  jobProgress </tt> and <tt>  jobDone </tt> events, such that the <tt>onJobProgress()</tt> and <tt>onJobDone()</tt> methods are only called when the job context actually changes.</p><p><i><b>   Note:  </b>  The  <tt>   description  </tt>  and parameter fields are used to auto-document your module, which you can view when you enter  <tt>   http://&lt;host&gt;:&lt;port&gt;/en-US/modules  </tt>  in Splunkweb. </i></p><h4><font size="3"><b><i> <a name="createacustommodule_to_implement_the_server-side_search_request_handler"><span class="mw-headline" id="To_implement_the_server-side_search_request_handler"> To implement the server-side search request handler</span></a></i></b></font></h4><p> Server-side code is implemented in the <tt>  CustomResultsTable.py </tt> file.</p><p><i><b>   Note:  </b>  The root filename is the same as the unique  <tt>   className  </tt>  defined in  <tt>   CustomResultsTable.conf</tt>. </i></p><ol><li>  Import the libraries needed by most modules.  <code><font size="2">
<p>import controllers.module as module
import splunk
import splunk.search
import splunk.util
import splunk.entity
import lib.util as util
import lib.i18n as i18n
import logging
</p>
</font></code><p><i><b>     Tip    </b>   &nbsp;:  It is the recommended practice to have each import statement on a separate line.    <br>    (See:    PEP 8 -- Style Guide for Python Code        )   </i></p></li><li>  Create a logger for your module to log error and debug messages.  <code><font size="2">
<p>logger = logging.getLogger('splunk.module.CustomResultsTable')
</p>
</font></code><p>   Messages are logged by calling   <tt>    logger.    <i>     logLevel    </i>    (    <i>     logMessage    </i>    )</tt>, which appends   <i>    logMessage   </i>   to the   <tt>    $SPLUNK_HOME/var/log/splunk/web_service.log   </tt>   file.  </p><p>   Loggers are arranged in a namespace hierarchy so create your logger passing the module namespace,   <tt>    splunk.module.CustomResultsTable   </tt>   as a parameter.  </p></li><li>  Define the module class, specifying the base class as a parameter.  <code><font size="2">
<p>class CustomResultsTable(module.ModuleHandler)
</p>
</font></code><p>   The <tt>ModuleHandler</tt> base class defines Module System server-side extension points for      handling module requests. Your module hooks into Module System by implementing the methods for your particular application.  </p></li><li>  The only method that needs to be implemented for this simple module is the  <tt>   generateResults()</tt> method.  Define the method and parameters used.  <code><font size="2">
<p>def generateResults(self, host_app, client_app, sid, count=1000,
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset=0, entity_name='results'):<br></font></code>
</font></code><p>   Validate the parameters and set local variables.  </p><code><font size="2">
<p>count = max(int(count), 0)
offset = max(int(offset), 0)
if not sid:
</p>
<code><font size="2"> &nbsp;&nbsp;raise Exception('CustomResultsTable.generateResults - sid not passed!')<br></font></code>
<p>try:
</p>
<code><font size="2"> &nbsp;&nbsp;job = splunk.search.getJob(sid)<br></font></code>
<p>except splunk.ResourceNotFound, e:
</p>
<code><font size="2"> &nbsp;&nbsp;logger.error('CustomResultsTable could not find job&nbsp;%s.'&nbsp;% sid)<br></font></code>
<p>return _('&lt;p class="resultStatusMessage"&gt;Could not retrieve search data.&lt;/p&gt;')
</p>
</font></code><p>   If the job ID parameter, sid, is not associated with your search request job, valid      data are not available. In more advanced examples, you will learn how to work with      job states.  </p><p class="note"><i><b>     Tip:    </b>    Use standard Python logging to log errors.   </i></p><p>   The rest of this method builds the HTML displayed by this module, inserting the CPU      Utilization search results in a table.  </p><code><font size="2">
<p>output = []
output.append('&lt;div class="CustomResultsTableWrapper"&gt;')
output.append('&lt;table class="CustomResultsTable splTable"&gt;')
fieldNames = [x for x in getattr(job, entity_name).fieldOrder if (not x.startswith('_'))]
dataset = getattr(job, entity_name)[offset: offset+count]
for i, result in enumerate(dataset):
</p>
<code><font size="2"> &nbsp;&nbsp;output.append('&lt;tr&gt;')<br>&nbsp;&nbsp;&nbsp;for field in fieldNames:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&lt;td')<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValues = result.get(cgi.escape(field), None)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if fieldValues:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&gt;%s&lt;/td&gt;'&nbsp;% fieldValues)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&gt;&lt;/td&gt;')<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&lt;/tr&gt;')<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.append('&lt;/table&gt;&lt;/div&gt;')<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output = <i>.join(output)</i><br></font></code>
<p>return output
</p>
</font></code><p>   The   <tt>    fieldNames   </tt>   variable contains the names of the fields specified in the search request (the pipeline      indexer stage   <tt>    name   </tt>   and   <tt>    cpu_seconds   </tt>   utilization), which are used to index the field value.  </p><p>   The method returns an HTML-formatted data table populated with CPU utilization data.  </p><p class="note"><i><b>     Tip:    </b>    To avoid security vulnerabilities, make sure to use HTML escaping of your data, either on the client or server, as applicable. Escaping is conveniently specified on the server using the Mako template but, because this example does not have a template, manually escape the HTML by calling    <tt>     cgi.escape(&lt;field&gt;)</tt>.   </i></p></li></ol><h4><font size="3"><b><i> <a name="createacustommodule_to_implement_the_client-side_results_renderer"><span class="mw-headline" id="To_implement_the_client-side_results_renderer"> To implement the client-side results renderer</span></a></i></b></font></h4><p> Client-side code is implemented in the <tt>  CustomResultsTable.js </tt> file.</p><p><i><b>   Note:  </b>  The root filename is the same as the unique  <tt>   className  </tt>  defined in  <tt>   CustomResultsTable.conf</tt>. </i></p><ol><li>  Instantiate an instance of the  <tt>   CustomResultsTable  </tt>  class as a subclass of  <tt>   Splunk.Module.DispatchingModule</tt>, using the jQuery <tt>  klass</tt> construct.  <code><font size="2">
<p>Splunk.Module.CustomResultsTable = $.klass(Splunk.Module.DispatchingModule, {...}
</p>
</font></code><p>   The   <tt>    DispatchingModule   </tt>   base class, subclassing   <tt>    Splunk.Module</tt>, defines Module System extension points for implementing client-side response data      handling and rendering particular to your application.  </p><p class="note"><i><b>     Tip:    </b>    Splunk provides a number of modules with predefined functionality.  Choose the module from which to inherit most appropriate for your module functionality. Splunk modules are located at    <tt>     $SPLUNK_HOME/share/splunk/search_mrsparkle/modules</tt>. All modules have    <tt>     Splunk.Module    </tt>    as the base class.   </i></p></li><li>  Implement the constructor, which is called automatically when the class is instantiated,         passing the containing DOM element as a parameter.  <code><font size="2">
<p>initialize: function($super, container) {
</p>
<code><font size="2"> &nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;this.resultsContainer = this.container;<br></font></code>
<p>},
</p>
</font></code><p>   All modules must have an   <tt>    initialize()</tt> method.  </p><p>   Call   <tt>    $super()</tt>, first, to guarantee that the base class constructor is called before the module   <tt>    initialize()</tt> method  executes. Save the container where results are rendered with this object.  </p></li><li>  Override the  <tt>   onJobDone()</tt> event handler.  <code><font size="2">
<p>onJobDone: function(event) {
</p>
<code><font size="2"> &nbsp;&nbsp;this.getResults();<br></font></code>
<p>},
</p>
</font></code><p>   This method is called when the search command is completed for the job associated      with this instance.  The only action needed for this simple example is to request the search results.  For more complex applications, you might consider using other job progress event handlers.  </p></li><li>  Override the  <tt>   getResultParams()</tt> method, which is called when results are available following the <tt>getResults()</tt> call.  <code><font size="2">
<p>getResultParams: function($super) {
</p>
<code><font size="2"> &nbsp;&nbsp;var params = $super();<br>&nbsp;&nbsp;&nbsp;var context = this.getContext();<br>&nbsp;&nbsp;&nbsp;var search = context.get("search");<br>&nbsp;&nbsp;&nbsp;var sid = search.job.getSearchId();<br>&nbsp;&nbsp;&nbsp;if (!sid) this.logger.error(this.moduleType, "Assertion Failed.");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.sid = sid;<br>&nbsp;&nbsp;&nbsp;return params;<br></font></code>
<p>},
</p>
</font></code></li><li>  Override the  <tt>   renderResults()</tt> method to render the results in the container for this module.  <code><font size="2">
<p>renderResults: function($super, htmlFragment) {
</p>
<code><font size="2"> &nbsp;&nbsp;if (!htmlFragment) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.resultsContainer.html('No content available.');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;this.resultsContainer.html(htmlFragment);<br></font></code>
<p>}
</p>
</font></code><p>   For this example, the HTML fragment constructed on the server can be rendered directly      by calling   <tt>    resultsContainer.html()</tt>, passing the results as a parameter.  </p></li></ol><p> The following simplified sequence diagram shows the basic client-server interaction:</p><p><img alt="ModuleSequence.png" src="images/8/86/ModuleSequence.png" width="363" height="287"></p><p> A search job is dispatched by the module with <tt>  DispatchingModule </tt> binding job progress events to the module.  The <tt>  getResults()</tt> and response sequence is implemented as an AJAX pattern.  Other apps may interact differently, responding to different job progress events or      doing something other than render the data.</p><h4><font size="3"><b><i> <a name="createacustommodule_to_integrate_the_module_into_the_app_view"><span class="mw-headline" id="To_integrate_the_module_into_the_app_view"> To integrate the module into the app view</span></a></i></b></font></h4><p> In the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/views/Example4.xml </tt> file, add the following line in the view hierarchy where you want your module data      rendered:</p><code><font size="2">
<code><font size="2">&lt;module name="CustomResultsTable"&gt;&lt;/module&gt;<br></font></code>
</font></code><p> In other examples, you will learn Parameterize your module.</p><h3> <a name="createacustommodule_related_recipes"><span class="mw-headline" id="Related_recipes"> Related recipes</span></a></h3><p> Render JSON data shows you how to transfer your data as JSON and format the display on the on the client.</p><p> Include 3rd-party libraries shows you how to import third-party graphics library for more advanced rendering.</p><p> Parameterize your module shows you how to statically parameterize your module.</p><p> Setup your app shows you how to configure your app at runtime.</p>

<a name="renderjsondata"></a><h2> <a name="renderjsondata_render_json_data"><span class="mw-headline" id="Render_JSON_data"> Render JSON data</span></a></h2>
<a href="#to_add_your_module_code"> To add your module code</a><br><a href="#to_define_the_customjsonresults_module"> To define the CustomJSONResults module</a><br><a href="#to_handle_the_search_request.2c_returning_json-formatted_data"> To handle the search request, returning JSON-formatted data</a><br><a href="#to_render_the_json_data"> To render the JSON data</a><br><a href="#to_integrate_the_customjsonresults_module_into_the_app_view"> To integrate the CustomJSONResults module into the app view</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32">Example 5</p><hr width="25%"><p> This recipe is the same as the Create a custom module recipe, except that results are formatted as JSON and sent to the client for rendering, instead of raw HTML.</p><h6> <a name="renderjsondata_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  The main point of interest is the introduction of the <tt>render_json()</tt> method to transmit JSON-formatted data to the client.  We also get the CPU utilization dataset directly, using the field name, instead of         implicitly as in the  <tt>   CustomResultsTable  </tt>  module. </p><p class="abstract">  &nbsp; </p><p> This represents an intermediate step between rendering an HTML table and a visualization that requires JSON, which we'll demonstrate in the Include 3rd-party libraries recipe.</p><h4><font size="3"><b><i> <a name="renderjsondata_to_add_your_module_code"><span class="mw-headline" id="To_add_your_module_code"> To add your module code</span></a></i></b></font></h4><p> Create the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/modules/CustomJSONResults </tt> directory and add the following files:</p><ul><li><tt>   CustomJSONResults.conf  </tt></li><li><tt>   CustomJSONResults.js  </tt></li><li><tt>   CustomJSONResults.py  </tt></li></ul><h4><font size="3"><b><i> <a name="renderjsondata_to_define_the_customjsonresults_module"><span class="mw-headline" id="To_define_the_CustomJSONResults_module"> To define the CustomJSONResults module</span></a></i></b></font></h4><p> In your <tt>  CustomJSONResults.conf file</tt>, set the module class name and specify the base class from which it inherits.</p><code><font size="2">
<p>[module]
className = Splunk.Module.CustomJSONResults
superClass = Splunk.Module.DispatchingModule
</p>
</font></code><p> In this example, <tt>  Splunk.Module.CustomJSONResults </tt> inherits from <tt>  Splunk.Module.DispatchingModule</tt>, which itself inherits from the root module class, <tt>Splunk.Module</tt>.</p><p> The module has no static parameters so none are defined.</p><h4><font size="3"><b><i> <a name="renderjsondata_to_handle_the_search_request.2c_returning_json-formatted_data"><span class="mw-headline" id="To_handle_the_search_request.2C_returning_JSON-formatted_data"> To handle the search request, returning JSON-formatted data</span></a></i></b></font></h4><p> The <tt>  CustomJSONResults.py </tt> file implements server-side request handling. It simply formats      the response data for the module and transmits it to the client.</p><ol><li>  Import the libraries needed for working with JSON, including the  CherryPy    framework         component for setting the content type in the response header.  <code><font size="2">
<p>import cherrypy
import jsonfrom splunk.appserver.mrsparkle.lib
import jsonresponse
</p>
</font></code></li><li>  Import libraries needed by most modules.  <code><font size="2">
<p>import controllers.module as module
import splunk
import splunk.search
import splunk.util
import splunk.entity
import lib.util as util
import lib.i18n as i18n
import logging
</p><p>logger = logging.getLogger('splunk.module.CustomJSONResults')
</p>
</font></code></li><li>  Define the class, inheriting from <tt>ModuleHandler</tt>.  <code><font size="2">
<p>class CustomJSONResults(module.ModuleHandler)
</p>
</font></code></li><li>  Override the  <tt>   generateResults()</tt> method to implement the code specific to this module.  <code><font size="2">
<p>def generateResults(self, host_app, client_app, sid, count=1000,
</p>
<code><font size="2"> &nbsp;&nbsp;offset=0, entity_name='results'):<br></font></code>
</font></code><p>   The   <tt>    sid</tt>,   <tt>    count</tt>,   <tt>    offset</tt>, and   <tt>    entity_name   </tt>   parameters are used to locate the data associated with the search request.  </p><code><font size="2">
<p>count = max(int(count), 0)
offset = max(int(offset), 0)
if not sid:
</p>
<code><font size="2"> &nbsp;&nbsp;raise Exception('CustomJSONResults.generateResults - sid not passed!')<br></font></code>
</font></code><p>   Use the job ID parameter,   <tt>    sid</tt>, to get the associated job for retrieving results data.  </p><code><font size="2">
<p>try:
</p>
<code><font size="2"> &nbsp;&nbsp;job = splunk.search.getJob(sid)<br></font></code>
<p>except splunk.ResourceNotFound, e:
</p>
<code><font size="2"> &nbsp;&nbsp;logger.error('CustomJSONResults could not find the job&nbsp;%s. Exception:&nbsp;%s'&nbsp;% (sid, e))<br></font></code>
<p>return _('&lt;p class="resultStatusMessage"&gt;Could not retrieve search data.&lt;/p&gt;')
</p>
</font></code><p>   Get the results data for the associated job.  </p><code><font size="2">
<p>dataset = getattr(job, entity_name)[offset: offset+count]
</p>
</font></code><p>   Iterate through the results, using the indexer   <tt>    name   </tt>   and   <tt>    totalCPU   </tt>   literals, appending the name-value pairs to the   <tt>    outputJSON   </tt>   dictionary.  </p><code><font size="2">
<p>outputJSON = {}
for i, result in enumerate(dataset):
</p>
<code><font size="2"> &nbsp;&nbsp;outputJSON[str(result.get('name', None))] = str(result.get('totalCPU', None))<br></font></code>
</font></code><p>   Use the CherryPy utility to set the   <tt>    text/json   </tt>   content type in the response header, and transmit the JSON string to the client using      the   <tt>    json.dumps()</tt> method.  </p><code><font size="2">
<p>cherrypy.response.headers['Content-Type'] = 'text/json'
return json.dumps(outputJSON, sort_keys=True)
</p>
</font></code><p><i><b>     Note:    </b>    Beginning with release 4.x, you can use <tt>render_json()</tt> to transmit JSON data.   </i></p><p>   The   <tt>    generateResults()</tt> method formats CPU utilization data similar to the following JSON example:  </p><code><font size="2">
<p>{
</p>
<code><font size="2"> &nbsp;&nbsp;dev-null":"0.000000",<br>&nbsp;&nbsp;&nbsp;fschangemanager":"0.000000",<br>&nbsp;&nbsp;&nbsp;indexerpipe":"9.327396",<br>&nbsp;&nbsp;&nbsp;merging":"0.543903",<br>&nbsp;&nbsp;&nbsp;parsing":"0.031909",<br>&nbsp;&nbsp;&nbsp;scheduler":"0.000000",<br>&nbsp;&nbsp;&nbsp;tcp":"0.000000",<br>&nbsp;&nbsp;&nbsp;typing":"0.120027"<br></font></code>
<p>}
</p>
</font></code></li></ol><h4><font size="3"><b><i> <a name="renderjsondata_to_render_the_json_data"><span class="mw-headline" id="To_render_the_JSON_data"> To render the JSON data</span></a></i></b></font></h4><p> Client-side code is implemented in the <tt>  CustomJSONResults.js </tt> file.</p><p><i><b>   Note:  </b>  Refer to the Create a custom module example for the general discussion of client processing. Here, we primarily cover the  <tt>   renderRusults()</tt> method, which is the major change from the previous example. </i></p><ol><li>  Client-side code is implemented in the  <tt>   CustomJSONResults.js  </tt>  file, which renders the JSON data.  <p>   Define the client component by subclassing <tt>Splunk.Module.DispatchingModule</tt>.  </p><code><font size="2">
<p>Splunk.Module.CustomJSONResults = $.klass(Splunk.Module.DispatchingModule, {...}
</p>
</font></code></li><li>  Override the <tt>renderResults()</tt> method to render the JSON data in the module container.  <p>   Validate that data is actually available from the server:  </p><code><font size="2">
<p>renderResults: function($super, results) {
</p>
<code><font size="2"> &nbsp;&nbsp;if(!results) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.resultsContainer.html('No content available.');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br></font></code>
<p>}
</p>
</font></code><p>   The main function of the method is to build the HTML fragment, which is similar to what was done by the server in the Create a custom module example:  </p><code><font size="2">
<p>htmlFragment = '&lt;div class="CustomResultsTableWrapper"&gt;';
htmlFragment += '&lt;table class="CustomResultsTable splTable"&gt;';
for (var key in results) {
</p>
<code><font size="2"> &nbsp;&nbsp;htmlFragment += '&lt;tr&gt;';<br>&nbsp;&nbsp;&nbsp;htmlFragment += '&lt;td&gt;' + key &nbsp;+ '&lt;/td&gt;&lt;td&gt;' + results[key] &nbsp;+ '&lt;/td&gt;';<br>&nbsp;&nbsp;&nbsp;htmlFragment += '&lt;/tr&gt;';<br></font></code>
<p>}
htmlFragment += '&lt;/table&gt;&lt;/div&gt;';
this.resultsContainer.html(htmlFragment);
}
</p>
</font></code></li></ol><p> Iterating through the keys in the JSON name-value pairs, the code builds the table,      which is rendered by calling the <tt>  html()</tt> method of <tt>  resultsContainer</tt>, passing the HTML fragment as a parameter and using the jQuery <tt>  appendTo()</tt> method to insert the fragment into the target container.</p><h4><font size="3"><b><i> <a name="renderjsondata_to_integrate_the_customjsonresults_module_into_the_app_view"><span class="mw-headline" id="To_integrate_the_CustomJSONResults_module_into_the_app_view"> To integrate the CustomJSONResults module into the app view</span></a></i></b></font></h4><p> In the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/views/Example5.xml </tt> file, add the following line in the view hierarchy where you want your module data      rendered:</p><code><font size="2">
<code><font size="2">&lt;module name="CustomJSONResults"&gt;&lt;/module&gt;<br></font></code>
</font></code><p> The HTML table is rendered in the bottom-most panel, displaying search results initiated      by the HiddenSearch module and forwarded to the CustomJSONResults module.</p><h3> <a name="renderjsondata_related_recipes"><span class="mw-headline" id="Related_recipes"> Related recipes</span></a></h3><p> Create a custom module shows you the basics of creating a custom module.</p><p> Include 3rd-party libraries shows you how to import third-party graphics library for more advanced rendering.</p><p> Parameterize your module shows you how to statically parameterize your module.</p><p> Setup your app shows you how to make your app configurable.</p>

<a name="include3rd-partylibraries"></a><h2> <a name="include3rd-partylibraries_include_3rd-party_libraries"><span class="mw-headline" id="Include_3rd-party_libraries"> Include 3rd-party libraries</span></a></h2>
<a href="#to_add_your_module_code"> To add your module code</a><br><a href="#to_define_the_treemap_module"> To define the treemap module</a><br><a href="#to_import_the_protovis_treemap_visualization_library"> To import the protovis treemap visualization library</a><br><a href="#to_handle_the_search_request"> To handle the search request</a><br><a href="#to_render_the_treemap"> To render the treemap</a><br><a href="#to_integrate_the_treemap_module_into_the_app_view"> To integrate the TreeMap module into the app view</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32">Example 6</p><hr width="25%"><p> This recipe extends the Render JSON data recipe by using the same search to render a treemap visualization, instead of an      HTML table.  For treemap rendering, we've selected the Protovis  graphical library, which provides a way to demonstrate the integration of non-Splunk      software in your application.  You can use this mechanism to include any custom JavaScript.</p><p><i><b>   Note:  </b>  The example for this tutorial, Example 6, currently only renders in the Firefox browser. </i></p><h6> <a name="include3rd-partylibraries_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  The module template file,  <tt>   TreeMap.html</tt>, added to the TreeMap module shows the mechanism for importing third-party libraries. </p><p class="abstract">  Additionally, a request to get CPU utilization data by both name and processor was         added to the search string in  <tt>   Example6.xml</tt>. </p><code><font size="2">
<code><font size="2"> index=_internal source=*metrics.log group=pipeline |<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stats sum(cpu_seconds) as totalCPU by name, processor<br></font></code>
 </font></code><p class="abstract">  Hierarchically showing processors grouped by indexer stage makes the visualization         more interesting, and is the way treemaps are intended to be used. </p><p class="abstract"><img alt="Cb 01.png" src="images/f/f8/Cb_01.png" width="587" height="268"><br></p><p class="abstract">  &nbsp; </p><p> See the Treemapping  reference to learn about treemaps and their application.</p><h4><font size="3"><b><i> <a name="include3rd-partylibraries_to_add_your_module_code"><span class="mw-headline" id="To_add_your_module_code"> To add your module code</span></a></i></b></font></h4><p> Create the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/modules/TreeMap </tt> directory      and add the following files:</p><ul><li><tt>   TreeMap.conf  </tt></li><li><tt>   TreeMap.html  </tt></li><li><tt>   TreeMap.js  </tt></li><li><tt>   TreeMap.py  </tt></li></ul><p> The HTML template file is added to the module as the mechanism for linking the <tt>  protovis.js </tt> graphical library.</p><h4><font size="3"><b><i> <a name="include3rd-partylibraries_to_define_the_treemap_module"><span class="mw-headline" id="To_define_the_treemap_module"> To define the treemap module</span></a></i></b></font></h4><p> In your TreeMap.conf file, define your module class name and your module base class.</p><code><font size="2">
<p>[module]
className = Splunk.Module.TreeMap
superClass = Splunk.Module.DispatchingModule
</p>
</font></code><h4><font size="3"><b><i> <a name="include3rd-partylibraries_to_import_the_protovis_treemap_visualization_library"><span class="mw-headline" id="To_import_the_protovis_treemap_visualization_library"> To import the protovis treemap visualization library</span></a></i></b></font></h4><p> Your template, <tt>  TreeMap.html </tt> custom template provides the mechanism for linking third-party libraries.  Custom templates are Mako templates, packaged within an app, that emit dynamic HTML.  You can specify custom or third-party JavaScript in the template.</p><ol><li>  Define the  <tt>   %page</tt>,  <tt>   %namespace</tt>, and  <tt>   %lib  </tt>  tags.  <code><font size="2">&lt;%page args="module" expression_filter="h"/&gt;&lt;%namespace name="lib" file="//lib.html" import="*"/&gt;&lt;%lib:script_tags files="${['/static/app/%s/protovis.js' % APP['id']]}" /&gt;  </font></code><p>   Use the   <tt>    %page   </tt>   expression for all templates to enforce the Mako expression filter,   <tt>    h</tt>, for all content rendered by the template.  Any variable passed to this template is escaped before rendering.  </p><p class="note"><i><b>     Tip:    </b>    This is a much more scalable practice than trying to apply expression filters on a per-variable basis. If double-escaping is needed, manually unescape variables using the    <tt>     n    </tt>    expression filter:    <tt>     &lt;div&gt;Something = ${ pre_escaped   n}&lt;/div&gt;    </tt></i></p><p>   The   <tt>    %namespace   </tt>   tag defines the   <tt>    lib   </tt>   namespace and imports from the   <tt>    lib.html   </tt>   base template (see   Mako Namespaces      ), inheriting all the   <tt>    def   </tt>   s from   <tt>    lib.html</tt>.  </p><p>   The   <tt>    %lib:script_tags   </tt>   tag includes the   <tt>    protovis.js   </tt>   reference in a script tag when   <tt>    TreeMap.html   </tt>   is rendered.  </p><br><i><b>    Tip:   </b>   Although not used in this example, you can use templates to include custom CSS and JavaScript in the HTML rendered by the template, using:   <ul><li><tt>script_tags()</tt>     for JavaScript    </li><li><tt>stylesheet_tags()</tt>     for CSS    </li></ul>   The best practice is to use the   <tt>css()</tt>,   <tt>    custom_css()</tt>, or   <tt>    js()</tt> methods inherited from   <tt>    layout/base.html</tt>. This ensure that dependencies and load orders are respected.   <br><br>   Implement the   <tt>script_tags()</tt>   and   <tt>stylesheet_tags()</tt>   calls inside   <tt>    custom_css()</tt>, as shown:  </i><code><font size="2">   &lt;%def name="custom_css()"&gt;	    &lt;%lib:stylesheet_tags files="${['/static/app/&lt;appname&gt;/&lt;custom&gt;.css']}" /&gt;	    &lt;%lib:script_tags files="${['/static/app/&lt;appname&gt;/&lt;custom&gt;.js']}" /&gt;  </font></code></li><li>  Protovis requires a DOM element ID where it renders the treemap.  Define a  <tt>   &lt;DIV&gt;  </tt>  element with ID  <tt>   TreeMapID</tt>.  <code><font size="2">   &lt;div id="TreeMapID" class="TreeMapResults"&gt;&lt;/div&gt;  </font></code><p><i><b>     Note:    </b>    See the    Mako documentation        for more about Mako templates.   </i></p></li></ol><p><i><b>   Note:  </b>  Load order is important, here.  Because the module template loads the  <tt>   protovis.js  </tt>  library after the module is loaded, you cannot reference library functions in the module constructor. </i></p><h4><font size="3"><b><i> <a name="include3rd-partylibraries_to_handle_the_search_request"><span class="mw-headline" id="To_handle_the_search_request"> To handle the search request</span></a></i></b></font></h4><p> The <tt>  TreeMap.py </tt> file handles the search request, formatting a JSON string and transmitting the data      to the client.</p><p><i><b>   Note:  </b>  This only differs from the Render JSON data example in adding  <tt>   processor  </tt>  field data to the results. </i></p><ol><li>  Define the treemap module class, inheriting from  <tt>   ModuleHandler</tt>.  <code><font size="2">   class TreeMap(module.ModuleHandler)  </font></code></li><li>  Override the  <tt>   generateResults()</tt> method, making the following code additions.  <code><font size="2">       def generateResults(self, host_app, client_app, sid, count=1000,             offset=0, entity_name='results'):  </font></code><p>   Validate parameters:  </p><code><font size="2">        count = max(int(count), 0)        offset = max(int(offset), 0)        if not sid:            raise Exception('TreeMap.generateResults - sid not passed!')  </font></code><p>   Get the job associated with this search instance:  </p><code><font size="2">        try:            job = splunk.search.getJob(sid)        except splunk.ResourceNotFound, e:            logger.error('TreeMap could not find job&nbsp;%s. Exception:&nbsp;%s'&nbsp;% (sid, e))            return _('&lt;p class="resultStatusMessage"&gt;Could not get search data.&lt;/p&gt;')  </font></code><p>   Get the search results data associated with the job:  </p><code><font size="2">   dataset = getattr(job, entity_name)[offset: offset+count]  </font></code><p>   Build a dictionary of CPU utilization, iterating through the search results and using      field name literals to index the data:  </p><code><font size="2">    outputJSON = {}        for i, result in enumerate(dataset):            tdict = {}            tdict[str(result.get('processor', None))] = str(result.get('totalCPU', None))            name = str(result.get('name', None))            if name not in outputJSON:                outputJSON[name] = dict()            outputJSON[name].update(tdict)  </font></code><p>   For each indexer stage, the data structure includes the processor-CPU utilization,      name-value pairs, for indexer processors.  </p><p>   Set the text/json data format in the response header and format a JSON string for      transfer to the client:  </p><code><font size="2">    cherrypy.response.headers['Content-Type'] = 'text/json'        return json.dumps(outputJSON, sort_keys=True)  </font></code><p><i><b>     Note:    </b>    Beginning with release 4.3, you can use    <tt>     render_json()</tt> to transmit JSON data.   </i></p></li></ol><p> The <tt>  generateResults()</tt> method now  formats CPU utilization data similar to the following JSON example:</p><code><font size="2">
<p>dev-null:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;nullqueue:"0.000000"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>fschangemanager:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;fschangemanager:"0.000000",<br>&nbsp;&nbsp;&nbsp;sendindex:"0.000000"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>indexerpipe:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;http-output-generic-processor:"0.000000",<br>&nbsp;&nbsp;&nbsp;index_thruput:"0.074836",<br>&nbsp;&nbsp;&nbsp;indexandforward:"0.000000",<br>&nbsp;&nbsp;&nbsp;indexer:"11.016261"<br>&nbsp;&nbsp;&nbsp;indexin:"0.000000"<br>&nbsp;&nbsp;&nbsp;signing:"0.000000"<br>&nbsp;&nbsp;&nbsp;syslog-output-generic-processor:"0.022083"<br>&nbsp;&nbsp;&nbsp;tcp-output-generic-processor:"0.000000"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>merging:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;aggregator:"0.732066",<br>&nbsp;&nbsp;&nbsp;readerin:"0.000000",<br>&nbsp;&nbsp;&nbsp;sendout:"0.031409"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>parsing:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;header:"0.000000",<br>&nbsp;&nbsp;&nbsp;linebreaker:"0.017684",<br>&nbsp;&nbsp;&nbsp;readerin:"0.000000",<br>&nbsp;&nbsp;&nbsp;sendout:"0.031909"<br>&nbsp;&nbsp;&nbsp;utf8:"0.000000"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>scheduler:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;livesplunks:"0.000000"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>tcp:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;tcp:"0.000000"<br>&nbsp;&nbsp;&nbsp;},<br></font></code>
<p>typing:
</p>
<code><font size="2"> &nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;annotator:"0.000000",<br>&nbsp;&nbsp;&nbsp;previewout:"0.000000",<br>&nbsp;&nbsp;&nbsp;readerin:"0.000000",<br>&nbsp;&nbsp;&nbsp;regexreplacement:"0.000000"<br>&nbsp;&nbsp;&nbsp;sendout:"0.140565"<br>&nbsp;&nbsp;&nbsp;}<br></font></code>
</font></code><h4><font size="3"><b><i> <a name="include3rd-partylibraries_to_render_the_treemap"><span class="mw-headline" id="To_render_the_treemap"> To render the treemap</span></a></i></b></font></h4><p> Client-side code is implemented in the <tt>  TreeMap.js </tt> file.</p><p><i><b>   Note:  </b>  Refer to the Create a custom module example for the general discussion of client processing. </i></p><p> Here, we override the <tt>  renderResults()</tt> method with calls to the Protovis API for rendering the treemap.</p><ol><li>  Define the client component, subclassing <tt>Splunk.Module.DispatchingModule</tt>.  <code><font size="2">   Splunk.Module.TreeMap = $.klass(Splunk.Module.DispatchingModule, {...}  </font></code></li><li>  Override the  <tt>   renderResults()</tt> method, making the following code changes.  <p>   Verifying data are available from the server.  </p><code><font size="2">    renderResults: function($super, results) {        if(!results) {            this.resultsContainer.html('No content available.');            return;        }  </font></code><p>   Set up treemap rendering properties for a Protovis panel and render the treemap.  </p><p>   The Protovis namespace is   <tt>    pv</tt>. You might find it helpful to review the   Protovis API.  </p><code><font size="2">        var re = "",            color = pv.Colors.category19().by(function(d) d.parentNode.nodeName)            nodes = pv.dom(results).root("flare").nodes();        var vis = new pv.Panel()            .width(920)            .height(420)            .canvas(document.getElementById('TreeMapID'));        /*  .canvas($('#TreeMapID')[0]); */         var treemap = vis.add(pv.Layout.Treemap)            .nodes(nodes)            .round(true);        treemap.leaf.add(pv.Panel)            .fillStyle(function(d) color(d).alpha(1))            .strokeStyle("#fff")            .lineWidth(1)            .antialias(false);        treemap.label.add(pv.Label)            .textStyle(function(d) pv.rgb(0, 0, 0, 1));        vis.render();    }  </font></code><p><i><b>     Note:    </b>    You can learn more about the Protovis treemap implementation and API at the    GitHub        repository.   </i></p><p>   The panel origin is set to the   <tt>    &lt;DIV id=TreeMapID&gt;   </tt>   element previously defined in our template file.  </p><p>   The input data used to build the treemap is the raw JSON data passed in the   <i>    results   </i>   parameter, which is assigned to the   <tt>    nodes   </tt>   variable.  </p><p class="note"><i><b>     Tip:    </b>    To handle browser dependencies, it is recommended that you use jQuery where possible,         as shown in the code comment, above, for getting the desired &lt;DIV&gt; element by ID, for rendering.   </i></p></li></ol><h4><font size="3"><b><i> <a name="include3rd-partylibraries_to_integrate_the_treemap_module_into_the_app_view"><span class="mw-headline" id="To_integrate_the_TreeMap_module_into_the_app_view"> To integrate the TreeMap module into the app view</span></a></i></b></font></h4><p> In the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/default/data/ui/views/Example6.xml </tt> file, add the following line in the view hierarchy where you want your module data      rendered:</p><code><font size="2">
<code><font size="2">&lt;module name="TreeMap"&gt;&lt;/module&gt;<br></font></code>
</font></code><p> The treemap visualization is rendered in the bottom-most panel, displaying search      results initiated by the HiddenSearch module and forwarded to the TreeMap module. </p><h3> <a name="include3rd-partylibraries_related_recipes"><span class="mw-headline" id="Related_recipes">  Related recipes </span></a></h3><p> Render JSON data shows you how to transfer your data as JSON and format the display on the on the      client.</p><p> Parameterize your module shows you how to statically parameterize your module.</p><p> Setup your app shows you how to make your app configurable.</p>

<a name="parameterizeyourmodule"></a><h2> <a name="parameterizeyourmodule_parameterize_your_module"><span class="mw-headline" id="Parameterize_your_module"> Parameterize your module</span></a></h2>
<a href="#to_add_your_module_code"> To add your module code</a><br><a href="#to_add_parameters"> To add parameters</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32">Example 7</p><hr width="25%"><p> You can define configurable items for your module at implementation time that are applied when the module initializes.</p><p><i><b>   Note:  </b>  The example for this tutorial, Example 7, currently only renders in the Firefox browser. </i></p><h6> <a name="parameterizeyourmodule_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  This recipe builds on the Include 3rd-party libraries recipe, which renders a treemap of fixed height and width.  Here, we show you how to use module parameters to make the height and width configurable.  </p><ol><li>    We create a new module,    <tt>     ParameterizedTreeMap</tt>.   </li><li>    The module configuration file defines the parameters and sets the desired height and width values.   </li><li>    When the module initializes, it reads the parameters, which are used in the call to render the treemap.   </li></ol><p class="abstract">  &nbsp; </p><p> Simple parameterization shows you how the app can be configured at initialization.      The Setup your app recipe shows you how you can achieve even more app flexibility by configuring the      app after initialization.</p><h4><font size="3"><b><i> <a name="parameterizeyourmodule_to_add_your_module_code"><span class="mw-headline" id="To_add_your_module_code"> To add your module code</span></a></i></b></font></h4><p> Create the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/appserver/modules/ParameterizedTreeMap </tt> directory and add the following files:</p><ul><li><tt>   ParameterizedTreeMap.conf  </tt></li><li><tt>   ParameterizedTreeMap.html  </tt></li><li><tt>   ParameterizedTreeMap.js  </tt></li><li><tt>   ParameterizedTreeMap.py  </tt></li></ul><p> The HTML template and <tt>  ParameterizedTreeMap.py </tt> files are the same as the TreeMap recipe files, except for different class names.</p><p> You need to add code to the <tt>  ParameterizedTreeMap.conf </tt> and <tt>  ParameterizedTreeMap.js </tt> files for defining and handling parameters.</p><h4><font size="3"><b><i> <a name="parameterizeyourmodule_to_add_parameters"><span class="mw-headline" id="To_add_parameters"> To add parameters</span></a></i></b></font></h4><ol><li>  Define the parameters in  <tt>   ParameterizedTreeMap.conf</tt>.  <p>   Define the module class name and the class from which it inherits, as usual.  </p><code><font size="2">
<p>[module]className = Splunk.Module.ParameterizedTreeMap
superClass = Splunk.Module.DispatchingModule
</p>
</font></code><p>   Define the parameters you want.  In this example, we define a height parameter and a width parameter.  </p><code><font size="2">
<p>[param:tmapWidth]required = False
default = 640
label = This parameter defines the treemap width.
description = this module waits for the search to complete, formats JSON data, and renders a treemap.
</p><p>[param:tmapHeight]
required = Falsede
fault = 320
label = This parameter defines the treemap height.
</p>
</font></code><p>   The parameters are not required, so the treemap is rendered using a default value for undefined parameters, as shown in the next step.  </p></li><li>  The client JavaScript is essentially the same as the Treemap app client handler, with the addition of parameter handling.  <p>   For this example, we define a new class.  </p><code><font size="2">
<p>Splunk.Module.ParameterizedTreeMap = $.klass(Splunk.Module.DispatchingModule, {...})
</p>
</font></code><p>   In the initialization method, we add getting the parameters into the   <tt>    tmapHeight   </tt>   and   <tt>    tmapWidth   </tt>   instance variables using <tt>getParam()</tt>.  If the parameters are not specified, we provide default height and width values as the second argument.  </p><code><font size="2">
<p>initialize: function($super, container) {
</p>
<code><font size="2"> &nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;this.resultsContainer = this.container;<br>&nbsp;&nbsp;&nbsp;this.tmapHeight = this.getParam('tmapHeight', 920);<br>&nbsp;&nbsp;&nbsp;this.tmapWidth = this.getParam('tmapWidth', 420);<br></font></code>
<p>},
</p>
</font></code><p>   The <tt>renderResults()</tt> method that we override uses the instance height and width variables to set the Protovis      treemap   <tt>    height   </tt>   and   <tt>    width   </tt>   variables.  </p><code><font size="2">
<p>renderResults: function($super, results) {
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... elided ...<br>&nbsp;&nbsp;&nbsp;var vis = new pv.Panel().width(this.tmapWidth).height(this.tmapHeight) /<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.canvas(document.getElementById('ParameterizedTreeMapID'));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;... elided ...<br></font></code>
</font></code><p>   You should notice the different size of the rendered treemap.  </p></li></ol><h3> <a name="parameterizeyourmodule_related_recipes"><span class="mw-headline" id="Related_recipes"> Related recipes</span></a></h3><p> Include 3rd-party libraries is the base recipe for this example, without parameters.</p><p> Setup your app shows how to configure your app, post-initialization.</p>

<a name="setupyourapp"></a><h2> <a name="setupyourapp_set_up_your_app"><span class="mw-headline" id="Set_up_your_app"> Set up your app</span></a></h2>
<a href="#to_bootstrap_the_controller"> To bootstrap the controller</a><br><a href="#to_specify_the_setup_view.2c_preserving_app_chrome"> To specify the setup view, preserving app chrome</a><br><a href="#to_render_the_setup_form"> To render the setup form</a><br><a href="#to_update_the_model"> To update the model</a><br><a href="#to_display_update_status_and_continue"> To display update status and continue</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32">Example 8</p><hr width="25%"><p> App setup involves setting properties to configure your app appearance or behavior.       Typically, you modify properties, or configuration objects, using HTML forms.  Module controllers, the parts that compose your view, are designed to facilitate asynchronous      interaction with Splunk context, search, and job facilities but not to support HTML      forms.  By design, module controllers only support the GET method and not POST.</p><p> To support both GET and POST methods on configuration objects, Module System provides      a Model-View-Controller  (MVC) architecture pattern implementation.  Briefly,</p><ul><li>  Model is the code that accesses the data, or REST endpoints. </li><li>  View is the code that renders and handles UI interaction. </li><li>  Controller is the code that mediates between the model and view, providing separation of concerns. </li></ul><p> The following figure shows the Splunk MVC implementation.</p><p><img alt="Mvc.png" src="/images/1/10/Mvc.png" width="440" height="411"><br> In the Module System MVC implementation:</p><ul><li>  All models inherit from the  <tt>SplunkAppObjModel</tt>  class.  The model uses the REST API to access data endpoints. </li></ul><p class="note"><i><b>   Tip:  </b>  See the  <tt>   $SPLUNK_HOME/lib/Python2.x/site-packages/splunk/models  </tt>  directory for the models that ship with Splunk. </i></p><ul><li>  Mako templates implement the view, which can be forms, pop-ups, and status notifications.          These can include custom JavaScript and CSS, although they are not included in this         tutorial. </li><li>  All controllers inherit from the  <tt>BaseController</tt>  class. </li></ul><h6> <a name="setupyourapp_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  Example8 uses the  <tt>   TutorialSetup  </tt>  controller to demonstrate how to set up an app.  The following figure shows the dependencies between  <tt>   TutorialSetup  </tt>  MVC         components: </p><p class="abstract"><img alt="Ex8 02.png" src="/images/f/f1/Ex8_02.png" width="640" height="400"><br>  The  <tt>web.conf</tt>  file hooks your controller into the Module System. </p><p class="abstract">  The  <tt>Example8.xml</tt>  file is mostly the same as module view definitions you've seen in previous recipes.          The difference here is that, to preserve our app chrome, we specify an iframe as the         module where the form is rendered.  The required module parameter is a pathname to the controller method that renders         the form. </p><p class="abstract">  The example  <tt>TutorialSetup.py</tt>  controller has two methods: </p><ul><li><b><tt>     show()</tt></b> Render the setup form.  </li><li><b><tt>     save()</tt></b> Commit the form values to the model, and announce update status upon completion.  </li></ul><p class="abstract">  These methods render the  <tt>   setup.html</tt>,  <tt>   success.html</tt>, and  <tt>   failure.html  </tt>  templates. </p><p class="abstract">  &nbsp; </p><p> You typically follow a logical sequence to implement app setup:</p><ol><li>  Define your model, which correlates with your UI form elements. </li><li>  Design your app UI (view) for setting configurable items and navigation upon update         complete (or error handling). </li><li>  Create your controller method to render the setup form. </li><li>  Create your controller method to update your model data objects and values. </li></ol><p><i><b>   Note:  </b>  This example simplifies the code as much as possible to highlight the essential setup         logic.  In a real-world application, you would augment the logic with facilities that make         for a more robust implementation.  But, to cover the various alternative and enhanced mechanisms here would obscure our         main purpose, which is to introduce you to app setup using MVC.  Where practical, we will suggest some implementation options to consider for your         own  learning.<h4><font size="3"><b><i> <a name="setupyourapp_to_bootstrap_the_controller"><span class="mw-headline" id="To_bootstrap_the_controller"> To bootstrap the controller</span></a></i></b></font></h4>&lt;p&gt; Create a <tt>web.conf</tt> file in the <tt>  $SPLUNK_HOME/etc/apps/Dev_tutorial/default </tt> directory that has the following line:&lt;/p&gt;<code><font size="2">
<p>[endpoint:TutorialSetup]
</p>
</font></code>&lt;p&gt; When SplunkWeb starts, this instantiates your controller and permits      URI targets to be routed to specific controller methods.&lt;/p&gt;&lt;p&gt;&lt;i&gt;<b>   Note:  </b>  CherryPy controllers are instantiated at startup, not on a per-request basis. Any change to controller code requires a Splunk restart to reload the controller instance. For this same reason, custom controllers should be resilient in handling exceptions on instantiation. </i></p><p> Controllers are exposed at:</p><code><font size="2">
<code><font size="2">/&lt;locale&gt;/custom/&lt;hostApp&gt;/&lt;controllerName&gt;<br></font></code>
</font></code><p> For example,</p><code><font size="2">
<code><font size="2">/en-US/custom/Dev_tutorial/TutorialSetup<br></font></code>
</font></code><p> To make sure that your controller has started, check the <tt>  /paths </tt> endpoint. If you do not see your controller listed after a Splunk restart, it has failed to load.  Check the logs to verify controller loading success or failure.</p><p class="note"><i><b>   Tip:  </b>  Use the <tt>@route</tt> decorator in your controller code, if needed, to expose additional endpoints.  (See h  <tt>   ttps://&lt;yourServer&gt;/en-US/paths  </tt>  for a list of exposed endpoints.) </i></p><h4><font size="3"><b><i> <a name="setupyourapp_to_specify_the_setup_view.2c_preserving_app_chrome"><span class="mw-headline" id="To_specify_the_setup_view.2C_preserving_app_chrome"> To specify the setup view, preserving app chrome</span></a></i></b></font></h4><p> We continue to work with the CPU utilization example because you are already familiar      with how the app works. Now, we modify the app behavior by specifying configurable      properties.  Instead of displaying the CPU utilization of all indexer stages, you can select which      stages you want to include in the display.</p><p><img alt="Ex8 00.png" src="images/a/ad/Ex8_00.png" width="480" height="349"><br> If an indexer stage is not checked, it is not included in the results.</p><p> When you have checked the stages you want displayed, click <tt>  Save </tt> to save the setup.</p><p> For most applications, the form needs to be embedded in a splunk view that preserves      the app chrome.  This is done using an iframe, as shown in the new module added to <tt>Example8.xml</tt>:</p><code><font size="2">
<code><font size="2">&lt;module name="IFrameInclude" layoutPanel="panel_row2_col1"&gt;<br>&nbsp;&nbsp;&nbsp;&lt;param name="src"&gt;/custom/Dev_tutorial/TutorialSetup/show&lt;/param&gt;<br>&lt;/module&gt;<br></font></code>
</font></code><p> The controller entry point that renders the form, <tt>  show()</tt>, is passed as a parameter.</p><h4><font size="3"><b><i> <a name="setupyourapp_to_render_the_setup_form"><span class="mw-headline" id="To_render_the_setup_form"> To render the setup form</span></a></i></b></font></h4><p> A first step is to create the templates, which define the parameters passed to the controller and the template arguments the controller needs to provide to the templates.</p><p> The <tt>setup.html</tt> template implements the checklist UI.  As a point of reference, here is a basic HTML fragment that renders a form:</p><code><font size="2">
<code><font size="2">&lt;div id="setup"&gt;<br>&lt;p class="pageDesc"&gt;Select the indexer stages you want to display:&lt;/p&gt;<br>&lt;form&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="dev-null" value="Yes" /&gt; dev-null&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="archivepipe" value="Yes" /&gt; archivepipe&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="fschangemanager" value="Yes" /&gt; fschangemanager&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="indexerpipe" value="Yes" checked/&gt; indexerpipe&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="merging" value="Yes" checked/&gt; merging&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="parsing" value="Yes" checked/&gt; parsing&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="scheduler" value="Yes" /&gt; scheduler&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="typing" value="Yes" checked/&gt; typing&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="tcp" value="Yes" /&gt; tcp&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input type="checkbox" name="udp" value="Yes" /&gt; udp&lt;br /&gt;<br></font></code>
<code><font size="2"> &nbsp;&nbsp;&lt;p&gt;Click the button to save your configuration:&lt;/p&gt;<br>&nbsp;&nbsp;&nbsp;&lt;input class="splButton-primary" type="submit" value="Save"&gt;&lt;/input&gt;<br>&lt;/form&gt;<br></font></code>
<p>&lt;/div&gt;
</p>
</font></code><p> Notice the differences between this code and the <tt>setup.html</tt> Mako template used in this tutorial.</p><p> Create a <tt>  setup.html </tt> file, adding the following templating facilities.</p><ol><li>  Specify the base template and namespaces, as described in Include 3rd-party libraries, adding support for logging, if needed.  <code><font size="2">
<p>&lt;%page expression_filter="h"/&gt;
&lt;%inherit file="//layout/base.html" /&gt;
&lt;%namespace name="lib" file="//lib.html" import="*"/&gt;
&lt;%namespace name="helpers" file="//view/_helpers.html" import="*"/&gt;
&lt;%!import logging
</p><p>logger = logging.getLogger('splunk.module.setup')%&gt;
</p>
</font></code></li><li>  Define a  <tt>   gen_form()</tt> function to POST the form data.  <code><font size="2">
<p>&lt;%def name="gen_form(method='POST', action=None)"&gt;
&lt;form  method="${method}"  action="${action if action else <i>}"&gt;</i>
&lt;/%def&gt;
</p>
</font></code><p>   Mako   <tt>    def   </tt>   s are equivalent to Python functions, but modified for use in templates.  A   <tt>    def   </tt>   must contain a name value that defines the namespace. As with Python functions, a   <tt>    def   </tt>   can optionally define positional and keyword arguments with default values.  </p></li><li>  Call the  <tt>   gen_form()</tt> function in the  <tt></tt>&lt;form&gt;   tag line.   <code><font size="2">
<p>${gen_form(method="POST", action=make_url(['custom', 'Dev_tutorial', 'TutorialSetup', 'save']))}
${csrf_hidden_input()}
</p>
</font></code><p class="note"><i><b>      Tip:     </b>     Make sure to use     <tt>      make_url()</tt>, defined in     <tt>      lib.html     </tt>     to define a path relative to the current app server location, handling locale.    </i></p><p class="note"><i><b>      Tip:     </b>     Make sure to use     <tt>csrf_hidden_input()</tt>     to add CSRF protection and pass the correct value on a POST.    </i></p>&lt;/form&gt;</li></ol><h4><font size="3"><b><i> <a name="setupyourapp_to_update_the_model"><span class="mw-headline" id="To_update_the_model"> To update the model</span></a></i></b></font></h4><p> Each controller method to be exposed through a URI uses the <tt>@expose_page()</tt> decorator.</p><ol><li>  Create the  <tt>TutorialSetup.py</tt>  controller file and import the libraries commonly used by controllers.  <code><font size="2">
<p>import logging
import os
import sys
import cherrypy
import splunk
import splunk.bundle as bundle
import splunk.appserver.mrsparkle.controllers as controllers
import splunk.appserver.mrsparkle.lib.util as util
from splunk.appserver.mrsparkle.lib.decorators
import expose_page
</p>
</font></code><p class="note"><i><b>     Tip:    </b>    Standard library imports should be listed first, followed by third-party imports,         followed by local imports. Following this convention makes imports easier for others         to understand.   </i></p></li><li>  Particularly, import  <tt>   event_type</tt>, which subclasses  <tt>SplunkAppObjModel</tt>, for working with configuration objects.  <code><font size="2">
<p>from splunk.models.event_type import EventType
</p>
</font></code><p><i><b>     Note:    </b>    Because    <tt>SplunkAppObjModel</tt>    is an abstract class, remember to instantiate and derive classes by subclassing   </i></p></li><li>  Define the example  <tt>   TutorialSetup  </tt>  controller class, inheriting from the  <tt>BaseController</tt>  class.  <code><font size="2">
<p>class TutorialSetup(controllers.BaseController):
</p>
</font></code></li><li>  Implement the  <tt>   show()</tt> method to render the  <tt>   setup.html  </tt>  form.  <code><font size="2">
<p>@expose_page(must_login=True, methods=['GET'])
</p>
<code><font size="2"> &nbsp;&nbsp;def show(self, **kwargs):<br></font></code>
</font></code><p>   The only thing we need to do in this example is render the form, passing the template      to be rendered as a parameter.  </p><code><font size="2">
<p>return self.render_template('/Dev_tutorial:/templates/setup.html')
</p>
</font></code><p>   In practice, you are likely to want to populate form fields with current field      values.  To do that, get the field values and pass them as a dictionary in a   <tt>render_template()</tt>   argument.  To get all the values for your app and render them, do something similar to the following:  </p><code><font size="2">
<p>etype = EventType.all().filter_by_app('Dev_tutorial')
return self.render_template('/Dev_tutorial:/templates/setup.html', dict(etype=etype))
</p>
</font></code><p class="note"><i><b>     Tip:    </b>    Use    <tt>EventType.get()</tt>    to get specific event values.   </i></p></li><li>  Implement the  <tt>   save()</tt> method to handle form submission and to save the configuration objects to the model, passing form data as a parameter.  <code><font size="2">
<p>@expose_page(must_login=True, trim_spaces=True, methods=['POST'])
</p>
<code><font size="2"> &nbsp;&nbsp;def save(self, **params):<br></font></code>
</font></code><p>   Declare a dictionary to hold our configuration objects of name-value pairs.  </p><code><font size="2">
<p>form_content = {}
</p>
</font></code><p>   Get the session   CherryPy session      associated with the authenticated user.  </p><code><font size="2">
<p>user = cherrypy.session['user']['name']
</p>
</font></code><p>   Iterate through the form data, passed in the parameter, and add the parameter name      and value to the dictionary.  </p><code><font size="2">
<p>for key, val in params.iteritems():
</p>
<code><font size="2"> &nbsp;&nbsp;try:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (key&nbsp;!= 'splunk_form_key'):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key] = EventType.get(EventType.build_id(key, 'Dev_tutorial', user))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key].search = val<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except Exception, ex:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key] = EventType('Dev_tutorial', user, key)<br></font></code>
</font></code><p>   For this tutorial, the model is not a defined endpoint so we need to create the configuration      objects.  We use an exception on the   <tt>get()</tt>   method to determine the object doesn't exist.  If it doesn't exist, we create the object instantiating a new configuration object by calling the   <tt>    EventType   </tt>   constructor.  </p><p class="note"><i><b>     Tip:    </b>    The    <tt>build_id()</tt>    method provides a convenient alternative to specifying a    <tt>get()</tt> path parameter such as:   </i></p><code><font size="2">
<p>'/servicesNS/%s/%s/saved/eventtypes/%s' % (user, 'Dev_tutorial', key)
</p>
</font></code><p>   After getting the form data, save each configuration object to the model.  </p><code><font size="2">
<p>for key in form_content.keys():
</p>
<code><font size="2"> &nbsp;&nbsp;try:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key].passive_save()<br></font></code>
</font></code><p class="note"><i><b>     Tip:    </b>    The    <tt>passive_save()</tt> method is recommended over    <tt>     save()</tt> because it handles errors for you.  Exception messages are added to the instance member so you can display errors from         the list in the best way for your application.   </i></p><p>   If the configuration object value is   <tt>    Yes</tt>, the associated indexer stage results are included in the display.  </p><p>   It is recommended that you handle save exceptions, particularly, authorization exceptions.  </p><code><font size="2">
<p>except splunk.AuthorizationFailed:
</p>
<code><font size="2"> &nbsp;&nbsp;logger.info('User %s is unauthorized to perform setup on %s' % (user,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Dev_tutorial'))<br>&nbsp;&nbsp;&nbsp;except Exception, ex:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(ex)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info('Failed to save eventtype %s' % key)<br></font></code>
</font></code><p>   Provide notification on the success or failure of the operation to update configuration      data by rendering a status template.  For simplicity, this example only provides a notification of successful completion.  </p><code><font size="2">
<p>return self.render_template('/Dev_tutorial:/templates/success.html')
</p>
</font></code></li></ol><h4><font size="3"><b><i> <a name="setupyourapp_to_display_update_status_and_continue"><span class="mw-headline" id="To_display_update_status_and_continue"> To display update status and continue</span></a></i></b></font></h4><p> You might want to provide a status template to be rendered when <tt>  show()</tt> completes successfully.  The <tt>success.html</tt> template is a simple implementation.</p><p><img alt="Ex8 01.png" src="images/e/e0/Ex8_01.png" width="300" height="108"><br></p><ol><li>  Specify the standard template base and namespace entities.  <code><font size="2">
<p>&lt;%inherit file="//layout/base.html" /&gt;
&lt;%namespace name="lib" file="//lib.html" import="*"/&gt;
</p>
</font></code></li><li>  Provide an exit prompt with the notification, specifying a destination URL.  <code><font size="2">
<p>&lt;a target="_parent" href="${make_url('/app/Dev_tutorial')}" class="splButton-primary"&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;&lt;span &nbsp;class="cancel"&gt;OK&lt;/span&gt;<br></font></code>
<p>&lt;/a&gt;
</p>
</font></code><p>   Because we are in an iframe, specify   <tt>    target-"_parent"   </tt>   to alter the parent document instead of the iframe.  </p><p>   Use <tt>make_url()</tt> to define a path relative to the current app server location.  </p></li></ol><h3> <a name="setupyourapp_related_recipes"><span class="mw-headline" id="Related_recipes"> Related recipes</span></a></h3><p> Create a custom module describes the basics of the environment in which your app runs.</p><p> Include 3rd-party libraries introduces you to templates.</p>

<h1>Examples source code</h1><a name="gettingstartedexample"></a><h2> <a name="gettingstartedexample_getting_started_example"><span class="mw-headline" id="Getting_started_example"> Getting started example</span></a></h2>
<h3> <a name="gettingstartedexample_app.conf"><span class="mw-headline" id="app.conf">app.conf</span></a></h3>
<code><font size="2"><br>[ui]<br>is_visible = true<br>label = App Framework Tutorial<br>&nbsp;<br>[package]<br>id = Dev_tutorial<br>&nbsp;<br>[launcher]<br>author = Splunk, Inc.<br>description = App Framework Tutorial App<br>version = 1.0<br></font></code>
<h3> <a name="gettingstartedexample_default.xml"><span class="mw-headline" id="default.xml">default.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;nav&gt;</span><br><span style="color: #008000; font-weight: bold">&lt;collection</span> <span style="color: #7D9029">label=</span><span style="color: #BA2121">"Examples"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/collection&gt;</span><br><span style="color: #008000; font-weight: bold">&lt;/nav&gt;</span>
</p>
<h3> <a name="gettingstartedexample_example.xml"><span class="mw-headline" id="Example.xml">Example.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example: Using a Custom Module<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">            &lt;h1&gt;Example: Using a Custom Module&lt;/h1&gt;</span>
<span style="color: #BC7A00">                &lt;p&gt;</span>
<span style="color: #BC7A00">                    This simple application searches the metrics log and lists the CPU utilization of each indexer stage, for the last seven days.</span>
<span style="color: #BC7A00">                &lt;/p&gt;</span>
<span style="color: #BC7A00">                &lt;p&gt;</span>
<span style="color: #BC7A00">                    Search string:  &lt;tt&gt;index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name&lt;/tt&gt;</span>
<span style="color: #BC7A00">                &lt;/p&gt;</span>
<span style="color: #BC7A00">                &lt;p&gt;</span>
<span style="color: #BC7A00">                    Results are displayed using a custom module, &lt;tt&gt;CustomResultsTable&lt;/tt&gt;.</span>
<span style="color: #BC7A00">                &lt;/p&gt;</span>
<span style="color: #BC7A00">            ]]&gt;</span>
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"CPU Utilization"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"CustomResultsTable"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="gettingstartedexample_customresultstable.conf"><span class="mw-headline" id="CustomResultsTable.conf">CustomResultsTable.conf</span></a></h3>
<code><font size="2"><br>[module]<br>className = Splunk.Module.CustomResultsTable<br>superClass = Splunk.Module.DispatchingModule<br>&nbsp;<br>description = Custom module for App Framework example.<br></font></code>
<h3> <a name="gettingstartedexample_customresultstable.js"><span class="mw-headline" id="CustomResultsTable.js">CustomResultsTable.js</span></a></h3>
<p>Splunk.Module.CustomResultsTable <span style="color: #666666">=</span> $.klass(Splunk.Module.DispatchingModule, {
</p>
<code><font size="2"> &nbsp;&nbsp;initialize<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, container) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.myParam <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getParam(<span style="color: #BA2121">"myParam"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.container;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;onJobDone<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>(event) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.getResults();<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;getResultParams<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> params <span style="color: #666666">=</span> $super();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> context <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> search &nbsp;<span style="color: #666666">=</span> context.get(<span style="color: #BA2121">"search"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> sid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666">=</span> search.job.getSearchId();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>sid) <span style="color: #008000; font-weight: bold">this</span>.logger.error(<span style="color: #008000; font-weight: bold">this</span>.moduleType, <span style="color: #BA2121">"Search ID is missing."</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.sid <span style="color: #666666">=</span> sid;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> params;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;renderResults<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, htmlFragment) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>htmlFragment) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer.html(<span style="color: #BA2121">'No content available.'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer.html(htmlFragment);<br>&nbsp;&nbsp;&nbsp;}<br></font></code>
<p>})
</p>
<h3> <a name="gettingstartedexample_customresultstable.py"><span class="mw-headline" id="CustomResultsTable.py">CustomResultsTable.py</span></a></h3>
<p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">controllers.module</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">module</span><br><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.search</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.util</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.entity</span><br><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.util</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">util</span><br><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.i18n</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">i18n</span><br><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span><br></p><p>logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(<span style="color: #BA2121">'splunk.module.CustomResultsTable'</span>)
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">math</span><br><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cgi</span>
</p><p>MAX_MULTI_VALUE_COUNT <span style="color: #666666">=</span> <span style="color: #666666">50</span>
</p><p><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">CustomResultsTable</span>(module<span style="color: #666666">.</span>ModuleHandler):
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">generateResults</span>(<span style="color: #008000">self</span>, host_app, client_app, sid, count<span style="color: #666666">=1000</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset<span style="color: #666666">=0</span>, entity_name<span style="color: #666666">=</span><span style="color: #BA2121">'results'</span>):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(count), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(offset), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> sid:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">Exception</span>(<span style="color: #BA2121">'CustomResultsTable.generateResults - sid not passed!'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job <span style="color: #666666">=</span> splunk<span style="color: #666666">.</span>search<span style="color: #666666">.</span>getJob(sid)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> splunk<span style="color: #666666">.</span>ResourceNotFound, e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>error(<span style="color: #BA2121">'CustomResultsTable could not find the job </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">. Exception: </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">'</span> <span style="color: #666666">%</span> (sid, e))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> _(<span style="color: #BA2121">'&lt;p class="resultStatusMessage"&gt;The job appears to have expired or has been canceled.&lt;/p&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> []<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;div class="CustomResultsTableWrapper"&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;table class="CustomResultsTable splTable"&gt;'</span>)<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldNames <span style="color: #666666">=</span> [x <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">getattr</span>(job, entity_name)<span style="color: #666666">.</span>fieldOrder <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #AA22FF; font-weight: bold">not</span> x<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">'_'</span>))]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_start <span style="color: #666666">=</span> offset<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> offset <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span> <span style="color: #AA22FF; font-weight: bold">and</span> count <span style="color: #666666">&lt;</span> <span style="color: #008000">abs</span>(offset):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_start <span style="color: #666666">=</span> <span style="color: #666666">-</span>count<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset <span style="color: #666666">=</span> <span style="color: #008000">getattr</span>(job, entity_name)[offset_start: offset<span style="color: #666666">+</span>count]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> i, result <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(dataset):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;tr&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> field <span style="color: #AA22FF; font-weight: bold">in</span> fieldNames:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;td'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValues <span style="color: #666666">=</span> result<span style="color: #666666">.</span>get(field, <span style="color: #008000">None</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> fieldValues:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderedValues <span style="color: #666666">=</span> [cgi<span style="color: #666666">.</span>escape(x<span style="color: #666666">.</span>value) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> fieldValues[:MAX_MULTI_VALUE_COUNT]]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&gt;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&lt;/td&gt;'</span> <span style="color: #666666">%</span> <span style="color: #BA2121">""</span><span style="color: #666666">.</span>join(renderedValues))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&gt;&lt;/td&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;/tr&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;/table&gt;&lt;/div&gt;'</span>)<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (entity_name <span style="color: #666666">==</span> <span style="color: #BA2121">'results'</span> <span style="color: #AA22FF; font-weight: bold">and</span> job<span style="color: #666666">.</span>resultCount <span style="color: #666666">==</span> <span style="color: #666666">0</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> job<span style="color: #666666">.</span>isDone:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>generateStatusMessage(entity_name, <span style="color: #BA2121">'nodata'</span>, job<span style="color: #666666">.</span>id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>generateStatusMessage(entity_name, <span style="color: #BA2121">'waiting'</span>, job<span style="color: #666666">.</span>id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> <span style="color: #BA2121">''</span><span style="color: #666666">.</span>join(output)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> output<br></font></code>
<a name="example1-simplecustomizations"></a><h2> <a name="example1-simplecustomizations_example_1_-_simple_customizations"><span class="mw-headline" id="Example_1_-_Simple_customizations"> Example 1 - Simple customizations</span></a></h2>
<h3> <a name="example1-simplecustomizations_example1.xml"><span class="mw-headline" id="Example1.xml">Example1.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example 1: A Basic Application<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">      &lt;h1&gt;Example 1: A Basic Application&lt;/h1&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          This simple application searches the metrics log and lists the CPU utilization of each indexer stage, for the last seven days.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt;</span>
<span style="color: #BC7A00">          Search string:  &lt;tt&gt;index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name&lt;/tt&gt;</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt;</span>
<span style="color: #BC7A00">          Results are displayed using the &lt;tt&gt;SimpleResultsTable&lt;/tt&gt; module.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">    ]]&gt;</span><span style="color: #008000; font-weight: bold">&lt;/param&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"CPU Utilization"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"&lt;span class="</span><span style="border: 1px solid #FF0000">keyword"</span><span style="color: #008000; font-weight: bold">&gt;</span>SimpleResultsTable<span style="color: #008000; font-weight: bold">&lt;/span&gt;</span>"&gt;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
</p>
<h3> <a name="example1-simplecustomizations_default.xml"><span class="mw-headline" id="default.xml">default.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;nav&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;collection</span> <span style="color: #7D9029">label=</span><span style="color: #BA2121">"Examples"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example1"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example2"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example3"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example4"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example5"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example6"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example7"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example8"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/collection&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/nav&gt;</span>
</p>
<a name="example2-simplecustomizations"></a><h2> <a name="example2-simplecustomizations_example_2_-_simple_customizations"><span class="mw-headline" id="Example_2_-_Simple_customizations"> Example 2 - Simple customizations</span></a></h2>
<h3> <a name="example2-simplecustomizations_example2.xml"><span class="mw-headline" id="Example2.xml">Example2.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span> <span style="color: #7D9029">stylesheet=</span><span style="color: #BA2121">"example2Styles.css"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example 2: Changing the Look of an Application<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">      &lt;h1&gt;Example 2: Changing the Look of an Application&lt;/h1&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          This example applies a custom CSS to the results table.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">    ]]&gt;</span><span style="color: #008000; font-weight: bold">&lt;/param&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"CPU Utilization, another view"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"SimpleResultsTable"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/module&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="example2-simplecustomizations_example2styles.css"><span class="mw-headline" id="example2Styles.css">example2Styles.css</span></a></h3>
<p><span style="color: #008000; font-weight: bold">table</span><span style="color: #0000FF; font-weight: bold">.simpleResultsTable</span> <span style="color: #008000; font-weight: bold">tbody</span>
{
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">background</span><span style="color: #666666">:</span> <span style="color: #666666">#ebf2e6</span>;<br></font></code>
<p>}
<span style="color: #008000; font-weight: bold">table</span><span style="color: #0000FF; font-weight: bold">.simpleResultsTable</span> <span style="color: #008000; font-weight: bold">td</span>
{
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">color</span><span style="color: #666666">:</span> <span style="color: #666666">#669</span>;<br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">border-top</span><span style="color: #666666">:</span> <span style="color: #666666">1px</span> <span style="color: #008000; font-weight: bold">dashed</span> <span style="color: #666666">#fff</span>;<br></font></code>
<p>}
<span style="color: #008000; font-weight: bold">table</span><span style="color: #0000FF; font-weight: bold">.simpleResultsTable</span> <span style="color: #008000; font-weight: bold">tbody</span> <span style="color: #008000; font-weight: bold">tr</span><span style="color: #AA22FF">:hover</span> <span style="color: #008000; font-weight: bold">td</span>
{
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">color</span><span style="color: #666666">:</span> <span style="color: #666666">#339</span>;<br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">background</span><span style="color: #666666">:</span> <span style="color: #666666">#b3d09f</span>;<br></font></code>
<p>}
</p>
<a name="example3-simplecustomizations"></a><h2> <a name="example3-simplecustomizations_example_3_-_simple_customizations"><span class="mw-headline" id="Example_3_-_Simple_customizations"> Example 3 - Simple customizations</span></a></h2>
<h3> <a name="example3-simplecustomizations_example3.xml"><span class="mw-headline" id="Example3.xml">Example3.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span> <span style="color: #7D9029">stylesheet=</span><span style="color: #BA2121">"example2Styles.css"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example 3: Adding Dynamic Behavior to an Application<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">      &lt;h1&gt;Example 3: Adding Dynamic Behavior to an Application&lt;/h1&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          This builds on Example2 by using custom JavaScript to handle clicking on a table row.  On click, the indexer stage name associated with the row is displayed.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">    ]]&gt;</span><span style="color: #008000; font-weight: bold">&lt;/param&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"CPU Utilization, other behavior"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"SimpleResultsTable"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"drilldown"</span><span style="color: #008000; font-weight: bold">&gt;</span>row<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"displayMenu"</span><span style="color: #008000; font-weight: bold">&gt;</span>true<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"NullModule"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/module&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="example3-simplecustomizations_application.js"><span class="mw-headline" id="application.js">application.js</span></a></h3>
<p><span style="color: #008000; font-weight: bold">switch</span> (Splunk.util.getCurrentView()) {
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">"Example3"</span><span style="color: #666666">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (Splunk.Module.NullModule) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Splunk.Module.NullModule <span style="color: #666666">=</span> $.klass(Splunk.Module.NullModule, {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getModifiedContext<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> context <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getContext(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;click <span style="color: #666666">=</span> context.getAll(<span style="color: #BA2121">'click'</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert (click.value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> context;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">break</span>;<br></font></code>
<p>}
</p>
<a name="example4-createacustommodule"></a><h2> <a name="example4-createacustommodule_example_4_-_create_a_custom_module"><span class="mw-headline" id="Example_4_-_Create_a_custom_module"> Example 4 - Create a custom module</span></a></h2>
<h3> <a name="example4-createacustommodule_app.conf"><span class="mw-headline" id="app.conf">app.conf</span></a></h3>
<p><code><font size="2">
[ui]
is_visible = true
label = App Framework Tutorial
</font></code></p><p>[package]
id = Dev_tutorial
</p><p>[launcher]
author = Splunk, Inc.
description = App Framework Tutorial App
version = 1.0

</p>
<h3> <a name="example4-createacustommodule_default.xml"><span class="mw-headline" id="default.xml">default.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;nav&gt;</span>
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;collection</span> <span style="color: #7D9029">label=</span><span style="color: #BA2121">"Examples"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Example"</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/collection&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/nav&gt;</span>
</p>
<h3> <a name="example4-createacustommodule_example.xml"><span class="mw-headline" id="Example.xml">Example.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example: Using a Custom Module<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">            &lt;h1&gt;Example: Using a Custom Module&lt;/h1&gt;</span>
<span style="color: #BC7A00">                &lt;p&gt;</span>
<span style="color: #BC7A00">                    This simple application searches the metrics log and lists the CPU utilization of each indexer stage, for the last seven days.</span>
<span style="color: #BC7A00">                &lt;/p&gt;</span>
<span style="color: #BC7A00">                &lt;p&gt;</span>
<span style="color: #BC7A00">                    Search string:  &lt;tt&gt;index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name&lt;/tt&gt;</span>
<span style="color: #BC7A00">                &lt;/p&gt;</span>
<span style="color: #BC7A00">                &lt;p&gt;</span>
<span style="color: #BC7A00">                    Results are displayed using a custom module, &lt;tt&gt;CustomResultsTable&lt;/tt&gt;.</span>
<span style="color: #BC7A00">                &lt;/p&gt;</span>
<span style="color: #BC7A00">            ]]&gt;</span>
</p>
<code><font size="2"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"CPU Utilization"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"CustomResultsTable"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="example4-createacustommodule_customresultstable.conf"><span class="mw-headline" id="CustomResultsTable.conf">CustomResultsTable.conf</span></a></h3>
<p><code><font size="2">
[module]
className = Splunk.Module.CustomResultsTable
superClass = Splunk.Module.DispatchingModule
</font></code></p><p>description = Custom module for App Framework example.

</p>
<h3> <a name="example4-createacustommodule_customresultstable.js"><span class="mw-headline" id="CustomResultsTable.js">CustomResultsTable.js</span></a></h3>
<p>Splunk.Module.CustomResultsTable <span style="color: #666666">=</span> $.klass(Splunk.Module.DispatchingModule, {
</p>
<code><font size="2"> &nbsp;&nbsp;initialize<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, container) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.myParam <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getParam(<span style="color: #BA2121">"myParam"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.container;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;onJobDone<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>(event) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.getResults();<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;getResultParams<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> params <span style="color: #666666">=</span> $super();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> context <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> search &nbsp;<span style="color: #666666">=</span> context.get(<span style="color: #BA2121">"search"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> sid &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #666666">=</span> search.job.getSearchId();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>sid) <span style="color: #008000; font-weight: bold">this</span>.logger.error(<span style="color: #008000; font-weight: bold">this</span>.moduleType, <span style="color: #BA2121">"Search ID is missing."</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.sid <span style="color: #666666">=</span> sid;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> params;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;renderResults<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, htmlFragment) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>htmlFragment) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer.html(<span style="color: #BA2121">'No content available.'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer.html(htmlFragment);<br>&nbsp;&nbsp;&nbsp;}<br></font></code>
<p>})
</p>
<h3> <a name="example4-createacustommodule_customresultstable.py"><span class="mw-headline" id="CustomResultsTable.py">CustomResultsTable.py</span></a></h3>
<p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">controllers.module</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">module</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.search</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.util</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.entity</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.util</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">util</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.i18n</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">i18n</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>
</p><p>logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(<span style="color: #BA2121">'splunk.module.CustomResultsTable'</span>)
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">math</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cgi</span>
</p><p>MAX_MULTI_VALUE_COUNT <span style="color: #666666">=</span> <span style="color: #666666">50</span>
</p><p><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">CustomResultsTable</span>(module<span style="color: #666666">.</span>ModuleHandler):
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">generateResults</span>(<span style="color: #008000">self</span>, host_app, client_app, sid, count<span style="color: #666666">=1000</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset<span style="color: #666666">=0</span>, entity_name<span style="color: #666666">=</span><span style="color: #BA2121">'results'</span>):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(count), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(offset), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> sid:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">Exception</span>(<span style="color: #BA2121">'CustomResultsTable.generateResults - sid not passed!'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job <span style="color: #666666">=</span> splunk<span style="color: #666666">.</span>search<span style="color: #666666">.</span>getJob(sid)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> splunk<span style="color: #666666">.</span>ResourceNotFound, e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>error(<span style="color: #BA2121">'CustomResultsTable could not find the job </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">. Exception: </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">'</span> <span style="color: #666666">%</span> (sid, e))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> _(<span style="color: #BA2121">'&lt;p class="resultStatusMessage"&gt;The job appears to have expired or has been canceled.&lt;/p&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> []<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;div class="CustomResultsTableWrapper"&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;table class="CustomResultsTable splTable"&gt;'</span>)<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldNames <span style="color: #666666">=</span> [x <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">getattr</span>(job, entity_name)<span style="color: #666666">.</span>fieldOrder <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #AA22FF; font-weight: bold">not</span> x<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">'_'</span>))]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_start <span style="color: #666666">=</span> offset<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> offset <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span> <span style="color: #AA22FF; font-weight: bold">and</span> count <span style="color: #666666">&lt;</span> <span style="color: #008000">abs</span>(offset):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset_start <span style="color: #666666">=</span> <span style="color: #666666">-</span>count<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset <span style="color: #666666">=</span> <span style="color: #008000">getattr</span>(job, entity_name)[offset_start: offset<span style="color: #666666">+</span>count]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> i, result <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(dataset):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;tr&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> field <span style="color: #AA22FF; font-weight: bold">in</span> fieldNames:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;td'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValues <span style="color: #666666">=</span> result<span style="color: #666666">.</span>get(field, <span style="color: #008000">None</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> fieldValues:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderedValues <span style="color: #666666">=</span> [cgi<span style="color: #666666">.</span>escape(x<span style="color: #666666">.</span>value) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> fieldValues[:MAX_MULTI_VALUE_COUNT]]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&gt;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&lt;/td&gt;'</span> <span style="color: #666666">%</span> <span style="color: #BA2121">""</span><span style="color: #666666">.</span>join(renderedValues))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&gt;&lt;/td&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;/tr&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output<span style="color: #666666">.</span>append(<span style="color: #BA2121">'&lt;/table&gt;&lt;/div&gt;'</span>)<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (entity_name <span style="color: #666666">==</span> <span style="color: #BA2121">'results'</span> <span style="color: #AA22FF; font-weight: bold">and</span> job<span style="color: #666666">.</span>resultCount <span style="color: #666666">==</span> <span style="color: #666666">0</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> job<span style="color: #666666">.</span>isDone:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>generateStatusMessage(entity_name, <span style="color: #BA2121">'nodata'</span>, job<span style="color: #666666">.</span>id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>generateStatusMessage(entity_name, <span style="color: #BA2121">'waiting'</span>, job<span style="color: #666666">.</span>id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output <span style="color: #666666">=</span> <span style="color: #BA2121">''</span><span style="color: #666666">.</span>join(output)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> output<br></font></code>
<a name="example5-renderjsondata"></a><h2> <a name="example5-renderjsondata_render_json_data"><span class="mw-headline" id="Render_JSON_data"> Render JSON data</span></a></h2>
<a href="#to_add_your_module_code"> To add your module code</a><br><a href="#to_define_the_customjsonresults_module"> To define the CustomJSONResults module</a><br><a href="#to_handle_the_search_request.2c_returning_json-formatted_data"> To handle the search request, returning JSON-formatted data</a><br><a href="#to_render_the_json_data"> To render the JSON data</a><br><a href="#to_integrate_the_customjsonresults_module_into_the_app_view"> To integrate the CustomJSONResults module into the app view</a><br><hr width="25%"><p><img alt="SplunkIcon.png" src="images/6/6d/SplunkIcon.png" width="32" height="32">Example 5</p><hr width="25%"><p> This recipe is the same as the Create a custom module recipe, except that results are formatted as JSON and sent to the client for rendering, instead of raw HTML.</p><h6> <a name="example5-renderjsondata_details"><span class="mw-headline" id="Details">  Details </span></a></h6><p class="abstract">  The main point of interest is the introduction of the <tt>render_json()</tt> method to transmit JSON-formatted data to the client.  We also get the CPU utilization dataset directly, using the field name, instead of         implicitly as in the  <tt>   CustomResultsTable  </tt>  module. </p><p class="abstract">  &nbsp; </p><p> This represents an intermediate step between rendering an HTML table and a visualization that requires JSON, which we'll demonstrate in the Include 3rd-party libraries recipe.</p><h4><font size="3"><b><i> <a name="example5-renderjsondata_to_add_your_module_code"><span class="mw-headline" id="To_add_your_module_code"> To add your module code</span></a></i></b></font></h4><p> Create the <tt>  $SPLUNK_HOME/etc/apps/splunk_app_framework_documentation/appserver/modules/CustomJSONResults </tt> directory and add the following files:</p><ul><li><tt>   CustomJSONResults.conf  </tt></li><li><tt>   CustomJSONResults.js  </tt></li><li><tt>   CustomJSONResults.py  </tt></li></ul><h4><font size="3"><b><i> <a name="example5-renderjsondata_to_define_the_customjsonresults_module"><span class="mw-headline" id="To_define_the_CustomJSONResults_module"> To define the CustomJSONResults module</span></a></i></b></font></h4><p> In your <tt>  CustomJSONResults.conf file</tt>, set the module class name and specify the base class from which it inherits.</p><code><font size="2">
<p>[module]
className = Splunk.Module.CustomJSONResults
superClass = Splunk.Module.DispatchingModule
</p>
</font></code><p> In this example, <tt>  Splunk.Module.CustomJSONResults </tt> inherits from <tt>  Splunk.Module.DispatchingModule</tt>, which itself inherits from the root module class, <tt>Splunk.Module</tt>.</p><p> The module has no static parameters so none are defined.</p><h4><font size="3"><b><i> <a name="example5-renderjsondata_to_handle_the_search_request.2c_returning_json-formatted_data"><span class="mw-headline" id="To_handle_the_search_request.2C_returning_JSON-formatted_data"> To handle the search request, returning JSON-formatted data</span></a></i></b></font></h4><p> The <tt>  CustomJSONResults.py </tt> file implements server-side request handling. It simply formats      the response data for the module and transmits it to the client.</p><ol><li>  Import the libraries needed for working with JSON, including the  CherryPy    framework         component for setting the content type in the response header.  <code><font size="2">
<p>import cherrypy
import jsonfrom splunk.appserver.mrsparkle.lib
import jsonresponse
</p>
</font></code></li><li>  Import libraries needed by most modules.  <code><font size="2">
<p>import controllers.module as module
import splunk
import splunk.search
import splunk.util
import splunk.entity
import lib.util as util
import lib.i18n as i18n
import logging
</p><p>logger = logging.getLogger('splunk.module.CustomJSONResults')
</p>
</font></code></li><li>  Define the class, inheriting from <tt>ModuleHandler</tt>.  <code><font size="2">
<p>class CustomJSONResults(module.ModuleHandler)
</p>
</font></code></li><li>  Override the  <tt>   generateResults()</tt> method to implement the code specific to this module.  <code><font size="2">
<p>def generateResults(self, host_app, client_app, sid, count=1000,
</p>
<code><font size="2"> &nbsp;&nbsp;offset=0, entity_name='results'):<br></font></code>
</font></code><p>   The   <tt>    sid</tt>,   <tt>    count</tt>,   <tt>    offset</tt>, and   <tt>    entity_name   </tt>   parameters are used to locate the data associated with the search request.  </p><code><font size="2">
<p>count = max(int(count), 0)
offset = max(int(offset), 0)
if not sid:
</p>
<code><font size="2"> &nbsp;&nbsp;raise Exception('CustomJSONResults.generateResults - sid not passed!')<br></font></code>
</font></code><p>   Use the job ID parameter,   <tt>    sid</tt>, to get the associated job for retrieving results data.  </p><code><font size="2">
<p>try:
</p>
<code><font size="2"> &nbsp;&nbsp;job = splunk.search.getJob(sid)<br></font></code>
<p>except splunk.ResourceNotFound, e:
</p>
<code><font size="2"> &nbsp;&nbsp;logger.error('CustomJSONResults could not find the job&nbsp;%s. Exception:&nbsp;%s'&nbsp;% (sid, e))<br></font></code>
<p>return _('&lt;p class="resultStatusMessage"&gt;Could not retrieve search data.&lt;/p&gt;')
</p>
</font></code><p>   Get the results data for the associated job.  </p><code><font size="2">
<p>dataset = getattr(job, entity_name)[offset: offset+count]
</p>
</font></code><p>   Iterate through the results, using the indexer   <tt>    name   </tt>   and   <tt>    totalCPU   </tt>   literals, appending the name-value pairs to the   <tt>    outputJSON   </tt>   dictionary.  </p><code><font size="2">
<p>outputJSON = {}
for i, result in enumerate(dataset):
</p>
<code><font size="2"> &nbsp;&nbsp;outputJSON[str(result.get('name', None))] = str(result.get('totalCPU', None))<br></font></code>
</font></code><p>   Use the CherryPy utility to set the   <tt>    text/json   </tt>   content type in the response header, and transmit the JSON string to the client using      the   <tt>    json.dumps()</tt> method.  </p><code><font size="2">
<p>cherrypy.response.headers['Content-Type'] = 'text/json'
return json.dumps(outputJSON, sort_keys=True)
</p>
</font></code><p><i><b>     Note:    </b>    Beginning with release 4.x, you can use <tt>render_json()</tt> to transmit JSON data.   </i></p><p>   The   <tt>    generateResults()</tt> method formats CPU utilization data similar to the following JSON example:  </p><code><font size="2">
<p>{
</p>
<code><font size="2"> &nbsp;&nbsp;dev-null":"0.000000",<br>&nbsp;&nbsp;&nbsp;fschangemanager":"0.000000",<br>&nbsp;&nbsp;&nbsp;indexerpipe":"9.327396",<br>&nbsp;&nbsp;&nbsp;merging":"0.543903",<br>&nbsp;&nbsp;&nbsp;parsing":"0.031909",<br>&nbsp;&nbsp;&nbsp;scheduler":"0.000000",<br>&nbsp;&nbsp;&nbsp;tcp":"0.000000",<br>&nbsp;&nbsp;&nbsp;typing":"0.120027"<br></font></code>
<p>}
</p>
</font></code></li></ol><h4><font size="3"><b><i> <a name="example5-renderjsondata_to_render_the_json_data"><span class="mw-headline" id="To_render_the_JSON_data"> To render the JSON data</span></a></i></b></font></h4><p> Client-side code is implemented in the <tt>  CustomJSONResults.js </tt> file.</p><p><i><b>   Note:  </b>  Refer to the Create a custom module example for the general discussion of client processing. Here, we primarily cover the  <tt>   renderRusults()</tt> method, which is the major change from the previous example. </i></p><ol><li>  Client-side code is implemented in the  <tt>   CustomJSONResults.js  </tt>  file, which renders the JSON data.  <p>   Define the client component by subclassing <tt>Splunk.Module.DispatchingModule</tt>.  </p><code><font size="2">
<p>Splunk.Module.CustomJSONResults = $.klass(Splunk.Module.DispatchingModule, {...}
</p>
</font></code></li><li>  Override the <tt>renderResults()</tt> method to render the JSON data in the module container.  <p>   Validate that data is actually available from the server:  </p><code><font size="2">
<p>renderResults: function($super, results) {
</p>
<code><font size="2"> &nbsp;&nbsp;if(!results) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.resultsContainer.html('No content available.');<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br></font></code>
<p>}
</p>
</font></code><p>   The main function of the method is to build the HTML fragment, which is similar to what was done by the server in the Create a custom module example:  </p><code><font size="2">
<p>htmlFragment = '&lt;div class="CustomResultsTableWrapper"&gt;';
htmlFragment += '&lt;table class="CustomResultsTable splTable"&gt;';
for (var key in results) {
</p>
<code><font size="2"> &nbsp;&nbsp;htmlFragment += '&lt;tr&gt;';<br>&nbsp;&nbsp;&nbsp;htmlFragment += '&lt;td&gt;' + key &nbsp;+ '&lt;/td&gt;&lt;td&gt;' + results[key] &nbsp;+ '&lt;/td&gt;';<br>&nbsp;&nbsp;&nbsp;htmlFragment += '&lt;/tr&gt;';<br></font></code>
<p>}
htmlFragment += '&lt;/table&gt;&lt;/div&gt;';
this.resultsContainer.html(htmlFragment);
}
</p>
</font></code></li></ol><p> Iterating through the keys in the JSON name-value pairs, the code builds the table,      which is rendered by calling the <tt>  html()</tt> method of <tt>  resultsContainer</tt>, passing the HTML fragment as a parameter and using the jQuery <tt>  appendTo()</tt> method to insert the fragment into the target container.</p><h4><font size="3"><b><i> <a name="example5-renderjsondata_to_integrate_the_customjsonresults_module_into_the_app_view"><span class="mw-headline" id="To_integrate_the_CustomJSONResults_module_into_the_app_view"> To integrate the CustomJSONResults module into the app view</span></a></i></b></font></h4><p> In the <tt>  $SPLUNK_HOME/etc/apps/splunk_app_framework_documentation/default/data/ui/views/Example5.xml </tt> file, add the following line in the view hierarchy where you want your module data      rendered:</p><code><font size="2">
<code><font size="2">&lt;module name="CustomJSONResults"&gt;&lt;/module&gt;<br></font></code>
</font></code><p> The HTML table is rendered in the bottom-most panel, displaying search results initiated      by the HiddenSearch module and forwarded to the CustomJSONResults module.</p><h3> <a name="example5-renderjsondata_related_recipes"><span class="mw-headline" id="Related_recipes"> Related recipes</span></a></h3><p> Create a custom module shows you the basics of creating a custom module.</p><p> Include 3rd-party libraries shows you how to import third-party graphics library for more advanced rendering.</p><p> Parameterize your module shows you how to statically parameterize your module.</p><p> Setup your app shows you how to make your app configurable.</p>

<a name="example6-include3rd-partylibraries"></a><h2> <a name="example6-include3rd-partylibraries_example_6_-_include_3rd-party_libraries"><span class="mw-headline" id="Example_6_-_Include_3rd-party_libraries"> Example 6 - Include 3rd-party libraries</span></a></h2>
<h3> <a name="example6-include3rd-partylibraries_example6.xml"><span class="mw-headline" id="Example6.xml">Example6.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example 6: Rendering a Treemap Visualization<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">      &lt;h1&gt;Example 6: Rendering a Treemap Visualization&lt;/h1&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          This simple application searches the metrics log and lists the CPU utilization of each processor of each indexer stage.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          Search string: &lt;tt&gt;index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name, processor&lt;/tt&gt;</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          JSON-formatted results are returned and rendered as a treemap using the custom &lt;tt&gt;TreeMap&lt;/tt&gt; module. Treemap rectangles are sized by CPU utilization, with processors grouped by indexer type.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">    ]]&gt;</span><span style="color: #008000; font-weight: bold">&lt;/param&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"CPU utilization thresholds"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name, processor<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"TreeMap"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/module&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="example6-include3rd-partylibraries_treemap.conf"><span class="mw-headline" id="TreeMap.conf">TreeMap.conf</span></a></h3>
<code><font size="2"><br>[module]<br># The JavaScript name of the module<br>className = Splunk.Module.TreeMap<br>&nbsp;<br># The module class to subclass from<br>superClass = Splunk.Module.DispatchingModule<br>&nbsp;<br>description = this module waits for the search to complete, formats JSON data, and renders results in a tabular format.<br>&nbsp;<br>[param:myParam]<br>required = False<br>default = none<br>label = This is an example parameter (not currently used).<br></font></code>
<h3> <a name="example6-include3rd-partylibraries_treemap.html"><span class="mw-headline" id="TreeMap.html">TreeMap.html</span></a></h3>
<p><span style="border: 1px solid #FF0000">&lt;</span>%page args="module" expression_filter="h"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%namespace name="lib" file="//lib.html" import="*"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%lib:script_tags files="[u'/static/app/Dev_tutorial/protovis.js']" /&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;div</span> <span style="color: #7D9029">id=</span><span style="color: #BA2121">"TreeMapID"</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"TreeMapResults"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/div&gt;</span><br></font></code>
<h3> <a name="example6-include3rd-partylibraries_treemap.js"><span class="mw-headline" id="TreeMap.js">TreeMap.js</span></a></h3>
<p><span style="color: #408080; font-style: italic">// A treemap renderer</span>
Splunk.Module.TreeMap <span style="color: #666666">=</span> $.klass(Splunk.Module.DispatchingModule, {
</p>
<code><font size="2"> &nbsp;&nbsp;initialize<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, container) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.myParam <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getParam(<span style="color: #BA2121">"myParam"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.container;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;onJobDone<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>(event) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.getResults();<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;getResultParams<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> params <span style="color: #666666">=</span> $super();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> context <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> search <span style="color: #666666">=</span> context.get(<span style="color: #BA2121">"search"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> sid <span style="color: #666666">=</span> search.job.getSearchId();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>sid) <span style="color: #008000; font-weight: bold">this</span>.logger.error(<span style="color: #008000; font-weight: bold">this</span>.moduleType, <span style="color: #BA2121">"Assertion Failed."</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.sid <span style="color: #666666">=</span> sid;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> params;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;renderResults<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, results) {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span>results) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer.html(<span style="color: #BA2121">'No content available.'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> re <span style="color: #666666">=</span> <span style="color: #BA2121">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> color <span style="color: #666666">=</span> pv.Colors.category19().by(<span style="color: #008000; font-weight: bold">function</span>(d){<span style="color: #008000; font-weight: bold">return</span> d.parentNode.nodeName});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> nodes <span style="color: #666666">=</span> pv.dom(results).root(<span style="color: #BA2121">"flare"</span>).nodes();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> vis <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> pv.Panel().width(<span style="color: #666666">920</span>).height(<span style="color: #666666">420</span>).canvas(<span style="color: #008000">document</span>.getElementById(<span style="color: #BA2121">'TreeMapID'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> treemap <span style="color: #666666">=</span> vis.add(pv.Layout.Treemap).nodes(nodes).round(<span style="color: #008000; font-weight: bold">true</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;treemap.leaf.add(pv.Panel).fillStyle(<span style="color: #008000; font-weight: bold">function</span>(d){<span style="color: #008000; font-weight: bold">return</span> color(d).alpha(<span style="color: #666666">1</span>)}).strokeStyle(<span style="color: #BA2121">"#fff"</span>).lineWidth(<span style="color: #666666">1</span>).antialias(<span style="color: #008000; font-weight: bold">false</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;treemap.label.add(pv.Label).textStyle(<span style="color: #008000; font-weight: bold">function</span>(d){<span style="color: #008000; font-weight: bold">return</span> pv.rgb(<span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">1</span>)});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vis.render();<br>&nbsp;&nbsp;&nbsp;}<br></font></code>
<p>})
</p>
<h3> <a name="example6-include3rd-partylibraries_treemap.py"><span class="mw-headline" id="TreeMap.py">TreeMap.py</span></a></h3>
<p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cherrypy</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">controllers.module</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">module</span>
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.search</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.util</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.entity</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">json</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">splunk.appserver.mrsparkle.lib</span> <span style="color: #008000; font-weight: bold">import</span> jsonresponse
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.util</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">util</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.i18n</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">i18n</span>
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>
logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(<span style="color: #BA2121">'splunk.module.TreeMap'</span>)
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">math</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cgi</span>
</p><p><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">TreeMap</span>(module<span style="color: #666666">.</span>ModuleHandler):
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">generateResults</span>(<span style="color: #008000">self</span>, host_app, client_app, sid, count<span style="color: #666666">=1000</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset<span style="color: #666666">=0</span>, entity_name<span style="color: #666666">=</span><span style="color: #BA2121">'results'</span>):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(count), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(offset), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> sid:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">Exception</span>(<span style="color: #BA2121">'TreeMap.generateResults - sid not passed!'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job <span style="color: #666666">=</span> splunk<span style="color: #666666">.</span>search<span style="color: #666666">.</span>getJob(sid)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> splunk<span style="color: #666666">.</span>ResourceNotFound, e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>error(<span style="color: #BA2121">'TreeMap could not find job </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">. Exception: </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">'</span> <span style="color: #666666">%</span> (sid, e))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> _(<span style="color: #BA2121">'&lt;p class="resultStatusMessage"&gt;Could not get search data.&lt;/p&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset <span style="color: #666666">=</span> <span style="color: #008000">getattr</span>(job, entity_name)[offset: offset<span style="color: #666666">+</span>count]<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputJSON <span style="color: #666666">=</span> {}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> i, result <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(dataset):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tdict <span style="color: #666666">=</span> {}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tdict[<span style="color: #008000">str</span>(result<span style="color: #666666">.</span>get(<span style="color: #BA2121">'processor'</span>, <span style="color: #008000">None</span>))] <span style="color: #666666">=</span> <span style="color: #008000">str</span>(result<span style="color: #666666">.</span>get(<span style="color: #BA2121">'totalCPU'</span>, <span style="color: #008000">None</span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name <span style="color: #666666">=</span> <span style="color: #008000">str</span>(result<span style="color: #666666">.</span>get(<span style="color: #BA2121">'name'</span>, <span style="color: #008000">None</span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> name <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> outputJSON:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputJSON[name] <span style="color: #666666">=</span> <span style="color: #008000">dict</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputJSON[name]<span style="color: #666666">.</span>update(tdict)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cherrypy<span style="color: #666666">.</span>response<span style="color: #666666">.</span>headers[<span style="color: #BA2121">'Content-Type'</span>] <span style="color: #666666">=</span> <span style="color: #BA2121">'text/json'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> json<span style="color: #666666">.</span>dumps(outputJSON, sort_keys<span style="color: #666666">=</span><span style="color: #008000">True</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">render_json</span>(<span style="color: #008000">self</span>, response_data, set_mime<span style="color: #666666">=</span><span style="color: #BA2121">'text/json'</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cherrypy<span style="color: #666666">.</span>response<span style="color: #666666">.</span>headers[<span style="color: #BA2121">'Content-Type'</span>] <span style="color: #666666">=</span> set_mime<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(response_data, jsonresponse<span style="color: #666666">.</span>JsonResponse):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response <span style="color: #666666">=</span> response_data<span style="color: #666666">.</span>toJson()<span style="color: #666666">.</span>replace(<span style="color: #BA2121">"&lt;/"</span>, <span style="color: #BA2121">"&lt;</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BA2121">/"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response <span style="color: #666666">=</span> json<span style="color: #666666">.</span>dumps(response_data)<span style="color: #666666">.</span>replace(<span style="color: #BA2121">"&lt;/"</span>, <span style="color: #BA2121">"&lt;</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BA2121">/"</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">' '</span> <span style="color: #666666">*</span> <span style="color: #666666">256</span> &nbsp;<span style="color: #666666">+</span> <span style="color: #BA2121">'</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">'</span> <span style="color: #666666">+</span> response<br></font></code>
<a name="example7-parameterizeyourmodule"></a><h2> <a name="example7-parameterizeyourmodule_example_7_-_parameterize_your_module"><span class="mw-headline" id="Example_7_-_Parameterize_your_module"> Example 7 - Parameterize your module</span></a></h2>
<h3> <a name="example7-parameterizeyourmodule_example7.xml"><span class="mw-headline" id="Example7.xml">Example7.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example 7: Parameterizing a Module<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">      &lt;h1&gt;Example 7: Parameterizing a Module&lt;/h1&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          This example shows you how to statically parameterize your module when the app starts by specifying properties in the module configuration file.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          Search string: &lt;tt&gt;index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name, processor&lt;/tt&gt;</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt;</span>
<span style="color: #BC7A00">          Example6 used hardcoded values for the treemap height and width.  This example lets you specify those values in the &lt;tt&gt;ParameterizedTreeMap.conf&lt;/tt&gt; configuration file.</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">    ]]&gt;</span><span style="color: #008000; font-weight: bold">&lt;/param&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"HiddenSearch"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span> <span style="color: #7D9029">group=</span><span style="color: #BA2121">"Threshold events"</span> <span style="color: #7D9029">autoRun=</span><span style="color: #BA2121">"True"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"search"</span><span style="color: #008000; font-weight: bold">&gt;</span>index=_internal source=*metrics.log group=pipeline | stats sum(cpu_seconds) as totalCPU by name, processor<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"earliest"</span><span style="color: #008000; font-weight: bold">&gt;</span>-7d<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"ParameterizedTreeMap"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/module&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="example7-parameterizeyourmodule_parameterizedtreemap.conf"><span class="mw-headline" id="ParameterizedTreeMap.conf">ParameterizedTreeMap.conf</span></a></h3>
<code><font size="2"><br>[module]<br># The JavaScript name of the module<br>className = Splunk.Module.ParameterizedTreeMap<br>&nbsp;<br># The module class to subclass from<br>superClass = Splunk.Module.DispatchingModule<br>&nbsp;<br>[param:tmapWidth]<br>required = False<br>default = 640<br>label = This parameter defines the treemap width.<br>description = this module waits for the search to complete, formats JSON data, and renders a treemap.<br>&nbsp;<br>[param:tmapHeight]<br>required = False<br>default = 320<br>label = This parameter defines the treemap height.<br></font></code>
<h3> <a name="example7-parameterizeyourmodule_parameterizedtreemap.html"><span class="mw-headline" id="ParameterizedTreeMap.html">ParameterizedTreeMap.html</span></a></h3>
<p><span style="border: 1px solid #FF0000">&lt;</span>%page args="module" expression_filter="h"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%namespace name="lib" file="//lib.html" import="*"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%lib:script_tags files="[u'/static/app/Dev_tutorial/protovis.js']" /&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;div</span> <span style="color: #7D9029">id=</span><span style="color: #BA2121">"ParameterizedTreeMapID"</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"ParameterizedTreeMapResults"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/div&gt;</span><br></font></code>
<h3> <a name="example7-parameterizeyourmodule_parameterizedtreemap.js"><span class="mw-headline" id="ParameterizedTreeMap.js">ParameterizedTreeMap.js</span></a></h3>
<p><span style="color: #408080; font-style: italic">// A treemap renderer</span>
Splunk.Module.ParameterizedTreeMap <span style="color: #666666">=</span> $.klass(Splunk.Module.DispatchingModule, {
</p>
<code><font size="2"> &nbsp;&nbsp;initialize<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, container) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$super(container);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.container;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.tmapHeight <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getParam(<span style="color: #BA2121">'tmapHeight'</span>, <span style="color: #666666">920</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.tmapWidth <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getParam(<span style="color: #BA2121">'tmapWidth'</span>, <span style="color: #666666">420</span>);<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;onJobDone<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>(event) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.getResults();<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;getResultParams<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> params <span style="color: #666666">=</span> $super();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> context <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">this</span>.getContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> search <span style="color: #666666">=</span> context.get(<span style="color: #BA2121">"search"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> sid <span style="color: #666666">=</span> search.job.getSearchId();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>sid) <span style="color: #008000; font-weight: bold">this</span>.logger.error(<span style="color: #008000; font-weight: bold">this</span>.moduleType, <span style="color: #BA2121">"Assertion Failed."</span>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.sid <span style="color: #666666">=</span> sid;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> params;<br>&nbsp;&nbsp;&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;renderResults<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">function</span>($super, results) {<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span>results) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">this</span>.resultsContainer.html(<span style="color: #BA2121">'No content available.'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> re <span style="color: #666666">=</span> <span style="color: #BA2121">""</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> color <span style="color: #666666">=</span> pv.Colors.category19().by(<span style="color: #008000; font-weight: bold">function</span>(d){<span style="color: #008000; font-weight: bold">return</span> d.parentNode.nodeName});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> nodes <span style="color: #666666">=</span> pv.dom(results).root(<span style="color: #BA2121">"flare"</span>).nodes();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> vis <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> pv.Panel().width(<span style="color: #008000; font-weight: bold">this</span>.tmapWidth).height(<span style="color: #008000; font-weight: bold">this</span>.tmapHeight).canvas(<span style="color: #008000">document</span>.getElementById(<span style="color: #BA2121">'ParameterizedTreeMapID'</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">var</span> treemap <span style="color: #666666">=</span> vis.add(pv.Layout.Treemap).nodes(nodes).round(<span style="color: #008000; font-weight: bold">true</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;treemap.leaf.add(pv.Panel).fillStyle(<span style="color: #008000; font-weight: bold">function</span>(d){<span style="color: #008000; font-weight: bold">return</span> color(d).alpha(<span style="color: #666666">1</span>)}).strokeStyle(<span style="color: #BA2121">"#fff"</span>).lineWidth(<span style="color: #666666">1</span>).antialias(<span style="color: #008000; font-weight: bold">false</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;treemap.label.add(pv.Label).textStyle(<span style="color: #008000; font-weight: bold">function</span>(d){<span style="color: #008000; font-weight: bold">return</span> pv.rgb(<span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">1</span>)});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vis.render();<br>&nbsp;&nbsp;&nbsp;}<br></font></code>
<p>})
</p>
<h3> <a name="example7-parameterizeyourmodule_parameterizedtreemap.py"><span class="mw-headline" id="ParameterizedTreeMap.py">ParameterizedTreeMap.py</span></a></h3>
<p><span style="color: #408080; font-style: italic">#</span>
<span style="color: #408080; font-style: italic"># Splunk UI module python renderer</span>
<span style="color: #408080; font-style: italic"># This module is imported by the module loader (lib.module.ModuleMapper) into</span>
<span style="color: #408080; font-style: italic"># the splunk.appserver.mrsparkle.controllers.module.* namespace.</span>
<span style="color: #408080; font-style: italic">#</span>
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cherrypy</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">controllers.module</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">module</span>
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.search</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.util</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">splunk.entity</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">json</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">splunk.appserver.mrsparkle.lib</span> <span style="color: #008000; font-weight: bold">import</span> jsonresponse
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.util</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">util</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">lib.i18n</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">i18n</span>
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>
logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(<span style="color: #BA2121">'splunk.module.ParameterizedTreeMap'</span>)
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">math</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cgi</span>
</p><p><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">ParameterizedTreeMap</span>(module<span style="color: #666666">.</span>ModuleHandler):
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">generateResults</span>(<span style="color: #008000">self</span>, host_app, client_app, sid, count<span style="color: #666666">=1000</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset<span style="color: #666666">=0</span>, entity_name<span style="color: #666666">=</span><span style="color: #BA2121">'results'</span>):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(count), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset <span style="color: #666666">=</span> <span style="color: #008000">max</span>(<span style="color: #008000">int</span>(offset), <span style="color: #666666">0</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> sid:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">Exception</span>(<span style="color: #BA2121">'ParameterizedTreeMap.generateResults - sid not passed!'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job <span style="color: #666666">=</span> splunk<span style="color: #666666">.</span>search<span style="color: #666666">.</span>getJob(sid)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> splunk<span style="color: #666666">.</span>ResourceNotFound, e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>error(<span style="color: #BA2121">'ParameterizedTreeMap could not find job </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">. Exception: </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">'</span> <span style="color: #666666">%</span> (sid, e))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> _(<span style="color: #BA2121">'&lt;p class="resultStatusMessage"&gt;Could not get search data.&lt;/p&gt;'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataset <span style="color: #666666">=</span> <span style="color: #008000">getattr</span>(job, entity_name)[offset: offset<span style="color: #666666">+</span>count]<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputJSON <span style="color: #666666">=</span> {}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> i, result <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(dataset):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tdict <span style="color: #666666">=</span> {}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tdict[<span style="color: #008000">str</span>(result<span style="color: #666666">.</span>get(<span style="color: #BA2121">'processor'</span>, <span style="color: #008000">None</span>))] <span style="color: #666666">=</span> <span style="color: #008000">str</span>(result<span style="color: #666666">.</span>get(<span style="color: #BA2121">'totalCPU'</span>, <span style="color: #008000">None</span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name <span style="color: #666666">=</span> <span style="color: #008000">str</span>(result<span style="color: #666666">.</span>get(<span style="color: #BA2121">'name'</span>, <span style="color: #008000">None</span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> name <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> outputJSON:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputJSON[name] <span style="color: #666666">=</span> <span style="color: #008000">dict</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputJSON[name]<span style="color: #666666">.</span>update(tdict)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cherrypy<span style="color: #666666">.</span>response<span style="color: #666666">.</span>headers[<span style="color: #BA2121">'Content-Type'</span>] <span style="color: #666666">=</span> <span style="color: #BA2121">'text/json'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> json<span style="color: #666666">.</span>dumps(outputJSON, sort_keys<span style="color: #666666">=</span><span style="color: #008000">True</span>)<br></font></code>
<p><span style="color: #408080; font-style: italic">#        return self.render_json(outputJSON)</span>
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">render_json</span>(<span style="color: #008000">self</span>, response_data, set_mime<span style="color: #666666">=</span><span style="color: #BA2121">'text/json'</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cherrypy<span style="color: #666666">.</span>response<span style="color: #666666">.</span>headers[<span style="color: #BA2121">'Content-Type'</span>] <span style="color: #666666">=</span> set_mime<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(response_data, jsonresponse<span style="color: #666666">.</span>JsonResponse):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response <span style="color: #666666">=</span> response_data<span style="color: #666666">.</span>toJson()<span style="color: #666666">.</span>replace(<span style="color: #BA2121">"&lt;/"</span>, <span style="color: #BA2121">"&lt;</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BA2121">/"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">else</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response <span style="color: #666666">=</span> json<span style="color: #666666">.</span>dumps(response_data)<span style="color: #666666">.</span>replace(<span style="color: #BA2121">"&lt;/"</span>, <span style="color: #BA2121">"&lt;</span><span style="color: #BB6622; font-weight: bold">\\</span><span style="color: #BA2121">/"</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #408080; font-style: italic"># Pad with 256 bytes of whitespace for IE security issue. See SPL-34355</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">' '</span> <span style="color: #666666">*</span> <span style="color: #666666">256</span> &nbsp;<span style="color: #666666">+</span> <span style="color: #BA2121">'</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">'</span> <span style="color: #666666">+</span> response<br></font></code>
<a name="example8-setupyourapp"></a><h2> <a name="example8-setupyourapp_example_8_-_set_up_your_app"><span class="mw-headline" id="Example_8_-_Set_up_your_app"> Example 8 - Set up your app</span></a></h2>
<h3> <a name="example8-setupyourapp_example8.xml"><span class="mw-headline" id="Example8.xml">Example8.xml</span></a></h3>
<p><span style="color: #008000; font-weight: bold">&lt;view</span> <span style="color: #7D9029">template=</span><span style="color: #BA2121">"dashboard.html"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;label&gt;</span>Example 8: Setting up an App (MVC)<span style="color: #008000; font-weight: bold">&lt;/label&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AccountBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"appHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"AppBar"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"navigationHeader"</span><span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"Message"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"messaging"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"filter"</span><span style="color: #008000; font-weight: bold">&gt;</span>*<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"clearOnJobDispatch"</span><span style="color: #008000; font-weight: bold">&gt;</span>False<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"maxSize"</span><span style="color: #008000; font-weight: bold">&gt;</span>1<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"StaticContentSample"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row1_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"text"</span><span style="color: #008000; font-weight: bold">&gt;</span><span style="color: #BC7A00">&lt;![CDATA[</span><br></font></code>
<p><span style="color: #BC7A00">      &lt;h1&gt;Example 8: Setting up an App (MVC)&lt;/h1&gt;</span>
<span style="color: #BC7A00">        &lt;p&gt; </span>
<span style="color: #BC7A00">          App setup involves configuring configuration objects using HTML forms.  This differs from Module Controllers, which facilitate asynchronous context, search, and job processing.  (Setup demonstrates how to use the MVC architectural pattern implemented by the App Framework.)</span>
<span style="color: #BC7A00">        &lt;/p&gt;</span>
<span style="color: #BC7A00">    ]]&gt;</span><span style="color: #008000; font-weight: bold">&lt;/param&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br>&nbsp;&nbsp;<br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;module</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"IFrameInclude"</span> <span style="color: #7D9029">layoutPanel=</span><span style="color: #BA2121">"panel_row2_col1"</span><span style="color: #008000; font-weight: bold">&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;param</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"src"</span><span style="color: #008000; font-weight: bold">&gt;</span>/custom/Dev_tutorial/TutorialSetup/show<span style="color: #008000; font-weight: bold">&lt;/param&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/module&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/view&gt;</span>
]]&gt;
</p>
<h3> <a name="example8-setupyourapp_web.conf"><span class="mw-headline" id="web.conf">web.conf</span></a></h3>
<code><font size="2"><br>[endpoint:TutorialSetup]<br></font></code>
<h3> <a name="example8-setupyourapp_tutorialsetup.py"><span class="mw-headline" id="TutorialSetup.py">TutorialSetup.py</span></a></h3>
<p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">logging</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">os</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cherrypy</span>
</p><p><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk.bundle</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">bundle</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk.appserver.mrsparkle.controllers</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">controllers</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">splunk.appserver.mrsparkle.lib.util</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">util</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">splunk.appserver.mrsparkle.lib.decorators</span> <span style="color: #008000; font-weight: bold">import</span> expose_page
</p><p><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">splunk.models.event_type</span> <span style="color: #008000; font-weight: bold">import</span> EventType
</p><p>logger <span style="color: #666666">=</span> logging<span style="color: #666666">.</span>getLogger(<span style="color: #BA2121">'splunk.appserver.mrsparkle.controllers.TutorialSetup'</span>)
</p><p><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">TutorialSetup</span>(controllers<span style="color: #666666">.</span>BaseController):
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #BA2121; font-style: italic">'''App Framework Tutorial Setup Controller'''</span><br><br>&nbsp;&nbsp;&nbsp;<span style="color: #AA22FF">@expose_page</span>(must_login<span style="color: #666666">=</span><span style="color: #008000">True</span>, methods<span style="color: #666666">=</span>[<span style="color: #BA2121">'GET'</span>])<br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">show</span>(<span style="color: #008000">self</span>, <span style="color: #666666">**</span>kwargs):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>render_template(<span style="color: #BA2121">'/Dev_tutorial:/templates/setup.html'</span>)<br><br>&nbsp;&nbsp;&nbsp;<span style="color: #AA22FF">@expose_page</span>(must_login<span style="color: #666666">=</span><span style="color: #008000">True</span>, trim_spaces<span style="color: #666666">=</span><span style="color: #008000">True</span>, methods<span style="color: #666666">=</span>[<span style="color: #BA2121">'POST'</span>])<br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">save</span>(<span style="color: #008000">self</span>, <span style="color: #666666">**</span>params):<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content <span style="color: #666666">=</span> {}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user <span style="color: #666666">=</span> cherrypy<span style="color: #666666">.</span>session[<span style="color: #BA2121">'user'</span>][<span style="color: #BA2121">'name'</span>]<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> key, val <span style="color: #AA22FF; font-weight: bold">in</span> params<span style="color: #666666">.</span>iteritems():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">if</span> (key <span style="color: #666666">!=</span> <span style="color: #BA2121">'splunk_form_key'</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key] <span style="color: #666666">=</span> EventType<span style="color: #666666">.</span>get(EventType<span style="color: #666666">.</span>build_id(key, <span style="color: #BA2121">'Dev_tutorial'</span>, user))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key]<span style="color: #666666">.</span>search <span style="color: #666666">=</span> val<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> <span style="color: #D2413A; font-weight: bold">Exception</span>, ex:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key] <span style="color: #666666">=</span> EventType(<span style="color: #BA2121">'Dev_tutorial'</span>, user, key)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">for</span> key <span style="color: #AA22FF; font-weight: bold">in</span> form_content<span style="color: #666666">.</span>keys():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form_content[key]<span style="color: #666666">.</span>passive_save()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> splunk<span style="color: #666666">.</span>AuthorizationFailed:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>info(<span style="color: #BA2121">'User </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"> is unauthorized to perform setup on </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">'</span> <span style="color: #666666">%</span> (user, <span style="color: #BA2121">'Dev_tutorial'</span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">except</span> <span style="color: #D2413A; font-weight: bold">Exception</span>, ex:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>info(ex)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger<span style="color: #666666">.</span>info(<span style="color: #BA2121">'Failed to save eventtype </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">'</span> <span style="color: #666666">%</span> key)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>render_template(<span style="color: #BA2121">'/Dev_tutorial:/templates/success.html'</span>)<br></font></code>
<h3> <a name="example8-setupyourapp_setup.html"><span class="mw-headline" id="setup.html">setup.html</span></a></h3>
<p><span style="border: 1px solid #FF0000">&lt;</span>%page expression_filter="h"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%inherit file="//layout/base.html" /&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%namespace name="lib" file="//lib.html" import="*"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%namespace name="helpers" file="//view/_helpers.html" import="*"/&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%!
</p>
<code><font size="2"> &nbsp;&nbsp;import logging<br>&nbsp;&nbsp;&nbsp;logger = logging.getLogger('splunk.module.setup')<br></font></code>
<p>%&gt;
</p><p><span style="border: 1px solid #FF0000">&lt;</span>%def name="gen_form(method='POST', action=None)"&gt;
</p>
<code><font size="2"> &nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;form</span> &nbsp;<span style="color: #7D9029">method=</span><span style="color: #BA2121">"${method}"</span> &nbsp;<span style="color: #7D9029">action=</span><span style="color: #BA2121">"${action if action else ''}"</span><span style="color: #008000; font-weight: bold">&gt;</span><br></font></code>
<p>/%def&gt;
</p><p><span style="color: #008000; font-weight: bold">&lt;div</span> <span style="color: #7D9029">id=</span><span style="color: #BA2121">"setup"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;p</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"pageDesc"</span><span style="color: #008000; font-weight: bold">&gt;</span>Select the indexer stages you want to display:<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span><br>&nbsp;${gen_form(method="POST", action=make_url(['custom', 'Dev_tutorial', 'TutorialSetup', 'save']))}<br>&nbsp;${csrf_hidden_input()}<br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"dev-null"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #008000; font-weight: bold">/&gt;</span> dev-null<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"archivepipe"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #008000; font-weight: bold">/&gt;</span> archivepipe<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"fschangemanager"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #008000; font-weight: bold">/&gt;</span> fschangemanager<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"indexerpipe"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #7D9029">checked</span><span style="color: #008000; font-weight: bold">/&gt;</span> indexerpipe<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"merging"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #7D9029">checked</span><span style="color: #008000; font-weight: bold">/&gt;</span> merging<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"parsing"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #7D9029">checked</span><span style="color: #008000; font-weight: bold">/&gt;</span> parsing<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"scheduler"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #008000; font-weight: bold">/&gt;</span> scheduler<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"typing"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #7D9029">checked</span><span style="color: #008000; font-weight: bold">/&gt;</span> typing<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"tcp"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #008000; font-weight: bold">/&gt;</span> tcp<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"checkbox"</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">"udp"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Yes"</span> <span style="color: #008000; font-weight: bold">/&gt;</span> udp<span style="color: #008000; font-weight: bold">&lt;br</span> <span style="color: #008000; font-weight: bold">/&gt;</span><br><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>Click the button to save your configuration:<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span><br>&nbsp;&nbsp;&nbsp;<span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"splButton-primary"</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">"submit"</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">"Save"</span><span style="color: #008000; font-weight: bold">&gt;&lt;/input&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/div&gt;</span>
</p>
<h3> <a name="example8-setupyourapp_success.html"><span class="mw-headline" id="success.html">success.html</span></a></h3>
<p><span style="border: 1px solid #FF0000">&lt;</span>%inherit file="//layout/base.html" /&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%namespace name="lib" file="//lib.html" import="*"/&gt;
<span style="color: #008000; font-weight: bold">&lt;div</span> <span style="color: #7D9029">id=</span><span style="color: #BA2121">"success"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;h2&gt;</span>Great Success!<span style="color: #008000; font-weight: bold">&lt;/h2&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>Your App Framework tutorial settings have been saved.<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>Click "OK" to go to the App Framework Tutorial home page.<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;a</span> <span style="color: #7D9029">target=</span><span style="color: #BA2121">"_parent"</span> <span style="color: #7D9029">href=</span><span style="color: #BA2121">"${make_url('/app/Dev_tutorial')}"</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"splButton-primary"</span><span style="color: #008000; font-weight: bold">&gt;&lt;span</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"cancel"</span><span style="color: #008000; font-weight: bold">&gt;</span>OK<span style="color: #008000; font-weight: bold">&lt;/span&gt;&lt;/a&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/div&gt;</span>
</p>
<h3> <a name="example8-setupyourapp_failure.html"><span class="mw-headline" id="failure.html">failure.html</span></a></h3>
<p><span style="border: 1px solid #FF0000">&lt;</span>%inherit file="//layout/base.html" /&gt;
<span style="border: 1px solid #FF0000">&lt;</span>%namespace name="lib" file="//lib.html" import="*"/&gt;
<span style="color: #008000; font-weight: bold">&lt;div</span> <span style="color: #7D9029">id=</span><span style="color: #BA2121">"failure"</span><span style="color: #008000; font-weight: bold">&gt;</span>
</p>
<code><font size="2"> <span style="color: #008000; font-weight: bold">&lt;h2&gt;</span>Failure<span style="color: #008000; font-weight: bold">&lt;/h2&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>App Framework Tutorial settings could not be loaded successfully. &nbsp;Click "OK" to return to setup.<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span><br>&nbsp;<span style="color: #008000; font-weight: bold">&lt;a</span> <span style="color: #7D9029">target=</span><span style="color: #BA2121">"_parent"</span> <span style="color: #7D9029">href=</span><span style="color: #BA2121">"${make_url('/app/Dev_tutorial/Example8')}"</span><span style="color: #008000; font-weight: bold">&gt;&lt;span</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">"splButton-primary cancel"</span><span style="color: #008000; font-weight: bold">&gt;</span>OK<span style="color: #008000; font-weight: bold">&lt;/span&gt;&lt;/a&gt;</span><br></font></code>
<p><span style="color: #008000; font-weight: bold">&lt;/div&gt;</span>
</p>
</body><script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

        <script src="js/index.js"></script></html>
