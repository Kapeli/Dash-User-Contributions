<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>SDL_LockAudioDevice</title>
    <script type="text/javascript" src="doc.js"></script>
  </head>
  <body>
    <div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867">
</p><h1 id="SDL_LockAudioDevice-1">SDL_LockAudioDevice</h1>
<span class="anchor" id="line-5"></span><p class="line874">Use this function to lock out the audio callback function for a specified device. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p class="line867"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#SDL_LockAudioDevice-1">SDL_LockAudioDevice</a><ol><li>
<a href="#Syntax">Syntax</a></li><li>
<a href="#Function_Parameters">Function Parameters</a></li><li>
<a href="#Code_Examples">Code Examples</a></li><li>
<a href="#Remarks">Remarks</a></li><li>
<a href="#Related_Functions">Related Functions</a></li></ol></li></ol></div><p class="line874"> <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><p class="line867">
</p><h2 id="Syntax">Syntax</h2>
<span class="anchor" id="line-10"></span><p class="line867"><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span></p><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-pygments_29\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-pygments_29" lang="en"><span class="line"><span class="kt">void</span> <span class="n">SDL_LockAudioDevice</span><span class="p">(</span><span class="n">SDL_AudioDeviceID</span> <span class="n">dev</span><span class="p">)</span>
</span></pre></div><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line867">
</p><h2 id="Function_Parameters">Function Parameters</h2>
<span class="anchor" id="line-15"></span><div><table><tbody><tr>  <td><p class="line891"><strong>dev</strong></p></td>
  <td><p class="line862">the ID of the device to be locked</p></td>
</tr>
</tbody></table></div><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
</p><h2 id="Code_Examples">Code Examples</h2>
<span class="anchor" id="line-18"></span><p class="line867"><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></p><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-pygments_30\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-pygments_30" lang="en"><span class="line"><span class="kt">void</span> <span class="nf">myAudioCallback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">userdata</span><span class="p">,</span> <span class="n">Uint8</span><span class="o">*</span> <span class="n">stream</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">printf</span><span class="p">(</span><span class="s">"The audio callback is running!</span><span class="se">
</span><span class="s">"</span><span class="p">);</span>
</span><span class="line">    <span class="n">SDL_memset</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>  <span class="c1">// just silence.</span>
</span><span class="line">    <span class="n">printf</span><span class="p">(</span><span class="s">"The audio callback is done!</span><span class="se">
</span><span class="s">"</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// don't lock for 2 seconds at a time in real life, please.</span>
</span><span class="line"><span class="k">extern</span> <span class="n">SDL_AudioDeviceID</span> <span class="n">devid</span><span class="p">;</span>
</span><span class="line"><span class="n">SDL_Delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>  <span class="c1">// callback runs for 2 seconds.</span>
</span><span class="line"><span class="n">SDL_LockAudioDevice</span><span class="p">(</span><span class="n">devid</span><span class="p">);</span>
</span><span class="line"><span class="n">printf</span><span class="p">(</span><span class="s">"The audio callback can't be running right now!</span><span class="se">
</span><span class="s">"</span><span class="p">);</span>
</span><span class="line"><span class="n">SDL_Delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>  <span class="c1">// callback doesn't run for 2 seconds.</span>
</span><span class="line"><span class="n">printf</span><span class="p">(</span><span class="s">"Ok, unlocking!</span><span class="se">
</span><span class="s">"</span><span class="p">);</span>
</span><span class="line"><span class="n">SDL_UnlockAudioDevice</span><span class="p">(</span><span class="n">devid</span><span class="p">);</span>
</span><span class="line"><span class="n">SDL_Delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>  <span class="c1">// callback runs for 2 seconds.</span>
</span></pre></div><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867">
</p><h2 id="Remarks">Remarks</h2>
<span class="anchor" id="line-38"></span><p class="line862">The lock manipulated by these functions protects the audio callback function specified in <a href="/SDL_OpenAudioDevice">SDL_OpenAudioDevice</a>().  During a <a href="/SDL_LockAudioDevice">SDL_LockAudioDevice</a>()/<a href="/SDL_UnlockAudioDevice">SDL_UnlockAudioDevice</a>() pair, you can be guaranteed that the callback function for that device is not running, even if the device is not paused. While a device is locked, any other unpaused, unlocked devices may still run their callbacks. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span></p><p class="line874">Calling this function from inside your audio callback is unnecessary. SDL obtains this lock before calling your function, and releases it when the function returns. <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></p><p class="line874">You should not hold the lock longer than absolutely necessary. If you hold it too long, you'll experience dropouts in your audio playback. Ideally, your application locks the device, sets a few variables and unlocks again. Do not do heavy work while holding the lock for a device. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span></p><p class="line862">It is safe to lock the audio device multiple times, as long as you unlock it an equivalent number of times. The callback will not run until the device has been unlocked completely in this way. If your application fails to unlock the device appropriately, your callback will never run, you might hear repeating bursts of audio, and <a href="/SDL_CloseAudioDevice">SDL_CloseAudioDevice</a>() will probably deadlock. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></p><p class="line874">Internally, the audio device lock is a mutex; if you lock from two threads at once, not only will you block the audio callback, you'll block the other thread. <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span></p><p class="line867">
</p><h2 id="Related_Functions">Related Functions</h2>
<span class="anchor" id="line-49"></span><ul><li style="list-style-type:none"><p class="line891"><a href="/SDL_UnlockAudioDevice">SDL_UnlockAudioDevice</a> <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span></p></li></ul><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-52"></span><a href="/CategoryAPI"><strong class="highlight">CategoryAPI</strong></a>, <a href="/CategoryAudio">CategoryAudio</a> <span class="anchor" id="line-53"></span><span class="anchor" id="bottom"></span></p></div>
  </body>
</html>
