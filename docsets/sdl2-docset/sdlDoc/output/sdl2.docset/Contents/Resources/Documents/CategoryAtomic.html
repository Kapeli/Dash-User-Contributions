<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>Atomic Operations</title>
    <script type="text/javascript" src="doc.js"></script>
  </head>
  <body>
    <div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
</p><h1 id="Atomic_Operations">Atomic Operations</h1>
<span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867"><strong>Include File(s):</strong>  <a class="http" href="http://hg.libsdl.org/SDL/file/default/include/SDL_atomic.h">SDL_atomic.h</a> <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></p><p class="line867"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Atomic_Operations">Atomic Operations</a><ol><li>
<a href="#Introduction">Introduction</a><ol><li>
<a href="#Atomic_Locks">Atomic Locks</a></li></ol></li><li>
<a href="#Structures">Structures</a></li><li>
<a href="#Functions">Functions</a></li></ol></li></ol></div> <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line867">
</p><h2 id="Introduction">Introduction</h2>
<span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line874">This category contains functions for handling atomic operations. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span></p><p class="line867"><img alt="/!\" height="16" src="/moin_static195/fixedleft/img/alert.png" title="/!\" width="16"> IMPORTANT: <span class="anchor" id="line-17"></span></p><ul><li style="list-style-type:none"><p class="line862">If you are not an expert in concurrent lockless programming, you should only be using the atomic lock and reference counting functions in this file.  In all other cases you should be protecting your data structures with full mutexes.  <em>Seriously, here be dragons!</em> <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></p></li></ul><p class="line874">"Safe" functions to use are: <span class="anchor" id="line-20"></span></p><ul><li><p class="line891"><a href="/SDL_AtomicLock">SDL_AtomicLock</a>() <span class="anchor" id="line-21"></span></p></li><li><p class="line891"><a href="/SDL_AtomicUnlock">SDL_AtomicUnlock</a>() <span class="anchor" id="line-22"></span></p></li><li><p class="line891"><a href="/SDL_AtomicIncRef">SDL_AtomicIncRef</a>() <span class="anchor" id="line-23"></span></p></li><li><p class="line891"><a href="/SDL_AtomicDecRef">SDL_AtomicDecRef</a>() <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span></p></li></ul><p class="line874">You can find out a little more about lockless programming and the subtle issues that can arise here: <span class="anchor" id="line-27"></span></p><ul><li style="list-style-type:none"><p class="line891"><a class="http" href="http://msdn.microsoft.com/en-us/library/ee418650%28v=vs.85%29.aspx">http://msdn.microsoft.com/en-us/library/ee418650%28v=vs.85%29.aspx</a> <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></p></li></ul><p class="line874">There's also lots of good information here: <span class="anchor" id="line-30"></span></p><ul><li style="list-style-type:none"><p class="line891"><a class="http" href="http://www.1024cores.net/home/lock-free-algorithms">http://www.1024cores.net/home/lock-free-algorithms</a> <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span></p></li></ul><p class="line862">These operations may or may not actually be implemented using processor specific atomic operations. When possible they are implemented as true processor specific atomic operations. When that is not possible the are implemented using locks that <strong>do</strong> use the available atomic operations.   <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span></p><p class="line874">All of the atomic operations that modify memory are full memory barriers. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span></p><p class="line867">
</p><h3 id="Atomic_Locks">Atomic Locks</h3>
<span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span></p><p class="line874">The atomic locks are efficient spinlocks using CPU instructions, but are vulnerable to starvation and can spin forever if a thread holding a lock has been terminated.  For this reason you should minimize the code executed inside an atomic lock and never do expensive things like API or system calls while holding them. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p><p class="line867"><img alt="/!\" height="16" src="/moin_static195/fixedleft/img/alert.png" title="/!\" width="16"> The atomic locks are not safe to lock recursively. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p><p class="line867"><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span></p><p class="line867"><span class="anchor" id="line-48"></span></p><p class="line867"><span class="anchor" id="line-49"></span></p><p class="line867"><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span></p><p class="line867">
</p><h2 id="Structures">Structures</h2>
<span class="anchor" id="line-52"></span><p class="line867"></p><div class="searchresults">
<ol start="1"><li><a href="/SDL_atomic_t?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryStruct%29">SDL_atomic_t</a></li></ol>
</div> <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><p class="line867">
</p><h2 id="Functions">Functions</h2>
<span class="anchor" id="line-55"></span><p class="line867"></p><div class="searchresults">
<ol start="1"><li><a href="/SDL_AtomicAdd?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicAdd</a></li><li><a href="/SDL_AtomicCAS?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicCAS</a></li><li><a href="/SDL_AtomicCASPtr?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicCASPtr</a></li><li><a href="/SDL_AtomicDecRef?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicDecRef</a></li><li><a href="/SDL_AtomicGet?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicGet</a></li><li><a href="/SDL_AtomicGetPtr?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicGetPtr</a></li><li><a href="/SDL_AtomicIncRef?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicIncRef</a></li><li><a href="/SDL_AtomicLock?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicLock</a></li><li><a href="/SDL_AtomicSet?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicSet</a></li><li><a href="/SDL_AtomicSetPtr?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicSetPtr</a></li><li><a href="/SDL_AtomicTryLock?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicTryLock</a></li><li><a href="/SDL_AtomicUnlock?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_AtomicUnlock</a></li><li><a href="/SDL_CompilerBarrier?highlight=%28%5CbCategoryAtomic%5Cb%29%7C%28CategoryEnum%29%7C%28CategoryStruct%29">SDL_CompilerBarrier</a></li></ol>
</div> <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-58"></span><a href="/CategoryCategory">CategoryCategory</a> <span class="anchor" id="line-59"></span><span class="anchor" id="bottom"></span></p></div>
  </body>
</html>

