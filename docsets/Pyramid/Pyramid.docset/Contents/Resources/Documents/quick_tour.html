<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quick Tour of Pyramid &mdash; The Pyramid Web Framework v1.5</title>
    
    <link rel="stylesheet" href="_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="The Pyramid Web Framework v1.5" href="index.html" />
    <link rel="next" title="Quick Tutorial for Pyramid" href="quick_tutorial/index.html" />
    <link rel="prev" title="Typographical Conventions" href="conventions.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="_static/pyramid.ico"/>

  </head>
  <body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="index.html">
      		<img class="logo" src="_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quick_tutorial/index.html" title="Quick Tutorial for Pyramid"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="conventions.html" title="Typographical Conventions"
             accesskey="P">previous</a> |</li>
    	<li><a href="index.html">The Pyramid Web Framework v1.5</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="quick-tour-of-pyramid">
<span id="quick-tour"></span><h1>Quick Tour of Pyramid<a class="headerlink" href="#quick-tour-of-pyramid" title="Permalink to this headline">¶</a></h1>
<p>Pyramid lets you start small and finish big.  This <em>Quick Tour</em> of Pyramid is
for those who want to evaluate Pyramid, whether you are new to Python
web frameworks, or a pro in a hurry. For more detailed treatment of
each topic, give the <a class="reference internal" href="quick_tutorial/index.html#quick-tutorial"><em>Quick Tutorial for Pyramid</em></a> a try.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Once you have a standard Python environment setup, getting started with
Pyramid is a breeze. Unfortunately &quot;standard&quot; is not so simple in Python.
For this Quick Tour, it means:
<a class="reference external" href="http://www.python.org/download/releases/">Python</a>, a
<a class="reference external" href="http://docs.python.org/dev/library/venv.html">virtual environment</a>
(or <a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtualenv for Python 2.7</a>),
and <a class="reference external" href="https://pypi.python.org/pypi/setuptools/">setuptools</a>.</p>
<p>As an example, for Python 3.3+ on Linux:</p>
<pre class="literal-block">
$ pyvenv env33
$ wget <a class="reference external" href="https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py">https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py</a> -O - | env33/bin/python
$ env33/bin/easy_install &quot;pyramid==1.5&quot;
</pre>
<p>For Windows:</p>
<pre class="literal-block">
# Use your browser to download:
#   <a class="reference external" href="https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py">https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py</a>
c:\&gt; c:\Python33\python -m venv env33
c:\&gt; env33\Scripts\python ez_setup.py
c:\&gt; env33\Scripts\easy_install &quot;pyramid==1.5&quot;
</pre>
<p>Of course Pyramid runs fine on Python 2.6+, as do the examples in this
<em>Quick Tour</em>. We're just showing Python 3 a little love (Pyramid had
production support in October 2011.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Why <tt class="docutils literal"><span class="pre">easy_install</span></tt> and not <tt class="docutils literal"><span class="pre">pip</span></tt>? Pyramid encourages use of namespace
packages which, until recently, <tt class="docutils literal"><span class="pre">pip</span></tt> didn't permit. Also, Pyramid has
some optional C extensions for performance. With <tt class="docutils literal"><span class="pre">easy_install</span></tt>, Windows
users can get these extensions without needing a C compiler.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/requirements.html#qtut-requirements"><em>Quick Tutorial section on Requirements</em></a>,
<a class="reference internal" href="narr/install.html#installing-unix"><em>Installing Pyramid on a UNIX System</em></a>,
<a class="reference internal" href="narr/install.html#installing-chapter"><em>Before You Install</em></a>, and
<a class="reference internal" href="narr/install.html#installing-windows"><em>Installing Pyramid on a Windows System</em></a></p>
</div>
</div>
<div class="section" id="hello-world">
<h2>Hello World<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p>Microframeworks have shown that learning starts best from a very small
first step. Here's a tiny application in Pyramid:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>


<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s">&#39;&lt;h1&gt;Hello World!&lt;/h1&gt;&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">hello_world</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">6543</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>This simple example is easy to run. Save this as <tt class="docutils literal"><span class="pre">app.py</span></tt> and run it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python ./app.py
</pre></div>
</div>
<p>Next, open <a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a> in a
browser and you will see the <tt class="docutils literal"><span class="pre">Hello</span> <span class="pre">World!</span></tt> message.</p>
<p>New to Python web programming? If so, some lines in the module merit
explanation:</p>
<ol class="arabic simple">
<li><em>Line 10</em>. The <tt class="docutils literal"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></tt> is Python's way of
saying &quot;Start here when running from the command line&quot;.</li>
<li><em>Lines 11-13</em>. Use Pyramid's <a class="reference internal" href="glossary.html#term-configurator"><em class="xref std std-term">configurator</em></a> to connect
<a class="reference internal" href="glossary.html#term-view"><em class="xref std std-term">view</em></a> code to a particular URL <a class="reference internal" href="glossary.html#term-route"><em class="xref std std-term">route</em></a>.</li>
<li><em>Lines 6-7</em>. Implement the view code that generates the
<a class="reference internal" href="glossary.html#term-response"><em class="xref std std-term">response</em></a>.</li>
<li><em>Lines 14-16</em>. Publish a <a class="reference internal" href="glossary.html#term-wsgi"><em class="xref std std-term">WSGI</em></a> app using an HTTP server.</li>
</ol>
<p>As shown in this example, the <a class="reference internal" href="glossary.html#term-configurator"><em class="xref std std-term">configurator</em></a> plays a central role
in Pyramid development. Building an application from loosely-coupled
parts via <a class="reference internal" href="narr/configuration.html"><em>Application Configuration</em></a> is a central idea in Pyramid,
one that we will revisit regurlarly in this <em>Quick Tour</em>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/hello_world.html#qtut-hello-world"><em>Quick Tutorial Hello World</em></a>,
<a class="reference internal" href="narr/firstapp.html#firstapp-chapter"><em>Creating Your First Pyramid Application</em></a>, and
<a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid-tutorials/en/latest/single_file_tasks/single_file_tasks.html#single-file-tutorial" title="(in Pyramid Tutorials v0.1)"><em class="xref std std-ref">Single File Tasks tutorial</em></a></p>
</div>
</div>
<div class="section" id="handling-web-requests-and-responses">
<h2>Handling Web Requests and Responses<a class="headerlink" href="#handling-web-requests-and-responses" title="Permalink to this headline">¶</a></h2>
<p>Developing for the web means processing web requests. As this is a
critical part of a web application, web developers need a robust,
mature set of software for web requests.</p>
<p>Pyramid has always fit nicely into the existing world of Python web
development (virtual environments, packaging, scaffolding,
first to embrace Python 3, etc.) For request handling, Pyramid turned
to the well-regarded <a class="reference internal" href="glossary.html#term-webob"><em class="xref std std-term">WebOb</em></a> Python library for request and
response handling. In our example
above, Pyramid hands <tt class="docutils literal"><span class="pre">hello_world</span></tt> a <tt class="docutils literal"><span class="pre">request</span></tt> that is
<a class="reference internal" href="narr/webob.html#webob-chapter"><em>based on WebOb</em></a>.</p>
<p>Let's see some features of requests and responses in action:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Some parameters from a request such as /?name=lisa</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;No Name Provided&#39;</span><span class="p">)</span>

    <span class="n">body</span> <span class="o">=</span> <span class="s">&#39;URL </span><span class="si">%s</span><span class="s"> with name: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
        <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;text/plain&quot;</span><span class="p">,</span>
        <span class="n">body</span><span class="o">=</span><span class="n">body</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>In this Pyramid view, we get the URL being visited from <tt class="docutils literal"><span class="pre">request.url</span></tt>.
Also, if you visited <tt class="docutils literal"><span class="pre">http://localhost:6543/?name=alice</span></tt>,
the name is included in the body of the response:</p>
<div class="highlight-python"><div class="highlight"><pre>URL http://localhost:6543/?name=alice with name: alice
</pre></div>
</div>
<p>Finally, we set the response's content type and return the Response.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/request_response.html#qtut-request-response"><em>Quick Tutorial Request and Response</em></a>
and
<a class="reference internal" href="narr/webob.html#webob-chapter"><em>Request and Response Objects</em></a></p>
</div>
</div>
<div class="section" id="views">
<h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>For the examples above, the <tt class="docutils literal"><span class="pre">hello_world</span></tt> function is a &quot;view&quot;. In
Pyramid, views are the primary way to accept web requests and return
responses.</p>
<p>So far our examples place everything in one file:</p>
<ul class="simple">
<li>the view function</li>
<li>its registration with the configurator</li>
<li>the route to map it to a URL</li>
<li>the WSGI application launcher</li>
</ul>
<p>Let's move the views out to their own <tt class="docutils literal"><span class="pre">views.py</span></tt> module and change
the <tt class="docutils literal"><span class="pre">app.py</span></tt> to scan that module, looking for decorators that set up
the views. First, our revised <tt class="docutils literal"><span class="pre">app.py</span></tt>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;/howdy&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;redirect&#39;</span><span class="p">,</span> <span class="s">&#39;/goto&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;exception&#39;</span><span class="p">,</span> <span class="s">&#39;/problem&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s">&#39;views&#39;</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">6543</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>We added some more routes, but we also removed the view code.
Our views and their registrations (via decorators) are now in a module
<tt class="docutils literal"><span class="pre">views.py</span></tt>, which is scanned via <tt class="docutils literal"><span class="pre">config.scan('views')</span></tt>.</p>
<p>We now have a <tt class="docutils literal"><span class="pre">views.py</span></tt> module that is focused on handling requests
and responses:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>


<span class="c"># First view, available at http://localhost:6543/</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;home&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s">&#39;&lt;p&gt;Visit &lt;a href=&quot;/howdy?name=lisa&quot;&gt;hello&lt;/a&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>


<span class="c"># /howdy?name=alice which links to the next view</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;No Name&#39;</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="s">&#39;&lt;p&gt;Hi </span><span class="si">%s</span><span class="s">, this &lt;a href=&quot;/goto&quot;&gt;redirects&lt;/a&gt;&lt;/p&gt;&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">body</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>


<span class="c"># /goto which issues HTTP redirect to the last view</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;redirect&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">redirect_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s">&quot;/problem&quot;</span><span class="p">)</span>


<span class="c"># /problem which causes an site error</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;exception&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">exception_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>We have 4 views, each leading to the other. If you start at
<tt class="docutils literal"><span class="pre">http://localhost:6543/</span></tt>, you get a response with a link to the next
view. The <tt class="docutils literal"><span class="pre">hello_view</span></tt> (available at the URL <tt class="docutils literal"><span class="pre">/howdy</span></tt>) has a link
to the <tt class="docutils literal"><span class="pre">redirect_view</span></tt>, which issues a redirect to the final
view.</p>
<p>Earlier we saw <tt class="docutils literal"><span class="pre">config.add_view</span></tt> as one way to configure a view. This
section introduces <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt>. Pyramid's configuration supports
<a class="reference internal" href="glossary.html#term-imperative-configuration"><em class="xref std std-term">imperative configuration</em></a>, such as the <tt class="docutils literal"><span class="pre">config.add_view</span></tt> in
the previous example. You can also use <a class="reference internal" href="glossary.html#term-declarative-configuration"><em class="xref std std-term">declarative
configuration</em></a>, in which a Python <a class="reference internal" href="glossary.html#term-decorator"><em class="xref std std-term">decorator</em></a> is placed on the
line above the view. Both approaches result in the same final
configuration, thus usually, it is simply a matter of taste.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/views.html#qtut-views"><em>Quick Tutorial Views</em></a>,
<a class="reference internal" href="narr/views.html"><em>Views</em></a>,
<a class="reference internal" href="narr/viewconfig.html"><em>View Configuration</em></a>, and
<a class="reference internal" href="narr/viewconfig.html#debugging-view-configuration"><em>Debugging View Configuration</em></a></p>
</div>
</div>
<div class="section" id="routing">
<h2>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h2>
<p>Writing web applications usually means sophisticated URL design. We
just saw some Pyramid machinery for requests and views. Let's look at
features that help in routing.</p>
<p>Above we saw the basics of routing URLs to views in Pyramid:</p>
<ul class="simple">
<li>Your project's &quot;setup&quot; code registers a route name to be used when
matching part of the URL</li>
<li>Elsewhere, a view is configured to be called for that route name</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Why do this twice? Other Python web frameworks let you create a
route and associate it with a view in one step. As
illustrated in <a class="reference internal" href="designdefense.html#routes-need-ordering"><em>Routes Need Relative Ordering</em></a>, multiple routes might
match the same URL pattern. Rather than provide ways to help guess,
Pyramid lets you be explicit in ordering. Pyramid also gives
facilities to avoid the problem.</p>
</div>
<p>What if we want part of the URL to be available as data in my view? This
route declaration:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="s">&#39;/howdy/{first}/{last}&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With this, URLs such as <tt class="docutils literal"><span class="pre">/howdy/amy/smith</span></tt> will assign <tt class="docutils literal"><span class="pre">amy</span></tt> to
<tt class="docutils literal"><span class="pre">first</span></tt> and <tt class="docutils literal"><span class="pre">smith</span></tt> to <tt class="docutils literal"><span class="pre">last</span></tt>. We can then use this data in our
view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="s">&#39;&lt;h1&gt;Hi </span><span class="si">%(first)s</span><span class="s"> </span><span class="si">%(last)s</span><span class="s">!&lt;/h1&gt;&#39;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">request.matchdict</span></tt> contains values from the URL that match the
&quot;replacement patterns&quot; (the curly braces) in the route declaration.
This information can then be used in your view.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/routing.html#qtut-routing"><em>Quick Tutorial Routing</em></a>,
<a class="reference internal" href="narr/urldispatch.html"><em>URL Dispatch</em></a>,
<a class="reference internal" href="narr/urldispatch.html#debug-routematch-section"><em>Debugging Route Matching</em></a>, and
<a class="reference internal" href="narr/router.html"><em>Request Processing</em></a></p>
</div>
</div>
<div class="section" id="templating">
<h2>Templating<a class="headerlink" href="#templating" title="Permalink to this headline">¶</a></h2>
<p>Ouch. We have been making our own <tt class="docutils literal"><span class="pre">Response</span></tt> and filling the response
body with HTML. You usually won't embed an HTML string directly in
Python, but instead, will use a templating language.</p>
<p>Pyramid doesn't mandate a particular database system, form library,
etc. It encourages replaceability. This applies equally to templating,
which is fortunate: developers have strong views about template
languages. That said, the Pylons Project officially supports bindings for
Chameleon, Jinja2, and Mako, so in this step, let's use Chameleon.</p>
<p>Let's add <tt class="docutils literal"><span class="pre">pyramid_chameleon</span></tt>, a Pyramid <a class="reference internal" href="glossary.html#term-add-on"><em class="xref std std-term">add-on</em></a> which enables
Chameleon as a <a class="reference internal" href="glossary.html#term-renderer"><em class="xref std std-term">renderer</em></a> in our Pyramid applications:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>easy_install pyramid_chameleon
</pre></div>
</div>
<p>With the package installed, we can include the template bindings into
our configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now lets change our views.py file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;hello_world.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Ahh, that looks better. We have a view that is focused on Python code.
Our <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> decorator specifies a <a class="reference internal" href="glossary.html#term-renderer"><em class="xref std std-term">renderer</em></a> that points
to our template file. Our view then simply returns data which is then
supplied to our template:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Quick Glance<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Hello ${name}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Since our view returned <tt class="docutils literal"><span class="pre">dict(name=request.matchdict['name'])</span></tt>,
we can use <tt class="docutils literal"><span class="pre">name</span></tt> as a variable in our template via
<tt class="docutils literal"><span class="pre">${name}</span></tt>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/templating.html#qtut-templating"><em>Quick Tutorial Templating</em></a>,
<a class="reference internal" href="narr/templates.html"><em>Templates</em></a>,
<a class="reference internal" href="narr/templates.html#debugging-templates"><em>Debugging Templates</em></a>, and
<a class="reference internal" href="narr/templates.html#available-template-system-bindings"><em>Available Add-On Template System Bindings</em></a></p>
</div>
</div>
<div class="section" id="templating-with-jinja2">
<h2>Templating With <tt class="docutils literal"><span class="pre">jinja2</span></tt><a class="headerlink" href="#templating-with-jinja2" title="Permalink to this headline">¶</a></h2>
<p>We just said Pyramid doesn't prefer one templating language over
another. Time to prove it. Jinja2 is a popular templating system,
modelled after Django's templates. Let's add <tt class="docutils literal"><span class="pre">pyramid_jinja2</span></tt>,
a Pyramid <a class="reference internal" href="glossary.html#term-add-on"><em class="xref std std-term">add-on</em></a> which enables Jinja2 as a <a class="reference internal" href="glossary.html#term-renderer"><em class="xref std std-term">renderer</em></a> in
our Pyramid applications:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>easy_install pyramid_jinja2
</pre></div>
</div>
<p>With the package installed, we can include the template bindings into
our configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_jinja2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The only change in our view is to point the renderer at the <tt class="docutils literal"><span class="pre">.jinja2</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre>@view_config(route_name=&#39;hello&#39;, renderer=&#39;hello_world.jinja2&#39;)
</pre></div>
</div>
<p>Our Jinja2 template is very similar to our previous template:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello World<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Hello {{ name }}!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Pyramid's templating add-ons register a new kind of renderer into your
application. The renderer registration maps to different kinds of
filename extensions. In this case, changing the extension from <tt class="docutils literal"><span class="pre">.pt</span></tt>
to <tt class="docutils literal"><span class="pre">.jinja2</span></tt> passed the view response through the <tt class="docutils literal"><span class="pre">pyramid_jinja2</span></tt>
renderer.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/jinja2.html#qtut-jinja2"><em>Quick Tutorial Jinja2</em></a>,
<a class="reference external" href="http://jinja.pocoo.org/">Jinja2 homepage</a>, and
<a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid-jinja2/en/latest/index.html#overview" title="(in pyramid_jinja2 v2.3.3)"><em class="xref std std-ref">pyramid_jinja2 Overview</em></a></p>
</div>
</div>
<div class="section" id="static-assets">
<h2>Static Assets<a class="headerlink" href="#static-assets" title="Permalink to this headline">¶</a></h2>
<p>Of course the Web is more than just markup. You need static assets:
CSS, JS, and images. Let's point our web app at a directory where
Pyramid will serve some static assets. First, another call to the
<a class="reference internal" href="glossary.html#term-configurator"><em class="xref std std-term">configurator</em></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This tells our WSGI application to map requests under
<tt class="docutils literal"><span class="pre">http://localhost:6543/static/</span></tt> to files and directories inside a
<tt class="docutils literal"><span class="pre">static</span></tt> directory alongside our Python module.</p>
<p>Next, make a directory <tt class="docutils literal"><span class="pre">static</span></tt> and place <tt class="docutils literal"><span class="pre">app.css</span></tt> inside:</p>
<div class="highlight-css"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">2em</span><span class="p">;</span>
    <span class="k">font-family</span><span class="o">:</span> <span class="k">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All we need to do now is point to it in the <tt class="docutils literal"><span class="pre">&lt;head&gt;</span></tt> of our Jinja2
template:</p>
<div class="highlight-html"><div class="highlight"><pre>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;/static/app.css&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>This link presumes that our CSS is at a URL starting with <tt class="docutils literal"><span class="pre">/static/</span></tt>.
What if the site is later moved under <tt class="docutils literal"><span class="pre">/somesite/static/</span></tt>? Or perhaps
a web developer changes the arrangement on disk? Pyramid provides a helper
to allow flexibility on URL generation:</p>
<div class="highlight-html"><div class="highlight"><pre>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
          <span class="na">href=</span><span class="s">&quot;${request.static_url(&#39;static/app.css&#39;)}&quot;</span>
     <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>By using <tt class="docutils literal"><span class="pre">request.static_url</span></tt> to generate the full URL to the static
assets, you both ensure you stay in sync with the configuration and
gain refactoring flexibility later.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/static_assets.html#qtut-static-assets"><em>Quick Tutorial Static Assets</em></a>,
<a class="reference internal" href="narr/assets.html"><em>Static Assets</em></a>,
<a class="reference internal" href="narr/environment.html#preventing-http-caching"><em>Preventing HTTP Caching</em></a>, and
<a class="reference internal" href="narr/viewconfig.html#influencing-http-caching"><em>Influencing HTTP Caching</em></a></p>
</div>
</div>
<div class="section" id="returning-json">
<h2>Returning JSON<a class="headerlink" href="#returning-json" title="Permalink to this headline">¶</a></h2>
<p>Modern web apps are more than rendered HTML. Dynamic pages now use
JavaScript to update the UI in the browser by requesting server data as
JSON. Pyramid supports this with a JSON renderer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;hello_json&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_json</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="c"># End View 1</span>
</pre></div>
</div>
<p>This wires up a view that returns some data through the JSON
<a class="reference internal" href="glossary.html#term-renderer"><em class="xref std std-term">renderer</em></a>, which calls Python's JSON support to serialize the data
into JSON and set the appropriate HTTP headers.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/json.html#qtut-json"><em>Quick Tutorial JSON</em></a>,
<a class="reference internal" href="narr/renderers.html#views-which-use-a-renderer"><em>Writing View Callables Which Use a Renderer</em></a>,
<a class="reference internal" href="narr/renderers.html#json-renderer"><em>JSON Renderer</em></a>, and
<a class="reference internal" href="narr/renderers.html#adding-and-overriding-renderers"><em>Adding and Changing Renderers</em></a></p>
</div>
</div>
<div class="section" id="view-classes">
<h2>View Classes<a class="headerlink" href="#view-classes" title="Permalink to this headline">¶</a></h2>
<p>So far our views have been simple, free-standing functions. Many times
your views are related: different ways to look at or work on the same
data or a REST API that handles multiple operations. Grouping these
together as a
<a class="reference internal" href="narr/views.html#class-as-view"><em>view class</em></a> makes sense:</p>
<ul class="simple">
<li>Group views</li>
<li>Centralize some repetitive defaults</li>
<li>Share some state and helpers</li>
</ul>
<p>The following shows a &quot;Hello World&quot; example with three operations: view
a form, save a change, or press the delete button:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># One route, at /howdy/amy, so don&#39;t repeat on each @view_config</span>
<span class="nd">@view_defaults</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HelloWorldViews</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="c"># Our templates can now say {{ view.name }}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

    <span class="c"># Retrieving /howdy/amy the first time</span>
    <span class="nd">@view_config</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s">&#39;hello.jinja2&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">hello_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c"># Posting to /howdy/amy via the &quot;Edit&quot; submit button</span>
    <span class="nd">@view_config</span><span class="p">(</span><span class="n">request_param</span><span class="o">=</span><span class="s">&#39;form.edit&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;edit.jinja2&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">edit_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Edited&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c"># Posting to /howdy/amy via the &quot;Delete&quot; submit button</span>
    <span class="nd">@view_config</span><span class="p">(</span><span class="n">request_param</span><span class="o">=</span><span class="s">&#39;form.delete&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;delete.jinja2&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Deleted&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
<p>As you can see, the three views are logically grouped together.
Specifically:</p>
<ul class="simple">
<li>The first view is returned when you go to <tt class="docutils literal"><span class="pre">/howdy/amy</span></tt>. This URL is
mapped to the <tt class="docutils literal"><span class="pre">hello</span></tt> route that we centrally set using the optional
<tt class="docutils literal"><span class="pre">&#64;view_defaults</span></tt>.</li>
<li>The second view is returned when the form data contains a field with
<tt class="docutils literal"><span class="pre">form.edit</span></tt>, such as clicking on
<tt class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">type=&quot;submit&quot;</span> <span class="pre">name=&quot;form.edit&quot;</span> <span class="pre">value=&quot;Save&quot;/&gt;</span></tt>. This rule
is specified in the <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> for that view.</li>
<li>The third view is returned when clicking on a button such
as <tt class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">type=&quot;submit&quot;</span> <span class="pre">name=&quot;form.delete&quot;</span> <span class="pre">value=&quot;Delete&quot;/&gt;</span></tt>.</li>
</ul>
<p>Only one route needed, stated in one place atop the view class. Also,
the assignment of the <tt class="docutils literal"><span class="pre">name</span></tt> is done in the <tt class="docutils literal"><span class="pre">__init__</span></tt>. Our
templates can then use <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">view.name</span> <span class="pre">}}</span></tt>.</p>
<p>Pyramid view classes, combined with built-in and custom predicates,
have much more to offer:</p>
<ul class="simple">
<li>All the same view configuration parameters as function views</li>
<li>One route leading to multiple views, based on information in the
request or data such as <tt class="docutils literal"><span class="pre">request_param</span></tt>, <tt class="docutils literal"><span class="pre">request_method</span></tt>,
<tt class="docutils literal"><span class="pre">accept</span></tt>, <tt class="docutils literal"><span class="pre">header</span></tt>, <tt class="docutils literal"><span class="pre">xhr</span></tt>, <tt class="docutils literal"><span class="pre">containment</span></tt>, and
<tt class="docutils literal"><span class="pre">custom_predicates</span></tt></li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/view_classes.html#qtut-view-classes"><em>Quick Tutorial View Classes</em></a>,
<a class="reference internal" href="quick_tutorial/more_view_classes.html#qtut-more-view-classes"><em>Quick Tutorial More View Classes</em></a>, and
<a class="reference internal" href="narr/views.html#class-as-view"><em>Defining a View Callable as a Class</em></a></p>
</div>
</div>
<div class="section" id="quick-project-startup-with-scaffolds">
<h2>Quick Project Startup with Scaffolds<a class="headerlink" href="#quick-project-startup-with-scaffolds" title="Permalink to this headline">¶</a></h2>
<p>So far we have done all of our <em>Quick Tour</em> as a single Python file.
No Python packages, no structure. Most Pyramid projects, though,
aren't developed this way.</p>
<p>To ease the process of getting started, Pyramid provides <em>scaffolds</em>
that generate sample projects from templates in Pyramid and Pyramid
add-ons. Pyramid's <tt class="docutils literal"><span class="pre">pcreate</span></tt> command can list the available scaffolds:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pcreate --list
Available scaffolds:
  alchemy:                 Pyramid SQLAlchemy project using url dispatch
  pyramid_jinja2_starter:  pyramid jinja2 starter project
  starter:                 Pyramid starter project
  zodb:                    Pyramid ZODB project using traversal
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">pyramid_jinja2</span></tt> add-on gave us a scaffold that we can use. From
the parent directory of where we want our Python package to be generated,
let's use that scaffold to make our project:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pcreate --scaffold pyramid_jinja2_starter hello_world
</pre></div>
</div>
<p>We next use the normal Python command to set up our package for
development:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>hello_world
<span class="nv">$ </span>python ./setup.py develop
</pre></div>
</div>
<p>We are moving in the direction of a full-featured Pyramid project,
with a proper setup for Python standards (packaging) and Pyramid
configuration. This includes a new way of running your application:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pserve development.ini
</pre></div>
</div>
<p>Let's look at <tt class="docutils literal"><span class="pre">pserve</span></tt> and configuration in more depth.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/scaffolds.html#qtut-scaffolds"><em>Quick Tutorial Scaffolds</em></a>,
<a class="reference internal" href="narr/project.html#project-narr"><em>Creating a Pyramid Project</em></a>, and
<a class="reference internal" href="narr/scaffolding.html"><em>Creating Pyramid Scaffolds</em></a></p>
</div>
</div>
<div class="section" id="application-running-with-pserve">
<h2>Application Running with <tt class="docutils literal"><span class="pre">pserve</span></tt><a class="headerlink" href="#application-running-with-pserve" title="Permalink to this headline">¶</a></h2>
<p>Prior to scaffolds, our project mixed a number of operations details
into our code. Why should my main code care which HTTP server I want and
what port number to run on?</p>
<p><tt class="docutils literal"><span class="pre">pserve</span></tt> is Pyramid's application runner, separating operational
details from your code. When you install Pyramid, a small command
program called <tt class="docutils literal"><span class="pre">pserve</span></tt> is written to your <tt class="docutils literal"><span class="pre">bin</span></tt> directory. This
program is an executable Python module. It's very small, getting most
of its brains via import.</p>
<p>You can run <tt class="docutils literal"><span class="pre">pserve</span></tt> with <tt class="docutils literal"><span class="pre">--help</span></tt> to see some of its options.
Doing so reveals that you can ask <tt class="docutils literal"><span class="pre">pserve</span></tt> to watch your development
files and reload the server when they change:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pserve development.ini --reload
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">pserve</span></tt> command has a number of other options and operations.
Most of the work, though, comes from your project's wiring, as
expressed in the configuration file you supply to <tt class="docutils literal"><span class="pre">pserve</span></tt>. Let's
take a look at this configuration file.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="narr/project.html#what-is-this-pserve-thing"><em>What Is This pserve Thing</em></a></p>
</div>
</div>
<div class="section" id="configuration-with-ini-files">
<h2>Configuration with <tt class="docutils literal"><span class="pre">.ini</span></tt> Files<a class="headerlink" href="#configuration-with-ini-files" title="Permalink to this headline">¶</a></h2>
<p>Earlier in <em>Quick Tour</em> we first met Pyramid's configuration system.
At that point we did all configuration in Python code. For example,
the port number chosen for our HTTP server was right there in Python
code. Our scaffold has moved this decision, and more, into the
<tt class="docutils literal"><span class="pre">development.ini</span></tt> file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="c1"># Start Includes</span>
<span class="k">[app:hello_world]</span>
<span class="na">pyramid.includes</span> <span class="o">=</span> <span class="s">pyramid_debugtoolbar</span>
<span class="c1"># End Includes</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:hello_world</span>
<span class="na">reload_templates</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">debug_authorization</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">debug_notfound</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">debug_routematch</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">debug_templates</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">default_locale_name</span> <span class="o">=</span> <span class="s">en</span>
<span class="na">jinja2.directories</span> <span class="o">=</span> <span class="s">hello_world:templates</span>

<span class="k">[pipeline:main]</span>
<span class="na">pipeline</span> <span class="o">=</span><span class="s"></span>
<span class="s">    hello_world</span>

<span class="k">[server:main]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:pyramid#wsgiref</span>
<span class="na">host</span> <span class="o">=</span> <span class="s">0.0.0.0</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">6543</span>

<span class="c1"># Begin logging configuration</span>

<span class="c1"># Start Sphinx Include</span>
<span class="k">[loggers]</span>
<span class="na">keys</span> <span class="o">=</span> <span class="s">root, hello_world</span>

<span class="k">[logger_hello_world]</span>
<span class="na">level</span> <span class="o">=</span> <span class="s">DEBUG</span>
<span class="na">handlers</span> <span class="o">=</span>
<span class="na">qualname</span> <span class="o">=</span> <span class="s">hello_world</span>
<span class="c1"># End Sphinx Include</span>

<span class="k">[handlers]</span>
<span class="na">keys</span> <span class="o">=</span> <span class="s">console</span>

<span class="k">[formatters]</span>
<span class="na">keys</span> <span class="o">=</span> <span class="s">generic</span>

<span class="k">[logger_root]</span>
<span class="na">level</span> <span class="o">=</span> <span class="s">INFO</span>
<span class="na">handlers</span> <span class="o">=</span> <span class="s">console</span>

<span class="k">[handler_console]</span>
<span class="na">class</span> <span class="o">=</span> <span class="s">StreamHandler</span>
<span class="na">args</span> <span class="o">=</span> <span class="s">(sys.stderr,)</span>
<span class="na">level</span> <span class="o">=</span> <span class="s">NOTSET</span>
<span class="na">formatter</span> <span class="o">=</span> <span class="s">generic</span>

<span class="k">[formatter_generic]</span>
<span class="na">format</span> <span class="o">=</span> <span class="s">%(asctime)s %(levelname)-5.5s [%(name)s][%(threadName)s] %(message)s</span>

<span class="c1"># End logging configuration</span>
</pre></div>
</div>
<p>Let's take a quick high-level look. First, the <tt class="docutils literal"><span class="pre">.ini</span></tt> file is divided
into sections:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">[app:hello_world]</span></tt> configures our WSGI app</li>
<li><tt class="docutils literal"><span class="pre">[pipeline:main]</span></tt> sets up our WSGI &quot;pipeline&quot;</li>
<li><tt class="docutils literal"><span class="pre">[server:main]</span></tt> holds our WSGI server settings</li>
<li>Various sections afterwards configure our Python logging system</li>
</ul>
<p>We have a few decisions made for us in this configuration:</p>
<ol class="arabic simple">
<li><em>Choice of web server</em>. The <tt class="docutils literal"><span class="pre">use</span> <span class="pre">=</span> <span class="pre">egg:pyramid#wsgiref</span></tt> tells
<tt class="docutils literal"><span class="pre">pserve</span></tt> to use the <tt class="docutils literal"><span class="pre">wsgiref</span></tt> server that is wrapped in the Pyramid
package.</li>
<li><em>Port number</em>. <tt class="docutils literal"><span class="pre">port</span> <span class="pre">=</span> <span class="pre">6543</span></tt> tells <tt class="docutils literal"><span class="pre">wsgiref</span></tt> to listen on port
6543.</li>
<li><em>WSGI app</em>. What package has our WSGI application in it?
<tt class="docutils literal"><span class="pre">use</span> <span class="pre">=</span> <span class="pre">egg:hello_world</span></tt> in the app section tells the
configuration what application to load.</li>
<li><em>Easier development by automatic template reloading</em>. In development
mode, you shouldn't have to restart the server when editing a Jinja2
template. <tt class="docutils literal"><span class="pre">reload_templates</span> <span class="pre">=</span> <span class="pre">true</span></tt> sets this policy,
which might be different in production.</li>
</ol>
<p>Additionally, the <tt class="docutils literal"><span class="pre">development.ini</span></tt> generated by this scaffold wired
up Python's standard logging. We'll now see in the console, for example,
a log on every request that comes in, as well as traceback information.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/ini.html#qtut-ini"><em>Quick Tutorial Application Configuration</em></a>,
<a class="reference internal" href="narr/environment.html#environment-chapter"><em>Environment Variables and .ini File Settings</em></a> and
<a class="reference internal" href="narr/paste.html"><em>PasteDeploy Configuration Files</em></a></p>
</div>
</div>
<div class="section" id="easier-development-with-debugtoolbar">
<h2>Easier Development with <tt class="docutils literal"><span class="pre">debugtoolbar</span></tt><a class="headerlink" href="#easier-development-with-debugtoolbar" title="Permalink to this headline">¶</a></h2>
<p>As we introduce the basics, we also want to show how to be productive in
development and debugging. For example, we just discussed template
reloading and earlier we showed <tt class="docutils literal"><span class="pre">--reload</span></tt> for application reloading.</p>
<p><tt class="docutils literal"><span class="pre">pyramid_debugtoolbar</span></tt> is a popular Pyramid add-on which makes
several tools available in your browser. Adding it to your project
illustrates several points about configuration.</p>
<p>First, change your <tt class="docutils literal"><span class="pre">setup.py</span></tt> to say:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pyramid&gt;=1.0.2&#39;</span><span class="p">,</span> <span class="s">&#39;pyramid_jinja2&#39;</span><span class="p">,</span> <span class="s">&#39;pyramid_debugtoolbar&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>...and re-run your setup:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python ./setup.py develop
</pre></div>
</div>
<p>The Python package was now installed into our environment. The package
is a Pyramid add-on, which means we need to include its configuration
into our web application. We could do this with imperative
configuration, as we did above for the <tt class="docutils literal"><span class="pre">pyramid_jinja2</span></tt> add-on:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_jinja2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have a configuration file, we can use the
<tt class="docutils literal"><span class="pre">pyramid.includes</span></tt> facility and place this in our
<tt class="docutils literal"><span class="pre">development.ini</span></tt> instead:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[app:hello_world]</span>
<span class="na">pyramid.includes</span> <span class="o">=</span> <span class="s">pyramid_debugtoolbar</span>
</pre></div>
</div>
<p>You'll now see an attractive (and
collapsible) menu in the right of your browser, providing introspective
access to debugging information. Even better, if your web application
generates an error, you will see a nice traceback on the screen. When
you want to disable this toolbar, no need to change code: you can
remove it from <tt class="docutils literal"><span class="pre">pyramid.includes</span></tt> in the relevant <tt class="docutils literal"><span class="pre">.ini</span></tt>
configuration file.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/debugtoolbar.html#qtut-debugtoolbar"><em>Quick Tutorial
pyramid_debugtoolbar</em></a> and
<a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid-debugtoolbar/en/latest/index.html#overview" title="(in pyramid_debugtoolbar v2.2)"><em class="xref std std-ref">pyramid_debugtoolbar</em></a></p>
</div>
</div>
<div class="section" id="unit-tests-and-nose">
<h2>Unit Tests and <tt class="docutils literal"><span class="pre">nose</span></tt><a class="headerlink" href="#unit-tests-and-nose" title="Permalink to this headline">¶</a></h2>
<p>Yikes! We got this far and we haven't yet discussed tests. Particularly
egregious, as Pyramid has had a deep commitment to full test coverage
since before it was released.</p>
<p>Our <tt class="docutils literal"><span class="pre">pyramid_jinja2_starter</span></tt> scaffold generated a <tt class="docutils literal"><span class="pre">tests.py</span></tt> module
with one unit test in it. To run it, let's install the handy <tt class="docutils literal"><span class="pre">nose</span></tt>
test runner by editing <tt class="docutils literal"><span class="pre">setup.py</span></tt>. While we're at it, we'll throw in
the <tt class="docutils literal"><span class="pre">coverage</span></tt> tool which yells at us for code that isn't tested:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;hello_world&#39;</span><span class="p">,</span>
      <span class="c"># Some lines removed...</span>
      <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
          <span class="s">&#39;testing&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;nose&#39;</span><span class="p">,</span> <span class="s">&#39;coverage&#39;</span><span class="p">],</span>
      <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We changed <tt class="docutils literal"><span class="pre">setup.py</span></tt> which means we need to re-run
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">./setup.py</span> <span class="pre">develop</span></tt>. We can now run all our tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>nosetests hello_world/tests.py
.
Name                  Stmts   Miss  Cover   Missing
---------------------------------------------------
hello_world             12      8    33%   11-23
hello_world.models       5      1    80%   8
hello_world.tests       14      0   100%
hello_world.views        4      0   100%
---------------------------------------------------
TOTAL                    35      9    74%
----------------------------------------------------------------------
Ran 1 <span class="nb">test </span>in 0.931s

OK
</pre></div>
</div>
<p>Our unit test passed. What did our test look like?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">pyramid</span> <span class="kn">import</span> <span class="n">testing</span>
<span class="kn">from</span> <span class="nn">pyramid.i18n</span> <span class="kn">import</span> <span class="n">TranslationStringFactory</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">TranslationStringFactory</span><span class="p">(</span><span class="s">&#39;hello_world&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ViewTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_my_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">hello_world.views</span> <span class="kn">import</span> <span class="n">my_view</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">DummyRequest</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">],</span> <span class="s">&#39;hello_world&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pyramid supplies helpers for test writing, which we use in the
test setup and teardown. Our one test imports the view,
makes a dummy request, and sees if the view returns what we expected.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/unit_testing.html#qtut-unit-testing"><em>Quick Tutorial Unit Testing</em></a>,
<a class="reference internal" href="quick_tutorial/functional_testing.html#qtut-functional-testing"><em>Quick Tutorial Functional Testing</em></a>,
and
<a class="reference internal" href="narr/testing.html#testing-chapter"><em>Unit, Integration, and Functional Testing</em></a></p>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>It's important to know what is going on inside our web application.
In development we might need to collect some output. In production,
we might need to detect situations when other people use the site. We
need <em>logging</em>.</p>
<p>Fortunately Pyramid uses the normal Python approach to logging. The
scaffold generated in your <tt class="docutils literal"><span class="pre">development.ini</span></tt> has a number of lines that
configure the logging for you to some reasonable defaults. You then see
messages sent by Pyramid (for example, when a new request comes in).</p>
<p>Maybe you would like to log messages in your code? In your Python
module, import and set up the logging:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now, in your code, log messages:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Some Message&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will log <tt class="docutils literal"><span class="pre">Some</span> <span class="pre">Message</span></tt> at a <tt class="docutils literal"><span class="pre">debug</span></tt> log level,
to the application-configured logger in your <tt class="docutils literal"><span class="pre">development.ini</span></tt>. What
controls that? These sections in the configuration file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[loggers]</span>
<span class="na">keys</span> <span class="o">=</span> <span class="s">root, hello_world</span>

<span class="k">[logger_hello_world]</span>
<span class="na">level</span> <span class="o">=</span> <span class="s">DEBUG</span>
<span class="na">handlers</span> <span class="o">=</span>
<span class="na">qualname</span> <span class="o">=</span> <span class="s">hello_world</span>
</pre></div>
</div>
<p>Our application, a package named <tt class="docutils literal"><span class="pre">hello_world</span></tt>, is set up as a logger
and configured to log messages at a <tt class="docutils literal"><span class="pre">DEBUG</span></tt> or higher level. When you
visit <tt class="docutils literal"><span class="pre">http://localhost:6543</span></tt> your console will now show:</p>
<div class="highlight-python"><div class="highlight"><pre>2013-08-09 10:42:42,968 DEBUG [hello_world.views][MainThread] Some Message
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/logging.html#qtut-logging"><em>Quick Tutorial Logging</em></a> and
<a class="reference internal" href="narr/logging.html#logging-chapter"><em>Logging</em></a></p>
</div>
</div>
<div class="section" id="sessions">
<h2>Sessions<a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a></h2>
<p>When people use your web application, they frequently perform a task
that requires semi-permanent data to be saved. For example, a shopping
cart. This is called a <a class="reference internal" href="glossary.html#term-session"><em class="xref std std-term">session</em></a>.</p>
<p>Pyramid has basic built-in support for sessions.  Third party packages such as
<tt class="docutils literal"><span class="pre">pyramid_redis_sessions</span></tt> provide richer session support.  Or you can create
your own custom sessioning engine.  Let's take a look at the
<a class="reference internal" href="narr/sessions.html"><em>built-in sessioning support</em></a>. In our
<tt class="docutils literal"><span class="pre">__init__.py</span></tt> we first import the kind of sessioning we want:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.session</span> <span class="kn">import</span> <span class="n">SignedCookieSessionFactory</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As noted in the session docs, this example implementation is
not intended for use in settings with security implications.</p>
</div>
<p>Now make a &quot;factory&quot; and pass it to the <a class="reference internal" href="glossary.html#term-configurator"><em class="xref std std-term">configurator</em></a>'s
<tt class="docutils literal"><span class="pre">session_factory</span></tt> argument:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">my_session_factory</span> <span class="o">=</span> <span class="n">SignedCookieSessionFactory</span><span class="p">(</span><span class="s">&#39;itsaseekreet&#39;</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">root_factory</span><span class="o">=</span><span class="n">get_root</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
                          <span class="n">session_factory</span><span class="o">=</span><span class="n">my_session_factory</span><span class="p">)</span>
</pre></div>
</div>
<p>Pyramid's <a class="reference internal" href="glossary.html#term-request"><em class="xref std std-term">request</em></a> object now has a <tt class="docutils literal"><span class="pre">session</span></tt> attribute
that we can use in our view code:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span>
    <span class="k">if</span> <span class="s">&#39;counter&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s">&#39;counter&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s">&#39;counter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>With this, each reload will increase the counter displayed in our
Jinja2 template:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="x">          &lt;p&gt;Counter: </span><span class="cp">{{</span> <span class="nv">request.session.counter</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/sessions.html#qtut-sessions"><em>Quick Tutorial Sessions</em></a>,
<a class="reference internal" href="narr/sessions.html#sessions-chapter"><em>Sessions</em></a>, <a class="reference internal" href="narr/sessions.html#flash-messages"><em>Flash Messages</em></a>,
<a class="reference internal" href="api/session.html#session-module"><em>pyramid.session</em></a>, and <a class="reference internal" href="glossary.html#term-pyramid-redis-sessions"><em class="xref std std-term">pyramid_redis_sessions</em></a>.</p>
</div>
</div>
<div class="section" id="databases">
<h2>Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h2>
<p>Web applications mean data. Data means databases. Frequently SQL
databases. SQL databases frequently mean an &quot;ORM&quot;
(object-relational mapper.) In Python, ORM usually leads to the
mega-quality <em>SQLAlchemy</em>, a Python package that greatly eases working
with databases.</p>
<p>Pyramid and SQLAlchemy are great friends. That friendship includes a
scaffold!</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pcreate --scaffold alchemy sqla_demo
<span class="nv">$ </span><span class="nb">cd </span>sqla_demo
<span class="nv">$ </span>python setup.py develop
</pre></div>
</div>
<p>We now have a working sample SQLAlchemy application with all
dependencies installed. The sample project provides a console script to
initialize a SQLite database with tables. Let's run it and then start
the application:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>initialize_sqla_demo_db development.ini
<span class="nv">$ </span>pserve development.ini
</pre></div>
</div>
<p>The ORM eases the mapping of database structures into a programming
language. SQLAlchemy uses &quot;models&quot; for this mapping. The scaffold
generated a sample model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;models&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<p>View code, which mediates the logic between web requests and the rest
of the system, can then easily get at the data thanks to SQLAlchemy:</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">one</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;one&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/databases.html#qtut-databases"><em>Quick Tutorial Databases</em></a>,
<a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a>,
<a class="reference internal" href="narr/commandline.html#making-a-console-script"><em>Making Your Script into a Console Script</em></a>,
<a class="reference internal" href="tutorials/wiki2/index.html#bfg-sql-wiki-tutorial"><em>SQLAlchemy + URL Dispatch Wiki Tutorial</em></a>, and
<a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid_tm/en/latest/index.html#overview" title="(in pyramid_tm v0.7)"><em class="xref std std-ref">Application Transactions With pyramid_tm</em></a></p>
</div>
</div>
<div class="section" id="forms">
<h2>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h2>
<p>Developers have lots of opinions about web forms, and thus there are many
form libraries for Python. Pyramid doesn't directly bundle a form
library, but <em>Deform</em> is a popular choice for forms,
along with its related <em>Colander</em> schema system.</p>
<p>As an example, imagine we want a form that edits a wiki page. The form
should have two fields on it, one of them a required title and the
other a rich text editor for the body. With Deform we can express this
as a Colander schema:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">WikiPage</span><span class="p">(</span><span class="n">colander</span><span class="o">.</span><span class="n">MappingSchema</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">colander</span><span class="o">.</span><span class="n">SchemaNode</span><span class="p">(</span><span class="n">colander</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">colander</span><span class="o">.</span><span class="n">SchemaNode</span><span class="p">(</span>
        <span class="n">colander</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">deform</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">RichTextWidget</span><span class="p">()</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>With this in place, we can render the HTML for a form,
perhaps with form data from an existing page:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiki_form</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
<p>We'd like to handle form submission, validation, and saving:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get the form data that was posted</span>
<span class="n">controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c"># Validate and either raise a validation error</span>
    <span class="c"># or return deserialized data from widgets</span>
    <span class="n">appstruct</span> <span class="o">=</span> <span class="n">wiki_form</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span>
<span class="k">except</span> <span class="n">deform</span><span class="o">.</span><span class="n">ValidationFailure</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># Bail out and render form with errors</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>

<span class="c"># Change the content and redirect to the view</span>
<span class="n">page</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">appstruct</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
<span class="n">page</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">appstruct</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Deform and Colander provide a very flexible combination for forms,
widgets, schemas, and validation. Recent versions of Deform also
include a <a class="reference external" href="http://docs.pylonsproject.org/projects/deform/en/latest/retail.html#retail" title="(in deform v0.9.9)"><em class="xref std std-ref">retail mode</em></a> for gaining Deform
features on custom forms.</p>
<p>Also, the <tt class="docutils literal"><span class="pre">deform_bootstrap</span></tt> Pyramid add-on restyles the stock Deform
widgets using attractive CSS from Bootstrap and more powerful widgets
from Chosen.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also:
<a class="reference internal" href="quick_tutorial/forms.html#qtut-forms"><em>Quick Tutorial Forms</em></a>,
<a class="reference external" href="http://docs.pylonsproject.org/projects/deform/en/latest/index.html#overview" title="(in deform v0.9.9)"><em class="xref std std-ref">Deform</em></a>,
<a class="reference external" href="http://docs.pylonsproject.org/projects/colander/en/latest/index.html#overview" title="(in colander v1.0b1)"><em class="xref std std-ref">Colander</em></a>, and
<a class="reference external" href="https://pypi.python.org/pypi/deform_bootstrap">deform_bootstrap</a></p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This <em>Quick Tour</em> covered a little about a lot. We introduced a long list
of concepts in Pyramid, many of which are expanded on more fully in the
Pyramid developer docs.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quick Tour of Pyramid</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#hello-world">Hello World</a></li>
<li><a class="reference internal" href="#handling-web-requests-and-responses">Handling Web Requests and Responses</a></li>
<li><a class="reference internal" href="#views">Views</a></li>
<li><a class="reference internal" href="#routing">Routing</a></li>
<li><a class="reference internal" href="#templating">Templating</a></li>
<li><a class="reference internal" href="#templating-with-jinja2">Templating With <tt class="docutils literal"><span class="pre">jinja2</span></tt></a></li>
<li><a class="reference internal" href="#static-assets">Static Assets</a></li>
<li><a class="reference internal" href="#returning-json">Returning JSON</a></li>
<li><a class="reference internal" href="#view-classes">View Classes</a></li>
<li><a class="reference internal" href="#quick-project-startup-with-scaffolds">Quick Project Startup with Scaffolds</a></li>
<li><a class="reference internal" href="#application-running-with-pserve">Application Running with <tt class="docutils literal"><span class="pre">pserve</span></tt></a></li>
<li><a class="reference internal" href="#configuration-with-ini-files">Configuration with <tt class="docutils literal"><span class="pre">.ini</span></tt> Files</a></li>
<li><a class="reference internal" href="#easier-development-with-debugtoolbar">Easier Development with <tt class="docutils literal"><span class="pre">debugtoolbar</span></tt></a></li>
<li><a class="reference internal" href="#unit-tests-and-nose">Unit Tests and <tt class="docutils literal"><span class="pre">nose</span></tt></a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#sessions">Sessions</a></li>
<li><a class="reference internal" href="#databases">Databases</a></li>
<li><a class="reference internal" href="#forms">Forms</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="conventions.html"
                        title="previous chapter">Typographical Conventions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="quick_tutorial/index.html"
                        title="next chapter">Quick Tutorial for Pyramid</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quick_tutorial/index.html" title="Quick Tutorial for Pyramid"
             >next</a> |</li>
        <li class="right" >
          <a href="conventions.html" title="Typographical Conventions"
             >previous</a> |</li>
    	<li><a href="index.html">The Pyramid Web Framework v1.5</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="copyright.html">Copyright</a> 2008-2014, Agendaless Consulting.
      Last updated on Nov 09, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>