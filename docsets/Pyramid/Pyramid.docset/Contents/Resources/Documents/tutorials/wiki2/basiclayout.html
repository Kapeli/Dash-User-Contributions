<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Basic Layout &mdash; The Pyramid Web Framework v1.5</title>
    
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="The Pyramid Web Framework v1.5" href="../../index.html" />
    <link rel="up" title="SQLAlchemy + URL Dispatch Wiki Tutorial" href="index.html" />
    <link rel="next" title="Defining the Domain Model" href="definingmodels.html" />
    <link rel="prev" title="Installation" href="installation.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head>
  <body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">SQLAlchemy + URL Dispatch Wiki Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="basic-layout">
<h1>Basic Layout<a class="headerlink" href="#basic-layout" title="Permalink to this headline">¶</a></h1>
<p>The starter files generated by the <tt class="docutils literal"><span class="pre">alchemy</span></tt> scaffold are very basic, but
they provide a good orientation for the high-level patterns common to most
<a class="reference internal" href="../../glossary.html#term-url-dispatch"><em class="xref std std-term">url dispatch</em></a> -based <span>Pyramid</span> projects.</p>
<div class="section" id="application-configuration-with-init-py">
<h2>Application Configuration with <tt class="docutils literal"><span class="pre">__init__.py</span></tt><a class="headerlink" href="#application-configuration-with-init-py" title="Permalink to this headline">¶</a></h2>
<p>A directory on disk can be turned into a Python <a class="reference internal" href="../../glossary.html#term-package"><em class="xref std std-term">package</em></a> by containing
an <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file.  Even if empty, this marks a directory as a Python
package.  We use <tt class="docutils literal"><span class="pre">__init__.py</span></tt> both as a marker indicating the directory
it's contained within is a package, and to contain configuration code.</p>
<p>Open <tt class="docutils literal"><span class="pre">tutorial/tutorial/__init__.py</span></tt>.  It should already contain
the following:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">engine_from_config</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DBSession</span><span class="p">,</span>
    <span class="n">Base</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function returns a Pyramid WSGI application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
    <span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Let's go over this piece-by-piece.  First, we need some imports to support
later code:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">engine_from_config</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DBSession</span><span class="p">,</span>
    <span class="n">Base</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">__init__.py</span></tt> defines a function named <tt class="docutils literal"><span class="pre">main</span></tt>.  Here is the entirety of
the <tt class="docutils literal"><span class="pre">main</span></tt> function we've defined in our <tt class="docutils literal"><span class="pre">__init__.py</span></tt>:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function returns a Pyramid WSGI application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
    <span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>When you invoke the <tt class="docutils literal"><span class="pre">pserve</span> <span class="pre">development.ini</span></tt> command, the <tt class="docutils literal"><span class="pre">main</span></tt> function
above is executed.  It accepts some settings and returns a <a class="reference internal" href="../../glossary.html#term-wsgi"><em class="xref std std-term">WSGI</em></a>
application.  (See <a class="reference internal" href="../../narr/startup.html#startup-chapter"><em>Startup</em></a> for more about <tt class="docutils literal"><span class="pre">pserve</span></tt>.)</p>
<p>The main function first creates a <a class="reference internal" href="../../glossary.html#term-sqlalchemy"><em class="xref std std-term">SQLAlchemy</em></a> database engine using
<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html#sqlalchemy.engine_from_config" title="(in SQLAlchemy v1.0)"><tt class="xref py py-func docutils literal"><span class="pre">sqlalchemy.engine_from_config()</span></tt></a> from the <tt class="docutils literal"><span class="pre">sqlalchemy.</span></tt> prefixed
settings in the <tt class="docutils literal"><span class="pre">development.ini</span></tt> file's <tt class="docutils literal"><span class="pre">[app:main]</span></tt> section.
This will be a URI (something like <tt class="docutils literal"><span class="pre">sqlite://</span></tt>):</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">main</span></tt> then initializes our SQLAlchemy session object, passing it the
engine:</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">main</span></tt> subsequently initializes our SQLAlchemy declarative <tt class="docutils literal"><span class="pre">Base</span></tt> object,
assigning the engine we created to the <tt class="docutils literal"><span class="pre">bind</span></tt> attribute of it's
<tt class="docutils literal"><span class="pre">metadata</span></tt> object.  This allows table definitions done imperatively
(instead of declaratively, via a class statement) to work.  We won't use any
such tables in our application, but if you add one later, long after you've
forgotten about this tutorial, you won't be left scratching your head when it
doesn't work.</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
</pre></div>
</div>
</div></blockquote>
<p>The next step of <tt class="docutils literal"><span class="pre">main</span></tt> is to construct a <a class="reference internal" href="../../glossary.html#term-configurator"><em class="xref std std-term">Configurator</em></a> object:</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">settings</span></tt> is passed to the Configurator as a keyword argument with the
dictionary values passed as the <tt class="docutils literal"><span class="pre">**settings</span></tt> argument.  This will be a
dictionary of settings parsed from the <tt class="docutils literal"><span class="pre">.ini</span></tt> file, which contains
deployment-related values such as <tt class="docutils literal"><span class="pre">pyramid.reload_templates</span></tt>,
<tt class="docutils literal"><span class="pre">db_string</span></tt>, etc.</p>
<p>Next, include <a class="reference internal" href="../../glossary.html#term-chameleon"><em class="xref std std-term">Chameleon</em></a> templating bindings so that we can use
renderers with the <tt class="docutils literal"><span class="pre">.pt</span></tt> extension within our project.</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">main</span></tt> now calls <a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.add_static_view" title="pyramid.config.Configurator.add_static_view"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.add_static_view()</span></tt></a> with
two arguments: <tt class="docutils literal"><span class="pre">static</span></tt> (the name), and <tt class="docutils literal"><span class="pre">static</span></tt> (the path):</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>This registers a static resource view which will match any URL that starts
with the prefix <tt class="docutils literal"><span class="pre">/static</span></tt> (by virtue of the first argument to
<tt class="docutils literal"><span class="pre">add_static_view</span></tt>).  This will serve up static resources for us from within
the <tt class="docutils literal"><span class="pre">static</span></tt> directory of our <tt class="docutils literal"><span class="pre">tutorial</span></tt> package, in this case, via
<tt class="docutils literal"><span class="pre">http://localhost:6543/static/</span></tt> and below (by virtue of the second argument
to <tt class="docutils literal"><span class="pre">add_static_view</span></tt>).  With this declaration, we're saying that any URL that
starts with <tt class="docutils literal"><span class="pre">/static</span></tt> should go to the static view; any remainder of its
path (e.g. the <tt class="docutils literal"><span class="pre">/foo</span></tt> in <tt class="docutils literal"><span class="pre">/static/foo</span></tt>) will be used to compose a path to
a static file resource, such as a CSS file.</p>
<p>Using the configurator <tt class="docutils literal"><span class="pre">main</span></tt> also registers a <a class="reference internal" href="../../glossary.html#term-route-configuration"><em class="xref std std-term">route configuration</em></a>
via the <a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.add_route()</span></tt></a> method that will be
used when the URL is <tt class="docutils literal"><span class="pre">/</span></tt>:</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Since this route has a <tt class="docutils literal"><span class="pre">pattern</span></tt> equalling <tt class="docutils literal"><span class="pre">/</span></tt> it is the route that will
be matched when the URL <tt class="docutils literal"><span class="pre">/</span></tt> is visited, e.g. <tt class="docutils literal"><span class="pre">http://localhost:6543/</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">main</span></tt> next calls the <tt class="docutils literal"><span class="pre">scan</span></tt> method of the configurator
(<a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.scan" title="pyramid.config.Configurator.scan"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.scan()</span></tt></a>), which will recursively scan our
<tt class="docutils literal"><span class="pre">tutorial</span></tt> package, looking for <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> (and
other special) decorators.  When it finds a <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> decorator, a
view configuration will be registered, which will allow one of our
application URLs to be mapped to some code.</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Finally, <tt class="docutils literal"><span class="pre">main</span></tt> is finished configuring things, so it uses the
<a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.make_wsgi_app" title="pyramid.config.Configurator.make_wsgi_app"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.make_wsgi_app()</span></tt></a> method to return a
<a class="reference internal" href="../../glossary.html#term-wsgi"><em class="xref std std-term">WSGI</em></a> application:</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre>    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="view-declarations-via-views-py">
<h2>View Declarations via <tt class="docutils literal"><span class="pre">views.py</span></tt><a class="headerlink" href="#view-declarations-via-views-py" title="Permalink to this headline">¶</a></h2>
<p>The main function of a web framework is mapping each URL pattern to code (a
<a class="reference internal" href="../../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a>) that is executed when the requested URL matches the
corresponding <a class="reference internal" href="../../glossary.html#term-route"><em class="xref std std-term">route</em></a>. Our application uses the
<a class="reference internal" href="../../api/view.html#pyramid.view.view_config" title="pyramid.view.view_config"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.view.view_config()</span></tt></a> decorator to perform this mapping.</p>
<p>Open <tt class="docutils literal"><span class="pre">tutorial/tutorial/views.py</span></tt>.  It should already contain the following:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">DBAPIError</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DBSession</span><span class="p">,</span>
    <span class="n">MyModel</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/mytemplate.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;one&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">DBAPIError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">conn_err_msg</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">status_int</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;one&#39;</span><span class="p">:</span> <span class="n">one</span><span class="p">,</span> <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="s">&#39;tutorial&#39;</span><span class="p">}</span>

<span class="n">conn_err_msg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Pyramid is having a problem using your SQL database.  The problem</span>
<span class="s">might be caused by one of the following things:</span>

<span class="s">1.  You may need to run the &quot;initialize_tutorial_db&quot; script</span>
<span class="s">    to initialize your database tables.  Check your virtual </span>
<span class="s">    environment&#39;s &quot;bin&quot; directory for this script and try to run it.</span>

<span class="s">2.  Your database server may not be running.  Check that the</span>
<span class="s">    database server referred to by the &quot;sqlalchemy.url&quot; setting in</span>
<span class="s">    your &quot;development.ini&quot; file is running.</span>

<span class="s">After you fix the problem, please restart the Pyramid application to</span>
<span class="s">try it again.</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>The important part here is that the <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> decorator associates the
function it decorates (<tt class="docutils literal"><span class="pre">my_view</span></tt>) with a <a class="reference internal" href="../../glossary.html#term-view-configuration"><em class="xref std std-term">view configuration</em></a>,
consisting of:</p>
<blockquote>
<div><ul class="simple">
<li>a <tt class="docutils literal"><span class="pre">route_name</span></tt> (<tt class="docutils literal"><span class="pre">home</span></tt>)</li>
<li>a <tt class="docutils literal"><span class="pre">renderer</span></tt>, which is a template from the <tt class="docutils literal"><span class="pre">templates</span></tt> subdirectory
of the package.</li>
</ul>
</div></blockquote>
<p>When the pattern associated with the <tt class="docutils literal"><span class="pre">home</span></tt> view is matched during a request,
<tt class="docutils literal"><span class="pre">my_view()</span></tt> will be executed.  <tt class="docutils literal"><span class="pre">my_view()</span></tt> returns a dictionary; the
renderer will use the <tt class="docutils literal"><span class="pre">templates/mytemplate.pt</span></tt> template to create a response
based on the values in the dictionary.</p>
<p>Note that <tt class="docutils literal"><span class="pre">my_view()</span></tt> accepts a single argument named <tt class="docutils literal"><span class="pre">request</span></tt>.  This is
the standard call signature for a Pyramid <a class="reference internal" href="../../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a>.</p>
<p>Remember in our <tt class="docutils literal"><span class="pre">__init__.py</span></tt> when we executed the
<a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.scan" title="pyramid.config.Configurator.scan"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.scan()</span></tt></a> method, i.e. <tt class="docutils literal"><span class="pre">config.scan()</span></tt>?  The
purpose of calling the scan method was to find and process this
<tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> decorator in order to create a view configuration within our
application.  Without being processed by <tt class="docutils literal"><span class="pre">scan</span></tt>, the decorator effectively
does nothing.  <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> is inert without being detected via a
<a class="reference internal" href="../../glossary.html#term-scan"><em class="xref std std-term">scan</em></a>.</p>
<p>The sample <tt class="docutils literal"><span class="pre">my_view()</span></tt> created by the scaffold uses a <tt class="docutils literal"><span class="pre">try:</span></tt> and <tt class="docutils literal"><span class="pre">except:</span></tt>
clause, to detect if there is a problem accessing the project database and
provide an alternate error response.  That response will include the text
shown at the end of the file, which will be displayed in the browser to
inform the user about possible actions to take to solve the problem.</p>
</div>
<div class="section" id="content-models-with-models-py">
<h2>Content Models with <tt class="docutils literal"><span class="pre">models.py</span></tt><a class="headerlink" href="#content-models-with-models-py" title="Permalink to this headline">¶</a></h2>
<p>In a SQLAlchemy-based application, a <em>model</em> object is an object composed by
querying the SQL database. The <tt class="docutils literal"><span class="pre">models.py</span></tt> file is where the <tt class="docutils literal"><span class="pre">alchemy</span></tt>
scaffold put the classes that implement our models.</p>
<p>Open <tt class="docutils literal"><span class="pre">tutorial/tutorial/models.py</span></tt>.  It should already contain the following:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Column</span><span class="p">,</span>
    <span class="n">Integer</span><span class="p">,</span>
    <span class="n">Text</span><span class="p">,</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">scoped_session</span><span class="p">,</span>
    <span class="n">sessionmaker</span><span class="p">,</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">zope.sqlalchemy</span> <span class="kn">import</span> <span class="n">ZopeTransactionExtension</span>

<span class="n">DBSession</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">ZopeTransactionExtension</span><span class="p">()))</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;models&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Let's examine this in detail. First, we need some imports to support later code:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Column</span><span class="p">,</span>
    <span class="n">Integer</span><span class="p">,</span>
    <span class="n">Text</span><span class="p">,</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">scoped_session</span><span class="p">,</span>
    <span class="n">sessionmaker</span><span class="p">,</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">zope.sqlalchemy</span> <span class="kn">import</span> <span class="n">ZopeTransactionExtension</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Next we set up a SQLAlchemy <tt class="docutils literal"><span class="pre">DBSession</span></tt> object:</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre><span class="n">DBSession</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">ZopeTransactionExtension</span><span class="p">()))</span>
</pre></div>
</div>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">scoped_session</span></tt> and <tt class="docutils literal"><span class="pre">sessionmaker</span></tt> are standard SQLAlchemy helpers.
<tt class="docutils literal"><span class="pre">scoped_session</span></tt> allows us to access our database connection globally.
<tt class="docutils literal"><span class="pre">sessionmaker</span></tt> creates a database session object.  We pass to
<tt class="docutils literal"><span class="pre">sessionmaker</span></tt> the <tt class="docutils literal"><span class="pre">extension=ZopeTransactionExtension()</span></tt> extension
option in order to allow the system to automatically manage database
transactions.  With <tt class="docutils literal"><span class="pre">ZopeTransactionExtension</span></tt> activated, our application
will automatically issue a transaction commit after every request unless an
exception is raised, in which case the transaction will be aborted.</p>
<p>We also need to create a declarative <tt class="docutils literal"><span class="pre">Base</span></tt> object to use as a
base class for our model:</p>
<blockquote>
<div><div class="highlight-py"><div class="highlight"><pre><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Our model classes will inherit from this <tt class="docutils literal"><span class="pre">Base</span></tt> class so they can be
associated with our particular database connection.</p>
<p>To give a simple example of a  model class, we define one named <tt class="docutils literal"><span class="pre">MyModel</span></tt>:</p>
<blockquote>
<div><div class="highlight-py"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;models&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Our example model does not require an <tt class="docutils literal"><span class="pre">__init__</span></tt> method because SQLAlchemy
supplies for us a default constructor if one is not already present,
which accepts keyword arguments of the same name as that of the mapped attributes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Example usage of MyModel:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">johnny</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Doe&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <tt class="docutils literal"><span class="pre">MyModel</span></tt> class has a <tt class="docutils literal"><span class="pre">__tablename__</span></tt> attribute.  This informs
SQLAlchemy which table to use to store the data representing instances of this
class.</p>
<p>That's about all there is to it regarding models, views, and initialization
code in our stock application.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic Layout</a><ul>
<li><a class="reference internal" href="#application-configuration-with-init-py">Application Configuration with <tt class="docutils literal"><span class="pre">__init__.py</span></tt></a></li>
<li><a class="reference internal" href="#view-declarations-via-views-py">View Declarations via <tt class="docutils literal"><span class="pre">views.py</span></tt></a></li>
<li><a class="reference internal" href="#content-models-with-models-py">Content Models with <tt class="docutils literal"><span class="pre">models.py</span></tt></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="definingmodels.html"
                        title="next chapter">Defining the Domain Model</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li>
          <li><a href="index.html" >SQLAlchemy + URL Dispatch Wiki Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../../copyright.html">Copyright</a> 2008-2014, Agendaless Consulting.
      Last updated on Nov 09, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>