<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Defining Views &mdash; The Pyramid Web Framework v1.5</title>
    
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="The Pyramid Web Framework v1.5" href="../../index.html" />
    <link rel="up" title="SQLAlchemy + URL Dispatch Wiki Tutorial" href="index.html" />
    <link rel="next" title="Adding Authorization" href="authorization.html" />
    <link rel="prev" title="Defining the Domain Model" href="definingmodels.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head>
  <body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="authorization.html" title="Adding Authorization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             accesskey="P">previous</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">SQLAlchemy + URL Dispatch Wiki Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="defining-views">
<h1>Defining Views<a class="headerlink" href="#defining-views" title="Permalink to this headline">¶</a></h1>
<p>A <a class="reference internal" href="../../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a> in a <span>Pyramid</span> application is typically a simple
Python function that accepts a single parameter named <a class="reference internal" href="../../glossary.html#term-request"><em class="xref std std-term">request</em></a>.  A
view callable is assumed to return a <a class="reference internal" href="../../glossary.html#term-response"><em class="xref std std-term">response</em></a> object.</p>
<p>The request object has a dictionary as an attribute named <tt class="docutils literal"><span class="pre">matchdict</span></tt>.  A
<tt class="docutils literal"><span class="pre">matchdict</span></tt> maps the placeholders in the matching URL <tt class="docutils literal"><span class="pre">pattern</span></tt> to the
substrings of the path in the <a class="reference internal" href="../../glossary.html#term-request"><em class="xref std std-term">request</em></a> URL. For instance, if a call to
<a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.add_route()</span></tt></a> has the pattern <tt class="docutils literal"><span class="pre">/{one}/{two}</span></tt>,
and a user visits <tt class="docutils literal"><span class="pre">http://example.com/foo/bar</span></tt>, our pattern would be matched
against <tt class="docutils literal"><span class="pre">/foo/bar</span></tt> and the <tt class="docutils literal"><span class="pre">matchdict</span></tt> would look like: <tt class="docutils literal"><span class="pre">{'one':'foo',</span>
<span class="pre">'two':'bar'}</span></tt></p>
<div class="section" id="declaring-dependencies-in-our-setup-py-file">
<h2>Declaring Dependencies in Our <tt class="docutils literal"><span class="pre">setup.py</span></tt> File<a class="headerlink" href="#declaring-dependencies-in-our-setup-py-file" title="Permalink to this headline">¶</a></h2>
<p>The view code in our application will depend on a package which is not a
dependency of the original &quot;tutorial&quot; application.  The original &quot;tutorial&quot;
application was generated by the <tt class="docutils literal"><span class="pre">pcreate</span></tt> command; it doesn't know
about our custom application requirements.</p>
<p>We need to add a dependency on the <tt class="docutils literal"><span class="pre">docutils</span></tt> package to our <tt class="docutils literal"><span class="pre">tutorial</span></tt>
package's <tt class="docutils literal"><span class="pre">setup.py</span></tt> file by assigning this dependency to the <tt class="docutils literal"><span class="pre">requires</span></tt> parameter in <tt class="docutils literal"><span class="pre">setup()</span></tt>.</p>
<p>Open <tt class="docutils literal"><span class="pre">tutorial/setup.py</span></tt> and edit it to look like the following:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;README.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">README</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;CHANGES.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">CHANGES</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;pyramid&#39;</span><span class="p">,</span>
    <span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">,</span>
    <span class="s">&#39;pyramid_debugtoolbar&#39;</span><span class="p">,</span>
    <span class="s">&#39;pyramid_tm&#39;</span><span class="p">,</span>
    <span class="s">&#39;SQLAlchemy&#39;</span><span class="p">,</span>
    <span class="s">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="s">&#39;zope.sqlalchemy&#39;</span><span class="p">,</span>
    <span class="s">&#39;waitress&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s">&#39;docutils&#39;</span><span class="p">,</span>
</span>    <span class="p">]</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;tutorial&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s">&#39;tutorial&#39;</span><span class="p">,</span>
      <span class="n">long_description</span><span class="o">=</span><span class="n">README</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">CHANGES</span><span class="p">,</span>
      <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s">&quot;Programming Language :: Python&quot;</span><span class="p">,</span>
        <span class="s">&quot;Framework :: Pyramid&quot;</span><span class="p">,</span>
        <span class="s">&quot;Topic :: Internet :: WWW/HTTP&quot;</span><span class="p">,</span>
        <span class="s">&quot;Topic :: Internet :: WWW/HTTP :: WSGI :: Application&quot;</span><span class="p">,</span>
        <span class="p">],</span>
      <span class="n">author</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">keywords</span><span class="o">=</span><span class="s">&#39;web wsgi bfg pylons pyramid&#39;</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
      <span class="n">test_suite</span><span class="o">=</span><span class="s">&#39;tutorial&#39;</span><span class="p">,</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="n">entry_points</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      [paste.app_factory]</span>
<span class="s">      main = tutorial:main</span>
<span class="s">      [console_scripts]</span>
<span class="s">      initialize_tutorial_db = tutorial.scripts.initializedb:main</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span>
      <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>(Only the highlighted line needs to be added.)</p>
</div>
<div class="section" id="running-setup-py-develop">
<h2>Running <tt class="docutils literal"><span class="pre">setup.py</span> <span class="pre">develop</span></tt><a class="headerlink" href="#running-setup-py-develop" title="Permalink to this headline">¶</a></h2>
<p>Since a new software dependency was added, you will need to rerun <tt class="docutils literal"><span class="pre">python</span>
<span class="pre">setup.py</span> <span class="pre">develop</span></tt> inside the root of the <tt class="docutils literal"><span class="pre">tutorial</span></tt> package to obtain and
register the newly added dependency distribution.</p>
<p>Make sure your current working directory is the root of the project (the
directory in which setup.py lives) and execute the following command.</p>
<p>On UNIX:</p>
<div class="highlight-text"><div class="highlight"><pre>$ cd tutorial
$ $VENV/bin/python setup.py develop
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-text"><div class="highlight"><pre>c:\pyramidtut&gt; cd tutorial
c:\pyramidtut\tutorial&gt; %VENV%\Scripts\python setup.py develop
</pre></div>
</div>
<p>Success executing this command will end with a line to the console something
like:</p>
<div class="highlight-python"><div class="highlight"><pre>Finished processing dependencies for tutorial==0.0
</pre></div>
</div>
</div>
<div class="section" id="changing-the-views-py-file">
<h2>Changing the <tt class="docutils literal"><span class="pre">views.py</span></tt> File<a class="headerlink" href="#changing-the-views-py-file" title="Permalink to this headline">¶</a></h2>
<p>It's time for a major change.  Open <tt class="docutils literal"><span class="pre">tutorial/tutorial/views.py</span></tt> and edit it to look like the following:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kn">import</span> <span class="nn">cgi</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">docutils.core</span> <span class="kn">import</span> <span class="n">publish_parts</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">HTTPFound</span><span class="p">,</span>
</span><span class="hll">    <span class="n">HTTPNotFound</span><span class="p">,</span>
</span>    <span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
<span class="hll">    <span class="n">DBSession</span><span class="p">,</span>
</span>    <span class="n">Page</span><span class="p">,</span>
    <span class="p">)</span>
<span class="hll">
</span><span class="hll"><span class="c"># regular expression used to find WikiWords</span>
</span><span class="hll"><span class="n">wikiwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b([A-Z]\w+[A-Z]+\w+)&quot;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;view_wiki&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span>
</span><span class="hll">                                                  <span class="n">pagename</span><span class="o">=</span><span class="s">&#39;FrontPage&#39;</span><span class="p">))</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/view.pt&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;pagename&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">page</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">HTTPNotFound</span><span class="p">(</span><span class="s">&#39;No such page&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
</span><span class="hll">        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll">        <span class="n">exists</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
</span><span class="hll">            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
</span><span class="hll">            <span class="k">return</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
</span><span class="hll">            <span class="k">return</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s">&#39;html&#39;</span><span class="p">)[</span><span class="s">&#39;html_body&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span class="hll">    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;pagename&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="k">if</span> <span class="s">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
</span><span class="hll">        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
</span><span class="hll">        <span class="n">DBSession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span>
</span><span class="hll">                                                      <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">))</span>
</span><span class="hll">    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
</span><span class="hll">    <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;pagename&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">page</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</span><span class="hll">    <span class="k">if</span> <span class="s">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
</span><span class="hll">        <span class="n">page</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">DBSession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span>
</span><span class="hll">                                                      <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">))</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
</span><span class="hll">        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
</span><span class="hll">        <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">),</span>
</span>        <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>(The highlighted lines are the ones that need to be added or edited.)</p>
<p>We got rid of the <tt class="docutils literal"><span class="pre">my_view</span></tt> view function and its decorator that was
added when we originally rendered the <tt class="docutils literal"><span class="pre">alchemy</span></tt> scaffold.  It was only an
example and isn't relevant to our application.</p>
<p>Then we added four <a class="reference internal" href="../../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a> functions to our <tt class="docutils literal"><span class="pre">views.py</span></tt>
module:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">view_wiki()</span></tt> - Displays the wiki itself. It will answer on the root URL.</li>
<li><tt class="docutils literal"><span class="pre">view_page()</span></tt> - Displays an individual page.</li>
<li><tt class="docutils literal"><span class="pre">add_page()</span></tt> - Allows the user to add a page.</li>
<li><tt class="docutils literal"><span class="pre">edit_page()</span></tt> - Allows the user to edit a page.</li>
</ul>
<p>We'll describe each one briefly and show the resulting <tt class="docutils literal"><span class="pre">views.py</span></tt> file
afterward.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is nothing special about the filename <tt class="docutils literal"><span class="pre">views.py</span></tt>.  A project may
have many view callables throughout its codebase in arbitrarily-named
files.  Files implementing view callables often have <tt class="docutils literal"><span class="pre">view</span></tt> in their
filenames (or may live in a Python subpackage of your application package
named <tt class="docutils literal"><span class="pre">views</span></tt>), but this is only by convention.</p>
</div>
<div class="section" id="the-view-wiki-view-function">
<h3>The <tt class="docutils literal"><span class="pre">view_wiki</span></tt> view function<a class="headerlink" href="#the-view-wiki-view-function" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">view_wiki()</span></tt> is the <a class="reference internal" href="../../glossary.html#term-default-view"><em class="xref std std-term">default view</em></a> that gets called when a request
is made to the root URL of our wiki.  It always redirects to
a URL which represents the path to our &quot;FrontPage&quot;.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;view_wiki&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span>
</pre></div>
</td></tr></table></div>
<p><tt class="docutils literal"><span class="pre">view_wiki()</span></tt> returns an instance of the
<a class="reference internal" href="../../api/httpexceptions.html#pyramid.httpexceptions.HTTPFound" title="pyramid.httpexceptions.HTTPFound"><tt class="xref py py-class docutils literal"><span class="pre">pyramid.httpexceptions.HTTPFound</span></tt></a> class (instances of which implement
the <a class="reference internal" href="../../api/interfaces.html#pyramid.interfaces.IResponse" title="pyramid.interfaces.IResponse"><tt class="xref py py-class docutils literal"><span class="pre">pyramid.interfaces.IResponse</span></tt></a> interface like
<a class="reference internal" href="../../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><tt class="xref py py-class docutils literal"><span class="pre">pyramid.response.Response</span></tt></a> does).</p>
<p>It uses the <a class="reference internal" href="../../api/request.html#pyramid.request.Request.route_url" title="pyramid.request.Request.route_url"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.request.Request.route_url()</span></tt></a> API to construct a
URL to the <tt class="docutils literal"><span class="pre">FrontPage</span></tt> page (e.g. <tt class="docutils literal"><span class="pre">http://localhost:6543/FrontPage</span></tt>), which
is used as the &quot;location&quot; of the <tt class="docutils literal"><span class="pre">HTTPFound</span></tt> response, forming an HTTP redirect.</p>
</div>
<div class="section" id="the-view-page-view-function">
<h3>The <tt class="docutils literal"><span class="pre">view_page</span></tt> view function<a class="headerlink" href="#the-view-page-view-function" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">view_page()</span></tt> is used to display a single page of our
wiki.  It renders the <a class="reference internal" href="../../glossary.html#term-restructuredtext"><em class="xref std std-term">reStructuredText</em></a> body of a page (stored as
the <tt class="docutils literal"><span class="pre">data</span></tt> attribute of a <tt class="docutils literal"><span class="pre">Page</span></tt> model object) as HTML.  Then it substitutes an
HTML anchor for each <em>WikiWord</em> reference in the rendered HTML using a
compiled regular expression.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/view.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;pagename&#39;</span><span class="p">]</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HTTPNotFound</span><span class="p">(</span><span class="s">&#39;No such page&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s">&#39;html&#39;</span><span class="p">)[</span><span class="s">&#39;html_body&#39;</span><span class="p">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <tt class="docutils literal"><span class="pre">check()</span></tt> function is used as the first argument to
<tt class="docutils literal"><span class="pre">wikiwords.sub</span></tt>, indicating that it should be called to provide a value for
each WikiWord match found in the content.  If the wiki already contains a
page with the matched WikiWord name, <tt class="docutils literal"><span class="pre">check()</span></tt> generates a view
link to be used as the substitution value and returns it.  If the wiki does
not already contain a page with the matched WikiWord name, <tt class="docutils literal"><span class="pre">check()</span></tt>
generates an &quot;add&quot; link as the substitution value and returns it.</p>
<p>As a result, the <tt class="docutils literal"><span class="pre">content</span></tt> variable is now a fully formed bit of HTML
containing various view and add links for WikiWords based on the content of
our current page object.</p>
<p>We then generate an edit URL because it's easier to do here than in the
template, and we return a dictionary with a number of arguments.  The fact that
<tt class="docutils literal"><span class="pre">view_page()</span></tt> returns a dictionary (as opposed to a <a class="reference internal" href="../../glossary.html#term-response"><em class="xref std std-term">response</em></a> object)
is a cue to <span>Pyramid</span> that it should try to use a <a class="reference internal" href="../../glossary.html#term-renderer"><em class="xref std std-term">renderer</em></a>
associated with the view configuration to render a response.  In our case, the
renderer used will be the <tt class="docutils literal"><span class="pre">templates/view.pt</span></tt> template, as indicated in the
<tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> decorator that is applied to <tt class="docutils literal"><span class="pre">view_page()</span></tt>.</p>
</div>
<div class="section" id="the-add-page-view-function">
<h3>The <tt class="docutils literal"><span class="pre">add_page</span></tt> view function<a class="headerlink" href="#the-add-page-view-function" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">add_page()</span></tt> is invoked when a user clicks on a <em>WikiWord</em> which
isn't yet represented as a page in the system.  The <tt class="docutils literal"><span class="pre">check</span></tt> function
within the <tt class="docutils literal"><span class="pre">view_page</span></tt> view generates URLs to this view.
<tt class="docutils literal"><span class="pre">add_page()</span></tt> also acts as a handler for the form that is generated
when we want to add a page object.  The <tt class="docutils literal"><span class="pre">matchdict</span></tt> attribute of the
request passed to the <tt class="docutils literal"><span class="pre">add_page()</span></tt> view will have the values we need
to construct URLs and find model objects.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;pagename&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
        <span class="n">DBSession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span>
                                                      <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">))</span>
    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <tt class="docutils literal"><span class="pre">matchdict</span></tt> will have a <tt class="docutils literal"><span class="pre">'pagename'</span></tt> key that matches the name of
the page we'd like to add.  If our add view is invoked via,
e.g. <tt class="docutils literal"><span class="pre">http://localhost:6543/add_page/SomeName</span></tt>, the value for
<tt class="docutils literal"><span class="pre">'pagename'</span></tt> in the <tt class="docutils literal"><span class="pre">matchdict</span></tt> will be <tt class="docutils literal"><span class="pre">'SomeName'</span></tt>.</p>
<p>If the view execution <em>is</em> a result of a form submission (i.e. the expression
<tt class="docutils literal"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>), we scrape the page body
from the form data, create a Page object with this page body and the name
taken from <tt class="docutils literal"><span class="pre">matchdict['pagename']</span></tt>, and save it into the database using
<tt class="docutils literal"><span class="pre">DBSession.add</span></tt>.  We then redirect back to the <tt class="docutils literal"><span class="pre">view_page</span></tt> view for the
newly created page.</p>
<p>If the view execution is <em>not</em> a result of a form submission (i.e. the
expression <tt class="docutils literal"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></tt> is <tt class="docutils literal"><span class="pre">False</span></tt>), the view
callable renders a template.  To do so, it generates a &quot;save url&quot; which the
template uses as the form post URL during rendering.  We're lazy here, so
we're going to use the same template (<tt class="docutils literal"><span class="pre">templates/edit.pt</span></tt>) for the add
view as well as the page edit view. To do so we create a dummy Page object
in order to satisfy the edit form's desire to have <em>some</em> page object
exposed as <tt class="docutils literal"><span class="pre">page</span></tt>. <span>Pyramid</span> will render the template associated
with this view to a response.</p>
</div>
<div class="section" id="the-edit-page-view-function">
<h3>The <tt class="docutils literal"><span class="pre">edit_page</span></tt> view function<a class="headerlink" href="#the-edit-page-view-function" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">edit_page()</span></tt> is invoked when a user clicks the &quot;Edit this
Page&quot; button on the view form.  It renders an edit form but it also acts as
the handler for the form it renders.  The <tt class="docutils literal"><span class="pre">matchdict</span></tt> attribute of the
request passed to the <tt class="docutils literal"><span class="pre">edit_page</span></tt> view will have a <tt class="docutils literal"><span class="pre">'pagename'</span></tt> key
matching the name of the page the user wants to edit.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;pagename&#39;</span><span class="p">]</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">DBSession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="k">if</span> <span class="s">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">page</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">DBSession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span>
                                                      <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
        <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">),</span>
</pre></div>
</td></tr></table></div>
<p>If the view execution <em>is</em> a result of a form submission (i.e. the expression
<tt class="docutils literal"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>), the view grabs the
<tt class="docutils literal"><span class="pre">body</span></tt> element of the request parameters and sets it as the <tt class="docutils literal"><span class="pre">data</span></tt>
attribute of the page object.  It then redirects to the <tt class="docutils literal"><span class="pre">view_page</span></tt> view
of the wiki page.</p>
<p>If the view execution is <em>not</em> a result of a form submission (i.e. the
expression <tt class="docutils literal"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></tt> is <tt class="docutils literal"><span class="pre">False</span></tt>), the view
simply renders the edit form, passing the page object and a <tt class="docutils literal"><span class="pre">save_url</span></tt>
which will be used as the action of the generated form.</p>
</div>
</div>
<div class="section" id="adding-templates">
<h2>Adding Templates<a class="headerlink" href="#adding-templates" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">view_page</span></tt>, <tt class="docutils literal"><span class="pre">add_page</span></tt> and <tt class="docutils literal"><span class="pre">edit_page</span></tt> views that we've added
reference a <a class="reference internal" href="../../glossary.html#term-template"><em class="xref std std-term">template</em></a>.  Each template is a <a class="reference internal" href="../../glossary.html#term-chameleon"><em class="xref std std-term">Chameleon</em></a> <a class="reference internal" href="../../glossary.html#term-zpt"><em class="xref std std-term">ZPT</em></a>
template.  These templates will live in the <tt class="docutils literal"><span class="pre">templates</span></tt> directory of our
tutorial package.  Chameleon templates must have a <tt class="docutils literal"><span class="pre">.pt</span></tt> extension to be
recognized as such.</p>
<div class="section" id="the-view-pt-template">
<h3>The <tt class="docutils literal"><span class="pre">view.pt</span></tt> Template<a class="headerlink" href="#the-view-pt-template" title="Permalink to this headline">¶</a></h3>
<p>Create <tt class="docutils literal"><span class="pre">tutorial/tutorial/templates/view.pt</span></tt> and add the following
content:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
<span class="cp">  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span>
      <span class="na">xmlns:tal=</span><span class="s">&quot;http://xml.zope.org/namespaces/tal&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>${page.name} - Pyramid tutorial wiki (based on
    TurboGears 20-Minute Wiki)<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;keywords&quot;</span> <span class="na">content=</span><span class="s">&quot;python web application&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;pyramid web application&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span>
        <span class="na">href=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/favicon.ico&#39;)}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
        <span class="na">href=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pylons.css&#39;)}&quot;</span>
        <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!--[if lte IE 6]&gt;</span>
<span class="c">  &lt;link rel=&quot;stylesheet&quot;</span>
<span class="c">        href=&quot;${request.static_url(&#39;tutorial:static/ie6.css&#39;)}&quot;</span>
<span class="c">        type=&quot;text/css&quot; media=&quot;screen&quot; charset=&quot;utf-8&quot; /&gt;</span>
<span class="c">  &lt;![endif]--&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrap&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;top-small&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;top-small align-center&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
          <span class="nt">&lt;img</span> <span class="na">width=</span><span class="s">&quot;220&quot;</span> <span class="na">height=</span><span class="s">&quot;50&quot;</span> <span class="na">alt=</span><span class="s">&quot;pyramid&quot;</span>
        <span class="na">src=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-small.png&#39;)}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;middle&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;middle align-right&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;left&quot;</span> <span class="na">class=</span><span class="s">&quot;app-welcome align-left&quot;</span><span class="nt">&gt;</span>
          Viewing <span class="nt">&lt;b&gt;&lt;span</span> <span class="na">tal:replace=</span><span class="s">&quot;page.name&quot;</span><span class="nt">&gt;</span>Page Name
              Goes Here<span class="nt">&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;</span>
          You can return to the
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${request.application_url}&quot;</span><span class="nt">&gt;</span>FrontPage<span class="nt">&lt;/a&gt;</span>.<span class="nt">&lt;br/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;right&quot;</span> <span class="na">class=</span><span class="s">&quot;app-welcome align-right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;bottom&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;bottom&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">tal:replace=</span><span class="s">&quot;structure content&quot;</span><span class="nt">&gt;</span>
          Page text goes here.
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">tal:attributes=</span><span class="s">&quot;href edit_url&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
            Edit this page
          <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This template is used by <tt class="docutils literal"><span class="pre">view_page()</span></tt> for displaying a single
wiki page. It includes:</p>
<ul class="simple">
<li>A <tt class="docutils literal"><span class="pre">div</span></tt> element that is replaced with the <tt class="docutils literal"><span class="pre">content</span></tt>
value provided by the view (rows 45-47).  <tt class="docutils literal"><span class="pre">content</span></tt>
contains HTML, so the <tt class="docutils literal"><span class="pre">structure</span></tt> keyword is used
to prevent escaping it (i.e. changing &quot;&gt;&quot; to &quot;&amp;gt;&quot;, etc.)</li>
<li>A link that points
at the &quot;edit&quot; URL which invokes the <tt class="docutils literal"><span class="pre">edit_page</span></tt> view for
the page being viewed (rows 49-51).</li>
</ul>
</div>
<div class="section" id="the-edit-pt-template">
<h3>The <tt class="docutils literal"><span class="pre">edit.pt</span></tt> Template<a class="headerlink" href="#the-edit-pt-template" title="Permalink to this headline">¶</a></h3>
<p>Create <tt class="docutils literal"><span class="pre">tutorial/tutorial/templates/edit.pt</span></tt> and add the following
content:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
<span class="cp">  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span>
      <span class="na">xmlns:tal=</span><span class="s">&quot;http://xml.zope.org/namespaces/tal&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>${page.name} - Pyramid tutorial wiki (based on
    TurboGears 20-Minute Wiki)<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;keywords&quot;</span> <span class="na">content=</span><span class="s">&quot;python web application&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;pyramid web application&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span>
        <span class="na">href=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/favicon.ico&#39;)}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>
        <span class="na">href=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pylons.css&#39;)}&quot;</span>
        <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!--[if lte IE 6]&gt;</span>
<span class="c">  &lt;link rel=&quot;stylesheet&quot;</span>
<span class="c">        href=&quot;${request.static_url(&#39;tutorial:static/ie6.css&#39;)}&quot;</span>
<span class="c">        type=&quot;text/css&quot; media=&quot;screen&quot; charset=&quot;utf-8&quot; /&gt;</span>
<span class="c">  &lt;![endif]--&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrap&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;top-small&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;top-small align-center&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
          <span class="nt">&lt;img</span> <span class="na">width=</span><span class="s">&quot;220&quot;</span> <span class="na">height=</span><span class="s">&quot;50&quot;</span> <span class="na">alt=</span><span class="s">&quot;pyramid&quot;</span>
        <span class="na">src=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-small.png&#39;)}&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;middle&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;middle align-right&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;left&quot;</span> <span class="na">class=</span><span class="s">&quot;app-welcome align-left&quot;</span><span class="nt">&gt;</span>
          Editing <span class="nt">&lt;b&gt;&lt;span</span> <span class="na">tal:replace=</span><span class="s">&quot;page.name&quot;</span><span class="nt">&gt;</span>Page Name Goes
            Here<span class="nt">&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;</span>
          You can return to the
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${request.application_url}&quot;</span><span class="nt">&gt;</span>FrontPage<span class="nt">&lt;/a&gt;</span>.<span class="nt">&lt;br/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;right&quot;</span> <span class="na">class=</span><span class="s">&quot;app-welcome align-right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;bottom&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;bottom&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;${save_url}&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">&quot;body&quot;</span> <span class="na">tal:content=</span><span class="s">&quot;page.data&quot;</span> <span class="na">rows=</span><span class="s">&quot;10&quot;</span>
                    <span class="na">cols=</span><span class="s">&quot;60&quot;</span><span class="nt">/&gt;&lt;br/&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;form.submitted&quot;</span> <span class="na">value=</span><span class="s">&quot;Save&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This template is used by <tt class="docutils literal"><span class="pre">add_page()</span></tt> and <tt class="docutils literal"><span class="pre">edit_page()</span></tt> for adding
and editing a wiki page.  It displays
a page containing a form that includes:</p>
<ul class="simple">
<li>A 10 row by 60 column <tt class="docutils literal"><span class="pre">textarea</span></tt> field named <tt class="docutils literal"><span class="pre">body</span></tt> that is filled
with any existing page data when it is rendered (rows 46-47).</li>
<li>A submit button that has the name <tt class="docutils literal"><span class="pre">form.submitted</span></tt> (row 48).</li>
</ul>
<p>The form POSTs back to the &quot;save_url&quot; argument supplied
by the view (row 45).  The view will use the <tt class="docutils literal"><span class="pre">body</span></tt> and
<tt class="docutils literal"><span class="pre">form.submitted</span></tt> values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Our templates use a <tt class="docutils literal"><span class="pre">request</span></tt> object that
none of our tutorial views return in their dictionary.
<tt class="docutils literal"><span class="pre">request</span></tt> is one of several
names that are available &quot;by default&quot; in a template when a template
renderer is used.  See <a class="reference internal" href="../../narr/templates.html#renderer-system-values"><em>System Values Used During Rendering</em></a> for
information about other names that are available by default
when a template is used as a renderer.</p>
</div>
</div>
<div class="section" id="static-assets">
<h3>Static Assets<a class="headerlink" href="#static-assets" title="Permalink to this headline">¶</a></h3>
<p>Our templates name a single static asset named <tt class="docutils literal"><span class="pre">pylons.css</span></tt>.  We don't need
to create this file within our package's <tt class="docutils literal"><span class="pre">static</span></tt> directory because it was
provided at the time we created the project. This file is a little too long
to replicate within the body of this guide, however it is available <a class="reference external" href="https://github.com/Pylons/pyramid/blob/master/docs/tutorials/wiki2/src/views/tutorial/static/pylons.css">online</a>.</p>
<p>This CSS file will be accessed via
e.g. <tt class="docutils literal"><span class="pre">http://localhost:6543/static/pylons.css</span></tt> by virtue of the call to
<tt class="docutils literal"><span class="pre">add_static_view</span></tt> directive we've made in the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file.  Any
number and type of static assets can be placed in this directory (or
subdirectories) and are just referred to by URL or by using the convenience
method <tt class="docutils literal"><span class="pre">static_url</span></tt>
e.g. <tt class="docutils literal"><span class="pre">request.static_url('{{package}}:static/foo.css')</span></tt> within templates.</p>
</div>
</div>
<div class="section" id="adding-routes-to-init-py">
<h2>Adding Routes to <tt class="docutils literal"><span class="pre">__init__.py</span></tt><a class="headerlink" href="#adding-routes-to-init-py" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file contains
<a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.add_route()</span></tt></a> calls which serve to add routes
to our application.  First, we’ll get rid of the existing route created by
the template using the name <tt class="docutils literal"><span class="pre">'home'</span></tt>. It’s only an example and isn’t
relevant to our application.</p>
<p>We then need to add four calls to <tt class="docutils literal"><span class="pre">add_route</span></tt>.  Note that the <em>ordering</em> of
these declarations is very important.  <tt class="docutils literal"><span class="pre">route</span></tt> declarations are matched in
the order they're found in the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file.</p>
<ol class="arabic simple">
<li>Add a declaration which maps the pattern <tt class="docutils literal"><span class="pre">/</span></tt> (signifying the root URL)
to the route named <tt class="docutils literal"><span class="pre">view_wiki</span></tt>.  It maps to our <tt class="docutils literal"><span class="pre">view_wiki</span></tt> view
callable by virtue of the <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt> attached to the <tt class="docutils literal"><span class="pre">view_wiki</span></tt>
view function indicating <tt class="docutils literal"><span class="pre">route_name='view_wiki'</span></tt>.</li>
<li>Add a declaration which maps the pattern <tt class="docutils literal"><span class="pre">/{pagename}</span></tt> to the route named
<tt class="docutils literal"><span class="pre">view_page</span></tt>.  This is the regular view for a page.  It maps
to our <tt class="docutils literal"><span class="pre">view_page</span></tt> view callable by virtue of the <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt>
attached to the <tt class="docutils literal"><span class="pre">view_page</span></tt> view function indicating
<tt class="docutils literal"><span class="pre">route_name='view_page'</span></tt>.</li>
<li>Add a declaration which maps the pattern <tt class="docutils literal"><span class="pre">/add_page/{pagename}</span></tt> to the
route named <tt class="docutils literal"><span class="pre">add_page</span></tt>.  This is the add view for a new page.  It maps
to our <tt class="docutils literal"><span class="pre">add_page</span></tt> view callable by virtue of the <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt>
attached to the <tt class="docutils literal"><span class="pre">add_page</span></tt> view function indicating
<tt class="docutils literal"><span class="pre">route_name='add_page'</span></tt>.</li>
<li>Add a declaration which maps the pattern <tt class="docutils literal"><span class="pre">/{pagename}/edit_page</span></tt> to the
route named <tt class="docutils literal"><span class="pre">edit_page</span></tt>.  This is the edit view for a page.  It maps
to our <tt class="docutils literal"><span class="pre">edit_page</span></tt> view callable by virtue of the <tt class="docutils literal"><span class="pre">&#64;view_config</span></tt>
attached to the <tt class="docutils literal"><span class="pre">edit_page</span></tt> view function indicating
<tt class="docutils literal"><span class="pre">route_name='edit_page'</span></tt>.</li>
</ol>
<p>As a result of our edits, the <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file should look
something like:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">engine_from_config</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DBSession</span><span class="p">,</span>
    <span class="n">Base</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function returns a Pyramid WSGI application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">engine_from_config</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;sqlalchemy.&#39;</span><span class="p">)</span>
    <span class="n">DBSession</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
<span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;view_wiki&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;view_page&#39;</span><span class="p">,</span> <span class="s">&#39;/{pagename}&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;add_page&#39;</span><span class="p">,</span> <span class="s">&#39;/add_page/{pagename}&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;edit_page&#39;</span><span class="p">,</span> <span class="s">&#39;/{pagename}/edit_page&#39;</span><span class="p">)</span>
</span>    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>(The highlighted lines are the ones that need to be added or edited.)</p>
</div>
<div class="section" id="viewing-the-application-in-a-browser">
<h2>Viewing the Application in a Browser<a class="headerlink" href="#viewing-the-application-in-a-browser" title="Permalink to this headline">¶</a></h2>
<p>We can finally examine our application in a browser (See
<a class="reference internal" href="installation.html#wiki2-start-the-application"><em>Starting the Application</em></a>).  Launch a browser and visit
each of the following URLs, check that the result is as expected:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543">http://localhost:6543</a> in a browser invokes the
<tt class="docutils literal"><span class="pre">view_wiki</span></tt> view.  This always redirects to the <tt class="docutils literal"><span class="pre">view_page</span></tt> view
of the FrontPage page object.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage">http://localhost:6543/FrontPage</a> in a browser invokes
the <tt class="docutils literal"><span class="pre">view_page</span></tt> view of the front page object.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage/edit_page">http://localhost:6543/FrontPage/edit_page</a> in a browser
invokes the edit view for the front page object.</li>
<li><a class="reference external" href="http://localhost:6543/add_page/SomePageName">http://localhost:6543/add_page/SomePageName</a> in a
browser invokes the add view for a page.</li>
<li>To generate an error, visit <a class="reference external" href="http://localhost:6543/foobars/edit_page">http://localhost:6543/foobars/edit_page</a> which
will generate a <tt class="docutils literal"><span class="pre">NoResultFound:</span> <span class="pre">No</span> <span class="pre">row</span> <span class="pre">was</span> <span class="pre">found</span> <span class="pre">for</span> <span class="pre">one()</span></tt> error.
You'll see an interactive traceback facility provided
by <a class="reference internal" href="../../glossary.html#term-pyramid-debugtoolbar"><em class="xref std std-term">pyramid_debugtoolbar</em></a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Views</a><ul>
<li><a class="reference internal" href="#declaring-dependencies-in-our-setup-py-file">Declaring Dependencies in Our <tt class="docutils literal"><span class="pre">setup.py</span></tt> File</a></li>
<li><a class="reference internal" href="#running-setup-py-develop">Running <tt class="docutils literal"><span class="pre">setup.py</span> <span class="pre">develop</span></tt></a></li>
<li><a class="reference internal" href="#changing-the-views-py-file">Changing the <tt class="docutils literal"><span class="pre">views.py</span></tt> File</a><ul>
<li><a class="reference internal" href="#the-view-wiki-view-function">The <tt class="docutils literal"><span class="pre">view_wiki</span></tt> view function</a></li>
<li><a class="reference internal" href="#the-view-page-view-function">The <tt class="docutils literal"><span class="pre">view_page</span></tt> view function</a></li>
<li><a class="reference internal" href="#the-add-page-view-function">The <tt class="docutils literal"><span class="pre">add_page</span></tt> view function</a></li>
<li><a class="reference internal" href="#the-edit-page-view-function">The <tt class="docutils literal"><span class="pre">edit_page</span></tt> view function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-templates">Adding Templates</a><ul>
<li><a class="reference internal" href="#the-view-pt-template">The <tt class="docutils literal"><span class="pre">view.pt</span></tt> Template</a></li>
<li><a class="reference internal" href="#the-edit-pt-template">The <tt class="docutils literal"><span class="pre">edit.pt</span></tt> Template</a></li>
<li><a class="reference internal" href="#static-assets">Static Assets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-routes-to-init-py">Adding Routes to <tt class="docutils literal"><span class="pre">__init__.py</span></tt></a></li>
<li><a class="reference internal" href="#viewing-the-application-in-a-browser">Viewing the Application in a Browser</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="definingmodels.html"
                        title="previous chapter">Defining the Domain Model</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="authorization.html"
                        title="next chapter">Adding Authorization</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="authorization.html" title="Adding Authorization"
             >next</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             >previous</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li>
          <li><a href="index.html" >SQLAlchemy + URL Dispatch Wiki Tutorial</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../../copyright.html">Copyright</a> 2008-2014, Agendaless Consulting.
      Last updated on Nov 09, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>