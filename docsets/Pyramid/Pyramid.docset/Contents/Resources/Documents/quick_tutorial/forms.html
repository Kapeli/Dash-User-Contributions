<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>18: Forms and Validation With Deform &mdash; The Pyramid Web Framework v1.5</title>
    
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="The Pyramid Web Framework v1.5" href="../index.html" />
    <link rel="up" title="Quick Tutorial for Pyramid" href="index.html" />
    <link rel="next" title="19: Databases Using SQLAlchemy" href="databases.html" />
    <link rel="prev" title="17: Transient Data Using Sessions" href="sessions.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head>
  <body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="databases.html" title="19: Databases Using SQLAlchemy"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sessions.html" title="17: Transient Data Using Sessions"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Quick Tutorial for Pyramid</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="forms-and-validation-with-deform">
<span id="qtut-forms"></span><h1>18: Forms and Validation With Deform<a class="headerlink" href="#forms-and-validation-with-deform" title="Permalink to this headline">¶</a></h1>
<p>Schema-driven, autogenerated forms with validation.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Modern web applications deal extensively with forms. Developers,
though, have a wide range of philosophies about how frameworks should
help them with their forms. As such, Pyramid doesn't directly bundle
one particular form library. Instead, there are a variety of form
libraries that are easy to use in Pyramid.</p>
<p><a class="reference external" href="http://docs.pylonsproject.org/projects/deform/en/latest/index.html#overview" title="(in deform v0.9.9)"><em class="xref std std-ref">Deform</em></a>
is one such library. In this step, we introduce Deform for our
forms and validation. This also gives us the
<a class="reference external" href="http://docs.pylonsproject.org/projects/colander/en/latest/index.html#overview" title="(in colander v1.0b1)"><em class="xref std std-ref">Colander</em></a> for schemas and validation.</p>
<p>Deform is getting a facelift, with styling from Twitter Bootstrap and
advanced widgets from popular JavaScript projects. The work began in
<tt class="docutils literal"><span class="pre">deform_bootstrap</span></tt> and is being merged into an update to Deform.</p>
</div>
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Make a schema using Colander, the companion to Deform</li>
<li>Create a form with Deform and change our views to handle validation</li>
</ul>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">First we copy the results of the <tt class="docutils literal"><span class="pre">view_classes</span></tt> step:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ..; cp -r view_classes forms; <span class="nb">cd </span>forms
</pre></div>
</div>
</li>
<li><p class="first">Let's edit <tt class="docutils literal"><span class="pre">forms/setup.py</span></tt> to declare a dependency on Deform
(which then pulls in Colander as a dependency:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;pyramid&#39;</span><span class="p">,</span>
    <span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">,</span>
    <span class="s">&#39;deform&#39;</span>
<span class="p">]</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;tutorial&#39;</span><span class="p">,</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="n">entry_points</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      [paste.app_factory]</span>
<span class="s">      main = tutorial:main</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">We can now install our project in development mode:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ $VENV</span>/bin/python setup.py develop
</pre></div>
</div>
</li>
<li><p class="first">Register a static view in <tt class="docutils literal"><span class="pre">forms/tutorial/__init__.py</span></tt> for
Deform's CSS/JS etc. as well as our demo wikipage scenario's
views:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;wiki_view&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;wikipage_add&#39;</span><span class="p">,</span> <span class="s">&#39;/add&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;wikipage_view&#39;</span><span class="p">,</span> <span class="s">&#39;/{uid}&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;wikipage_edit&#39;</span><span class="p">,</span> <span class="s">&#39;/{uid}/edit&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s">&#39;deform_static&#39;</span><span class="p">,</span> <span class="s">&#39;deform:static/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s">&#39;.views&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Implement the new views, as well as the form schemas and some
dummy data, in <tt class="docutils literal"><span class="pre">forms/tutorial/views.py</span></tt>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">colander</span>
<span class="kn">import</span> <span class="nn">deform.widget</span>

<span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>
<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>

<span class="n">pages</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;100&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Page 100&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&#39;&lt;em&gt;100&lt;/em&gt;&#39;</span><span class="p">),</span>
    <span class="s">&#39;101&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s">&#39;101&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Page 101&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&#39;&lt;em&gt;101&lt;/em&gt;&#39;</span><span class="p">),</span>
    <span class="s">&#39;102&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s">&#39;102&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Page 102&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&#39;&lt;em&gt;102&lt;/em&gt;&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">WikiPage</span><span class="p">(</span><span class="n">colander</span><span class="o">.</span><span class="n">MappingSchema</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">colander</span><span class="o">.</span><span class="n">SchemaNode</span><span class="p">(</span><span class="n">colander</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">colander</span><span class="o">.</span><span class="n">SchemaNode</span><span class="p">(</span>
        <span class="n">colander</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">deform</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">RichTextWidget</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">WikiViews</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wiki_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">WikiPage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">deform</span><span class="o">.</span><span class="n">Form</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;submit&#39;</span><span class="p">,))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reqts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiki_form</span><span class="o">.</span><span class="n">get_widget_resources</span><span class="p">()</span>

    <span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;wiki_view&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;wiki_view.pt&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wiki_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pages</span><span class="o">=</span><span class="n">pages</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;wikipage_add&#39;</span><span class="p">,</span>
                 <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;wikipage_addedit.pt&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wikipage_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiki_form</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">&#39;submit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">appstruct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiki_form</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">deform</span><span class="o">.</span><span class="n">ValidationFailure</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c"># Form is NOT valid</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>

            <span class="c"># Form is valid, make a new identifier and add to list</span>
            <span class="n">last_uid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pages</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">new_uid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">last_uid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">pages</span><span class="p">[</span><span class="n">new_uid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">uid</span><span class="o">=</span><span class="n">new_uid</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">appstruct</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">appstruct</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c"># Now visit new page</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;wikipage_view&#39;</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="n">new_uid</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>

    <span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;wikipage_view&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;wikipage_view.pt&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wikipage_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">pages</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">)</span>

    <span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s">&#39;wikipage_edit&#39;</span><span class="p">,</span>
                 <span class="n">renderer</span><span class="o">=</span><span class="s">&#39;wikipage_addedit.pt&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wikipage_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">pages</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>

        <span class="n">wiki_form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wiki_form</span>

        <span class="k">if</span> <span class="s">&#39;submit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">appstruct</span> <span class="o">=</span> <span class="n">wiki_form</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">deform</span><span class="o">.</span><span class="n">ValidationFailure</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>

            <span class="c"># Change the content and redirect to the view</span>
            <span class="n">page</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">appstruct</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
            <span class="n">page</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">appstruct</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>

            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;wikipage_view&#39;</span><span class="p">,</span>
                                         <span class="n">uid</span><span class="o">=</span><span class="n">page</span><span class="p">[</span><span class="s">&#39;uid&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">wiki_form</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">A template for the top of the &quot;wiki&quot; in
<tt class="docutils literal"><span class="pre">forms/tutorial/wiki_view.pt</span></tt>:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Wiki: View<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Wiki<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${request.route_url(&#39;wikipage_add&#39;)}&quot;</span><span class="nt">&gt;</span>Add
    WikiPage<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">tal:repeat=</span><span class="s">&quot;page pages&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${request.route_url(&#39;wikipage_view&#39;, uid=page.uid)}&quot;</span><span class="nt">&gt;</span>
                ${page.title}
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Another template for adding/editing in
<tt class="docutils literal"><span class="pre">forms/tutorial/wikipage_addedit.pt</span></tt>:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>WikiPage: Add/Edit<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;tal:block</span> <span class="na">tal:repeat=</span><span class="s">&quot;reqt view.reqts[&#39;css&#39;]&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span>
              <span class="na">href=</span><span class="s">&quot;${request.static_url(reqt)}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/tal:block&gt;</span>
    <span class="nt">&lt;tal:block</span> <span class="na">tal:repeat=</span><span class="s">&quot;reqt view.reqts[&#39;js&#39;]&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;${request.static_url(reqt)}&quot;</span>
                <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/tal:block&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Wiki<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>${structure: form}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
    <span class="nx">deform</span><span class="p">.</span><span class="nx">load</span><span class="p">()</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Finally, a template at <tt class="docutils literal"><span class="pre">forms/tutorial/wikipage_view.pt</span></tt>
for viewing a wiki page:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>WikiPage: View<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${request.route_url(&#39;wiki_view&#39;)}&quot;</span><span class="nt">&gt;</span>
    Up
<span class="nt">&lt;/a&gt;</span> |
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;${request.route_url(&#39;wikipage_edit&#39;, uid=page.uid)}&quot;</span><span class="nt">&gt;</span>
    Edit
<span class="nt">&lt;/a&gt;</span>

<span class="nt">&lt;h1&gt;</span>${page.title}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>${structure: page.body}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Run your Pyramid application with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ $VENV</span>/bin/pserve development.ini --reload
</pre></div>
</div>
</li>
<li><p class="first">Open <a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a> in a browser.</p>
</li>
</ol>
</div>
<div class="section" id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<p>This step helps illustrate the utility of asset specifications for
static assets. We have an outside package called Deform with static
assets which need to be published. We don't have to know where on disk
it is located. We point at the package, then the path inside the package.</p>
<p>We just need to include a call to <tt class="docutils literal"><span class="pre">add_static_view</span></tt> to make that
directory available at a URL. For Pyramid-specific pages,
Pyramid provides a facility (<tt class="docutils literal"><span class="pre">config.include()</span></tt>) which even makes
that unnecessary for consumers of a package. (Deform is not specific to
Pyramid.)</p>
<p>Our forms have rich widgets which need the static CSS and JS just
mentioned. Deform has a <a class="reference external" href="http://docs.pylonsproject.org/projects/deform/en/latest/glossary.html#term-resource-registry" title="(in deform v0.9.9)"><em class="xref std std-term">resource registry</em></a> which allows widgets
to specify which JS and CSS are needed. Our <tt class="docutils literal"><span class="pre">wikipage_addedit.pt</span></tt>
template shows how we iterated over that data to generate markup that
includes the needed resources.</p>
<p>Our add and edit views use a pattern called <em>self-posting forms</em>.
Meaning, the same URL is used to <tt class="docutils literal"><span class="pre">GET</span></tt> the form as is used to
<tt class="docutils literal"><span class="pre">POST</span></tt> the form. The route, the view, and the template are the same
whether you are walking up to it the first time or you clicked a button.</p>
<p>Inside the view we do <tt class="docutils literal"><span class="pre">if</span> <span class="pre">'submit'</span> <span class="pre">in</span> <span class="pre">self.request.params:</span></tt> to see if
this form was a <tt class="docutils literal"><span class="pre">POST</span></tt> where the user clicked on a particular button
<tt class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">name=&quot;submit&quot;&gt;</span></tt>.</p>
<p>The form controller then follows a typical pattern:</p>
<ul class="simple">
<li>If you are doing a GET, skip over and just return the form</li>
<li>If you are doing a POST, validate the form contents</li>
<li>If the form is invalid, bail out by re-rendering the form with the
supplied <tt class="docutils literal"><span class="pre">POST</span></tt> data</li>
<li>If the validation succeeded, perform some action and issue a
redirect via <tt class="docutils literal"><span class="pre">HTTPFound</span></tt>.</li>
</ul>
<p>We are, in essence, writing our own form controller. Other
Pyramid-based systems, including <tt class="docutils literal"><span class="pre">pyramid_deform</span></tt>, provide a
form-centric view class which automates much of this branching and
routing.</p>
</div>
<div class="section" id="extra-credit">
<h2>Extra Credit<a class="headerlink" href="#extra-credit" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Give a try at a button that goes to a delete view for a
particular wiki page.</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">18: Forms and Validation With Deform</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#objectives">Objectives</a></li>
<li><a class="reference internal" href="#steps">Steps</a></li>
<li><a class="reference internal" href="#analysis">Analysis</a></li>
<li><a class="reference internal" href="#extra-credit">Extra Credit</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sessions.html"
                        title="previous chapter">17: Transient Data Using Sessions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="databases.html"
                        title="next chapter">19: Databases Using SQLAlchemy</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="databases.html" title="19: Databases Using SQLAlchemy"
             >next</a> |</li>
        <li class="right" >
          <a href="sessions.html" title="17: Transient Data Using Sessions"
             >previous</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li>
          <li><a href="index.html" >Quick Tutorial for Pyramid</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2008-2014, Agendaless Consulting.
      Last updated on Nov 09, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>