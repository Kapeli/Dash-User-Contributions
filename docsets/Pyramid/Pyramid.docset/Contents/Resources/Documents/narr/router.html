<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Request Processing &mdash; The Pyramid Web Framework v1.5</title>
    
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="The Pyramid Web Framework v1.5" href="../index.html" />
    <link rel="next" title="URL Dispatch" href="urldispatch.html" />
    <link rel="prev" title="Startup" href="startup.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head>
  <body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="urldispatch.html" title="URL Dispatch"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="startup.html" title="Startup"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="request-processing">
<span id="router-chapter"></span><span id="index-0"></span><h1>Request Processing<a class="headerlink" href="#request-processing" title="Permalink to this headline">Â¶</a></h1>
<p>Once a <span>Pyramid</span> application is up and running, it is ready to accept
requests and return responses.  What happens from the time a <a class="reference internal" href="../glossary.html#term-wsgi"><em class="xref std std-term">WSGI</em></a>
request enters a <span>Pyramid</span> application through to the point that
<span>Pyramid</span> hands off a response back to WSGI for upstream processing?</p>
<ol class="arabic simple">
<li>A user initiates a request from his browser to the hostname and port
number of the WSGI server used by the <span>Pyramid</span> application.</li>
<li>The WSGI server used by the <span>Pyramid</span> application passes the WSGI
environment to the <tt class="docutils literal"><span class="pre">__call__</span></tt> method of the <span>Pyramid</span>
<a class="reference internal" href="../glossary.html#term-router"><em class="xref std std-term">router</em></a> object.</li>
<li>A <a class="reference internal" href="../glossary.html#term-request"><em class="xref std std-term">request</em></a> object is created based on the WSGI environment.</li>
<li>The <a class="reference internal" href="../glossary.html#term-application-registry"><em class="xref std std-term">application registry</em></a> and the <a class="reference internal" href="../glossary.html#term-request"><em class="xref std std-term">request</em></a> object created in
the last step are pushed on to the <a class="reference internal" href="../glossary.html#term-thread-local"><em class="xref std std-term">thread local</em></a> stack that
<span>Pyramid</span> uses to allow the functions named
<a class="reference internal" href="../api/threadlocal.html#pyramid.threadlocal.get_current_request" title="pyramid.threadlocal.get_current_request"><tt class="xref py py-func docutils literal"><span class="pre">get_current_request()</span></tt></a> and
<a class="reference internal" href="../api/threadlocal.html#pyramid.threadlocal.get_current_registry" title="pyramid.threadlocal.get_current_registry"><tt class="xref py py-func docutils literal"><span class="pre">get_current_registry()</span></tt></a> to work.</li>
<li>A <a class="reference internal" href="../api/events.html#pyramid.events.NewRequest" title="pyramid.events.NewRequest"><tt class="xref py py-class docutils literal"><span class="pre">NewRequest</span></tt></a> <a class="reference internal" href="../glossary.html#term-event"><em class="xref std std-term">event</em></a> is sent to any
subscribers.</li>
<li>If any <a class="reference internal" href="../glossary.html#term-route"><em class="xref std std-term">route</em></a> has been defined within application configuration,
the <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-router"><em class="xref std std-term">router</em></a> calls a <a class="reference internal" href="../glossary.html#term-url-dispatch"><em class="xref std std-term">URL dispatch</em></a> &quot;route
mapper.&quot;  The job of the mapper is to examine the request to determine
whether any user-defined <a class="reference internal" href="../glossary.html#term-route"><em class="xref std std-term">route</em></a> matches the current WSGI
environment.  The <a class="reference internal" href="../glossary.html#term-router"><em class="xref std std-term">router</em></a> passes the request as an argument to the
mapper.</li>
<li>If any route matches, the route mapper adds attributes to the request:
<tt class="docutils literal"><span class="pre">matchdict</span></tt> and <tt class="docutils literal"><span class="pre">matched_route</span></tt> attributes are added to the request
object.  The former contains a dictionary representing the matched dynamic
elements of the request's <tt class="docutils literal"><span class="pre">PATH_INFO</span></tt> value, the latter contains the
<a class="reference internal" href="../api/interfaces.html#pyramid.interfaces.IRoute" title="pyramid.interfaces.IRoute"><tt class="xref py py-class docutils literal"><span class="pre">IRoute</span></tt></a> object representing the route which
matched.  The root object associated with the route found is also
generated: if the <a class="reference internal" href="../glossary.html#term-route-configuration"><em class="xref std std-term">route configuration</em></a> which matched has an
associated <tt class="docutils literal"><span class="pre">factory</span></tt> argument, this factory is used to generate the
root object, otherwise a default <a class="reference internal" href="../glossary.html#term-root-factory"><em class="xref std std-term">root factory</em></a> is used.</li>
<li>If a route match was <em>not</em> found, and a <tt class="docutils literal"><span class="pre">root_factory</span></tt> argument was
passed to the <a class="reference internal" href="../glossary.html#term-configurator"><em class="xref std std-term">Configurator</em></a> constructor, that callable is used to
generate the root object.  If the <tt class="docutils literal"><span class="pre">root_factory</span></tt> argument passed to the
Configurator constructor was <tt class="docutils literal"><span class="pre">None</span></tt>, a default root factory is used to
generate a root object.</li>
<li>The <span>Pyramid</span> router calls a &quot;traverser&quot; function with the root
object and the request.  The traverser function attempts to traverse the
root object (using any existing <tt class="docutils literal"><span class="pre">__getitem__</span></tt> on the root object and
subobjects) to find a <a class="reference internal" href="../glossary.html#term-context"><em class="xref std std-term">context</em></a>.  If the root object has no
<tt class="docutils literal"><span class="pre">__getitem__</span></tt> method, the root itself is assumed to be the context.  The
exact traversal algorithm is described in <a class="reference internal" href="traversal.html#traversal-chapter"><em>Traversal</em></a>. The
traverser function returns a dictionary, which contains a <a class="reference internal" href="../glossary.html#term-context"><em class="xref std std-term">context</em></a>
and a <a class="reference internal" href="../glossary.html#term-view-name"><em class="xref std std-term">view name</em></a> as well as other ancillary information.</li>
<li>The request is decorated with various names returned from the traverser
(such as <tt class="docutils literal"><span class="pre">context</span></tt>, <tt class="docutils literal"><span class="pre">view_name</span></tt>, and so forth), so they can be
accessed via e.g. <tt class="docutils literal"><span class="pre">request.context</span></tt> within <a class="reference internal" href="../glossary.html#term-view"><em class="xref std std-term">view</em></a> code.</li>
<li>A <a class="reference internal" href="../api/events.html#pyramid.events.ContextFound" title="pyramid.events.ContextFound"><tt class="xref py py-class docutils literal"><span class="pre">ContextFound</span></tt></a> <a class="reference internal" href="../glossary.html#term-event"><em class="xref std std-term">event</em></a> is sent to any
subscribers.</li>
<li><span>Pyramid</span> looks up a <a class="reference internal" href="../glossary.html#term-view"><em class="xref std std-term">view</em></a> callable using the context, the
request, and the view name.  If a view callable doesn't exist for this
combination of objects (based on the type of the context, the type of the
request, and the value of the view name, and any <a class="reference internal" href="../glossary.html#term-predicate"><em class="xref std std-term">predicate</em></a>
attributes applied to the view configuration), <span>Pyramid</span> raises a
<a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPNotFound" title="pyramid.httpexceptions.HTTPNotFound"><tt class="xref py py-class docutils literal"><span class="pre">HTTPNotFound</span></tt></a> exception, which is meant to
be caught by a surrounding <a class="reference internal" href="../glossary.html#term-exception-view"><em class="xref std std-term">exception view</em></a>.</li>
<li>If a view callable was found, <span>Pyramid</span> attempts to call it.  If an
<a class="reference internal" href="../glossary.html#term-authorization-policy"><em class="xref std std-term">authorization policy</em></a> is in use, and the view configuration is
protected by a <a class="reference internal" href="../glossary.html#term-permission"><em class="xref std std-term">permission</em></a>, <span>Pyramid</span> determines whether the
view callable being asked for can be executed by the requesting user based
on credential information in the request and security information attached
to the context.  If the view execution is allowed, <span>Pyramid</span> calls
the view callable to obtain a response.  If view execution is forbidden,
<span>Pyramid</span> raises a <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPForbidden" title="pyramid.httpexceptions.HTTPForbidden"><tt class="xref py py-class docutils literal"><span class="pre">HTTPForbidden</span></tt></a>
exception.</li>
<li>If any exception is raised within a <a class="reference internal" href="../glossary.html#term-root-factory"><em class="xref std std-term">root factory</em></a>, by
<a class="reference internal" href="../glossary.html#term-traversal"><em class="xref std std-term">traversal</em></a>, by a <a class="reference internal" href="../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a> or by <span>Pyramid</span> itself
(such as when it raises <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPNotFound" title="pyramid.httpexceptions.HTTPNotFound"><tt class="xref py py-class docutils literal"><span class="pre">HTTPNotFound</span></tt></a> or
<a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPForbidden" title="pyramid.httpexceptions.HTTPForbidden"><tt class="xref py py-class docutils literal"><span class="pre">HTTPForbidden</span></tt></a>), the router catches the
exception, and attaches it to the request as the <tt class="docutils literal"><span class="pre">exception</span></tt> attribute.
It then attempts to find a <a class="reference internal" href="../glossary.html#term-exception-view"><em class="xref std std-term">exception view</em></a> for the exception that
was caught.  If it finds an exception view callable, that callable is
called, and is presumed to generate a response.  If an <a class="reference internal" href="../glossary.html#term-exception-view"><em class="xref std std-term">exception
view</em></a> that matches the exception cannot be found, the exception is
reraised.</li>
<li>The following steps occur only when a <a class="reference internal" href="../glossary.html#term-response"><em class="xref std std-term">response</em></a> could be
successfully generated by a normal <a class="reference internal" href="../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a> or an
<a class="reference internal" href="../glossary.html#term-exception-view"><em class="xref std std-term">exception view</em></a> callable.  <span>Pyramid</span> will attempt to execute
any <a class="reference internal" href="../glossary.html#term-response-callback"><em class="xref std std-term">response callback</em></a> functions attached via
<a class="reference internal" href="../api/request.html#pyramid.request.Request.add_response_callback" title="pyramid.request.Request.add_response_callback"><tt class="xref py py-meth docutils literal"><span class="pre">add_response_callback()</span></tt></a>.  A
<a class="reference internal" href="../api/events.html#pyramid.events.NewResponse" title="pyramid.events.NewResponse"><tt class="xref py py-class docutils literal"><span class="pre">NewResponse</span></tt></a> <a class="reference internal" href="../glossary.html#term-event"><em class="xref std std-term">event</em></a> is then sent to any
subscribers.  The response object's <tt class="docutils literal"><span class="pre">__call__</span></tt> method is then used to
generate a WSGI response.  The response is sent back to the upstream WSGI
server.</li>
<li><span>Pyramid</span> will attempt to execute any <a class="reference internal" href="../glossary.html#term-finished-callback"><em class="xref std std-term">finished
callback</em></a> functions attached via
<a class="reference internal" href="../api/request.html#pyramid.request.Request.add_finished_callback" title="pyramid.request.Request.add_finished_callback"><tt class="xref py py-meth docutils literal"><span class="pre">add_finished_callback()</span></tt></a>.</li>
<li>The <a class="reference internal" href="../glossary.html#term-thread-local"><em class="xref std std-term">thread local</em></a> stack is popped.</li>
</ol>
<img alt="../_images/router.png" src="../_images/router.png" />
<p>This is a very high-level overview that leaves out various details.  For more
detail about subsystems invoked by the <span>Pyramid</span> router such as
traversal, URL dispatch, views, and event processing, see
<a class="reference internal" href="urldispatch.html#urldispatch-chapter"><em>URL Dispatch</em></a>, <a class="reference internal" href="views.html#views-chapter"><em>Views</em></a>, and <a class="reference internal" href="events.html#events-chapter"><em>Using Events</em></a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="startup.html"
                        title="previous chapter">Startup</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="urldispatch.html"
                        title="next chapter">URL Dispatch</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="urldispatch.html" title="URL Dispatch"
             >next</a> |</li>
        <li class="right" >
          <a href="startup.html" title="Startup"
             >previous</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2008-2014, Agendaless Consulting.
      Last updated on Nov 09, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>