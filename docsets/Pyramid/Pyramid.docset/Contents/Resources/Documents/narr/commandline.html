<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Command-Line Pyramid &mdash; The Pyramid Web Framework v1.5</title>
    
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="The Pyramid Web Framework v1.5" href="../index.html" />
    <link rel="next" title="Internationalization and Localization" href="i18n.html" />
    <link rel="prev" title="PasteDeploy Configuration Files" href="paste.html" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head>
  <body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="i18n.html" title="Internationalization and Localization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="paste.html" title="PasteDeploy Configuration Files"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="command-line-pyramid">
<span id="command-line-chapter"></span><h1>Command-Line Pyramid<a class="headerlink" href="#command-line-pyramid" title="Permalink to this headline">¶</a></h1>
<p>Your <span>Pyramid</span> application can be controlled and inspected using a
variety of command-line utilities.  These utilities are documented in this
chapter.</p>
<div class="section" id="displaying-matching-views-for-a-given-url">
<span id="displaying-matching-views"></span><span id="index-0"></span><h2>Displaying Matching Views for a Given URL<a class="headerlink" href="#displaying-matching-views-for-a-given-url" title="Permalink to this headline">¶</a></h2>
<p>For a big application with several views, it can be hard to keep the view
configuration details in your head, even if you defined all the views
yourself. You can use the <tt class="docutils literal"><span class="pre">pviews</span></tt> command in a terminal window to
print a summary of matching routes and views for a given URL in your
application. The <tt class="docutils literal"><span class="pre">pviews</span></tt> command accepts two arguments. The first
argument to <tt class="docutils literal"><span class="pre">pviews</span></tt> is the path to your application's <tt class="docutils literal"><span class="pre">.ini</span></tt> file and
section name inside the <tt class="docutils literal"><span class="pre">.ini</span></tt> file which points to your application.  This
should be of the format <tt class="docutils literal"><span class="pre">config_file#section_name</span></tt>. The second argument is
the URL to test for matching views.  The <tt class="docutils literal"><span class="pre">section_name</span></tt> may be omitted; if
it is, it's considered to be <tt class="docutils literal"><span class="pre">main</span></tt>.</p>
<p>Here is an example for a simple view configuration using <a class="reference internal" href="../glossary.html#term-traversal"><em class="xref std std-term">traversal</em></a>:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre>$ $VENV/bin/pviews development.ini#tutorial /FrontPage

URL = /FrontPage

    context: &lt;tutorial.models.Page object at 0xa12536c&gt;
    view name:

    View:
    -----
    tutorial.views.view_page
    required permission = view
</pre></div>
</td></tr></table></div>
<p>The output always has the requested URL at the top and below that all the
views that matched with their view configuration details. In this example
only one view matches, so there is just a single <em>View</em> section. For each
matching view, the full code path to the associated view callable is shown,
along with any permissions and predicates that are part of that view
configuration.</p>
<p>A more complex configuration might generate something like this:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre>$ $VENV/bin/pviews development.ini#shootout /about

URL = /about

    context: &lt;shootout.models.RootFactory object at 0xa56668c&gt;
    view name: about

    Route:
    ------
    route name: about
    route pattern: /about
    route path: /about
    subpath:
    route predicates (request method = GET)

        View:
        -----
        shootout.views.about_view
        required permission = view
        view predicates (request_param testing, header X/header)

    Route:
    ------
    route name: about_post
    route pattern: /about
    route path: /about
    subpath:
    route predicates (request method = POST)

        View:
        -----
        shootout.views.about_view_post
        required permission = view
        view predicates (request_param test)

        View:
        -----
        shootout.views.about_view_post2
        required permission = view
        view predicates (request_param test2)
</pre></div>
</td></tr></table></div>
<p>In this case, we are dealing with a <a class="reference internal" href="../glossary.html#term-url-dispatch"><em class="xref std std-term">URL dispatch</em></a> application. This
specific URL has two matching routes. The matching route information is
displayed first, followed by any views that are associated with that route.
As you can see from the second matching route output, a route can be
associated with more than one view.</p>
<p>For a URL that doesn't match any views, <tt class="docutils literal"><span class="pre">pviews</span></tt> will simply print out a
<em>Not found</em> message.</p>
</div>
<div class="section" id="the-interactive-shell">
<span id="interactive-shell"></span><span id="index-1"></span><h2>The Interactive Shell<a class="headerlink" href="#the-interactive-shell" title="Permalink to this headline">¶</a></h2>
<p>Once you've installed your program for development using <tt class="docutils literal"><span class="pre">setup.py</span>
<span class="pre">develop</span></tt>, you can use an interactive Python shell to execute expressions in
a Python environment exactly like the one that will be used when your
application runs &quot;for real&quot;.  To do so, use the <tt class="docutils literal"><span class="pre">pshell</span></tt> command line
utility.</p>
<p>The argument to <tt class="docutils literal"><span class="pre">pshell</span></tt> follows the format <tt class="docutils literal"><span class="pre">config_file#section_name</span></tt>
where <tt class="docutils literal"><span class="pre">config_file</span></tt> is the path to your application's <tt class="docutils literal"><span class="pre">.ini</span></tt> file and
<tt class="docutils literal"><span class="pre">section_name</span></tt> is the <tt class="docutils literal"><span class="pre">app</span></tt> section name inside the <tt class="docutils literal"><span class="pre">.ini</span></tt> file which
points to your application.  For example, if your application <tt class="docutils literal"><span class="pre">.ini</span></tt> file
might have a <tt class="docutils literal"><span class="pre">[app:main]</span></tt> section that looks like so:</p>
<div class="highlight-ini"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">[app:main]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:MyProject</span>
<span class="na">pyramid.reload_templates</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">pyramid.debug_authorization</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">pyramid.debug_notfound</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">pyramid.debug_templates</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">pyramid.default_locale_name</span> <span class="o">=</span> <span class="s">en</span>
</pre></div>
</td></tr></table></div>
<p>If so, you can use the following command to invoke a debug shell using the
name <tt class="docutils literal"><span class="pre">main</span></tt> as a section name:</p>
<div class="highlight-text"><div class="highlight"><pre>$ $VENV/bin/pshell starter/development.ini#main
Python 2.6.5 (r265:79063, Apr 29 2010, 00:31:32)
[GCC 4.4.3] on linux2
Type &quot;help&quot; for more information.

Environment:
  app          The WSGI application.
  registry     Active Pyramid registry.
  request      Active request object.
  root         Root of the default resource tree.
  root_factory Default root factory used to create `root`.

&gt;&gt;&gt; root
&lt;myproject.resources.MyResource object at 0x445270&gt;
&gt;&gt;&gt; registry
&lt;Registry myproject&gt;
&gt;&gt;&gt; registry.settings[&#39;pyramid.debug_notfound&#39;]
False
&gt;&gt;&gt; from myproject.views import my_view
&gt;&gt;&gt; from pyramid.request import Request
&gt;&gt;&gt; r = Request.blank(&#39;/&#39;)
&gt;&gt;&gt; my_view(r)
{&#39;project&#39;: &#39;myproject&#39;}
</pre></div>
</div>
<p>The WSGI application that is loaded will be available in the shell as the
<tt class="docutils literal"><span class="pre">app</span></tt> global. Also, if the application that is loaded is the <span>Pyramid</span>
app with no surrounding <a class="reference internal" href="../glossary.html#term-middleware"><em class="xref std std-term">middleware</em></a>, the <tt class="docutils literal"><span class="pre">root</span></tt> object returned by
the default <a class="reference internal" href="../glossary.html#term-root-factory"><em class="xref std std-term">root factory</em></a>, <tt class="docutils literal"><span class="pre">registry</span></tt>, and <tt class="docutils literal"><span class="pre">request</span></tt> will be
available.</p>
<p>You can also simply rely on the <tt class="docutils literal"><span class="pre">main</span></tt> default section name by omitting any
hash after the filename:</p>
<div class="highlight-text"><div class="highlight"><pre>$ $VENV/bin/pshell starter/development.ini
</pre></div>
</div>
<p>Press <tt class="docutils literal"><span class="pre">Ctrl-D</span></tt> to exit the interactive shell (or <tt class="docutils literal"><span class="pre">Ctrl-Z</span></tt> on Windows).</p>
<div class="section" id="extending-the-shell">
<span id="extending-pshell"></span><span id="index-2"></span><h3>Extending the Shell<a class="headerlink" href="#extending-the-shell" title="Permalink to this headline">¶</a></h3>
<p>It is convenient when using the interactive shell often to have some
variables significant to your application already loaded as globals when
you start the <tt class="docutils literal"><span class="pre">pshell</span></tt>. To facilitate this, <tt class="docutils literal"><span class="pre">pshell</span></tt> will look for a
special <tt class="docutils literal"><span class="pre">[pshell]</span></tt> section in your INI file and expose the subsequent
key/value pairs to the shell.  Each key is a variable name that will be
global within the pshell session; each value is a <a class="reference internal" href="../glossary.html#term-dotted-python-name"><em class="xref std std-term">dotted Python name</em></a>.
If specified, the special key <tt class="docutils literal"><span class="pre">setup</span></tt> should be a <a class="reference internal" href="../glossary.html#term-dotted-python-name"><em class="xref std std-term">dotted Python name</em></a>
pointing to a callable that accepts the dictionary of globals that will
be loaded into the shell. This allows for some custom initializing code
to be executed each time the <tt class="docutils literal"><span class="pre">pshell</span></tt> is run. The <tt class="docutils literal"><span class="pre">setup</span></tt> callable
can also be specified from the commandline using the <tt class="docutils literal"><span class="pre">--setup</span></tt> option
which will override the key in the INI file.</p>
<p>For example, you want to expose your model to the shell, along with the
database session so that you can mutate the model on an actual database.
Here, we'll assume your model is stored in the <tt class="docutils literal"><span class="pre">myapp.models</span></tt> package.</p>
<div class="highlight-ini"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">[pshell]</span>
<span class="na">setup</span> <span class="o">=</span> <span class="s">myapp.lib.pshell.setup</span>
<span class="na">m</span> <span class="o">=</span> <span class="s">myapp.models</span>
<span class="na">session</span> <span class="o">=</span> <span class="s">myapp.models.DBSession</span>
<span class="na">t</span> <span class="o">=</span> <span class="s">transaction</span>
</pre></div>
</td></tr></table></div>
<p>By defining the <tt class="docutils literal"><span class="pre">setup</span></tt> callable, we will create the module
<tt class="docutils literal"><span class="pre">myapp.lib.pshell</span></tt> containing a callable named <tt class="docutils literal"><span class="pre">setup</span></tt> that will receive
the global environment before it is exposed to the shell. Here we mutate the
environment's request as well as add a new value containing a WebTest version
of the application to which we can easily submit requests.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># myapp/lib/pshell.py</span>
<span class="kn">from</span> <span class="nn">webtest</span> <span class="kn">import</span> <span class="n">TestApp</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="n">env</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s">&#39;www.example.com&#39;</span>
    <span class="n">env</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="s">&#39;https&#39;</span>
    <span class="n">env</span><span class="p">[</span><span class="s">&#39;testapp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TestApp</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;app&#39;</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
<p>When this INI file is loaded, the extra variables <tt class="docutils literal"><span class="pre">m</span></tt>, <tt class="docutils literal"><span class="pre">session</span></tt> and
<tt class="docutils literal"><span class="pre">t</span></tt> will be available for use immediately. Since a <tt class="docutils literal"><span class="pre">setup</span></tt> callable
was also specified, it is executed and a new variable <tt class="docutils literal"><span class="pre">testapp</span></tt> is
exposed, and the request is configured to generate urls from the host
<tt class="docutils literal"><span class="pre">http://www.example.com</span></tt>. For example:</p>
<div class="highlight-text"><div class="highlight"><pre>$ $VENV/bin/pshell starter/development.ini
Python 2.6.5 (r265:79063, Apr 29 2010, 00:31:32)
[GCC 4.4.3] on linux2
Type &quot;help&quot; for more information.

Environment:
  app          The WSGI application.
  registry     Active Pyramid registry.
  request      Active request object.
  root         Root of the default resource tree.
  root_factory Default root factory used to create `root`.
  testapp      &lt;webtest.TestApp object at ...&gt;

Custom Variables:
  m            myapp.models
  session      myapp.models.DBSession
  t            transaction

&gt;&gt;&gt; testapp.get(&#39;/&#39;)
&lt;200 OK text/html body=&#39;&lt;!DOCTYPE...l&gt;\n&#39;/3337&gt;
&gt;&gt;&gt; request.route_url(&#39;home&#39;)
&#39;https://www.example.com/&#39;
</pre></div>
</div>
</div>
<div class="section" id="ipython-or-bpython">
<span id="index-3"></span><span id="id1"></span><h3>IPython or bpython<a class="headerlink" href="#ipython-or-bpython" title="Permalink to this headline">¶</a></h3>
<p>If you have <a class="reference external" href="http://en.wikipedia.org/wiki/IPython">IPython</a> and/or
<a class="reference external" href="http://bpython-interpreter.org/">bpython</a> in
the interpreter you use to invoke the <tt class="docutils literal"><span class="pre">pshell</span></tt> command, <tt class="docutils literal"><span class="pre">pshell</span></tt> will
autodiscover and use the first one found, in this order:
IPython, bpython, standard Python interpreter. However you could
specifically invoke one of your choice with the <tt class="docutils literal"><span class="pre">-p</span> <span class="pre">choice</span></tt> or
<tt class="docutils literal"><span class="pre">--python-shell</span> <span class="pre">choice</span></tt> option.</p>
<div class="highlight-text"><div class="highlight"><pre>$ $VENV/bin/pshell -p ipython | bpython | python development.ini#MyProject
</pre></div>
</div>
</div>
</div>
<div class="section" id="displaying-all-application-routes">
<span id="displaying-application-routes"></span><span id="index-4"></span><h2>Displaying All Application Routes<a class="headerlink" href="#displaying-all-application-routes" title="Permalink to this headline">¶</a></h2>
<p>You can use the <tt class="docutils literal"><span class="pre">proutes</span></tt> command in a terminal window to print a summary
of routes related to your application.  Much like the <tt class="docutils literal"><span class="pre">pshell</span></tt>
command (see <a class="reference internal" href="#interactive-shell"><em>The Interactive Shell</em></a>), the <tt class="docutils literal"><span class="pre">proutes</span></tt> command
accepts one argument with the format <tt class="docutils literal"><span class="pre">config_file#section_name</span></tt>.  The
<tt class="docutils literal"><span class="pre">config_file</span></tt> is the path to your application's <tt class="docutils literal"><span class="pre">.ini</span></tt> file, and
<tt class="docutils literal"><span class="pre">section_name</span></tt> is the <tt class="docutils literal"><span class="pre">app</span></tt> section name inside the <tt class="docutils literal"><span class="pre">.ini</span></tt> file which
points to your application.  By default, the <tt class="docutils literal"><span class="pre">section_name</span></tt> is <tt class="docutils literal"><span class="pre">main</span></tt> and
can be omitted.</p>
<p>For example:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre>$ $VENV/bin/proutes development.ini
Name            Pattern                        View
----            -------                        ----
home            /                              &lt;function my_view&gt;
home2           /                              &lt;function my_view&gt;
another         /another                       None
static/         static/*subpath                &lt;static_view object&gt;
catchall        /*subpath                      &lt;function static_view&gt;
</pre></div>
</td></tr></table></div>
<p><tt class="docutils literal"><span class="pre">proutes</span></tt> generates a table with three columns: <em>Name</em>, <em>Pattern</em>,
and <em>View</em>.  The items listed in the
Name column are route names, the items listed in the Pattern column are route
patterns, and the items listed in the View column are representations of the
view callable that will be invoked when a request matches the associated
route pattern.  The view column may show <tt class="docutils literal"><span class="pre">None</span></tt> if no associated view
callable could be found.  If no routes are configured within your
application, nothing will be printed to the console when <tt class="docutils literal"><span class="pre">proutes</span></tt>
is executed.</p>
</div>
<div class="section" id="displaying-tweens">
<span id="index-5"></span><span id="id2"></span><h2>Displaying &quot;Tweens&quot;<a class="headerlink" href="#displaying-tweens" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../glossary.html#term-tween"><em class="xref std std-term">tween</em></a> is a bit of code that sits between the main Pyramid
application request handler and the WSGI application which calls it.  A user
can get a representation of both the implicit tween ordering (the ordering
specified by calls to <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_tween" title="pyramid.config.Configurator.add_tween"><tt class="xref py py-meth docutils literal"><span class="pre">pyramid.config.Configurator.add_tween()</span></tt></a>) and the
explicit tween ordering (specified by the <tt class="docutils literal"><span class="pre">pyramid.tweens</span></tt> configuration
setting) orderings using the <tt class="docutils literal"><span class="pre">ptweens</span></tt> command.  Tween factories
will show up represented by their standard Python dotted name in the
<tt class="docutils literal"><span class="pre">ptweens</span></tt> output.</p>
<p>For example, here's the <tt class="docutils literal"><span class="pre">ptweens</span></tt> command run against a system
configured without any explicit tweens:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre>$ $VENV/bin/ptweens development.ini
&quot;pyramid.tweens&quot; config value NOT set (implicitly ordered tweens used)

Implicit Tween Chain

Position    Name                                                Alias
--------    ----                                                -----
-           -                                                   INGRESS
0           pyramid_debugtoolbar.toolbar.toolbar_tween_factory  pdbt
1           pyramid.tweens.excview_tween_factory                excview
-           -                                                   MAIN
</pre></div>
</td></tr></table></div>
<p>Here's the <tt class="docutils literal"><span class="pre">ptweens</span></tt> command run against a system configured <em>with</em>
explicit tweens defined in its <tt class="docutils literal"><span class="pre">development.ini</span></tt> file:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre>$ ptweens development.ini
&quot;pyramid.tweens&quot; config value set (explicitly ordered tweens used)

Explicit Tween Chain (used)

Position    Name
--------    ----
-           INGRESS
0           starter.tween_factory2
1           starter.tween_factory1
2           pyramid.tweens.excview_tween_factory
-           MAIN

Implicit Tween Chain (not used)

Position    Name
--------    ----
-           INGRESS
0           pyramid_debugtoolbar.toolbar.toolbar_tween_factory
1           pyramid.tweens.excview_tween_factory
-           MAIN
</pre></div>
</td></tr></table></div>
<p>Here's the application configuration section of the <tt class="docutils literal"><span class="pre">development.ini</span></tt> used
by the above <tt class="docutils literal"><span class="pre">ptweens</span></tt> command which reports that the explicit tween chain
is used:</p>
<div class="highlight-ini"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">[app:main]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:starter</span>
<span class="na">reload_templates</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">debug_authorization</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">debug_notfound</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">debug_routematch</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">debug_templates</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">default_locale_name</span> <span class="o">=</span> <span class="s">en</span>
<span class="na">pyramid.include</span> <span class="o">=</span> <span class="s">pyramid_debugtoolbar</span>
<span class="na">pyramid.tweens</span> <span class="o">=</span> <span class="s">starter.tween_factory2</span>
<span class="s">                 starter.tween_factory1</span>
<span class="s">                 pyramid.tweens.excview_tween_factory</span>
</pre></div>
</td></tr></table></div>
<p>See <a class="reference internal" href="hooks.html#registering-tweens"><em>Registering Tweens</em></a> for more information about tweens.</p>
</div>
<div class="section" id="invoking-a-request">
<span id="index-6"></span><span id="id3"></span><h2>Invoking a Request<a class="headerlink" href="#invoking-a-request" title="Permalink to this headline">¶</a></h2>
<p>You can use the <tt class="docutils literal"><span class="pre">prequest</span></tt> command-line utility to send a request to your
application and see the response body without starting a server.</p>
<p>There are two required arguments to <tt class="docutils literal"><span class="pre">prequest</span></tt>:</p>
<ul class="simple">
<li>The config file/section: follows the format <tt class="docutils literal"><span class="pre">config_file#section_name</span></tt>
where <tt class="docutils literal"><span class="pre">config_file</span></tt> is the path to your application's <tt class="docutils literal"><span class="pre">.ini</span></tt> file and
<tt class="docutils literal"><span class="pre">section_name</span></tt> is the <tt class="docutils literal"><span class="pre">app</span></tt> section name inside the <tt class="docutils literal"><span class="pre">.ini</span></tt> file.  The
<tt class="docutils literal"><span class="pre">section_name</span></tt> is optional, it defaults to <tt class="docutils literal"><span class="pre">main</span></tt>.  For example:
<tt class="docutils literal"><span class="pre">development.ini</span></tt>.</li>
<li>The path: this should be the non-url-quoted path element of the URL to the
resource you'd like to be rendered on the server.  For example, <tt class="docutils literal"><span class="pre">/</span></tt>.</li>
</ul>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ $VENV/bin/prequest development.ini /
</pre></div>
</div>
<p>This will print the body of the response to the console on which it was
invoked.</p>
<p>Several options are supported by <tt class="docutils literal"><span class="pre">prequest</span></tt>.  These should precede any
config file name or URL.</p>
<p><tt class="docutils literal"><span class="pre">prequest</span></tt> has a <tt class="docutils literal"><span class="pre">-d</span></tt> (aka <tt class="docutils literal"><span class="pre">--display-headers</span></tt>) option which prints the
status and headers returned by the server before the output:</p>
<div class="highlight-python"><div class="highlight"><pre>$ $VENV/bin/prequest -d development.ini /
</pre></div>
</div>
<p>This will print the status, then the headers, then the body of the response
to the console.</p>
<p>You can add request header values by using the <tt class="docutils literal"><span class="pre">--header</span></tt> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ $VENV/bin/prequest --header=Host:example.com development.ini /
</pre></div>
</div>
<p>Headers are added to the WSGI environment by converting them to their
CGI/WSGI equivalents (e.g. <tt class="docutils literal"><span class="pre">Host=example.com</span></tt> will insert the <tt class="docutils literal"><span class="pre">HTTP_HOST</span></tt>
header variable as the value <tt class="docutils literal"><span class="pre">example.com</span></tt>).  Multiple <tt class="docutils literal"><span class="pre">--header</span></tt> options
can be supplied.  The special header value <tt class="docutils literal"><span class="pre">content-type</span></tt> sets the
<tt class="docutils literal"><span class="pre">CONTENT_TYPE</span></tt> in the WSGI environment.</p>
<p>By default, <tt class="docutils literal"><span class="pre">prequest</span></tt> sends a <tt class="docutils literal"><span class="pre">GET</span></tt> request.  You can change this by
using the <tt class="docutils literal"><span class="pre">-m</span></tt> (aka <tt class="docutils literal"><span class="pre">--method</span></tt>) option.  <tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">HEAD</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt> and
<tt class="docutils literal"><span class="pre">DELETE</span></tt> are currently supported.  When you use <tt class="docutils literal"><span class="pre">POST</span></tt>, the standard
input of the <tt class="docutils literal"><span class="pre">prequest</span></tt> process is used as the <tt class="docutils literal"><span class="pre">POST</span></tt> body:</p>
<div class="highlight-python"><div class="highlight"><pre>$ $VENV/bin/prequest -mPOST development.ini / &lt; somefile
</pre></div>
</div>
</div>
<div class="section" id="using-custom-arguments-to-python-when-running-p-scripts">
<h2>Using Custom Arguments to Python when Running <tt class="docutils literal"><span class="pre">p*</span></tt> Scripts<a class="headerlink" href="#using-custom-arguments-to-python-when-running-p-scripts" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.5.</span></p>
</div>
<p>Each of Pyramid's console scripts (<tt class="docutils literal"><span class="pre">pserve</span></tt>, <tt class="docutils literal"><span class="pre">pviews</span></tt>, etc) can be run
directly using <tt class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span></tt>, allowing custom arguments to be sent to the
python interpreter at runtime. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>python -3 -m pyramid.scripts.pserve development.ini
</pre></div>
</div>
</div>
<div class="section" id="showing-all-installed-distributions-and-their-versions">
<h2>Showing All Installed Distributions and their Versions<a class="headerlink" href="#showing-all-installed-distributions-and-their-versions" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.5.</span></p>
</div>
<p>You can use the <tt class="docutils literal"><span class="pre">pdistreport</span></tt> command to show the Pyramid version in use, the
Python version in use, and all installed versions of Python distributions in
your Python environment:</p>
<div class="highlight-python"><div class="highlight"><pre>$ $VENV/bin/pdistreport
Pyramid version: 1.5dev
Platform Linux-3.2.0-51-generic-x86_64-with-debian-wheezy-sid
Packages:
  authapp 0.0
    /home/chrism/projects/foo/src/authapp
  beautifulsoup4 4.1.3
    /home/chrism/projects/foo/lib/python2.7/site-packages/beautifulsoup4-4.1.3-py2.7.egg
... more output ...
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">pdistreport</span></tt> takes no options.  Its output is useful to paste into a
pastebin when you are having problems and need someone with more familiarity
with Python packaging and distribution than you have to look at your
environment.</p>
</div>
<div class="section" id="writing-a-script">
<span id="id4"></span><h2>Writing a Script<a class="headerlink" href="#writing-a-script" title="Permalink to this headline">¶</a></h2>
<p>All web applications are, at their hearts, systems which accept a request and
return a response.  When a request is accepted by a <span>Pyramid</span>
application, the system receives state from the request which is later relied
on by your application code.  For example, one <a class="reference internal" href="../glossary.html#term-view-callable"><em class="xref std std-term">view callable</em></a> may assume
it's working against a request that has a <tt class="docutils literal"><span class="pre">request.matchdict</span></tt> of a
particular composition, while another assumes a different composition of the
matchdict.</p>
<p>In the meantime, it's convenient to be able to write a Python script that can
work &quot;in a Pyramid environment&quot;, for instance to update database tables used
by your <span>Pyramid</span> application.  But a &quot;real&quot; Pyramid environment doesn't
have a completely static state independent of a request; your application
(and Pyramid itself) is almost always reliant on being able to obtain
information from a request.  When you run a Python script that simply imports
code from your application and tries to run it, there just is no request
data, because there isn't any real web request.  Therefore some parts of your
application and some Pyramid APIs will not work.</p>
<p>For this reason, <span>Pyramid</span> makes it possible to run a script in an
environment much like the environment produced when a particular
<a class="reference internal" href="../glossary.html#term-request"><em class="xref std std-term">request</em></a> reaches your <span>Pyramid</span> application.  This is achieved by
using the <a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a> command in the body of your
script.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.1: </span><a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a></p>
</div>
<p>In the simplest case, <a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a> can be used with a
single argument, which accepts the <a class="reference internal" href="../glossary.html#term-pastedeploy"><em class="xref std std-term">PasteDeploy</em></a> <tt class="docutils literal"><span class="pre">.ini</span></tt> file
representing Pyramid your application configuration as a single argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.paster</span> <span class="kn">import</span> <span class="n">bootstrap</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="s">&#39;/path/to/my/development.ini&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a> returns a dictionary containing
framework-related information.  This dictionary will always contain a
<a class="reference internal" href="../glossary.html#term-request"><em class="xref std std-term">request</em></a> object as its <tt class="docutils literal"><span class="pre">request</span></tt> key.</p>
<p>The following keys are available in the <tt class="docutils literal"><span class="pre">env</span></tt> dictionary returned by
<a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a>:</p>
<p>request</p>
<blockquote>
<div>A <a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><tt class="xref py py-class docutils literal"><span class="pre">pyramid.request.Request</span></tt></a> object implying the current request
state for your script.</div></blockquote>
<p>app</p>
<blockquote>
<div>The <a class="reference internal" href="../glossary.html#term-wsgi"><em class="xref std std-term">WSGI</em></a> application object generated by bootstrapping.</div></blockquote>
<p>root</p>
<blockquote>
<div>The <a class="reference internal" href="../glossary.html#term-resource"><em class="xref std std-term">resource</em></a> root of your <span>Pyramid</span> application.  This is an
object generated by the <a class="reference internal" href="../glossary.html#term-root-factory"><em class="xref std std-term">root factory</em></a> configured in your
application.</div></blockquote>
<p>registry</p>
<blockquote>
<div>The <a class="reference internal" href="../glossary.html#term-application-registry"><em class="xref std std-term">application registry</em></a> of your <span>Pyramid</span> application.</div></blockquote>
<p>closer</p>
<blockquote>
<div>A parameterless callable that can be used to pop an internal
<span>Pyramid</span> threadlocal stack (used by
<a class="reference internal" href="../api/threadlocal.html#pyramid.threadlocal.get_current_registry" title="pyramid.threadlocal.get_current_registry"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.threadlocal.get_current_registry()</span></tt></a> and
<a class="reference internal" href="../api/threadlocal.html#pyramid.threadlocal.get_current_request" title="pyramid.threadlocal.get_current_request"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.threadlocal.get_current_request()</span></tt></a>) when your scripting job
is finished.</div></blockquote>
<p>Let's assume that the <tt class="docutils literal"><span class="pre">/path/to/my/development.ini</span></tt> file used in the
example above looks like so:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[pipeline:main]</span>
<span class="na">pipeline</span> <span class="o">=</span> <span class="s">translogger</span>
<span class="s">           another</span>

<span class="k">[filter:translogger]</span>
<span class="na">filter_app_factory</span> <span class="o">=</span> <span class="s">egg:Paste#translogger</span>
<span class="na">setup_console_handler</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">logger_name</span> <span class="o">=</span> <span class="s">wsgi</span>

<span class="k">[app:another]</span>
<span class="na">use</span> <span class="o">=</span> <span class="s">egg:MyProject</span>
</pre></div>
</div>
<p>The configuration loaded by the above bootstrap example will use the
configuration implied by the <tt class="docutils literal"><span class="pre">[pipeline:main]</span></tt> section of your
configuration file by default.  Specifying <tt class="docutils literal"><span class="pre">/path/to/my/development.ini</span></tt> is
logically equivalent to specifying <tt class="docutils literal"><span class="pre">/path/to/my/development.ini#main</span></tt>.  In
this case, we'll be using a configuration that includes an <tt class="docutils literal"><span class="pre">app</span></tt> object
which is wrapped in the Paste &quot;translogger&quot; <a class="reference internal" href="../glossary.html#term-middleware"><em class="xref std std-term">middleware</em></a> (which logs
requests to the console).</p>
<p>You can also specify a particular <em>section</em> of the PasteDeploy <tt class="docutils literal"><span class="pre">.ini</span></tt> file
to load instead of <tt class="docutils literal"><span class="pre">main</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.paster</span> <span class="kn">import</span> <span class="n">bootstrap</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="s">&#39;/path/to/my/development.ini#another&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The above example specifies the <tt class="docutils literal"><span class="pre">another</span></tt> <tt class="docutils literal"><span class="pre">app</span></tt>, <tt class="docutils literal"><span class="pre">pipeline</span></tt>, or
<tt class="docutils literal"><span class="pre">composite</span></tt> section of your PasteDeploy configuration file. The <tt class="docutils literal"><span class="pre">app</span></tt>
object present in the <tt class="docutils literal"><span class="pre">env</span></tt> dictionary returned by
<a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a> will be a <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-router"><em class="xref std std-term">router</em></a>.</p>
<div class="section" id="changing-the-request">
<h3>Changing the Request<a class="headerlink" href="#changing-the-request" title="Permalink to this headline">¶</a></h3>
<p>By default, Pyramid will generate a request object in the <tt class="docutils literal"><span class="pre">env</span></tt> dictionary
for the URL <tt class="docutils literal"><span class="pre">http://localhost:80/</span></tt>. This means that any URLs generated
by Pyramid during the execution of your script will be anchored here. This
is generally not what you want.</p>
<p>So how do we make Pyramid generate the correct URLs?</p>
<p>Assuming that you have a route configured in your application like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;verify&#39;</span><span class="p">,</span> <span class="s">&#39;/verify/{code}&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You need to inform the Pyramid environment that the WSGI application is
handling requests from a certain base. For example, we want to simulate
mounting our application at <cite>https://example.com/prefix</cite>, to ensure that
the generated URLs are correct for our deployment. This can be done by
either mutating the resulting request object, or more simply by constructing
the desired request and passing it into <a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">bootstrap()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.paster</span> <span class="kn">import</span> <span class="n">bootstrap</span>
<span class="kn">from</span> <span class="nn">pyramid.request</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">blank</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="s">&#39;https://example.com/prefix&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="s">&#39;/path/to/my/development.ini#another&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">application_url</span><span class="p">)</span>
<span class="c"># will print &#39;https://example.com/prefix&#39;</span>
</pre></div>
</div>
<p>Now you can readily use Pyramid's APIs for generating URLs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">env</span><span class="p">[</span><span class="s">&#39;request&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s">&#39;verify&#39;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s">&#39;1337&#39;</span><span class="p">)</span>
<span class="c"># will return &#39;https://example.com/prefix/verify/1337&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="cleanup">
<h3>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h3>
<p>When your scripting logic finishes, it's good manners to call the <tt class="docutils literal"><span class="pre">closer</span></tt>
callback:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyramid.paster</span> <span class="kn">import</span> <span class="n">bootstrap</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="s">&#39;/path/to/my/development.ini&#39;</span><span class="p">)</span>

<span class="c"># .. do stuff ...</span>

<span class="n">env</span><span class="p">[</span><span class="s">&#39;closer&#39;</span><span class="p">]()</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-logging">
<h3>Setting Up Logging<a class="headerlink" href="#setting-up-logging" title="Permalink to this headline">¶</a></h3>
<p>By default, <a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a> does not configure logging
parameters present in the configuration file.  If you'd like to configure
logging based on <tt class="docutils literal"><span class="pre">[logger]</span></tt> and related sections in the configuration file,
use the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyramid.paster</span>
<span class="n">pyramid</span><span class="o">.</span><span class="n">paster</span><span class="o">.</span><span class="n">setup_logging</span><span class="p">(</span><span class="s">&#39;/path/to/my/development.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="logging.html#logging-chapter"><em>Logging</em></a> for more information on logging within
<span>Pyramid</span>.</p>
</div>
</div>
<div class="section" id="making-your-script-into-a-console-script">
<span id="making-a-console-script"></span><span id="index-7"></span><h2>Making Your Script into a Console Script<a class="headerlink" href="#making-your-script-into-a-console-script" title="Permalink to this headline">¶</a></h2>
<p>A &quot;console script&quot; is <a class="reference internal" href="../glossary.html#term-setuptools"><em class="xref std std-term">setuptools</em></a> terminology for a script that gets
installed into the <tt class="docutils literal"><span class="pre">bin</span></tt> directory of a Python <a class="reference internal" href="../glossary.html#term-virtualenv"><em class="xref std std-term">virtualenv</em></a> (or
&quot;base&quot; Python environment) when a <a class="reference internal" href="../glossary.html#term-distribution"><em class="xref std std-term">distribution</em></a> which houses that
script is installed.  Because it's installed into the <tt class="docutils literal"><span class="pre">bin</span></tt> directory of a
virtualenv when the distribution is installed, it's a convenient way to
package and distribute functionality that you can call from the command-line.
It's often more convenient to create a console script than it is to create a
<tt class="docutils literal"><span class="pre">.py</span></tt> script and instruct people to call it with the &quot;right&quot; Python
interpreter.  A console script generates a file that lives in <tt class="docutils literal"><span class="pre">bin</span></tt>, and when it's
invoked it will always use the &quot;right&quot; Python environment, which means it
will always be invoked in an environment where all the libraries it needs
(such as Pyramid) are available.</p>
<p>In general, you can make your script into a console script by doing the
following:</p>
<ul class="simple">
<li>Use an existing distribution (such as one you've already created via
<tt class="docutils literal"><span class="pre">pcreate</span></tt>) or create a new distribution that possesses at least one
package or module.  It should, within any module within the distribution,
house a callable (usually a function) that takes no arguments and which
runs any of the code you wish to run.</li>
<li>Add a <tt class="docutils literal"><span class="pre">[console_scripts]</span></tt> section to the <tt class="docutils literal"><span class="pre">entry_points</span></tt> argument of the
distribution which creates a mapping between a script name and a dotted
name representing the callable you added to your distribution.</li>
<li>Run <tt class="docutils literal"><span class="pre">setup.py</span> <span class="pre">develop</span></tt>, <tt class="docutils literal"><span class="pre">setup.py</span> <span class="pre">install</span></tt>, or <tt class="docutils literal"><span class="pre">easy_install</span></tt> to get
your distribution reinstalled.  When you reinstall your distribution, a
file representing the script that you named in the last step will be in the
<tt class="docutils literal"><span class="pre">bin</span></tt> directory of the virtualenv in which you installed the
distribution.  It will be executable.  Invoking it from a terminal will
execute your callable.</li>
</ul>
<p>As an example, let's create some code that can be invoked by a console script
that prints the deployment settings of a Pyramid application.  To do so,
we'll pretend you have a distribution with a package in it named
<tt class="docutils literal"><span class="pre">myproject</span></tt>.  Within this package, we'll pretend you've added a
<tt class="docutils literal"><span class="pre">scripts.py</span></tt> module which contains the following code:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># myproject.scripts module</span>

<span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">from</span> <span class="nn">pyramid.paster</span> <span class="kn">import</span> <span class="n">bootstrap</span>

<span class="k">def</span> <span class="nf">settings_show</span><span class="p">():</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">    Print the deployment settings for a Pyramid application.  Example:</span>
<span class="s">    &#39;show_settings deployment.ini&#39;</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&quot;usage: %prog config_uri&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span>
        <span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="s">&#39;--omit&#39;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s">&#39;omit&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;PREFIX&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s">&#39;append&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;Omit settings which start with PREFIX (you can use this &quot;</span>
              <span class="s">&quot;option multiple times)&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;You must provide at least one argument&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="n">config_uri</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">omit</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">omit</span>
    <span class="k">if</span> <span class="n">omit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">omit</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="p">(</span><span class="n">config_uri</span><span class="p">)</span>
    <span class="n">settings</span><span class="p">,</span> <span class="n">closer</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;registry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">env</span><span class="p">[</span><span class="s">&#39;closer&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">omit</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%-40s</span><span class="s">     </span><span class="si">%-20s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">closer</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>This script uses the Python <tt class="docutils literal"><span class="pre">optparse</span></tt> module to allow us to make sense out
of extra arguments passed to the script.  It uses the
<a class="reference internal" href="../api/paster.html#pyramid.paster.bootstrap" title="pyramid.paster.bootstrap"><tt class="xref py py-func docutils literal"><span class="pre">pyramid.paster.bootstrap()</span></tt></a> function to get information about the
application defined by a config file, and prints the deployment settings
defined in that config file.</p>
<p>After adding this script to the package, you'll need to tell your
distribution's <tt class="docutils literal"><span class="pre">setup.py</span></tt> about its existence.  Within your distribution's
top-level directory your <tt class="docutils literal"><span class="pre">setup.py</span></tt> file will look something like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;README.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">README</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;CHANGES.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">CHANGES</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pyramid&#39;</span><span class="p">,</span> <span class="s">&#39;pyramid_debugtoolbar&#39;</span><span class="p">]</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;MyProject&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s">&#39;My project&#39;</span><span class="p">,</span>
      <span class="n">long_description</span><span class="o">=</span><span class="n">README</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">+</span>  <span class="n">CHANGES</span><span class="p">,</span>
      <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s">&quot;Programming Language :: Python&quot;</span><span class="p">,</span>
        <span class="s">&quot;Framework :: Pylons&quot;</span><span class="p">,</span>
        <span class="s">&quot;Topic :: Internet :: WWW/HTTP&quot;</span><span class="p">,</span>
        <span class="s">&quot;Topic :: Internet :: WWW/HTTP :: WSGI :: Application&quot;</span><span class="p">,</span>
        <span class="p">],</span>
      <span class="n">author</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">keywords</span><span class="o">=</span><span class="s">&#39;web pyramid pylons&#39;</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="n">tests_require</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="n">test_suite</span><span class="o">=</span><span class="s">&quot;myproject&quot;</span><span class="p">,</span>
      <span class="n">entry_points</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      [paste.app_factory]</span>
<span class="s">      main = myproject:main</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span>
      <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>We're going to change the setup.py file to add an <tt class="docutils literal"><span class="pre">[console_scripts]</span></tt>
section with in the <tt class="docutils literal"><span class="pre">entry_points</span></tt> string.  Within this section, you should
specify a <tt class="docutils literal"><span class="pre">scriptname</span> <span class="pre">=</span> <span class="pre">dotted.path.to:yourfunction</span></tt> line.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre>[console_scripts]
show_settings = myproject.scripts:settings_show
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">show_settings</span></tt> name will be the name of the script that is installed
into <tt class="docutils literal"><span class="pre">bin</span></tt>.  The colon (<tt class="docutils literal"><span class="pre">:</span></tt>) between <tt class="docutils literal"><span class="pre">myproject.scripts</span></tt> and
<tt class="docutils literal"><span class="pre">settings_show</span></tt> above indicates that <tt class="docutils literal"><span class="pre">myproject.scripts</span></tt> is a Python
module, and <tt class="docutils literal"><span class="pre">settings_show</span></tt> is the function in that module which contains
the code you'd like to run as the result of someone invoking the
<tt class="docutils literal"><span class="pre">show_settings</span></tt> script from their command line.</p>
<p>The result will be something like:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;README.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">README</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;CHANGES.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">CHANGES</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pyramid&#39;</span><span class="p">,</span> <span class="s">&#39;pyramid_debugtoolbar&#39;</span><span class="p">]</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;MyProject&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s">&#39;My project&#39;</span><span class="p">,</span>
      <span class="n">long_description</span><span class="o">=</span><span class="n">README</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">+</span>  <span class="n">CHANGES</span><span class="p">,</span>
      <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s">&quot;Programming Language :: Python&quot;</span><span class="p">,</span>
        <span class="s">&quot;Framework :: Pylons&quot;</span><span class="p">,</span>
        <span class="s">&quot;Topic :: Internet :: WWW/HTTP&quot;</span><span class="p">,</span>
        <span class="s">&quot;Topic :: Internet :: WWW/HTTP :: WSGI :: Application&quot;</span><span class="p">,</span>
        <span class="p">],</span>
      <span class="n">author</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
      <span class="n">keywords</span><span class="o">=</span><span class="s">&#39;web pyramid pylons&#39;</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
      <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="n">tests_require</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
      <span class="n">test_suite</span><span class="o">=</span><span class="s">&quot;myproject&quot;</span><span class="p">,</span>
      <span class="n">entry_points</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      [paste.app_factory]</span>
<span class="s">      main = myproject:main</span>
<span class="s">      [console_scripts]</span>
<span class="s">      show_settings = myproject.scripts:settings_show</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span>
      <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Once you've done this, invoking <tt class="docutils literal"><span class="pre">$$VENV/bin/python</span> <span class="pre">setup.py</span>
<span class="pre">develop</span></tt> will install a file named <tt class="docutils literal"><span class="pre">show_settings</span></tt> into the
<tt class="docutils literal"><span class="pre">$somevirtualenv/bin</span></tt> directory with a small bit of Python code that points
to your entry point.  It will be executable.  Running it without any
arguments will print an error and exit.  Running it with a single argument
that is the path of a config file will print the settings.  Running it with
an <tt class="docutils literal"><span class="pre">--omit=foo</span></tt> argument will omit the settings that have keys that start
with <tt class="docutils literal"><span class="pre">foo</span></tt>.  Running it with two &quot;omit&quot; options (e.g. <tt class="docutils literal"><span class="pre">--omit=foo</span>
<span class="pre">--omit=bar</span></tt>) will omit all settings that have keys that start with either
<tt class="docutils literal"><span class="pre">foo</span></tt> or <tt class="docutils literal"><span class="pre">bar</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ $VENV/bin/show_settings development.ini --omit=pyramid --omit=debugtoolbar
debug_routematch                             False
debug_templates                              True
reload_templates                             True
mako.directories                             []
debug_notfound                               False
default_locale_name                          en
reload_resources                             False
debug_authorization                          False
reload_assets                                False
prevent_http_cache                           False
</pre></div>
</div>
<p>Pyramid's <tt class="docutils literal"><span class="pre">pserve</span></tt>, <tt class="docutils literal"><span class="pre">pcreate</span></tt>, <tt class="docutils literal"><span class="pre">pshell</span></tt>, <tt class="docutils literal"><span class="pre">prequest</span></tt>, <tt class="docutils literal"><span class="pre">ptweens</span></tt> and
other <tt class="docutils literal"><span class="pre">p*</span></tt> scripts are implemented as console scripts.  When you invoke one
of those, you are using a console script.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Command-Line Pyramid</a><ul>
<li><a class="reference internal" href="#displaying-matching-views-for-a-given-url">Displaying Matching Views for a Given URL</a></li>
<li><a class="reference internal" href="#the-interactive-shell">The Interactive Shell</a><ul>
<li><a class="reference internal" href="#extending-the-shell">Extending the Shell</a></li>
<li><a class="reference internal" href="#ipython-or-bpython">IPython or bpython</a></li>
</ul>
</li>
<li><a class="reference internal" href="#displaying-all-application-routes">Displaying All Application Routes</a></li>
<li><a class="reference internal" href="#displaying-tweens">Displaying &quot;Tweens&quot;</a></li>
<li><a class="reference internal" href="#invoking-a-request">Invoking a Request</a></li>
<li><a class="reference internal" href="#using-custom-arguments-to-python-when-running-p-scripts">Using Custom Arguments to Python when Running <tt class="docutils literal"><span class="pre">p*</span></tt> Scripts</a></li>
<li><a class="reference internal" href="#showing-all-installed-distributions-and-their-versions">Showing All Installed Distributions and their Versions</a></li>
<li><a class="reference internal" href="#writing-a-script">Writing a Script</a><ul>
<li><a class="reference internal" href="#changing-the-request">Changing the Request</a></li>
<li><a class="reference internal" href="#cleanup">Cleanup</a></li>
<li><a class="reference internal" href="#setting-up-logging">Setting Up Logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#making-your-script-into-a-console-script">Making Your Script into a Console Script</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="paste.html"
                        title="previous chapter">PasteDeploy Configuration Files</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="i18n.html"
                        title="next chapter">Internationalization and Localization</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="i18n.html" title="Internationalization and Localization"
             >next</a> |</li>
        <li class="right" >
          <a href="paste.html" title="PasteDeploy Configuration Files"
             >previous</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.5</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2008-2014, Agendaless Consulting.
      Last updated on Nov 09, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>