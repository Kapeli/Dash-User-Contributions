<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>App Engine Python SDK: google.appengine.ext.remote_api.throttle.Throttle Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="common.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gae-python.logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">App Engine Python SDK
   &#160;<span id="projectnumber">v1.6.9 rev.445</span>
   </div>
   <div id="projectbrief">The Python runtime is available as an experimental Preview feature.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>google</b></li><li class="navelem"><b>appengine</b></li><li class="navelem"><b>ext</b></li><li class="navelem"><b>remote_api</b></li><li class="navelem"><b>throttle</b></li><li class="navelem"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle.html">Throttle</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">google.appengine.ext.remote_api.throttle.Throttle Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for google.appengine.ext.remote_api.throttle.Throttle:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle.png" usemap="#google.appengine.ext.remote_api.throttle.Throttle_map" alt=""/>
  <map id="google.appengine.ext.remote_api.throttle.Throttle_map" name="google.appengine.ext.remote_api.throttle.Throttle_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a851189f9d14845e9c5c553934d32506f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a851189f9d14845e9c5c553934d32506f"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>__init__</b></td></tr>
<tr class="separator:a851189f9d14845e9c5c553934d32506f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac056ab2e5b3cf398a5f7b04ae34c5fbe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac056ab2e5b3cf398a5f7b04ae34c5fbe"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>AddThrottle</b></td></tr>
<tr class="separator:ac056ab2e5b3cf398a5f7b04ae34c5fbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec18d9cf65f8186af2686e7b8aab4ad"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ec18d9cf65f8186af2686e7b8aab4ad"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>AddThrottles</b></td></tr>
<tr class="separator:a6ec18d9cf65f8186af2686e7b8aab4ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a646906eef909e50739699f327afcfd2b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle.html#a646906eef909e50739699f327afcfd2b">Register</a></td></tr>
<tr class="separator:a646906eef909e50739699f327afcfd2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04bb77e759c3caeb8ca530f982c53a65"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a04bb77e759c3caeb8ca530f982c53a65"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>VerifyThrottleName</b></td></tr>
<tr class="separator:a04bb77e759c3caeb8ca530f982c53a65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cb21f80dcc1da46352322184378c184"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle.html#a1cb21f80dcc1da46352322184378c184">AddTransfer</a></td></tr>
<tr class="separator:a1cb21f80dcc1da46352322184378c184"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa49c6f9a3a4ff111907aed2995ca579f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle.html#aa49c6f9a3a4ff111907aed2995ca579f">Sleep</a></td></tr>
<tr class="separator:aa49c6f9a3a4ff111907aed2995ca579f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abeefe0a377d1344a6a52771e769aa3f8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1remote__api_1_1throttle_1_1_throttle.html#abeefe0a377d1344a6a52771e769aa3f8">TotalTransferred</a></td></tr>
<tr class="separator:abeefe0a377d1344a6a52771e769aa3f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ae1e57b8fd24c5bf9522094c94a647d6d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae1e57b8fd24c5bf9522094c94a647d6d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>get_time</b></td></tr>
<tr class="separator:ae1e57b8fd24c5bf9522094c94a647d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46b767bbc7adb607581ab8679f2a7a6a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a46b767bbc7adb607581ab8679f2a7a6a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>thread_sleep</b></td></tr>
<tr class="separator:a46b767bbc7adb607581ab8679f2a7a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47c0cf54542b587f8ce9be0298d2213e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a47c0cf54542b587f8ce9be0298d2213e"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>start_time</b></td></tr>
<tr class="separator:a47c0cf54542b587f8ce9be0298d2213e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bf8ea10179d62b2eaadcb67ef8cb760"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4bf8ea10179d62b2eaadcb67ef8cb760"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>transferred</b></td></tr>
<tr class="separator:a4bf8ea10179d62b2eaadcb67ef8cb760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0babfd645741d758df38df5c7c111719"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0babfd645741d758df38df5c7c111719"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>prior_block</b></td></tr>
<tr class="separator:a0babfd645741d758df38df5c7c111719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0844d4b3da2e74abfaf9f0e6fa6001dd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0844d4b3da2e74abfaf9f0e6fa6001dd"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>totals</b></td></tr>
<tr class="separator:a0844d4b3da2e74abfaf9f0e6fa6001dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54a7564227fc258c0db225cee2e84ec2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a54a7564227fc258c0db225cee2e84ec2"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>throttles</b></td></tr>
<tr class="separator:a54a7564227fc258c0db225cee2e84ec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd1501f74481f82a30268cefaee2b015"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acd1501f74481f82a30268cefaee2b015"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>last_rotate</b></td></tr>
<tr class="separator:acd1501f74481f82a30268cefaee2b015"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c6fbef9ad50362dea236cb563a7054"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a06c6fbef9ad50362dea236cb563a7054"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>rotate_mutex</b></td></tr>
<tr class="separator:a06c6fbef9ad50362dea236cb563a7054"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a96c1be88892a7a4d2b10e4498a402eac"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a96c1be88892a7a4d2b10e4498a402eac"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>ROTATE_PERIOD</b> = 600</td></tr>
<tr class="separator:a96c1be88892a7a4d2b10e4498a402eac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">A base class for upload rate throttling.

Transferring large number of entities, too quickly, could trigger
quota limits and cause the transfer process to halt.  In order to
stay within the application's quota, we throttle the data transfer
to a specified limit (across all transfer threads).

This class tracks a moving average of some aspect of the transfer
rate (bandwidth, records per second, http connections per
second). It keeps two windows of counts of bytes transferred, on a
per-thread basis. One block is the "current" block, and the other is
the "prior" block. It will rotate the counts from current to prior
when ROTATE_PERIOD has passed.  Thus, the current block will
represent from 0 seconds to ROTATE_PERIOD seconds of activity
(determined by: time.time() - self.last_rotate).  The prior block
will always represent a full ROTATE_PERIOD.

Sleeping is performed just before a transfer of another block, and is
based on the counts transferred *before* the next transfer. It really
does not matter how much will be transferred, but only that for all the
data transferred SO FAR that we have interspersed enough pauses to
ensure the aggregate transfer rate is within the specified limit.

These counts are maintained on a per-thread basis, so we do not require
any interlocks around incrementing the counts. There IS an interlock on
the rotation of the counts because we do not want multiple threads to
multiply-rotate the counts.

There are various race conditions in the computation and collection
of these counts. We do not require precise values, but simply to
keep the overall transfer within the bandwidth limits. If a given
pause is a little short, or a little long, then the aggregate delays
will be correct.
</pre> </div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a1cb21f80dcc1da46352322184378c184"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.ext.remote_api.throttle.Throttle.AddTransfer </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>throttle_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>token_count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Add a count to the amount this thread has transferred.

Each time a thread transfers some data, it should call this method to
note the amount sent. The counts may be rotated if sufficient time
has passed since the last rotation.

Args:
  throttle_name: The name of the throttle to add to.
  token_count: The number to add to the throttle counter.
</pre> 
</div>
</div>
<a class="anchor" id="a646906eef909e50739699f327afcfd2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.ext.remote_api.throttle.Throttle.Register </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>thread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Register this thread with the throttler.</pre> 
</div>
</div>
<a class="anchor" id="aa49c6f9a3a4ff111907aed2995ca579f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.ext.remote_api.throttle.Throttle.Sleep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>throttle_name</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Possibly sleep in order to limit the transfer rate.

Note that we sleep based on *prior* transfers rather than what we
may be about to transfer. The next transfer could put us under/over
and that will be rectified *after* that transfer. Net result is that
the average transfer rate will remain within bounds. Spiky behavior
or uneven rates among the threads could possibly bring the transfer
rate above the requested limit for short durations.

Args:
  throttle_name: The name of the throttle to sleep on.  If None or
omitted, then sleep on all throttles.
</pre> 
</div>
</div>
<a class="anchor" id="abeefe0a377d1344a6a52771e769aa3f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.ext.remote_api.throttle.Throttle.TotalTransferred </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>throttle_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Return the total transferred, and over what period.

Args:
  throttle_name: The name of the throttle to total.

Returns:
  A tuple of the total count and running time for the given throttle name.
</pre> 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>code/googleappengine-read-only/python/google/appengine/ext/remote_api/throttle.py</li>
</ul>
</div><!-- contents -->
<address class="footer">
    <small>Maintained by <a href="http://www.tzmartin.com">tzmartin</a></small>
</address>