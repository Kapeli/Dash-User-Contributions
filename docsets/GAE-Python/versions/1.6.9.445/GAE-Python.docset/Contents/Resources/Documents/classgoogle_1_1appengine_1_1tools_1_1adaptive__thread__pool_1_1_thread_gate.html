<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>App Engine Python SDK: google.appengine.tools.adaptive_thread_pool.ThreadGate Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="common.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gae-python.logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">App Engine Python SDK
   &#160;<span id="projectnumber">v1.6.9 rev.445</span>
   </div>
   <div id="projectbrief">The Python runtime is available as an experimental Preview feature.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>google</b></li><li class="navelem"><b>appengine</b></li><li class="navelem"><b>tools</b></li><li class="navelem"><b>adaptive_thread_pool</b></li><li class="navelem"><a class="el" href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.html">ThreadGate</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">google.appengine.tools.adaptive_thread_pool.ThreadGate Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for google.appengine.tools.adaptive_thread_pool.ThreadGate:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.png" usemap="#google.appengine.tools.adaptive_thread_pool.ThreadGate_map" alt=""/>
  <map id="google.appengine.tools.adaptive_thread_pool.ThreadGate_map" name="google.appengine.tools.adaptive_thread_pool.ThreadGate_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a17f007094896960a48353b48f0bc6879"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.html#a17f007094896960a48353b48f0bc6879">__init__</a></td></tr>
<tr class="separator:a17f007094896960a48353b48f0bc6879"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4061330b7ba39bcd2d4c57a95738c1ea"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4061330b7ba39bcd2d4c57a95738c1ea"></a>
def&#160;</td><td class="memItemRight" valign="bottom"><b>num_threads</b></td></tr>
<tr class="separator:a4061330b7ba39bcd2d4c57a95738c1ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fada61ae7f3f79fb8c01d51d0125e4c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.html#a8fada61ae7f3f79fb8c01d51d0125e4c">EnableThread</a></td></tr>
<tr class="separator:a8fada61ae7f3f79fb8c01d51d0125e4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ca9fc5bff4dbd1fcdbafeb0ca9dcc97"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.html#a3ca9fc5bff4dbd1fcdbafeb0ca9dcc97">EnableAllThreads</a></td></tr>
<tr class="separator:a3ca9fc5bff4dbd1fcdbafeb0ca9dcc97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e278bb15bc3af1428353b7fd16c5cf"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.html#ae2e278bb15bc3af1428353b7fd16c5cf">StartWork</a></td></tr>
<tr class="separator:ae2e278bb15bc3af1428353b7fd16c5cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a4c4790bf171b664a1f84b8d8416fc0"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1tools_1_1adaptive__thread__pool_1_1_thread_gate.html#a0a4c4790bf171b664a1f84b8d8416fc0">FinishWork</a></td></tr>
<tr class="separator:a0a4c4790bf171b664a1f84b8d8416fc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a72a3ebee010c0c7bafbed681b3f07ce1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a72a3ebee010c0c7bafbed681b3f07ce1"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>INCREASE</b> = 'increase'</td></tr>
<tr class="separator:a72a3ebee010c0c7bafbed681b3f07ce1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b48c1c2aff5449f2839ec4b7d1bdc05"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5b48c1c2aff5449f2839ec4b7d1bdc05"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>HOLD</b> = 'hold'</td></tr>
<tr class="separator:a5b48c1c2aff5449f2839ec4b7d1bdc05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a296927c600ab26f7ebda8894662d161d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a296927c600ab26f7ebda8894662d161d"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>DECREASE</b> = 'decrease'</td></tr>
<tr class="separator:a296927c600ab26f7ebda8894662d161d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Manage the number of active worker threads.

The ThreadGate limits the number of threads that are simultaneously
active in order to implement adaptive rate control.

Initially the ThreadGate allows only one thread to be active.  For
each successful work item, another thread is activated and for each
failed item, the number of active threads is reduced by one.  When only
one thread is active, failures will cause exponential backoff.

For example, a ThreadGate instance, thread_gate can be used in a number
of threads as so:

# Block until this thread is enabled for work.
thread_gate.StartWork()
try:
  status = DoSomeWorkInvolvingLimitedSharedResources()
  succeeded = IsStatusGood(status)
  badly_failed = IsStatusVeryBad(status)
finally:
  if succeeded:
    # Succeeded, add more simultaneously enabled threads to the task.
    thread_gate.FinishWork(instruction=ThreadGate.INCREASE)
  elif badly_failed:
    # Failed, or succeeded but with high resource load, reduce number of
    # workers.
    thread_gate.FinishWork(instruction=ThreadGate.DECREASE)
  else:
    # We succeeded, but don't want to add more workers to the task.
    thread_gate.FinishWork(instruction=ThreadGate.HOLD)

the thread_gate will enable and disable/backoff threads in response to
resource load conditions.

StartWork can block indefinitely. FinishWork, while not
lock-free, should never block absent a demonic scheduler.
</pre> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a17f007094896960a48353b48f0bc6879"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.tools.adaptive_thread_pool.ThreadGate.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sleep</em> = <code>InterruptibleSleep</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Constructor for ThreadGate instances.

Args:
  num_threads: The total number of threads using this gate.
  sleep: Used for dependency injection.
</pre> 
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a3ca9fc5bff4dbd1fcdbafeb0ca9dcc97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.tools.adaptive_thread_pool.ThreadGate.EnableAllThreads </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Enable all worker threads.</pre> 
</div>
</div>
<a class="anchor" id="a8fada61ae7f3f79fb8c01d51d0125e4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.tools.adaptive_thread_pool.ThreadGate.EnableThread </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Enable one more worker thread.</pre> 
</div>
</div>
<a class="anchor" id="a0a4c4790bf171b664a1f84b8d8416fc0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.tools.adaptive_thread_pool.ThreadGate.FinishWork </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>instruction</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Ends a critical section started with self.StartWork().</pre> 
</div>
</div>
<a class="anchor" id="ae2e278bb15bc3af1428353b7fd16c5cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.tools.adaptive_thread_pool.ThreadGate.StartWork </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Starts a critical section in which the number of workers is limited.

Starts a critical section which allows self.__enabled_count
simultaneously operating threads. The critical section is ended by
calling self.FinishWork().
</pre> 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>code/googleappengine-read-only/python/google/appengine/tools/adaptive_thread_pool.py</li>
</ul>
</div><!-- contents -->
<address class="footer">
    <small>Maintained by <a href="http://www.tzmartin.com">tzmartin</a></small>
</address>