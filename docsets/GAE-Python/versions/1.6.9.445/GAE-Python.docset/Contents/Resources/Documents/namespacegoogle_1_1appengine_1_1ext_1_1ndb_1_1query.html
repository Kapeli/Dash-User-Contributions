<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>App Engine Python SDK: google.appengine.ext.ndb.query Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="common.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gae-python.logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">App Engine Python SDK
   &#160;<span id="projectnumber">v1.6.9 rev.445</span>
   </div>
   <div id="projectbrief">The Python runtime is available as an experimental Preview feature.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>google</b></li><li class="navelem"><b>appengine</b></li><li class="navelem"><b>ext</b></li><li class="navelem"><a class="el" href="namespacegoogle_1_1appengine_1_1ext_1_1ndb.html">ndb</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1appengine_1_1ext_1_1ndb_1_1query.html">query</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">google.appengine.ext.ndb.query Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1___multi_query.html">_MultiQuery</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1___sub_query_iterator_state.html">_SubQueryIteratorState</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_conjunction_node.html">ConjunctionNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_disjunction_node.html">DisjunctionNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_false_node.html">FalseNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_filter_node.html">FilterNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_node.html">Node</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_parameter.html">Parameter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_parameterized_function.html">ParameterizedFunction</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_parameterized_thing.html">ParameterizedThing</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_parameter_node.html">ParameterNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_post_filter_node.html">PostFilterNode</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_query.html">Query</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_query_iterator.html">QueryIterator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_query_options.html">QueryOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_repeated_structured_property_predicate.html">RepeatedStructuredPropertyPredicate</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae7c2671ea62a21ce8a262426b13961c9"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegoogle_1_1appengine_1_1ext_1_1ndb_1_1query.html#ae7c2671ea62a21ce8a262426b13961c9">gql</a></td></tr>
<tr class="separator:ae7c2671ea62a21ce8a262426b13961c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa4d7feeab11cf9fbee21ffa47bca11cd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa4d7feeab11cf9fbee21ffa47bca11cd"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>__author__</b> = 'guido@google.com (Guido van Rossum)'</td></tr>
<tr class="separator:aa4d7feeab11cf9fbee21ffa47bca11cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa11e93d7cea874d2bdb75eef6b20dc6"><td class="memItemLeft" align="right" valign="top">list&#160;</td><td class="memItemRight" valign="bottom"><b>__all__</b></td></tr>
<tr class="separator:afa11e93d7cea874d2bdb75eef6b20dc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a397029cecd212ac69c7d249f84db8e80"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a397029cecd212ac69c7d249f84db8e80"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>Cursor</b> = datastore_query.Cursor</td></tr>
<tr class="separator:a397029cecd212ac69c7d249f84db8e80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9701a01af0c5692df3347d28ca6cea76"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9701a01af0c5692df3347d28ca6cea76"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_ASC</b> = datastore_query.PropertyOrder.ASCENDING</td></tr>
<tr class="separator:a9701a01af0c5692df3347d28ca6cea76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5f58d3dacfb84eb264dba6482bedf61"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae5f58d3dacfb84eb264dba6482bedf61"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_DESC</b> = datastore_query.PropertyOrder.DESCENDING</td></tr>
<tr class="separator:ae5f58d3dacfb84eb264dba6482bedf61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f23dc7791e98577fffb2b824ee460eb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5f23dc7791e98577fffb2b824ee460eb"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_AND</b> = datastore_query.CompositeFilter.AND</td></tr>
<tr class="separator:a5f23dc7791e98577fffb2b824ee460eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0e4b4a8ff467b7bd3bf41d5bf8d9ff2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab0e4b4a8ff467b7bd3bf41d5bf8d9ff2"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>_KEY</b> = datastore_types._KEY_SPECIAL_PROPERTY</td></tr>
<tr class="separator:ab0e4b4a8ff467b7bd3bf41d5bf8d9ff2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac57b7dd8c6fdbd9090b642c20eaa6a7a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac57b7dd8c6fdbd9090b642c20eaa6a7a"></a>
tuple&#160;</td><td class="memItemRight" valign="bottom"><b>_OPS</b> = frozenset(['=', '!=', '&lt;', '&lt;=', '&gt;', '&gt;=', 'in'])</td></tr>
<tr class="separator:ac57b7dd8c6fdbd9090b642c20eaa6a7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81a4af9b3c0faddecf4380c12f59806b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a81a4af9b3c0faddecf4380c12f59806b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>_MAX_LIMIT</b> = 2</td></tr>
<tr class="separator:a81a4af9b3c0faddecf4380c12f59806b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a959d83280e182ac1b2563e7123f52993"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a959d83280e182ac1b2563e7123f52993"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>AND</b> = <a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_conjunction_node.html">ConjunctionNode</a></td></tr>
<tr class="separator:a959d83280e182ac1b2563e7123f52993"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30ee1b5405ac3c605dfdebfe1e243e40"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a30ee1b5405ac3c605dfdebfe1e243e40"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>OR</b> = <a class="el" href="classgoogle_1_1appengine_1_1ext_1_1ndb_1_1query_1_1_disjunction_node.html">DisjunctionNode</a></td></tr>
<tr class="separator:a30ee1b5405ac3c605dfdebfe1e243e40"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Higher-level Query wrapper.

There are perhaps too many query APIs in the world.

The fundamental API here overloads the 6 comparisons operators to
represent filters on property values, and supports AND and OR
operations (implemented as functions -- Python's 'and' and 'or'
operators cannot be overloaded, and the '&amp;' and '|' operators have a
priority that conflicts with the priority of comparison operators).
For example:

  class Employee(Model):
    name = StringProperty()
    age = IntegerProperty()
    rank = IntegerProperty()

    @classmethod
    def demographic(cls, min_age, max_age):
return cls.query().filter(AND(cls.age &gt;= min_age, cls.age &lt;= max_age))

    @classmethod
    def ranked(cls, rank):
return cls.query(cls.rank == rank).order(cls.age)

  for emp in Employee.seniors(42, 5):
    print emp.name, emp.age, emp.rank

The 'in' operator cannot be overloaded, but is supported through the
IN() method.  For example:

  Employee.query().filter(Employee.rank.IN([4, 5, 6]))

Sort orders are supported through the order() method; unary minus is
overloaded on the Property class to represent a descending order:

  Employee.query().order(Employee.name, -Employee.age)

Besides using AND() and OR(), filters can also be combined by
repeatedly calling .filter():

  q1 = Employee.query()  # A query that returns all employees
  q2 = q1.filter(Employee.age &gt;= 30)  # Only those over 30
  q3 = q2.filter(Employee.age &lt; 40)  # Only those in their 30s

A further shortcut is calling .filter() with multiple arguments; this
implies AND():

  q1 = Employee.query()  # A query that returns all employees
  q3 = q1.filter(Employee.age &gt;= 30,
           Employee.age &lt; 40)  # Only those in their 30s

And finally you can also pass one or more filter expressions directly
to the .query() method:

  q3 = Employee.query(Employee.age &gt;= 30,
                Employee.age &lt; 40)  # Only those in their 30s

Query objects are immutable, so these methods always return a new
Query object; the above calls to filter() do not affect q1.  (On the
other hand, operations that are effectively no-ops may return the
original Query object.)

Sort orders can also be combined this way, and .filter() and .order()
calls may be intermixed:

  q4 = q3.order(-Employee.age)
  q5 = q4.order(Employee.name)
  q6 = q5.filter(Employee.rank == 5)

Again, multiple .order() calls can be combined:

  q5 = q3.order(-Employee.age, Employee.name)

The simplest way to retrieve Query results is a for-loop:

  for emp in q3:
    print emp.name, emp.age

Some other methods to run a query and access its results:

  q.iter() # Return an iterator; same as iter(q) but more flexible
  q.map(callback) # Call the callback function for each query result
  q.fetch(N) # Return a list of the first N results
  q.get() # Return the first result
  q.count(N) # Return the number of results, with a maximum of N
  q.fetch_page(N, start_cursor=cursor) # Return (results, cursor, has_more)

All of the above methods take a standard set of additional query
options, either in the form of keyword arguments such as
keys_only=True, or as QueryOptions object passed with
options=QueryOptions(...).  The most important query options are:

  keys_only: bool, if set the results are keys instead of entities
  limit: int, limits the number of results returned
  offset: int, skips this many results first
  start_cursor: Cursor, start returning results after this position
  end_cursor: Cursor, stop returning results after this position
  batch_size: int, hint for the number of results returned per RPC
  prefetch_size: int, hint for the number of results in the first RPC
  produce_cursors: bool, return Cursor objects with the results

For additional (obscure) query options and more details on them,
including an explanation of Cursors, see datastore_query.py.

All of the above methods except for iter() have asynchronous variants
as well, which return a Future; to get the operation's ultimate
result, yield the Future (when inside a tasklet) or call the Future's
get_result() method (outside a tasklet):

  q.map_async(callback)  # Callback may be a task or a plain function
  q.fetch_async(N)
  q.get_async()
  q.count_async(N)
  q.fetch_page_async(N, start_cursor=cursor)

Finally, there's an idiom to efficiently loop over the Query results
in a tasklet, properly yielding when appropriate:

  it = q.iter()
  while (yield it.has_next_async()):
    emp = it.next()
    print emp.name, emp.age
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae7c2671ea62a21ce8a262426b13961c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def google.appengine.ext.ndb.query.gql </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>query_string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>kwds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Parse a GQL query string.

Args:
  query_string: Full GQL query, e.g. 'SELECT * FROM Kind WHERE prop = 1'.
  *args, **kwds: If present, used to call bind().

Returns:
  An instance of query_class.
</pre> 
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="afa11e93d7cea874d2bdb75eef6b20dc6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">list google.appengine.ext.ndb.query.__all__</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacegoogle_1_1appengine_1_1ext_1_1ndb_1_1query.html">    1</a></span>&#160;= [<span class="stringliteral">&#39;Query&#39;</span>, <span class="stringliteral">&#39;QueryOptions&#39;</span>, <span class="stringliteral">&#39;Cursor&#39;</span>, <span class="stringliteral">&#39;QueryIterator&#39;</span>,</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;           <span class="stringliteral">&#39;RepeatedStructuredPropertyPredicate&#39;</span>,</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;           <span class="stringliteral">&#39;AND&#39;</span>, <span class="stringliteral">&#39;OR&#39;</span>, <span class="stringliteral">&#39;ConjunctionNode&#39;</span>, <span class="stringliteral">&#39;DisjunctionNode&#39;</span>,</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;           <span class="stringliteral">&#39;FilterNode&#39;</span>, <span class="stringliteral">&#39;PostFilterNode&#39;</span>, <span class="stringliteral">&#39;FalseNode&#39;</span>, <span class="stringliteral">&#39;Node&#39;</span>,</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;           <span class="stringliteral">&#39;ParameterNode&#39;</span>, <span class="stringliteral">&#39;ParameterizedThing&#39;</span>, <span class="stringliteral">&#39;Parameter&#39;</span>,</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;           <span class="stringliteral">&#39;ParameterizedFunction&#39;</span>, <span class="stringliteral">&#39;gql&#39;</span>,</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;           ]</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<address class="footer">
    <small>Maintained by <a href="http://www.tzmartin.com">tzmartin</a></small>
</address>