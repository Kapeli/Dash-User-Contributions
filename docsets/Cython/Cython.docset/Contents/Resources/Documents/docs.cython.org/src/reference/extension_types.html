

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from docs.cython.org/src/reference/extension_types.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 23:32:58 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extension Types &mdash; Cython 0.20 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Cython 0.20 documentation" href="../../index-2.html" />
    <link rel="up" title="Reference Guide" href="index.html" />
    <link rel="next" title="Interfacing with Other Code" href="interfacing_with_other_code.html" />
    <link rel="prev" title="Language Basics" href="language_basics.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="interfacing_with_other_code.html" title="Interfacing with Other Code"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="language_basics.html" title="Language Basics"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index-2.html">Cython 0.20 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Reference Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="extension-types">
<span id="id1"></span><h1>Extension Types<a class="headerlink" href="#extension-types" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Normal Python as well as extension type classes can be defined.</li>
<li>Extension types:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Are considered by Python as &#8220;built-in&#8221; types.</li>
<li>Can be used to wrap arbitrary C-data structures, and provide a Python-like interface to them from Python.</li>
<li>Attributes and methods can be called from Python or Cython code</li>
<li>Are defined by the <tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">class</span></tt> statement.</li>
</ul>
</div></blockquote>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">Shrubbery</span><span class="p">:</span>

    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">width</span><span class="p">,</span> <span class="nf">height</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>

    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;This shrubbery is&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> \
            <span class="s">&quot;by&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="s">&quot;cubits.&quot;</span>
</pre></div>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Are stored directly in the object&#8217;s C struct.</li>
<li>Are fixed at compile time.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>You can&#8217;t add attributes to an extension type instance at run time like in normal Python.</li>
<li>You can sub-class the extenstion type in Python to add attributes at run-time.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>There are two ways to access extension type attributes:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>By Python look-up.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Python code&#8217;s only method of access.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>By direct access to the C struct from Cython code.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Cython code can use either method of access, though.</li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li>By default, extension type attributes are:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Only accessible by direct access.</li>
<li>Not accessible from Python code.</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">To make attributes accessible to Python, they must be declared <tt class="docutils literal"><span class="pre">public</span></tt> or <tt class="docutils literal"><span class="pre">readonly</span></tt>:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">Shrubbery</span><span class="p">:</span>
    <span class="k">cdef</span> <span class="kr">public</span> <span class="kt">int</span> <span class="nf">width</span><span class="p">,</span> <span class="nf">height</span>
    <span class="k">cdef</span> <span class="kr">readonly</span> <span class="kt">float</span> <span class="nf">depth</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">width</span></tt> and <tt class="docutils literal"><span class="pre">height</span></tt> attributes are readable and writable from Python code.</li>
<li>The <tt class="docutils literal"><span class="pre">depth</span></tt> attribute is readable but not writable.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can only expose simple C types, such as ints, floats, and strings, for Python access. You can also expose Python-valued attributes.</p>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">public</span></tt> and <tt class="docutils literal"><span class="pre">readonly</span></tt> options apply only to Python access, not direct access. All the attributes of an extension type are always readable and writable by C-level access.</p>
</div>
</div>
</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">self</span></tt> is used in extension type methods just like it normally is in Python.</li>
<li>See <strong>Functions and Methods</strong>; all of which applies here.</li>
</ul>
</div>
<div class="section" id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Cython provides a special syntax:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">Spam</span><span class="p">:</span>

    <span class="k">property</span> <span class="nf">cheese</span><span class="p">:</span>

        <span class="s">&quot;A doc string can go here.&quot;</span>

        <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c"># This is called when the property is read.</span>
            <span class="o">...</span>

        <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="c"># This is called when the property is written.</span>
            <span class="o">...</span>

        <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c"># This is called when the property is deleted.</span>
</pre></div>
</div>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">__get__()</span></tt>, <tt class="docutils literal"><span class="pre">__set__()</span></tt>, and <tt class="docutils literal"><span class="pre">__del__()</span></tt> methods are all optional.</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>If they are ommitted, An exception is raised when an access attempt is made.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Below, is a full example that defines a property which can..</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Add to a list each time it is written to (<tt class="docutils literal"><span class="pre">&quot;__set__&quot;</span></tt>).</li>
<li>Return the list when it is read (<tt class="docutils literal"><span class="pre">&quot;__get__&quot;</span></tt>).</li>
<li>Empty the list when it is deleted (<tt class="docutils literal"><span class="pre">&quot;__del__&quot;</span></tt>).</li>
</ul>
</div></blockquote>
<div class="highlight-cython"><div class="highlight"><pre><span class="c"># cheesy.pyx</span>
<span class="k">cdef</span> <span class="k">class</span> <span class="nf">CheeseShop</span><span class="p">:</span>

    <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">cheeses</span>

    <span class="k">def</span> <span class="nf">__cinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cheeses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">property</span> <span class="nf">cheese</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;We don&#39;t have: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheeses</span>

        <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cheeses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheeses</span><span class="p">[:]</span>

<span class="c"># Test input</span>
<span class="k">from</span> <span class="nn">cheesy</span> <span class="k">import</span> <span class="n">CheeseShop</span>

<span class="n">shop</span> <span class="o">=</span> <span class="n">CheeseShop</span><span class="p">()</span>
<span class="k">print</span> <span class="n">shop</span><span class="o">.</span><span class="n">cheese</span>

<span class="n">shop</span><span class="o">.</span><span class="n">cheese</span> <span class="o">=</span> <span class="s">&quot;camembert&quot;</span>
<span class="k">print</span> <span class="n">shop</span><span class="o">.</span><span class="n">cheese</span>

<span class="n">shop</span><span class="o">.</span><span class="n">cheese</span> <span class="o">=</span> <span class="s">&quot;cheddar&quot;</span>
<span class="k">print</span> <span class="n">shop</span><span class="o">.</span><span class="n">cheese</span>

<span class="k">del</span> <span class="n">shop</span><span class="o">.</span><span class="n">cheese</span>
<span class="k">print</span> <span class="n">shop</span><span class="o">.</span><span class="n">cheese</span>
</pre></div>
</div>
<div class="highlight-cython"><div class="highlight"><pre><span class="c"># Test output</span>
<span class="n">We</span> <span class="n">don</span><span class="s">&#39;t have: []</span>
<span class="n">We</span> <span class="n">don</span><span class="s">&#39;t have: [&#39;</span><span class="n">camembert</span><span class="s">&#39;]</span>
<span class="n">We</span> <span class="n">don</span><span class="s">&#39;t have: [&#39;</span><span class="n">camembert</span><span class="s">&#39;, &#39;</span><span class="n">cheddar</span><span class="s">&#39;]</span>
<span class="n">We</span> <span class="n">don</span><span class="s">&#39;t have: []</span>
</pre></div>
</div>
</div>
<div class="section" id="special-methods">
<h2>Special Methods<a class="headerlink" href="#special-methods" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>The semantics of Cython&#8217;s special methods are similar in principle to that of Python&#8217;s.</li>
<li>There are substantial differences in some behavior.</li>
<li>Some Cython special methods have no Python counter-part.</li>
</ol>
</div>
<ul class="simple">
<li>See the <a class="reference internal" href="special_methods_table.html#special-methods-table"><em>Special Methods Table</em></a> for the many that are available.</li>
</ul>
<div class="section" id="declaration">
<h3>Declaration<a class="headerlink" href="#declaration" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Must be declared with <tt class="docutils literal"><span class="pre">def</span></tt> and cannot be declared with <tt class="docutils literal"><span class="pre">cdef</span></tt>.</li>
<li>Performance is not affected by the <tt class="docutils literal"><span class="pre">def</span></tt> declaration because of special calling conventions</li>
</ul>
</div>
<div class="section" id="docstrings">
<h3>Docstrings<a class="headerlink" href="#docstrings" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Docstrings are not supported yet for some special method types.</li>
<li>They can be included in the source, but may not appear in the corresponding <tt class="docutils literal"><span class="pre">__doc__</span></tt> attribute at run-time.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>This a Python library limitation because the <tt class="docutils literal"><span class="pre">PyTypeObject</span></tt> data structure is limited</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="initialization-cinit-and-init">
<h3>Initialization: <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> and <tt class="docutils literal"><span class="pre">__init__()</span></tt><a class="headerlink" href="#initialization-cinit-and-init" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Any arguments passed to the extension type&#8217;s constructor, will be passed to both initialization methods.</li>
<li><tt class="docutils literal"><span class="pre">__cinit__()</span></tt> is where you should perform C-level initialization of the object</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>This includes any allocation of C data structures.</li>
<li><strong>Caution</strong> is warranted as to what you do in this method.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The object may not be fully valid Python object when it is called.</li>
<li>Calling Python objects, including the extensions own methods, may be hazardous.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>By the time <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> is called...</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Memory has been allocated for the object.</li>
<li>All C-level attributes have been initialized to 0 or null.</li>
<li>Python have been initialized to <tt class="docutils literal"><span class="pre">None</span></tt>, but you can not rely on that for each occasion.</li>
<li>This initialization method is guaranteed to be called exactly once.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>For Extensions types that inherit a base type:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> method of the base type is automatically called before this one.</li>
<li>The inherited <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> method can not be called explicitly.</li>
<li>Passing modified argument lists to the base type must be done through <tt class="docutils literal"><span class="pre">__init__()</span></tt>.</li>
<li>It may be wise to give the <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> method both <tt class="docutils literal"><span class="pre">&quot;*&quot;</span></tt> and <tt class="docutils literal"><span class="pre">&quot;**&quot;</span></tt> arguments.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Allows the method to accept or ignore additional arguments.</li>
<li>Eliminates the need for a Python level sub-class, that changes the <tt class="docutils literal"><span class="pre">__init__()</span></tt> method&#8217;s signature, to have to override both the <tt class="docutils literal"><span class="pre">__new__()</span></tt> and <tt class="docutils literal"><span class="pre">__init__()</span></tt> methods.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>If <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> is declared to take no arguments except <tt class="docutils literal"><span class="pre">self</span></tt>, it will ignore any extra arguments passed to the constructor without complaining about a signature mis-match</li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">__init__()</span></tt> is for higher-level initialization and is safer for Python access.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>By the time this method is called, the extension type is a fully valid Python object.</li>
<li>All operations are safe.</li>
<li>This method may sometimes be called more than once, or possibly not at all.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Take this into consideration to make sure the design of your other methods are robust of this fact.</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="finalization-dealloc">
<h3>Finalization: <tt class="docutils literal"><span class="pre">__dealloc__()</span></tt><a class="headerlink" href="#finalization-dealloc" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>This method is the counter-part to <tt class="docutils literal"><span class="pre">__cinit__()</span></tt>.</li>
<li>Any C-data that was explicitly allocated in the <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> method should be freed here.</li>
<li>Use caution in this method:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The Python object to which this method belongs may not be completely intact at this point.</li>
<li>Avoid invoking any Python operations that may touch the object.</li>
<li>Don&#8217;t call any of this object&#8217;s methods.</li>
<li>It&#8217;s best to just deallocate C-data structures here.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>All Python attributes of your extension type object are deallocated by Cython after the <tt class="docutils literal"><span class="pre">__dealloc__()</span></tt> method returns.</li>
</ul>
</div>
<div class="section" id="arithmetic-methods">
<h3>Arithmetic Methods<a class="headerlink" href="#arithmetic-methods" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most of these methods behave differently than in Python</p>
</div>
<ul class="simple">
<li>There are not &#8220;reversed&#8221; versions of these methods... there is no __radd__() for instance.</li>
<li>If the first operand cannot perform the operation, the same method of the second operand is called, with the operands in the same order.</li>
<li>Do not rely on the first parameter of these methods, being <tt class="docutils literal"><span class="pre">&quot;self&quot;</span></tt> or the right type.</li>
<li>The types of both operands should be tested before deciding what to do.</li>
<li>Return <tt class="docutils literal"><span class="pre">NotImplemented</span></tt> for unhandled, mis-matched operand types.</li>
<li>The previously mentioned points..</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Also apply to &#8216;in-place&#8217; method <tt class="docutils literal"><span class="pre">__ipow__()</span></tt>.</li>
<li>Do not apply to other &#8216;in-place&#8217; methods like <tt class="docutils literal"><span class="pre">__iadd__()</span></tt>, in that these always take <tt class="docutils literal"><span class="pre">self</span></tt> as the first argument.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="rich-comparisons">
<h3>Rich Comparisons<a class="headerlink" href="#rich-comparisons" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are no separate methods for individual rich comparison operations.</p>
</div>
<ul>
<li><p class="first">A single special method called <tt class="docutils literal"><span class="pre">__richcmp__()</span></tt> replaces all the individual rich compare, special method types.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">__richcmp__()</span></tt> takes an integer argument, indicating which operation is to be performed as shown in the table below.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last">&lt;</p>
</td>
<td><p class="first last">0</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last">==</p>
</td>
<td><p class="first last">2</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last">&gt;</p>
</td>
<td><p class="first last">4</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last">&lt;=</p>
</td>
<td><p class="first last">1</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last">!=</p>
</td>
<td><p class="first last">3</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last">&gt;=</p>
</td>
<td><p class="first last">5</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="the-next-method">
<h3>The <tt class="docutils literal"><span class="pre">__next__()</span></tt> Method<a class="headerlink" href="#the-next-method" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extension types used to expose an iterator interface should define a <tt class="docutils literal"><span class="pre">__next__()</span></tt> method.</li>
<li><strong>Do not</strong> explicitly supply a <tt class="docutils literal"><span class="pre">next()</span></tt> method, because Python does that for you automatically.</li>
</ul>
</div>
</div>
<div class="section" id="subclassing">
<h2>Subclassing<a class="headerlink" href="#subclassing" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">An extension type may inherit from a built-in type or another extension type:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">Parrot</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">cdef</span> <span class="k">class</span> <span class="nf">Norwegian</span><span class="p">(</span><span class="n">Parrot</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">A complete definition of the base type must be available to Cython</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>If the base type is a built-in type, it must have been previously declared as an <tt class="docutils literal"><span class="pre">extern</span></tt> extension type.</li>
<li><tt class="docutils literal"><span class="pre">cimport</span></tt> can be used to import the base type, if the extern declared base type is in a <tt class="docutils literal"><span class="pre">.pxd</span></tt> definition file.</li>
<li>In Cython, multiple inheritance is not permitted.. singlular inheritance only</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Cython extenstion types can also be sub-classed in Python.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Here multiple inhertance is permissible as is normal for Python.</li>
<li>Even multiple extension types may be inherited, but C-layout of all the base classes must be compatible.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="forward-declarations">
<h2>Forward Declarations<a class="headerlink" href="#forward-declarations" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Extension types can be &#8220;forward-declared&#8221;.</p>
</li>
<li><p class="first">This is necessary when two extension types refer to each other:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">Shrubbery</span> <span class="c"># forward declaration</span>

<span class="k">cdef</span> <span class="k">class</span> <span class="nf">Shrubber</span><span class="p">:</span>
    <span class="k">cdef</span> <span class="kt">Shrubbery</span> <span class="nf">work_in_progress</span>

<span class="k">cdef</span> <span class="k">class</span> <span class="nf">Shrubbery</span><span class="p">:</span>
    <span class="k">cdef</span> <span class="kt">Shrubber</span> <span class="nf">creator</span>
</pre></div>
</div>
</li>
<li><p class="first">An extension type that has a base-class, requires that both forward-declarations be specified:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">A</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="o">...</span>

<span class="k">cdef</span> <span class="k">class</span> <span class="nf">A</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
    <span class="c"># attributes and methods</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="extension-types-and-none">
<h2>Extension Types and None<a class="headerlink" href="#extension-types-and-none" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Parameters and C-variables declared as an Extension type, may take the value of <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li>This is analogous to the way a C-pointer can take the value of <tt class="docutils literal"><span class="pre">NULL</span></tt>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic simple">
<li>Exercise caution when using <tt class="docutils literal"><span class="pre">None</span></tt></li>
<li>Read this section carefully.</li>
</ol>
</div>
<ul class="simple">
<li>There is no problem as long as you are performing Python operations on it.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>This is because full dynamic type checking is applied</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>When accessing an extension type&#8217;s C-attributes, <strong>make sure</strong> it is not <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Cython does not check this for reasons of efficency.</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">Be very aware of exposing Python functions that take extension types as arguments:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">widen_shrubbery</span><span class="p">(</span><span class="n">Shrubbery</span> <span class="n">sh</span><span class="p">,</span> <span class="n">extra_width</span><span class="p">):</span> <span class="c"># This is</span>
<span class="n">sh</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">extra_width</span>

<span class="o">*</span> <span class="n">Users</span> <span class="n">could</span> <span class="o">**</span><span class="n">crash</span><span class="o">**</span> <span class="n">the</span> <span class="n">program</span> <span class="k">by</span> <span class="n">passing</span> <span class="sb">``</span><span class="bp">None</span><span class="sb">``</span> <span class="k">for</span> <span class="n">the</span> <span class="sb">``</span><span class="n">sh</span><span class="sb">``</span> <span class="n">parameter</span><span class="o">.</span>
<span class="o">*</span> <span class="n">This</span> <span class="n">could</span> <span class="n">be</span> <span class="n">avoided</span> <span class="k">by</span><span class="p">::</span>

    <span class="k">def</span> <span class="nf">widen_shrubbery</span><span class="p">(</span><span class="n">Shrubbery</span> <span class="n">sh</span><span class="p">,</span> <span class="n">extra_width</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sh</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">extra_width</span>

<span class="o">*</span> <span class="n">Cython</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">more</span> <span class="n">convenient</span> <span class="n">way</span> <span class="k">with</span> <span class="n">a</span> <span class="sb">``</span><span class="ow">not</span> <span class="bp">None</span><span class="sb">``</span> <span class="n">clause</span><span class="p">::</span>

    <span class="k">def</span> <span class="nf">widen_shrubbery</span><span class="p">(</span><span class="n">Shrubbery</span> <span class="n">sh</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="n">extra_width</span><span class="p">):</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">extra_width</span>

<span class="o">*</span> <span class="n">Now</span> <span class="n">this</span> <span class="n">function</span> <span class="n">automatically</span> <span class="n">checks</span> <span class="n">that</span> <span class="sb">``</span><span class="n">sh</span><span class="sb">``</span> <span class="ow">is</span> <span class="ow">not</span> <span class="sb">``</span><span class="bp">None</span><span class="sb">``</span><span class="p">,</span> <span class="k">as</span> <span class="n">well</span> <span class="k">as</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">right</span> <span class="nb">type</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">not</span> <span class="pre">None</span></tt> can only be used in Python functions (declared with <tt class="docutils literal"><span class="pre">def</span></tt> <strong>not</strong> <tt class="docutils literal"><span class="pre">cdef</span></tt>).</p>
</li>
<li><p class="first">For <tt class="docutils literal"><span class="pre">cdef</span></tt> functions, you will have to provide the check yourself.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">self</span></tt> parameter of an extension type is guaranteed to <strong>never</strong> be <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
</li>
<li><p class="first">When comparing a value <tt class="docutils literal"><span class="pre">x</span></tt> with <tt class="docutils literal"><span class="pre">None</span></tt>, and <tt class="docutils literal"><span class="pre">x</span></tt> is a Python object, note the following:</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">None</span></tt> and <tt class="docutils literal"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></tt> are very efficient.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>They translate directly to C-pointer comparisons.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">None</span></tt> and <tt class="docutils literal"><span class="pre">x</span> <span class="pre">!=</span> <span class="pre">None</span></tt> or <tt class="docutils literal"><span class="pre">if</span> <span class="pre">x:</span> <span class="pre">...</span></tt> (a boolean condition), will invoke Python operations and will therefore be much slower.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="weak-referencing">
<h2>Weak Referencing<a class="headerlink" href="#weak-referencing" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">By default, weak references are not supported.</p>
</li>
<li><p class="first">It can be enabled by declaring a C attribute of the <tt class="docutils literal"><span class="pre">object</span></tt> type called <tt class="docutils literal"><span class="pre">__weakref__()</span></tt>:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">ExplodingAnimal</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This animal will self-destruct when it is</span>
<span class="sd">    no longer strongly referenced.&quot;&quot;&quot;</span>

    <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">__weakref__</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="external-and-public-types">
<h2>External and Public Types<a class="headerlink" href="#external-and-public-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="public">
<h3>Public<a class="headerlink" href="#public" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>When an extention type is declared <tt class="docutils literal"><span class="pre">public</span></tt>, Cython will generate a C-header (&#8221;.h&#8221;) file.</li>
<li>The header file will contain the declarations for it&#8217;s <strong>object-struct</strong> and it&#8217;s <strong>type-object</strong>.</li>
<li>External C-code can now access the attributes of the extension type.</li>
</ul>
</div>
<div class="section" id="external">
<h3>External<a class="headerlink" href="#external" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>An <tt class="docutils literal"><span class="pre">extern</span></tt> extension type allows you to gain access to the internals of:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Python objects defined in the Python core.</li>
<li>Non-Cython extension modules</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">The following example lets you get at the C-level members of Python&#8217;s built-in &#8220;complex&#8221; object:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kr">extern</span> <span class="k">from</span> <span class="s">&quot;complexobject.h&quot;</span><span class="p">:</span>

    <span class="k">struct</span> <span class="nc">Py_complex</span><span class="p">:</span>
        <span class="n">double</span> <span class="n">real</span>
        <span class="n">double</span> <span class="n">imag</span>

    <span class="k">ctypedef</span> <span class="k">class</span> <span class="nc">__builtin__</span><span class="o">.</span><span class="n">complex</span> <span class="p">[</span><span class="nb">object</span> <span class="n">PyComplexObject</span><span class="p">]:</span>
        <span class="k">cdef</span> <span class="kt">Py_complex</span> <span class="nf">cval</span>

<span class="c"># A function which uses the above type</span>
<span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="nb">complex</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Real:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">cval</span><span class="o">.</span><span class="n">real</span>
    <span class="k">print</span> <span class="s">&quot;Imag:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">cval</span><span class="o">.</span><span class="n">imag</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Some important things in the example:
#. <tt class="docutils literal"><span class="pre">ctypedef</span></tt> has been used because because Python&#8217;s header file has the struct decalared with:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">ctypedef</span> <span class="k">struct</span> <span class="err">{</span>
<span class="o">...</span>
<span class="p">}</span> <span class="n">PyComplexObject</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>The module of where this type object can be found is specified along side the name of the extension type. See <strong>Implicit Importing</strong>.</li>
<li>When declaring an external extension type...</li>
</ol>
<blockquote class="last">
<div><ul class="simple">
<li>Don&#8217;t declare any methods, because they are Python method class the are not needed.</li>
<li>Similiar to <strong>structs</strong> and <strong>unions</strong>, extension classes declared inside a <tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">extern</span> <span class="pre">from</span></tt> block only need to declare the C members which you will actually need to access in your module.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="name-specification-clause">
<h3>Name Specification Clause<a class="headerlink" href="#name-specification-clause" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only available to <strong>public</strong> and <strong>extern</strong> extension types.</p>
</div>
<ul>
<li><p class="first">Example:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="p">[</span><span class="nb">object</span> <span class="n">object_struct_name</span><span class="p">,</span> <span class="nb">type</span> <span class="n">type_object_name</span> <span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">object_struct_name</span></tt> is the name to assume for the type&#8217;s C-struct.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">type_object_name</span></tt> is the name to assume for the type&#8217;s statically declared type-object.</p>
</li>
<li><p class="first">The object and type clauses can be written in any order.</p>
</li>
<li><p class="first">For <tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">extern</span> <span class="pre">from</span></tt> declarations, This clause <strong>is required</strong>.</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The object clause is required because Cython must generate code that is compatible with the declarations in the header file.</li>
<li>Otherwise the object clause is optional.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>For public extension types, both the object and type clauses <strong>are required</strong> for Cython to generate code that is compatible with external C-code.</li>
</ul>
</div>
</div>
<div class="section" id="type-names-vs-constructor-names">
<h2>Type Names vs. Constructor Names<a class="headerlink" href="#type-names-vs-constructor-names" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>In a Cython module, the name of an extension type serves two distinct purposes:</li>
</ul>
<blockquote>
<div><ol class="arabic simple">
<li>When used in an expression, it refers to a &#8220;module-level&#8221; global variable holding the type&#8217;s constructor (i.e. it&#8217;s type-object)</li>
<li>It can also be used as a C-type name to declare a &#8220;type&#8221; for variables, arguments, and return values.</li>
</ol>
</div></blockquote>
<ul>
<li><p class="first">Example:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kr">extern</span> <span class="k">class</span> <span class="kt">MyModule</span>.<span class="nf">Spam</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The name &#8220;Spam&#8221; serves both of these roles.</li>
<li>Only &#8220;Spam&#8221; can be used as the type-name.</li>
<li>The constructor can be referred to by other names.</li>
<li>Upon an explicit import of &#8220;MyModule&#8221;...</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">MyModule.Spam()</span></tt> could be used as the constructor call.</li>
<li><tt class="docutils literal"><span class="pre">MyModule.Spam</span></tt> could not be used as a type-name</li>
</ul>
</div></blockquote>
</div></blockquote>
<ul>
<li><p class="first">When an &#8220;as&#8221; clause is used, the name specified takes over both roles:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kr">extern</span> <span class="k">class</span> <span class="kt">MyModule</span>.<span class="kt">Spam</span> <span class="k">as</span> <span class="nf">Yummy</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">Yummy</span></tt> becomes both type-name and a name for the constructor.</li>
<li>There other ways of course, to get hold of the constructor, but <tt class="docutils literal"><span class="pre">Yummy</span></tt> is the only usable type-name.</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index-2.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extension Types</a><ul>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#properties">Properties</a></li>
<li><a class="reference internal" href="#special-methods">Special Methods</a><ul>
<li><a class="reference internal" href="#declaration">Declaration</a></li>
<li><a class="reference internal" href="#docstrings">Docstrings</a></li>
<li><a class="reference internal" href="#initialization-cinit-and-init">Initialization: <tt class="docutils literal"><span class="pre">__cinit__()</span></tt> and <tt class="docutils literal"><span class="pre">__init__()</span></tt></a></li>
<li><a class="reference internal" href="#finalization-dealloc">Finalization: <tt class="docutils literal"><span class="pre">__dealloc__()</span></tt></a></li>
<li><a class="reference internal" href="#arithmetic-methods">Arithmetic Methods</a></li>
<li><a class="reference internal" href="#rich-comparisons">Rich Comparisons</a></li>
<li><a class="reference internal" href="#the-next-method">The <tt class="docutils literal"><span class="pre">__next__()</span></tt> Method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subclassing">Subclassing</a></li>
<li><a class="reference internal" href="#forward-declarations">Forward Declarations</a></li>
<li><a class="reference internal" href="#extension-types-and-none">Extension Types and None</a></li>
<li><a class="reference internal" href="#weak-referencing">Weak Referencing</a></li>
<li><a class="reference internal" href="#external-and-public-types">External and Public Types</a><ul>
<li><a class="reference internal" href="#public">Public</a></li>
<li><a class="reference internal" href="#external">External</a></li>
<li><a class="reference internal" href="#name-specification-clause">Name Specification Clause</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-names-vs-constructor-names">Type Names vs. Constructor Names</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="language_basics.html"
                        title="previous chapter">Language Basics</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="interfacing_with_other_code.html"
                        title="next chapter">Interfacing with Other Code</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/src/reference/extension_types.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://docs.cython.org/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="interfacing_with_other_code.html" title="Interfacing with Other Code"
             >next</a></li>
        <li class="right" >
          <a href="language_basics.html" title="Language Basics"
             >previous</a> |</li>
        <li><a href="../../index-2.html">Cython 0.20 documentation</a> &raquo;</li>
          <li><a href="index.html" >Reference Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, Stefan Behnel, Robert Bradshaw, Dag Sverre Seljebotn, Greg Ewing, William Stein, Gabriel Gellner, et al..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6139100-3");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>

<!-- Mirrored from docs.cython.org/src/reference/extension_types.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 23:32:58 GMT -->
</html>