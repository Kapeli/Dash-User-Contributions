

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from docs.cython.org/src/userguide/language_basics.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 23:32:57 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Language Basics &mdash; Cython 0.20 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Cython 0.20 documentation" href="../../index-2.html" />
    <link rel="up" title="Users Guide" href="index.html" />
    <link rel="next" title="Extension Types" href="extension_types.html" />
    <link rel="prev" title="Users Guide" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="extension_types.html" title="Extension Types"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="Users Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index-2.html">Cython 0.20 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Users Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ctypedef">
<span id="enum"></span><span id="union"></span><span id="struct"></span><span id="language-basics"></span><span id="id1"></span><h1>Language Basics<a class="headerlink" href="#ctypedef" title="Permalink to this headline">¶</a></h1>
<div class="section" id="c-variable-and-type-definitions">
<h2>C variable and type definitions<a class="headerlink" href="#c-variable-and-type-definitions" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> statement is used to declare C variables, either local or
module-level:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span>
<span class="k">cdef</span> <span class="kt">float</span> <span class="nf">f</span><span class="p">,</span> <span class="kt">g</span>[42], *<span class="nf">h</span>
</pre></div>
</div>
<p>and C <a class="reference internal" href="#struct"><tt class="xref std std-keyword docutils literal"><span class="pre">struct</span></tt></a>, <a class="reference internal" href="#union"><tt class="xref std std-keyword docutils literal"><span class="pre">union</span></tt></a> or <a class="reference internal" href="#enum"><tt class="xref std std-keyword docutils literal"><span class="pre">enum</span></tt></a> types:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">struct</span> <span class="nf">Grail</span><span class="p">:</span>
    <span class="nb">int</span> <span class="n">age</span>
    <span class="nb">float</span> <span class="n">volume</span>

<span class="k">cdef</span> <span class="k">union</span> <span class="nf">Food</span><span class="p">:</span>
    <span class="n">char</span> <span class="o">*</span><span class="n">spam</span>
    <span class="nb">float</span> <span class="o">*</span><span class="n">eggs</span>

<span class="k">cdef</span> <span class="k">enum</span> <span class="nf">CheeseType</span><span class="p">:</span>
    <span class="n">cheddar</span><span class="p">,</span> <span class="n">edam</span><span class="p">,</span>
    <span class="n">camembert</span>

<span class="k">cdef</span> <span class="k">enum</span> <span class="nf">CheeseState</span><span class="p">:</span>
    <span class="n">hard</span> <span class="o">=</span> <span class="mf">1</span>
    <span class="n">soft</span> <span class="o">=</span> <span class="mf">2</span>
    <span class="n">runny</span> <span class="o">=</span> <span class="mf">3</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="external_C_code.html#struct-union-enum-styles"><em>Styles of struct, union and enum declaration</em></a></p>
<p>There is currently no special syntax for defining a constant, but you can use
an anonymous <a class="reference internal" href="#enum"><tt class="xref std std-keyword docutils literal"><span class="pre">enum</span></tt></a> declaration for this purpose, for example,:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">enum</span><span class="p">:</span>
    <span class="n">tons_of_spam</span> <span class="o">=</span> <span class="mf">3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>the words <tt class="docutils literal"><span class="pre">struct</span></tt>, <tt class="docutils literal"><span class="pre">union</span></tt> and <tt class="docutils literal"><span class="pre">enum</span></tt> are used only when
defining a type, not when referring to it. For example, to declare a variable
pointing to a <tt class="docutils literal"><span class="pre">Grail</span></tt> you would write:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">Grail</span> *<span class="nf">gp</span>
</pre></div>
</div>
<p>and not:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">struct</span> <span class="kt">Grail</span> *<span class="nf">gp</span> <span class="c"># WRONG</span>
</pre></div>
</div>
<p>There is also a <tt class="docutils literal"><span class="pre">ctypedef</span></tt> statement for giving names to types, e.g.:</p>
<div class="last highlight-cython"><div class="highlight"><pre><span class="k">ctypedef</span> <span class="n">unsigned</span> <span class="nb">long</span> <span class="n">ULong</span>

<span class="k">ctypedef</span> <span class="nb">int</span><span class="o">*</span> <span class="n">IntPtr</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-multiple-c-declarations">
<h3>Grouping multiple C declarations<a class="headerlink" href="#grouping-multiple-c-declarations" title="Permalink to this headline">¶</a></h3>
<p>If you have a series of declarations that all begin with <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a>, you
can group them into a <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> block like this:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="n">cdef</span><span class="p">:</span>
    <span class="k">struct</span> <span class="nc">Spam</span><span class="p">:</span>
        <span class="nb">int</span> <span class="n">tons</span>

    <span class="nb">int</span> <span class="n">i</span>
    <span class="nb">float</span> <span class="n">f</span>
    <span class="n">Spam</span> <span class="o">*</span><span class="n">p</span>

    <span class="n">void</span> <span class="n">f</span><span class="p">(</span><span class="n">Spam</span> <span class="o">*</span><span class="n">s</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">tons</span><span class="p">,</span> <span class="s">&quot;Tons of spam&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="python-functions-vs-c-functions">
<h2>Python functions vs. C functions<a class="headerlink" href="#python-functions-vs-c-functions" title="Permalink to this headline">¶</a></h2>
<p>There are two kinds of function definition in Cython:</p>
<p>Python functions are defined using the def statement, as in Python. They take
Python objects as parameters and return Python objects.</p>
<p>C functions are defined using the new <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> statement. They take
either Python objects or C values as parameters, and can return either Python
objects or C values.</p>
<p>Within a Cython module, Python functions and C functions can call each other
freely, but only Python functions can be called from outside the module by
interpreted Python code. So, any functions that you want to &#8220;export&#8221; from your
Cython module must be declared as Python functions using def.
There is also a hybrid function, called <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a>. A <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a>
can be called from anywhere, but uses the faster C calling conventions
when being called from other Cython code. A <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a> can also be overridden
by a Python method on a subclass or an instance attribute, even when called from Cython.
If this happens, most performance gains are of course lost and even if it does not,
there is a tiny overhead in calling a <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a> method from Cython compared to
calling a <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> method.</p>
<p>Parameters of either type of function can be declared to have C data types,
using normal C declaration syntax. For example,:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">s</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">cdef</span> <span class="kt">int</span> <span class="nf">eggs</span><span class="p">(</span><span class="n">unsigned</span> <span class="nb">long</span> <span class="n">l</span><span class="p">,</span> <span class="nb">float</span> <span class="n">f</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>When a parameter of a Python function is declared to have a C data type, it is
passed in as a Python object and automatically converted to a C value, if
possible. In other words, the definition of <tt class="docutils literal"><span class="pre">spam</span></tt> above is equivalent to
writing:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">python_i</span><span class="p">,</span> <span class="n">python_s</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span> <span class="o">=</span> <span class="n">python_i</span>
    <span class="k">cdef</span> <span class="kt">char</span>* <span class="nf">s</span> <span class="o">=</span> <span class="n">python_s</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Automatic conversion is currently only possible for numeric types,
string types and structs (composed recursively of any of these types);
attempting to use any other type for the parameter of a
Python function will result in a compile-time error.
Care must be taken with strings to ensure a reference if the pointer is to be used
after the call. Structs can be obtained from Python mappings, and again care must be taken
with string attributes if they are to be used after the function returns.</p>
<p>C functions, on the other hand, can have parameters of any type, since they&#8217;re
passed in directly using a normal C function call.</p>
<p>A more complete comparison of the pros and cons of these different method
types can be found at <a class="reference internal" href="early_binding_for_speed.html#early-binding-for-speed"><em>Early Binding for Speed</em></a>.</p>
<div class="section" id="python-objects-as-parameters-and-return-values">
<h3>Python objects as parameters and return values<a class="headerlink" href="#python-objects-as-parameters-and-return-values" title="Permalink to this headline">¶</a></h3>
<p>If no type is specified for a parameter or return value, it is assumed to be a
Python object. (Note that this is different from the C convention, where it
would default to int.) For example, the following defines a C function that
takes two Python objects as parameters and returns a Python object:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="nf">spamobjs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Reference counting for these objects is performed automatically according to
the standard Python/C API rules (i.e. borrowed references are taken as
parameters and a new reference is returned).</p>
<p>The name object can also be used to explicitly declare something as a Python
object. This can be useful if the name being declared would otherwise be taken
as the name of a type, for example,:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="nf">ftang</span><span class="p">(</span><span class="nb">object</span> <span class="nb">int</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>declares a parameter called int which is a Python object. You can also use
object as the explicit return type of a function, e.g.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">object</span> <span class="nf">ftang</span><span class="p">(</span><span class="nb">object</span> <span class="nb">int</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In the interests of clarity, it is probably a good idea to always be explicit
about object parameters in C functions.</p>
</div>
<div class="section" id="error-return-values">
<h3>Error return values<a class="headerlink" href="#error-return-values" title="Permalink to this headline">¶</a></h3>
<p>If you don&#8217;t do anything special, a function declared with <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> that
does not return a Python object has no way of reporting Python exceptions to
its caller. If an exception is detected in such a function, a warning message
is printed and the exception is ignored.</p>
<p>If you want a C function that does not return a Python object to be able to
propagate exceptions to its caller, you need to declare an exception value for
it. Here is an example:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">spam</span><span class="p">()</span> <span class="k">except</span> <span class="o">-</span><span class="mf">1</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>With this declaration, whenever an exception occurs inside spam, it will
immediately return with the value <tt class="docutils literal"><span class="pre">-1</span></tt>. Furthermore, whenever a call to spam
returns <tt class="docutils literal"><span class="pre">-1</span></tt>, an exception will be assumed to have occurred and will be
propagated.</p>
<p>When you declare an exception value for a function, you should never
explicitly return that value. If all possible return values are legal and you
can&#8217;t reserve one entirely for signalling errors, you can use an alternative
form of exception value declaration:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">spam</span><span class="p">()</span> <span class="k">except</span><span class="o">?</span> <span class="o">-</span><span class="mf">1</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The &#8221;?&#8221; indicates that the value <tt class="docutils literal"><span class="pre">-1</span></tt> only indicates a possible error. In this
case, Cython generates a call to <a class="reference external" href="http://docs.python.org/3.3/c-api/exceptions.html#PyErr_Occurred" title="(in Python v3.3)"><tt class="xref c c-func docutils literal"><span class="pre">PyErr_Occurred()</span></tt></a> if the exception value is
returned, to make sure it really is an error.</p>
<p>There is also a third form of exception value declaration:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">spam</span><span class="p">()</span> <span class="k">except</span> <span class="o">*</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This form causes Cython to generate a call to <a class="reference external" href="http://docs.python.org/3.3/c-api/exceptions.html#PyErr_Occurred" title="(in Python v3.3)"><tt class="xref c c-func docutils literal"><span class="pre">PyErr_Occurred()</span></tt></a> after
every call to spam, regardless of what value it returns. If you have a
function returning void that needs to propagate errors, you will have to use
this form, since there isn&#8217;t any return value to test.
Otherwise there is little use for this form.</p>
<p>An external C++ function that may raise an exception can be declared with:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">spam</span><span class="p">()</span> <span class="k">except</span> <span class="o">+</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="wrapping_CPlusPlus.html#wrapping-cplusplus"><em>Using C++ in Cython</em></a> for more details.</p>
<p>Some things to note:</p>
<ul>
<li><p class="first">Exception values can only declared for functions returning an integer, enum,
float or pointer type, and the value must be a constant expression.
Void functions can only use the <tt class="docutils literal"><span class="pre">except</span> <span class="pre">*</span></tt> form.</p>
</li>
<li><p class="first">The exception value specification is part of the signature of the function.
If you&#8217;re passing a pointer to a function as a parameter or assigning it
to a variable, the declared type of the parameter or variable must have
the same exception value specification (or lack thereof). Here is an
example of a pointer-to-function declaration with an exception
value:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">grail</span><span class="p">)(</span><span class="nb">int</span><span class="p">,</span> <span class="n">char</span><span class="o">*</span><span class="p">)</span> <span class="k">except</span> <span class="o">-</span><span class="mf">1</span>
</pre></div>
</div>
</li>
<li><p class="first">You don&#8217;t need to (and shouldn&#8217;t) declare exception values for functions
which return Python objects. Remember that a function with no declared
return type implicitly returns a Python object. (Exceptions on such functions
are implicitly propagated by returning NULL.)</p>
</li>
</ul>
</div>
<div class="section" id="checking-return-values-of-non-cython-functions">
<h3>Checking return values of non-Cython functions<a class="headerlink" href="#checking-return-values-of-non-cython-functions" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s important to understand that the except clause does not cause an error to
be raised when the specified value is returned. For example, you can&#8217;t write
something like:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kr">extern</span> <span class="kt">FILE</span> *<span class="nf">fopen</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">)</span> <span class="k">except</span> <span class="bp">NULL</span> <span class="c"># WRONG!</span>
</pre></div>
</div>
<p>and expect an exception to be automatically raised if a call to <tt class="xref py py-func docutils literal"><span class="pre">fopen()</span></tt>
returns <tt class="docutils literal"><span class="pre">NULL</span></tt>. The except clause doesn&#8217;t work that way; its only purpose is
for propagating Python exceptions that have already been raised, either by a Cython
function or a C function that calls Python/C API routines. To get an exception
from a non-Python-aware function such as <tt class="xref py py-func docutils literal"><span class="pre">fopen()</span></tt>, you will have to check the
return value and raise it yourself, for example,:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">FILE</span>* <span class="nf">p</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;spam.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="bp">NULL</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">SpamError</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t open the spam file&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="automatic-type-conversions">
<h2>Automatic type conversions<a class="headerlink" href="#automatic-type-conversions" title="Permalink to this headline">¶</a></h2>
<p>In most situations, automatic conversions will be performed for the basic
numeric and string types when a Python object is used in a context requiring a
C value, or vice versa. The following table summarises the conversion
possibilities.</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="30%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">C types</th>
<th class="head">From Python types</th>
<th class="head">To Python types</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[unsigned] char
[unsigned] short
int, long</td>
<td>int, long</td>
<td>int</td>
</tr>
<tr class="row-odd"><td>unsigned int
unsigned long
[unsigned] long long</td>
<td>int, long</td>
<td>long</td>
</tr>
<tr class="row-even"><td>float, double, long double</td>
<td>int, long, float</td>
<td>float</td>
</tr>
<tr class="row-odd"><td>char*</td>
<td>str/bytes</td>
<td>str/bytes <a class="footnote-reference" href="#id3" id="id2">[1]</a></td>
</tr>
<tr class="row-even"><td>struct</td>
<td>&nbsp;</td>
<td>dict</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>The conversion is to/from str for Python 2.x, and bytes for Python 3.x.</td></tr>
</tbody>
</table>
<div class="section" id="caveats-when-using-a-python-string-in-a-c-context">
<h3>Caveats when using a Python string in a C context<a class="headerlink" href="#caveats-when-using-a-python-string-in-a-c-context" title="Permalink to this headline">¶</a></h3>
<p>You need to be careful when using a Python string in a context expecting a
<tt class="docutils literal"><span class="pre">char*</span></tt>. In this situation, a pointer to the contents of the Python string is
used, which is only valid as long as the Python string exists. So you need to
make sure that a reference to the original Python string is held for as long
as the C string is needed. If you can&#8217;t guarantee that the Python string will
live long enough, you will need to copy the C string.</p>
<p>Cython detects and prevents some mistakes of this kind. For instance, if you
attempt something like:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">char</span> *<span class="nf">s</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pystring1</span> <span class="o">+</span> <span class="n">pystring2</span>
</pre></div>
</div>
<p>then Cython will produce the error message <tt class="docutils literal"><span class="pre">Obtaining</span> <span class="pre">char*</span> <span class="pre">from</span> <span class="pre">temporary</span>
<span class="pre">Python</span> <span class="pre">value</span></tt>. The reason is that concatenating the two Python strings
produces a new Python string object that is referenced only by a temporary
internal variable that Cython generates. As soon as the statement has finished,
the temporary variable will be decrefed and the Python string deallocated,
leaving <tt class="docutils literal"><span class="pre">s</span></tt> dangling. Since this code could not possibly work, Cython refuses to
compile it.</p>
<p>The solution is to assign the result of the concatenation to a Python
variable, and then obtain the <tt class="docutils literal"><span class="pre">char*</span></tt> from that, i.e.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">char</span> *<span class="nf">s</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pystring1</span> <span class="o">+</span> <span class="n">pystring2</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">p</span>
</pre></div>
</div>
<p>It is then your responsibility to hold the reference p for as long as
necessary.</p>
<p>Keep in mind that the rules used to detect such errors are only heuristics.
Sometimes Cython will complain unnecessarily, and sometimes it will fail to
detect a problem that exists. Ultimately, you need to understand the issue and
be careful what you do.</p>
</div>
</div>
<div class="section" id="statements-and-expressions">
<h2>Statements and expressions<a class="headerlink" href="#statements-and-expressions" title="Permalink to this headline">¶</a></h2>
<p>Control structures and expressions follow Python syntax for the most part.
When applied to Python objects, they have the same semantics as in Python
(unless otherwise noted). Most of the Python operators can also be applied to
C values, with the obvious semantics.</p>
<p>If Python objects and C values are mixed in an expression, conversions are
performed automatically between Python objects and C numeric or string types.</p>
<p>Reference counts are maintained automatically for all Python objects, and all
Python operations are automatically checked for errors, with appropriate
action taken.</p>
<div class="section" id="differences-between-c-and-cython-expressions">
<h3>Differences between C and Cython expressions<a class="headerlink" href="#differences-between-c-and-cython-expressions" title="Permalink to this headline">¶</a></h3>
<p>There are some differences in syntax and semantics between C expressions and
Cython expressions, particularly in the area of C constructs which have no
direct equivalent in Python.</p>
<ul>
<li><p class="first">An integer literal is treated as a C constant, and will
be truncated to whatever size your C compiler thinks appropriate.
To get a Python integer (of arbitrary precision) cast immediately to
an object (e.g. <tt class="docutils literal"><span class="pre">&lt;object&gt;100000000000000000000</span></tt>). The <tt class="docutils literal"><span class="pre">L</span></tt>, <tt class="docutils literal"><span class="pre">LL</span></tt>,
and <tt class="docutils literal"><span class="pre">U</span></tt> suffixes have the same meaning as in C.</p>
</li>
<li><p class="first">There is no <tt class="docutils literal"><span class="pre">-&gt;</span></tt> operator in Cython. Instead of <tt class="docutils literal"><span class="pre">p-&gt;x</span></tt>, use <tt class="docutils literal"><span class="pre">p.x</span></tt></p>
</li>
<li><p class="first">There is no unary <tt class="docutils literal"><span class="pre">*</span></tt> operator in Cython. Instead of <tt class="docutils literal"><span class="pre">*p</span></tt>, use <tt class="docutils literal"><span class="pre">p[0]</span></tt></p>
</li>
<li><p class="first">There is an <tt class="docutils literal"><span class="pre">&amp;</span></tt> operator, with the same semantics as in C.</p>
</li>
<li><p class="first">The null C pointer is called <tt class="docutils literal"><span class="pre">NULL</span></tt>, not <tt class="docutils literal"><span class="pre">0</span></tt> (and <tt class="docutils literal"><span class="pre">NULL</span></tt> is a reserved word).</p>
</li>
<li><p class="first">Type casts are written <tt class="docutils literal"><span class="pre">&lt;type&gt;value</span></tt> , for example,:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">char</span>* <span class="nf">p</span><span class="p">,</span> <span class="kt">float</span>* <span class="nf">q</span>
<span class="n">p</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">char</span><span class="o">*&gt;</span><span class="n">q</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="scope-rules">
<h3>Scope rules<a class="headerlink" href="#scope-rules" title="Permalink to this headline">¶</a></h3>
<p>Cython determines whether a variable belongs to a local scope, the module
scope, or the built-in scope completely statically. As with Python, assigning
to a variable which is not otherwise declared implicitly declares it to be a
Python variable residing in the scope where it is assigned.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A consequence of these rules is that the module-level scope behaves the
same way as a Python local scope if you refer to a variable before assigning
to it. In particular, tricks such as the following will not work in Cython:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="bp">True</span> <span class="o">=</span> <span class="mf">1</span>
</pre></div>
</div>
<p>because, due to the assignment, the True will always be looked up in the
module-level scope. You would have to do something like this instead:</p>
<div class="last highlight-cython"><div class="highlight"><pre><span class="k">import</span> <span class="nn">__builtin__</span>
<span class="k">try</span><span class="p">:</span>
    <span class="bp">True</span> <span class="o">=</span> <span class="n">__builtin__</span><span class="o">.</span><span class="n">True</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="bp">True</span> <span class="o">=</span> <span class="mf">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="built-in-functions">
<h3>Built-in Functions<a class="headerlink" href="#built-in-functions" title="Permalink to this headline">¶</a></h3>
<p>Cython compiles calls to most built-in functions into direct calls to
the corresponding Python/C API routines, making them particularly fast.</p>
<p>Only direct function calls using these names are optimised. If you do
something else with one of these names that assumes it&#8217;s a Python object,
such as assign it to a Python variable, and later call it, the call will
be made as a Python function call.</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="18%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function and arguments</th>
<th class="head">Return type</th>
<th class="head">Python/C API Equivalent</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>abs(obj)</td>
<td>object,
double, ...</td>
<td>PyNumber_Absolute, fabs,
fabsf, ...</td>
</tr>
<tr class="row-odd"><td>callable(obj)</td>
<td>bint</td>
<td>PyObject_Callable</td>
</tr>
<tr class="row-even"><td>delattr(obj, name)</td>
<td>None</td>
<td>PyObject_DelAttr</td>
</tr>
<tr class="row-odd"><td>exec(code, [glob, [loc]])</td>
<td>object</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>dir(obj)</td>
<td>list</td>
<td>PyObject_Dir</td>
</tr>
<tr class="row-odd"><td>divmod(a, b)</td>
<td>tuple</td>
<td>PyNumber_Divmod</td>
</tr>
<tr class="row-even"><td>getattr(obj, name, [default])
(Note 1)</td>
<td>object</td>
<td>PyObject_GetAttr</td>
</tr>
<tr class="row-odd"><td>hasattr(obj, name)</td>
<td>bint</td>
<td>PyObject_HasAttr</td>
</tr>
<tr class="row-even"><td>hash(obj)</td>
<td>int / long</td>
<td>PyObject_Hash</td>
</tr>
<tr class="row-odd"><td>intern(obj)</td>
<td>object</td>
<td>Py*_InternFromString</td>
</tr>
<tr class="row-even"><td>isinstance(obj, type)</td>
<td>bint</td>
<td>PyObject_IsInstance</td>
</tr>
<tr class="row-odd"><td>issubclass(obj, type)</td>
<td>bint</td>
<td>PyObject_IsSubclass</td>
</tr>
<tr class="row-even"><td>iter(obj, [sentinel])</td>
<td>object</td>
<td>PyObject_GetIter</td>
</tr>
<tr class="row-odd"><td>len(obj)</td>
<td>Py_ssize_t</td>
<td>PyObject_Length</td>
</tr>
<tr class="row-even"><td>pow(x, y, [z])</td>
<td>object</td>
<td>PyNumber_Power</td>
</tr>
<tr class="row-odd"><td>reload(obj)</td>
<td>object</td>
<td>PyImport_ReloadModule</td>
</tr>
<tr class="row-even"><td>repr(obj)</td>
<td>object</td>
<td>PyObject_Repr</td>
</tr>
<tr class="row-odd"><td>setattr(obj, name)</td>
<td>void</td>
<td>PyObject_SetAttr</td>
</tr>
</tbody>
</table>
<p>Note 1: Pyrex originally provided a function <tt class="xref py py-func docutils literal"><span class="pre">getattr3(obj,</span> <span class="pre">name,</span> <span class="pre">default)()</span></tt>
corresponding to the three-argument form of the Python builtin <a class="reference external" href="http://docs.python.org/3.3/library/functions.html#getattr" title="(in Python v3.3)"><tt class="xref py py-func docutils literal"><span class="pre">getattr()</span></tt></a>.
Cython still supports this function, but the usage is deprecated in favour of
the normal builtin, which Cython can optimise in both forms.</p>
</div>
<div class="section" id="operator-precedence">
<h3>Operator Precedence<a class="headerlink" href="#operator-precedence" title="Permalink to this headline">¶</a></h3>
<p>Keep in mind that there are some differences in operator precedence between
Python and C, and that Cython uses the Python precedences, not the C ones.</p>
</div>
<div class="section" id="integer-for-loops">
<h3>Integer for-loops<a class="headerlink" href="#integer-for-loops" title="Permalink to this headline">¶</a></h3>
<p>Cython recognises the usual Python for-in-range integer loop pattern:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If <tt class="docutils literal"><span class="pre">i</span></tt> is declared as a <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> integer type, it will
optimise this into a pure C loop.  This restriction is required as
otherwise the generated code wouldn&#8217;t be correct due to potential
integer overflows on the target architecture.  If you are worried that
the loop is not being converted correctly, use the annotate feature of
the cython commandline (<tt class="docutils literal"><span class="pre">-a</span></tt>) to easily see the generated C code.
See <a class="reference internal" href="pyrex_differences.html#automatic-range-conversion"><em>Automatic range conversion</em></a></p>
<p>For backwards compatibility to Pyrex, Cython also supports a more verbose
form of for-loop which you might find in legacy code:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">by</span> <span class="n">s</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">s</span></tt> is some integer step size.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This syntax is deprecated and should not be used in new code.
Use the normal Python for-loop instead.</p>
</div>
<p>Some things to note about the for-from loop:</p>
<ul class="simple">
<li>The target expression must be a plain variable name.</li>
<li>The name between the lower and upper bounds must be the same as the target
name.</li>
<li>The direction of iteration is determined by the relations. If they are both
from the set {<tt class="docutils literal"><span class="pre">&lt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;=</span></tt>} then it is upwards; if they are both from the set
{<tt class="docutils literal"><span class="pre">&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&gt;=</span></tt>} then it is downwards. (Any other combination is disallowed.)</li>
</ul>
<p>Like other Python looping statements, break and continue may be used in the
body, and the loop may have an else clause.</p>
</div>
</div>
<div class="section" id="the-include-statement">
<h2>The include statement<a class="headerlink" href="#the-include-statement" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Historically the <tt class="docutils literal"><span class="pre">include</span></tt> statement was used for sharing declarations.
Use <a class="reference internal" href="sharing_declarations.html#sharing-declarations"><em>Sharing Declarations Between Cython Modules</em></a> instead.</p>
</div>
<p>A Cython source file can include material from other files using the include
statement, for example,:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">include</span> <span class="s">&quot;spamstuff.pxi&quot;</span>
</pre></div>
</div>
<p>The contents of the named file are textually included at that point. The
included file can contain any complete statements or declarations that are
valid in the context where the include statement appears, including other
include statements. The contents of the included file should begin at an
indentation level of zero, and will be treated as though they were indented to
the level of the include statement that is including the file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are other mechanisms available for splitting Cython code into
separate parts that may be more appropriate in many cases. See
<a class="reference internal" href="sharing_declarations.html#sharing-declarations"><em>Sharing Declarations Between Cython Modules</em></a>.</p>
</div>
</div>
<div class="section" id="conditional-compilation">
<h2>Conditional Compilation<a class="headerlink" href="#conditional-compilation" title="Permalink to this headline">¶</a></h2>
<p>Some features are available for conditional compilation and compile-time
constants within a Cython source file.</p>
<div class="section" id="compile-time-definitions">
<h3>Compile-Time Definitions<a class="headerlink" href="#compile-time-definitions" title="Permalink to this headline">¶</a></h3>
<p>A compile-time constant can be defined using the DEF statement:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="cp">DEF</span> <span class="n">FavouriteFood</span> <span class="o">=</span> <span class="s">&quot;spam&quot;</span>
<span class="cp">DEF</span> <span class="n">ArraySize</span> <span class="o">=</span> <span class="mf">42</span>
<span class="cp">DEF</span> <span class="n">OtherArraySize</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">ArraySize</span> <span class="o">+</span> <span class="mf">17</span>
</pre></div>
</div>
<p>The right-hand side of the <tt class="docutils literal"><span class="pre">DEF</span></tt> must be a valid compile-time expression.
Such expressions are made up of literal values and names defined using <tt class="docutils literal"><span class="pre">DEF</span></tt>
statements, combined using any of the Python expression syntax.</p>
<p>The following compile-time names are predefined, corresponding to the values
returned by <a class="reference external" href="http://docs.python.org/3.3/library/os.html#os.uname" title="(in Python v3.3)"><tt class="xref py py-func docutils literal"><span class="pre">os.uname()</span></tt></a>.</p>
<blockquote>
<div>UNAME_SYSNAME, UNAME_NODENAME, UNAME_RELEASE,
UNAME_VERSION, UNAME_MACHINE</div></blockquote>
<p>The following selection of builtin constants and functions are also available:</p>
<blockquote>
<div>None, True, False,
abs, bool, chr, cmp, complex, dict, divmod, enumerate,
float, hash, hex, int, len, list, long, map, max, min,
oct, ord, pow, range, reduce, repr, round, slice, str,
sum, tuple, xrange, zip</div></blockquote>
<p>A name defined using <tt class="docutils literal"><span class="pre">DEF</span></tt> can be used anywhere an identifier can appear,
and it is replaced with its compile-time value as though it were written into
the source at that point as a literal. For this to work, the compile-time
expression must evaluate to a Python value of type <tt class="docutils literal"><span class="pre">int</span></tt>, <tt class="docutils literal"><span class="pre">long</span></tt>,
<tt class="docutils literal"><span class="pre">float</span></tt> or <tt class="docutils literal"><span class="pre">str</span></tt>.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="kt">a1</span>[<span class="kt">ArraySize</span>]
<span class="k">cdef</span> <span class="kt">int</span> <span class="kt">a2</span>[<span class="kt">OtherArraySize</span>]
<span class="k">print</span> <span class="s">&quot;I like&quot;</span><span class="p">,</span> <span class="n">FavouriteFood</span>
</pre></div>
</div>
</div>
<div class="section" id="conditional-statements">
<h3>Conditional Statements<a class="headerlink" href="#conditional-statements" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">IF</span></tt> statement can be used to conditionally include or exclude sections
of code at compile time. It works in a similar way to the <tt class="docutils literal"><span class="pre">#if</span></tt> preprocessor
directive in C.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="cp">IF</span> <span class="n">UNAME_SYSNAME</span> <span class="o">==</span> <span class="s">&quot;Windows&quot;</span><span class="p">:</span>
    <span class="k">include</span> <span class="s">&quot;icky_definitions.pxi&quot;</span>
<span class="cp">ELIF</span> <span class="n">UNAME_SYSNAME</span> <span class="o">==</span> <span class="s">&quot;Darwin&quot;</span><span class="p">:</span>
    <span class="k">include</span> <span class="s">&quot;nice_definitions.pxi&quot;</span>
<span class="cp">ELIF</span> <span class="n">UNAME_SYSNAME</span> <span class="o">==</span> <span class="s">&quot;Linux&quot;</span><span class="p">:</span>
    <span class="k">include</span> <span class="s">&quot;penguin_definitions.pxi&quot;</span>
<span class="cp">ELSE</span><span class="p">:</span>
    <span class="k">include</span> <span class="s">&quot;other_definitions.pxi&quot;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">ELIF</span></tt> and <tt class="docutils literal"><span class="pre">ELSE</span></tt> clauses are optional. An <tt class="docutils literal"><span class="pre">IF</span></tt> statement can appear
anywhere that a normal statement or declaration can appear, and it can contain
any statements or declarations that would be valid in that context, including
<tt class="docutils literal"><span class="pre">DEF</span></tt> statements and other <tt class="docutils literal"><span class="pre">IF</span></tt> statements.</p>
<p>The expressions in the <tt class="docutils literal"><span class="pre">IF</span></tt> and <tt class="docutils literal"><span class="pre">ELIF</span></tt> clauses must be valid compile-time
expressions as for the <tt class="docutils literal"><span class="pre">DEF</span></tt> statement, although they can evaluate to any
Python value, and the truth of the result is determined in the usual Python
way.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index-2.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Language Basics</a><ul>
<li><a class="reference internal" href="#c-variable-and-type-definitions">C variable and type definitions</a><ul>
<li><a class="reference internal" href="#grouping-multiple-c-declarations">Grouping multiple C declarations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-functions-vs-c-functions">Python functions vs. C functions</a><ul>
<li><a class="reference internal" href="#python-objects-as-parameters-and-return-values">Python objects as parameters and return values</a></li>
<li><a class="reference internal" href="#error-return-values">Error return values</a></li>
<li><a class="reference internal" href="#checking-return-values-of-non-cython-functions">Checking return values of non-Cython functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#automatic-type-conversions">Automatic type conversions</a><ul>
<li><a class="reference internal" href="#caveats-when-using-a-python-string-in-a-c-context">Caveats when using a Python string in a C context</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statements-and-expressions">Statements and expressions</a><ul>
<li><a class="reference internal" href="#differences-between-c-and-cython-expressions">Differences between C and Cython expressions</a></li>
<li><a class="reference internal" href="#scope-rules">Scope rules</a></li>
<li><a class="reference internal" href="#built-in-functions">Built-in Functions</a></li>
<li><a class="reference internal" href="#operator-precedence">Operator Precedence</a></li>
<li><a class="reference internal" href="#integer-for-loops">Integer for-loops</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-include-statement">The include statement</a></li>
<li><a class="reference internal" href="#conditional-compilation">Conditional Compilation</a><ul>
<li><a class="reference internal" href="#compile-time-definitions">Compile-Time Definitions</a></li>
<li><a class="reference internal" href="#conditional-statements">Conditional Statements</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Users Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="extension_types.html"
                        title="next chapter">Extension Types</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/src/userguide/language_basics.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://docs.cython.org/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="extension_types.html" title="Extension Types"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="Users Guide"
             >previous</a> |</li>
        <li><a href="../../index-2.html">Cython 0.20 documentation</a> &raquo;</li>
          <li><a href="index.html" >Users Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, Stefan Behnel, Robert Bradshaw, Dag Sverre Seljebotn, Greg Ewing, William Stein, Gabriel Gellner, et al..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6139100-3");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>

<!-- Mirrored from docs.cython.org/src/userguide/language_basics.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 23:32:57 GMT -->
</html>