

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from docs.cython.org/src/userguide/pyrex_differences.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 23:32:58 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Differences between Cython and Pyrex &mdash; Cython 0.20 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Cython 0.20 documentation" href="../../index-2.html" />
    <link rel="up" title="Users Guide" href="index.html" />
    <link rel="next" title="Typed Memoryviews" href="memoryviews.html" />
    <link rel="prev" title="Limitations" href="limitations.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="memoryviews.html" title="Typed Memoryviews"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="limitations.html" title="Limitations"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index-2.html">Cython 0.20 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Users Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="differences-between-cython-and-pyrex">
<span id="pyrex-differences"></span><h1>Differences between Cython and Pyrex<a class="headerlink" href="#differences-between-cython-and-pyrex" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Both Cython and Pyrex are moving targets. It has come to the point
that an explicit list of all the differences between the two
projects would be laborious to list and track, but hopefully
this high-level list gives an idea of the differences that
are present. It should be noted that both projects make an effort
at mutual compatibility, but Cython&#8217;s goal is to be as close to
and complete as Python as reasonable.</p>
</div>
<div class="section" id="python-3-support">
<h2>Python 3 Support<a class="headerlink" href="#python-3-support" title="Permalink to this headline">¶</a></h2>
<p>Cython creates <tt class="docutils literal"><span class="pre">.c</span></tt> files that can be built and used with both
Python 2.x and Python 3.x. In fact, compiling your module with
Cython may very well be the easiest way to port code to Python 3.
We are also working to make the compiler run in both Python 2.x and 3.x.</p>
<p>Many Python 3 constructs are already supported by Cython.</p>
<div class="section" id="list-set-dict-comprehensions">
<h3>List/Set/Dict Comprehensions<a class="headerlink" href="#list-set-dict-comprehensions" title="Permalink to this headline">¶</a></h3>
<p>Cython supports the different comprehensions defined by Python 3 for
lists, sets and dicts:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="p">[</span><span class="n">expr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span>             <span class="c"># list</span>
<span class="p">{</span><span class="n">expr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">A</span><span class="p">}</span>             <span class="c"># set</span>
<span class="p">{</span><span class="n">key</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">:</span> <span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">A</span><span class="p">}</span>   <span class="c"># dict</span>
</pre></div>
</div>
<p>Looping is optimized if <tt class="docutils literal"><span class="pre">A</span></tt> is a list, tuple or dict.  You can use
the <a class="reference external" href="http://docs.python.org/3.3/reference/compound_stmts.html#for" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">for</span></tt></a> ... <a class="reference external" href="http://docs.python.org/3.3/reference/simple_stmts.html#from" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">from</span></tt></a> syntax, too, but it is
generally preferred to use the usual <a class="reference external" href="http://docs.python.org/3.3/reference/compound_stmts.html#for" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">for</span></tt></a> ... <a class="reference external" href="http://docs.python.org/3.3/reference/expressions.html#in" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">in</span></tt></a>
<tt class="docutils literal"><span class="pre">range(...)</span></tt> syntax with a C run variable (e.g. <tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">int</span> <span class="pre">i</span></tt>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">see <a class="reference internal" href="#automatic-range-conversion"><em>Automatic range conversion</em></a></p>
</div>
<p>Note that Cython also supports set literals starting from Python 2.4.</p>
</div>
<div class="section" id="keyword-only-arguments">
<h3>Keyword-only arguments<a class="headerlink" href="#keyword-only-arguments" title="Permalink to this headline">¶</a></h3>
<p>Python functions can have keyword-only arguments listed after the <tt class="docutils literal"><span class="pre">*</span></tt>
parameter and before the <tt class="docutils literal"><span class="pre">**</span></tt> parameter if any, e.g.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">42</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Here <tt class="docutils literal"><span class="pre">c</span></tt>, <tt class="docutils literal"><span class="pre">d</span></tt> and <tt class="docutils literal"><span class="pre">e</span></tt> cannot be passed as position arguments and must be
passed as keyword arguments. Furthermore, <tt class="docutils literal"><span class="pre">c</span></tt> and <tt class="docutils literal"><span class="pre">e</span></tt> are required keyword
arguments, since they do not have a default value.</p>
<p>If the parameter name after the <tt class="docutils literal"><span class="pre">*</span></tt> is omitted, the function will not accept any
extra positional arguments, e.g.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>takes exactly two positional parameters and has two required keyword parameters.</p>
</div>
</div>
<div class="section" id="conditional-expressions-x-if-b-else-y">
<h2>Conditional expressions &#8220;x if b else y&#8221;<a class="headerlink" href="#conditional-expressions-x-if-b-else-y" title="Permalink to this headline">¶</a></h2>
<p>Conditional expressions as described in
<a class="reference external" href="http://www.python.org/dev/peps/pep-0308/">http://www.python.org/dev/peps/pep-0308/</a>:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="n">X</span> <span class="k">if</span> <span class="n">C</span> <span class="k">else</span> <span class="n">Y</span>
</pre></div>
</div>
<p>Only one of <tt class="docutils literal"><span class="pre">X</span></tt> and <tt class="docutils literal"><span class="pre">Y</span></tt> is evaluated (depending on the value of C).</p>
</div>
<div class="section" id="cdef-inline">
<span id="inline"></span><h2>cdef inline<a class="headerlink" href="#cdef-inline" title="Permalink to this headline">¶</a></h2>
<p>Module level functions can now be declared inline, with the <a class="reference internal" href="#inline"><tt class="xref std std-keyword docutils literal"><span class="pre">inline</span></tt></a>
keyword passed on to the C compiler. These can be as fast as macros.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">something_fast</span><span class="p">(</span><span class="nb">int</span> <span class="n">a</span><span class="p">,</span> <span class="nb">int</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>Note that class-level <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> functions are handled via a virtual
function table, so the compiler won&#8217;t be able to inline them in almost all
cases.</p>
</div>
<div class="section" id="assignment-on-declaration-e-g-cdef-int-spam-5">
<h2>Assignment on declaration (e.g. &#8220;cdef int spam = 5&#8221;)<a class="headerlink" href="#assignment-on-declaration-e-g-cdef-int-spam-5" title="Permalink to this headline">¶</a></h2>
<p>In Pyrex, one must write:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span>
<span class="n">i</span> <span class="o">=</span> <span class="mf">2</span>
<span class="n">j</span> <span class="o">=</span> <span class="mf">5</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">7</span>
</pre></div>
</div>
<p>Now, with cython, one can write:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span> <span class="o">=</span> <span class="mf">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mf">5</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">7</span>
</pre></div>
</div>
<p>The expression on the right hand side can be arbitrarily complicated, e.g.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">n</span> <span class="o">=</span> <span class="n">python_call</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mf">32</span>
</pre></div>
</div>
</div>
<div class="section" id="by-expression-in-for-loop-e-g-for-i-from-0-i-10-by-2">
<h2>&#8216;by&#8217; expression in for loop (e.g. &#8220;for i from 0 &lt;= i &lt; 10 by 2&#8221;)<a class="headerlink" href="#by-expression-in-for-loop-e-g-for-i-from-0-i-10-by-2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="k">from</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">10</span> <span class="k">by</span> <span class="mf">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">i</span>
</pre></div>
</div>
<p>yields:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="mf">0</span>
<span class="mf">2</span>
<span class="mf">4</span>
<span class="mf">6</span>
<span class="mf">8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Usage of this syntax is discouraged as it is redundant with the
normal Python <a class="reference external" href="http://docs.python.org/3.3/reference/compound_stmts.html#for" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">for</span></tt></a> loop.
See <a class="reference internal" href="#automatic-range-conversion"><em>Automatic range conversion</em></a>.</p>
</div>
</div>
<div class="section" id="boolean-int-type-e-g-it-acts-like-a-c-int-but-coerces-to-from-python-as-a-boolean">
<h2>Boolean int type (e.g. it acts like a c int, but coerces to/from python as a boolean)<a class="headerlink" href="#boolean-int-type-e-g-it-acts-like-a-c-int-but-coerces-to-from-python-as-a-boolean" title="Permalink to this headline">¶</a></h2>
<p>In C, ints are used for truth values. In python, any object can be used as a
truth value (using the <tt class="xref py py-meth docutils literal"><span class="pre">__nonzero__()</span></tt> method), but the canonical choices
are the two boolean objects <tt class="docutils literal"><span class="pre">True</span></tt> and <tt class="docutils literal"><span class="pre">False</span></tt>. The <tt class="xref c c-type docutils literal"><span class="pre">bint</span></tt> (for
&#8220;boolean int&#8221;) type is compiled to a C int, but coerces to and from
Python as booleans. The return type of comparisons and several builtins is a
<tt class="xref c c-type docutils literal"><span class="pre">bint</span></tt> as well. This reduces the need for wrapping things in
<a class="reference external" href="http://docs.python.org/3.3/library/functions.html#bool" title="(in Python v3.3)"><tt class="xref py py-func docutils literal"><span class="pre">bool()</span></tt></a>. For example, one can write:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_equal</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>
</pre></div>
</div>
<p>which would return <tt class="docutils literal"><span class="pre">1</span></tt> or <tt class="docutils literal"><span class="pre">0</span></tt> in Pyrex, but returns <tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt> in
Cython. One can declare variables and return values for functions to be of the
<tt class="xref c c-type docutils literal"><span class="pre">bint</span></tt> type.  For example:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span> <span class="o">=</span> <span class="n">x</span>
<span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">b</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<p>The first conversion would happen via <tt class="docutils literal"><span class="pre">x.__int__()</span></tt> whereas the second would
happen via <tt class="docutils literal"><span class="pre">x.__bool__()</span></tt> (a.k.a. <tt class="docutils literal"><span class="pre">__nonzero__()</span></tt>), with appropriate
optimisations for known builtin types.</p>
</div>
<div class="section" id="executable-class-bodies">
<h2>Executable class bodies<a class="headerlink" href="#executable-class-bodies" title="Permalink to this headline">¶</a></h2>
<p>Including a working <a class="reference external" href="http://docs.python.org/3.3/library/functions.html#classmethod" title="(in Python v3.3)"><tt class="xref py py-func docutils literal"><span class="pre">classmethod()</span></tt></a>:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">Blah</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="bp">self</span>
    <span class="n">some_method</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">some_method</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">2</span><span class="o">*</span><span class="mf">3</span>
    <span class="k">print</span> <span class="s">&quot;hi&quot;</span><span class="p">,</span> <span class="n">a</span>
</pre></div>
</div>
</div>
<div class="section" id="cpdef-functions">
<h2>cpdef functions<a class="headerlink" href="#cpdef-functions" title="Permalink to this headline">¶</a></h2>
<p>Cython adds a third function type on top of the usual <a class="reference external" href="http://docs.python.org/3.3/reference/compound_stmts.html#def" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">def</span></tt></a> and
<a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a>. If a function is declared <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a> it can be called
from and overridden by both extension and normal python subclasses. You can
essentially think of a <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a> method as a <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> method +
some extras. (That&#8217;s how it&#8217;s implemented at least.) First, it creates a
<a class="reference external" href="http://docs.python.org/3.3/reference/compound_stmts.html#def" title="(in Python v3.3)"><tt class="xref std std-keyword docutils literal"><span class="pre">def</span></tt></a> method that does nothing but call the underlying
<a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> method (and does argument unpacking/coercion if needed). At
the top of the <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> method a little bit of code is added to see
if it&#8217;s overridden, similar to the following pseudocode:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s">&#39;__dict__&#39;</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">foo</span>
    <span class="k">if</span> <span class="n">foo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">wrapper_foo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">foo</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="p">[</span><span class="k">cdef</span> <span class="kt">method</span> <span class="kt">body</span>]
</pre></div>
</div>
<p>To detect whether or not a type has a dictionary, it just checks the
<tt class="docutils literal"><span class="pre">tp_dictoffset</span></tt> slot, which is <tt class="docutils literal"><span class="pre">NULL</span></tt> (by default) for extension types,
but non- null for instance classes. If the dictionary exists, it does a single
attribute lookup and can tell (by comparing pointers) whether or not the
returned result is actually a new function. If, and only if, it is a new
function, then the arguments packed into a tuple and the method called. This
is all very fast. A flag is set so this lookup does not occur if one calls the
method on the class directly, e.g.:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">A</span><span class="p">:</span>
    <span class="k">cpdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>  <span class="c"># will check to see if overridden</span>
<span class="n">A</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c"># will call A&#39;s implementation whether overridden or not</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="early_binding_for_speed.html#early-binding-for-speed"><em>Early Binding for Speed</em></a> for explanation and usage tips.</p>
</div>
<div class="section" id="automatic-range-conversion">
<span id="id1"></span><h2>Automatic range conversion<a class="headerlink" href="#automatic-range-conversion" title="Permalink to this headline">¶</a></h2>
<p>This will convert statements of the form <tt class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(...)</span></tt> to <tt class="docutils literal"><span class="pre">for</span> <span class="pre">i</span>
<span class="pre">from</span> <span class="pre">...</span></tt> when <tt class="docutils literal"><span class="pre">i</span></tt> is any cdef&#8217;d integer type, and the direction (i.e. sign
of step) can be determined.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This may change the semantics if the range causes
assignment to <tt class="docutils literal"><span class="pre">i</span></tt> to overflow. Specifically, if this option is set, an error
will be raised before the loop is entered, whereas without this option the loop
will execute until a overflowing value is encountered. If this effects you
change <tt class="docutils literal"><span class="pre">Cython/Compiler/Options.py</span></tt> (eventually there will be a better
way to set this).</p>
</div>
</div>
<div class="section" id="more-friendly-type-casting">
<h2>More friendly type casting<a class="headerlink" href="#more-friendly-type-casting" title="Permalink to this headline">¶</a></h2>
<p>In Pyrex, if one types <tt class="docutils literal"><span class="pre">&lt;int&gt;x</span></tt> where <tt class="docutils literal"><span class="pre">x</span></tt> is a Python object, one will get
the memory address of <tt class="docutils literal"><span class="pre">x</span></tt>. Likewise, if one types <tt class="docutils literal"><span class="pre">&lt;object&gt;i</span></tt> where <tt class="docutils literal"><span class="pre">i</span></tt>
is a C int, one will get an &#8220;object&#8221; at location <tt class="docutils literal"><span class="pre">i</span></tt> in memory. This leads
to confusing results and segfaults.</p>
<p>In Cython <tt class="docutils literal"><span class="pre">&lt;type&gt;x</span></tt> will try and do a coercion (as would happen on assignment of
<tt class="docutils literal"><span class="pre">x</span></tt> to a variable of type type) if exactly one of the types is a python object.
It does not stop one from casting where there is no conversion (though it will
emit a warning). If one really wants the address, cast to a <tt class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></tt> first.</p>
<p>As in Pyrex <tt class="docutils literal"><span class="pre">&lt;MyExtensionType&gt;x</span></tt> will cast <tt class="docutils literal"><span class="pre">x</span></tt> to type <tt class="xref c c-type docutils literal"><span class="pre">MyExtensionType</span></tt>
without any type checking. Cython supports the syntax <tt class="docutils literal"><span class="pre">&lt;MyExtensionType?&gt;</span></tt> to do
the cast with type checking (i.e. it will throw an error if <tt class="docutils literal"><span class="pre">x</span></tt> is not a
(subclass of) <tt class="xref c c-type docutils literal"><span class="pre">MyExtensionType</span></tt>.</p>
</div>
<div class="section" id="optional-arguments-in-cdef-cpdef-functions">
<h2>Optional arguments in cdef/cpdef functions<a class="headerlink" href="#optional-arguments-in-cdef-cpdef-functions" title="Permalink to this headline">¶</a></h2>
<p>Cython now supports optional arguments for <a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> and
<a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a> functions.</p>
<p>The syntax in the <tt class="docutils literal"><span class="pre">.pyx</span></tt> file remains as in Python, but one declares such
functions in the <tt class="docutils literal"><span class="pre">.pxd</span></tt> file by writing <tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">foo(x=*)</span></tt>. The number of
arguments may increase on subclassing, but the argument types and order must
remain the same. There is a slight performance penalty in some cases when a
cdef/cpdef function without any optional is overridden with one that does have
default argument values.</p>
<p>For example, one can have the <tt class="docutils literal"><span class="pre">.pxd</span></tt> file:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">A</span><span class="p">:</span>
    <span class="k">cdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="k">cdef</span> <span class="k">class</span> <span class="nf">B</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">cdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=*</span><span class="p">)</span>
<span class="k">cdef</span> <span class="k">class</span> <span class="nf">C</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
    <span class="k">cpdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=*</span><span class="p">,</span> <span class="nb">int</span> <span class="n">k</span><span class="o">=*</span><span class="p">)</span>
</pre></div>
</div>
<p>with corresponding <tt class="docutils literal"><span class="pre">.pyx</span></tt> file:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="k">class</span> <span class="nf">A</span><span class="p">:</span>
    <span class="k">cdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;A&quot;</span>
<span class="k">cdef</span> <span class="k">class</span> <span class="nf">B</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">cdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">x</span>
<span class="k">cdef</span> <span class="k">class</span> <span class="nf">C</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
    <span class="k">cpdef</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">int</span> <span class="n">k</span><span class="o">=</span><span class="mf">3</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;C&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this also demonstrates how <a class="reference internal" href="../reference/language_basics.html#cpdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cpdef</span></tt></a> functions can override
<a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> functions.</p>
</div>
</div>
<div class="section" id="function-pointers-in-structs">
<h2>Function pointers in structs<a class="headerlink" href="#function-pointers-in-structs" title="Permalink to this headline">¶</a></h2>
<p>Functions declared in <a class="reference internal" href="language_basics.html#struct"><tt class="xref std std-keyword docutils literal"><span class="pre">struct</span></tt></a> are automatically converted to
function pointers for convenience.</p>
</div>
<div class="section" id="c-exception-handling">
<h2>C++ Exception handling<a class="headerlink" href="#c-exception-handling" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/language_basics.html#cdef"><tt class="xref std std-keyword docutils literal"><span class="pre">cdef</span></tt></a> functions can now be declared as:</p>
<div class="highlight-cython"><div class="highlight"><pre><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">except</span> <span class="o">+</span>
<span class="k">cdef</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">except</span> <span class="o">+</span><span class="ne">TypeError</span>
<span class="k">cdef</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">except</span> <span class="o">+</span><span class="n">python_error_raising_function</span>
</pre></div>
</div>
<p>in which case a Python exception will be raised when a C++ error is caught.
See <a class="reference internal" href="wrapping_CPlusPlus.html#wrapping-cplusplus"><em>Using C++ in Cython</em></a> for more details.</p>
</div>
<div class="section" id="synonyms">
<h2>Synonyms<a class="headerlink" href="#synonyms" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">import</span> <span class="pre">from</span></tt> means the same thing as <tt class="docutils literal"><span class="pre">cdef</span> <span class="pre">extern</span> <span class="pre">from</span></tt></p>
</div>
<div class="section" id="source-code-encoding">
<h2>Source code encoding<a class="headerlink" href="#source-code-encoding" title="Permalink to this headline">¶</a></h2>
<p>Cython supports PEP 3120 and PEP 263, i.e. you can start your Cython source
file with an encoding comment and generally write your source code in UTF-8.
This impacts the encoding of byte strings and the conversion of unicode string
literals like <tt class="docutils literal"><span class="pre">u'abcd'</span></tt> to unicode objects.</p>
</div>
<div class="section" id="automatic-typecheck">
<h2>Automatic <tt class="docutils literal"><span class="pre">typecheck</span></tt><a class="headerlink" href="#automatic-typecheck" title="Permalink to this headline">¶</a></h2>
<p>Rather than introducing a new keyword <tt class="docutils literal"><span class="pre">typecheck</span></tt> as explained in the
<a class="reference external" href="http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/version/Doc/Manual/special_methods.html">Pyrex docs</a>,
Cython emits a (non-spoofable and faster) typecheck whenever
<a class="reference external" href="http://docs.python.org/3.3/library/functions.html#isinstance" title="(in Python v3.3)"><tt class="xref py py-func docutils literal"><span class="pre">isinstance()</span></tt></a> is used with an extension type as the second parameter.</p>
</div>
<div class="section" id="from-future-directives">
<h2>From __future__ directives<a class="headerlink" href="#from-future-directives" title="Permalink to this headline">¶</a></h2>
<p>Cython supports several <tt class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">...</span></tt> directives, namely
<tt class="docutils literal"><span class="pre">absolute_import</span></tt>, <tt class="docutils literal"><span class="pre">unicode_literals</span></tt>, <tt class="docutils literal"><span class="pre">print_function</span></tt> and <tt class="docutils literal"><span class="pre">division</span></tt>.</p>
<p>With statements are always enabled.</p>
</div>
<div class="section" id="pure-python-mode">
<h2>Pure Python mode<a class="headerlink" href="#pure-python-mode" title="Permalink to this headline">¶</a></h2>
<p>Cython has support for compiling <tt class="docutils literal"><span class="pre">.py</span></tt> files, and
accepting type annotations using decorators and other
valid Python syntax. This allows the same source to
be interpreted as straight Python, or compiled for
optimized results. See <a class="reference internal" href="../tutorial/pure.html#pure-mode"><em>Pure Python Mode</em></a> for more details.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index-2.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Differences between Cython and Pyrex</a><ul>
<li><a class="reference internal" href="#python-3-support">Python 3 Support</a><ul>
<li><a class="reference internal" href="#list-set-dict-comprehensions">List/Set/Dict Comprehensions</a></li>
<li><a class="reference internal" href="#keyword-only-arguments">Keyword-only arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conditional-expressions-x-if-b-else-y">Conditional expressions &#8220;x if b else y&#8221;</a></li>
<li><a class="reference internal" href="#cdef-inline">cdef inline</a></li>
<li><a class="reference internal" href="#assignment-on-declaration-e-g-cdef-int-spam-5">Assignment on declaration (e.g. &#8220;cdef int spam = 5&#8221;)</a></li>
<li><a class="reference internal" href="#by-expression-in-for-loop-e-g-for-i-from-0-i-10-by-2">&#8216;by&#8217; expression in for loop (e.g. &#8220;for i from 0 &lt;= i &lt; 10 by 2&#8221;)</a></li>
<li><a class="reference internal" href="#boolean-int-type-e-g-it-acts-like-a-c-int-but-coerces-to-from-python-as-a-boolean">Boolean int type (e.g. it acts like a c int, but coerces to/from python as a boolean)</a></li>
<li><a class="reference internal" href="#executable-class-bodies">Executable class bodies</a></li>
<li><a class="reference internal" href="#cpdef-functions">cpdef functions</a></li>
<li><a class="reference internal" href="#automatic-range-conversion">Automatic range conversion</a></li>
<li><a class="reference internal" href="#more-friendly-type-casting">More friendly type casting</a></li>
<li><a class="reference internal" href="#optional-arguments-in-cdef-cpdef-functions">Optional arguments in cdef/cpdef functions</a></li>
<li><a class="reference internal" href="#function-pointers-in-structs">Function pointers in structs</a></li>
<li><a class="reference internal" href="#c-exception-handling">C++ Exception handling</a></li>
<li><a class="reference internal" href="#synonyms">Synonyms</a></li>
<li><a class="reference internal" href="#source-code-encoding">Source code encoding</a></li>
<li><a class="reference internal" href="#automatic-typecheck">Automatic <tt class="docutils literal"><span class="pre">typecheck</span></tt></a></li>
<li><a class="reference internal" href="#from-future-directives">From __future__ directives</a></li>
<li><a class="reference internal" href="#pure-python-mode">Pure Python mode</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="limitations.html"
                        title="previous chapter">Limitations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="memoryviews.html"
                        title="next chapter">Typed Memoryviews</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/src/userguide/pyrex_differences.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://docs.cython.org/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="memoryviews.html" title="Typed Memoryviews"
             >next</a></li>
        <li class="right" >
          <a href="limitations.html" title="Limitations"
             >previous</a> |</li>
        <li><a href="../../index-2.html">Cython 0.20 documentation</a> &raquo;</li>
          <li><a href="index.html" >Users Guide</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, Stefan Behnel, Robert Bradshaw, Dag Sverre Seljebotn, Greg Ewing, William Stein, Gabriel Gellner, et al..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6139100-3");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>

<!-- Mirrored from docs.cython.org/src/userguide/pyrex_differences.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 23:32:58 GMT -->
</html>