
<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Reformer ‚Äî transformers 4.2.0 documentation</title>
<link href="../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/huggingface.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/code-snippets.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/hidesidebar.css" rel="stylesheet" type="text/css"/>
<link href="../_static/favicon.ico" rel="shortcut icon"/>
<!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/clipboard.min.js"></script>
<script src="../_static/copybutton.js"></script>
<script src="../_static/js/custom.js"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="../_static/js/theme.js" type="text/javascript"></script>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="retribert.html" rel="next" title="RetriBERT"/>
<link href="rag.html" rel="prev" title="RAG"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../index.html"> transformers
          

          
          </a>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quicktour.html">Quick tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Using ü§ó Transformers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../task_summary.html">Summary of the tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_summary.html">Summary of the models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocessing.html">Preprocessing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training.html">Training and fine-tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_sharing.html">Model sharing and uploading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tokenizer_summary.html">Summary of the tokenizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multilingual.html">Multi-lingual models</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pretrained_models.html">Pretrained models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../custom_datasets.html">Fine-tuning with custom datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks.html">ü§ó Transformers Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../converting_tensorflow_models.html">Converting Tensorflow Checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">Migrating from previous packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">How to contribute to transformers?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../serialization.html">Exporting transformers models</a></li>
</ul>
<p class="caption"><span class="caption-text">Research</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bertology.html">BERTology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../perplexity.html">Perplexity of fixed-length models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption"><span class="caption-text">Main Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/callback.html">Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/model.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/optimizer_schedules.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/output.html">Model outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/pipelines.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/processors.html">Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/tokenizer.html">Tokenizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_classes/trainer.html">Trainer</a></li>
</ul>
<p class="caption"><span class="caption-text">Models</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="albert.html">ALBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto.html">Auto Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="bart.html">BART</a></li>
<li class="toctree-l1"><a class="reference internal" href="barthez.html">BARThez</a></li>
<li class="toctree-l1"><a class="reference internal" href="bert.html">BERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="bertweet.html">Bertweet</a></li>
<li class="toctree-l1"><a class="reference internal" href="bertgeneration.html">BertGeneration</a></li>
<li class="toctree-l1"><a class="reference internal" href="blenderbot.html">Blenderbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="blenderbot_small.html">Blenderbot Small</a></li>
<li class="toctree-l1"><a class="reference internal" href="camembert.html">CamemBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="ctrl.html">CTRL</a></li>
<li class="toctree-l1"><a class="reference internal" href="deberta.html">DeBERTa</a></li>
<li class="toctree-l1"><a class="reference internal" href="dialogpt.html">DialoGPT</a></li>
<li class="toctree-l1"><a class="reference internal" href="distilbert.html">DistilBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="dpr.html">DPR</a></li>
<li class="toctree-l1"><a class="reference internal" href="electra.html">ELECTRA</a></li>
<li class="toctree-l1"><a class="reference internal" href="encoderdecoder.html">Encoder Decoder Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="flaubert.html">FlauBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="fsmt.html">FSMT</a></li>
<li class="toctree-l1"><a class="reference internal" href="funnel.html">Funnel Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="herbert.html">herBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="layoutlm.html">LayoutLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="led.html">LED</a></li>
<li class="toctree-l1"><a class="reference internal" href="longformer.html">Longformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="lxmert.html">LXMERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="marian.html">MarianMT</a></li>
<li class="toctree-l1"><a class="reference internal" href="mbart.html">MBart</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobilebert.html">MobileBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpnet.html">MPNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="mt5.html">MT5</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpt.html">OpenAI GPT</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpt2.html">OpenAI GPT2</a></li>
<li class="toctree-l1"><a class="reference internal" href="pegasus.html">Pegasus</a></li>
<li class="toctree-l1"><a class="reference internal" href="phobert.html">PhoBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="prophetnet.html">ProphetNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag.html">RAG</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reformer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#axial-positional-encodings">Axial Positional Encodings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lsh-self-attention">LSH Self Attention</a></li>
<li class="toctree-l2"><a class="reference internal" href="#local-self-attention">Local Self Attention</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training">Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformerconfig">ReformerConfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformertokenizer">ReformerTokenizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformertokenizerfast">ReformerTokenizerFast</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformermodel">ReformerModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformermodelwithlmhead">ReformerModelWithLMHead</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformerformaskedlm">ReformerForMaskedLM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformerforsequenceclassification">ReformerForSequenceClassification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reformerforquestionanswering">ReformerForQuestionAnswering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="retribert.html">RetriBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="roberta.html">RoBERTa</a></li>
<li class="toctree-l1"><a class="reference internal" href="squeezebert.html">SqueezeBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="t5.html">T5</a></li>
<li class="toctree-l1"><a class="reference internal" href="tapas.html">TAPAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="transformerxl.html">Transformer XL</a></li>
<li class="toctree-l1"><a class="reference internal" href="xlm.html">XLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="xlmprophetnet.html">XLM-ProphetNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="xlmroberta.html">XLM-RoBERTa</a></li>
<li class="toctree-l1"><a class="reference internal" href="xlnet.html">XLNet</a></li>
</ul>
<p class="caption"><span class="caption-text">Internal Helpers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../internal/modeling_utils.html">Custom Layers and Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internal/pipelines_utils.html">Utilities for pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internal/tokenization_utils.html">Utilities for Tokenizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internal/trainer_utils.html">Utilities for Trainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internal/generation_utils.html">Utilities for Generation</a></li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../index.html">transformers</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a class="icon icon-home" href="../index.html"></a> ¬ª</li>
<li>Reformer</li>
<li class="wy-breadcrumbs-aside">
<a href="../_sources/model_doc/reformer.rst.txt" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<div class="section" id="reformer">
<h1>Reformer<a class="headerlink" href="#reformer" title="Permalink to this headline">¬∂</a></h1>
<p><strong>DISCLAIMER:</strong> This model is still a work in progress, if you see something strange, file a <a class="reference external" href="https://github.com/huggingface/transformers/issues/new?assignees=&amp;labels=&amp;template=bug-report.md&amp;title">Github Issue</a>.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¬∂</a></h2>
<p>The Reformer model was proposed in the paper <a class="reference external" href="https://arxiv.org/abs/2001.04451.pdf">Reformer: The Efficient Transformer</a> by Nikita Kitaev, ≈Åukasz Kaiser, Anselm Levskaya.</p>
<p>The abstract from the paper is the following:</p>
<p><em>Large Transformer models routinely achieve state-of-the-art results on a number of tasks but training these models can
be prohibitively costly, especially on long sequences. We introduce two techniques to improve the efficiency of
Transformers. For one, we replace dot-product attention by one that uses locality-sensitive hashing, changing its
complexity from O(L^2) to O(Llog(L)), where L is the length of the sequence. Furthermore, we use reversible residual
layers instead of the standard residuals, which allows storing activations only once in the training process instead of
N times, where N is the number of layers. The resulting model, the Reformer, performs on par with Transformer models
while being much more memory-efficient and much faster on long sequences.</em></p>
<p>The Authors‚Äô code can be found <a class="reference external" href="https://github.com/google/trax/tree/master/trax/models/reformer">here</a>.</p>
</div>
<div class="section" id="axial-positional-encodings">
<h2>Axial Positional Encodings<a class="headerlink" href="#axial-positional-encodings" title="Permalink to this headline">¬∂</a></h2>
<p>Axial Positional Encodings were first implemented in Google‚Äôs <a class="reference external" href="https://github.com/google/trax/blob/4d99ad4965bab1deba227539758d59f0df0fef48/trax/layers/research/position_encodings.py#L29">trax library</a>
and developed by the authors of this model‚Äôs paper. In models that are treating very long input sequences, the
conventional position id encodings store an embedings vector of size <span class="math notranslate nohighlight">\(d\)</span> being the <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.hidden_size</span></code> for
every position <span class="math notranslate nohighlight">\(i, \ldots, n_s\)</span>, with <span class="math notranslate nohighlight">\(n_s\)</span> being <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.max_embedding_size</span></code>. This means that having
a sequence length of <span class="math notranslate nohighlight">\(n_s = 2^{19} \approx 0.5M\)</span> and a <code class="docutils literal notranslate"><span class="pre">config.hidden_size</span></code> of <span class="math notranslate nohighlight">\(d = 2^{10} \approx 1000\)</span>
would result in a position encoding matrix:</p>
<div class="math notranslate nohighlight">
\[X_{i,j}, \text{ with } i \in \left[1,\ldots, d\right] \text{ and } j \in \left[1,\ldots, n_s\right]\]</div>
<p>which alone has over 500M parameters to store. Axial positional encodings factorize <span class="math notranslate nohighlight">\(X_{i,j}\)</span> into two matrices:</p>
<div class="math notranslate nohighlight">
\[X^{1}_{i,j}, \text{ with } i \in \left[1,\ldots, d^1\right] \text{ and } j \in \left[1,\ldots, n_s^1\right]\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[X^{2}_{i,j}, \text{ with } i \in \left[1,\ldots, d^2\right] \text{ and } j \in \left[1,\ldots, n_s^2\right]\]</div>
<p>with:</p>
<div class="math notranslate nohighlight">
\[d = d^1 + d^2 \text{ and } n_s = n_s^1 \times n_s^2 .\]</div>
<p>Therefore the following holds:</p>
<div class="math notranslate nohighlight">
\[\begin{split}X_{i,j} = \begin{cases}
            X^{1}_{i, k}, &amp; \text{if }\ i &lt; d^1 \text{ with } k = j \mod n_s^1 \\
            X^{2}_{i - d^1, l}, &amp; \text{if } i \ge d^1 \text{ with } l = \lfloor\frac{j}{n_s^1}\rfloor
          \end{cases}\end{split}\]</div>
<p>Intuitively, this means that a position embedding vector <span class="math notranslate nohighlight">\(x_j \in \mathbb{R}^{d}\)</span> is now the composition of two
factorized embedding vectors: <span class="math notranslate nohighlight">\(x^1_{k, l} + x^2_{l, k}\)</span>, where as the <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.max_embedding_size</span></code> dimension
<span class="math notranslate nohighlight">\(j\)</span> is factorized into <span class="math notranslate nohighlight">\(k \text{ and } l\)</span>. This design ensures that each position embedding vector
<span class="math notranslate nohighlight">\(x_j\)</span> is unique.</p>
<p>Using the above example again, axial position encoding with <span class="math notranslate nohighlight">\(d^1 = 2^5, d^2 = 2^5, n_s^1 = 2^9, n_s^2 = 2^{10}\)</span>
can drastically reduced the number of parameters to <span class="math notranslate nohighlight">\(2^{14} + 2^{15} \approx 49000\)</span> parameters.</p>
<p>In practice, the parameter <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.axial_pos_embds_dim</span></code> is set to a tuple <span class="math notranslate nohighlight">\((d^1, d^2)\)</span> which sum has to be
equal to <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.hidden_size</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.axial_pos_shape</span></code> is set to a tuple <span class="math notranslate nohighlight">\((n_s^1, n_s^2)\)</span> which
product has to be equal to <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.max_embedding_size</span></code>, which during training has to be equal to the <cite>sequence
length</cite> of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code>.</p>
</div>
<div class="section" id="lsh-self-attention">
<h2>LSH Self Attention<a class="headerlink" href="#lsh-self-attention" title="Permalink to this headline">¬∂</a></h2>
<p>In Locality sensitive hashing (LSH) self attention the key and query projection weights are tied. Therefore, the key
query embedding vectors are also tied. LSH self attention uses the locality sensitive hashing mechanism proposed in
<a class="reference external" href="https://arxiv.org/abs/1509.02897">Practical and Optimal LSH for Angular Distance</a> to assign each of the tied key
query embedding vectors to one of <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_buckets</span></code> possible buckets. The premise is that the more ‚Äúsimilar‚Äù
key query embedding vectors (in terms of <em>cosine similarity</em>) are to each other, the more likely they are assigned to
the same bucket.</p>
<p>The accuracy of the LSH mechanism can be improved by increasing <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_hashes</span></code> or directly the argument
<code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code> of the forward function so that the output of the LSH self attention better approximates the output
of the ‚Äúnormal‚Äù full self attention. The buckets are then sorted and chunked into query key embedding vector chunks
each of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.lsh_chunk_length</span></code>. For each chunk, the query embedding vectors attend to its key vectors
(which are tied to themselves) and to the key embedding vectors of <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.lsh_num_chunks_before</span></code> previous
neighboring chunks and <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.lsh_num_chunks_after</span></code> following neighboring chunks.</p>
<p>For more information, see the <a class="reference external" href="https://arxiv.org/abs/2001.04451">original Paper</a> or this great <a class="reference external" href="https://www.pragmatic.ml/reformer-deep-dive/">blog post</a>.</p>
<p>Note that <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_buckets</span></code> can also be factorized into a list <span class="math notranslate nohighlight">\((n_{\text{buckets}}^1,
n_{\text{buckets}}^2)\)</span>. This way instead of assigning the query key embedding vectors to one of <span class="math notranslate nohighlight">\((1,\ldots,
n_{\text{buckets}})\)</span> they are assigned to one of <span class="math notranslate nohighlight">\((1-1,\ldots, n_{\text{buckets}}^1-1, \ldots,
1-n_{\text{buckets}}^2, \ldots, n_{\text{buckets}}^1-n_{\text{buckets}}^2)\)</span>. This is crucial for very long sequences to
save memory.</p>
<p>When training a model from scratch, it is recommended to leave <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_buckets=None</span></code>, so that depending on the
sequence length a good value for <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_buckets</span></code> is calculated on the fly. This value will then automatically be
saved in the config and should be reused for inference.</p>
<p>Using LSH self attention, the memory and time complexity of the query-key matmul operation can be reduced from
<span class="math notranslate nohighlight">\(\mathcal{O}(n_s \times n_s)\)</span> to <span class="math notranslate nohighlight">\(\mathcal{O}(n_s \times \log(n_s))\)</span>, which usually represents the memory
and time bottleneck in a transformer model, with <span class="math notranslate nohighlight">\(n_s\)</span> being the sequence length.</p>
</div>
<div class="section" id="local-self-attention">
<h2>Local Self Attention<a class="headerlink" href="#local-self-attention" title="Permalink to this headline">¬∂</a></h2>
<p>Local self attention is essentially a ‚Äúnormal‚Äù self attention layer with key, query and value projections, but is
chunked so that in each chunk of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.local_chunk_length</span></code> the query embedding vectors only attends to
the key embedding vectors in its chunk and to the key embedding vectors of <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.local_num_chunks_before</span></code>
previous neighboring chunks and <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.local_num_chunks_after</span></code> following neighboring chunks.</p>
<p>Using Local self attention, the memory and time complexity of the query-key matmul operation can be reduced from
<span class="math notranslate nohighlight">\(\mathcal{O}(n_s \times n_s)\)</span> to <span class="math notranslate nohighlight">\(\mathcal{O}(n_s \times \log(n_s))\)</span>, which usually represents the memory
and time bottleneck in a transformer model, with <span class="math notranslate nohighlight">\(n_s\)</span> being the sequence length.</p>
</div>
<div class="section" id="training">
<h2>Training<a class="headerlink" href="#training" title="Permalink to this headline">¬∂</a></h2>
<p>During training, we must ensure that the sequence length is set to a value that can be divided by the least common
multiple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.lsh_chunk_length</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.local_chunk_length</span></code> and that the parameters of the Axial
Positional Encodings are correctly set as described above. Reformer is very memory efficient so that the model can
easily be trained on sequences as long as 64000 tokens.</p>
<p>For training, the <a class="reference internal" href="#transformers.ReformerModelWithLMHead" title="transformers.ReformerModelWithLMHead"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModelWithLMHead</span></code></a> should be used as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_ids</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'This is a sentence from the training data'</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s1">'pt'</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">input_ids</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="reformerconfig">
<h2>ReformerConfig<a class="headerlink" href="#reformerconfig" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerConfig"><a name="//apple_ref/cpp/Class/transformers.ReformerConfig"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerConfig</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">attention_head_size</span><span class="o">=</span><span class="default_value">64</span></em>, <em class="sig-param"><span class="n">attn_layers</span><span class="o">=</span><span class="default_value">['local', 'lsh', 'local', 'lsh', 'local', 'lsh']</span></em>, <em class="sig-param"><span class="n">axial_norm_std</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">axial_pos_embds</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">axial_pos_shape</span><span class="o">=</span><span class="default_value">[64, 64]</span></em>, <em class="sig-param"><span class="n">axial_pos_embds_dim</span><span class="o">=</span><span class="default_value">[64, 192]</span></em>, <em class="sig-param"><span class="n">chunk_size_lm_head</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">eos_token_id</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">feed_forward_size</span><span class="o">=</span><span class="default_value">512</span></em>, <em class="sig-param"><span class="n">hash_seed</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">hidden_act</span><span class="o">=</span><span class="default_value">'relu'</span></em>, <em class="sig-param"><span class="n">hidden_dropout_prob</span><span class="o">=</span><span class="default_value">0.05</span></em>, <em class="sig-param"><span class="n">hidden_size</span><span class="o">=</span><span class="default_value">256</span></em>, <em class="sig-param"><span class="n">initializer_range</span><span class="o">=</span><span class="default_value">0.02</span></em>, <em class="sig-param"><span class="n">is_decoder</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">layer_norm_eps</span><span class="o">=</span><span class="default_value">1e-12</span></em>, <em class="sig-param"><span class="n">local_num_chunks_before</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">local_num_chunks_after</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">local_attention_probs_dropout_prob</span><span class="o">=</span><span class="default_value">0.05</span></em>, <em class="sig-param"><span class="n">local_attn_chunk_length</span><span class="o">=</span><span class="default_value">64</span></em>, <em class="sig-param"><span class="n">lsh_attn_chunk_length</span><span class="o">=</span><span class="default_value">64</span></em>, <em class="sig-param"><span class="n">lsh_attention_probs_dropout_prob</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">lsh_num_chunks_before</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">lsh_num_chunks_after</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">max_position_embeddings</span><span class="o">=</span><span class="default_value">4096</span></em>, <em class="sig-param"><span class="n">num_attention_heads</span><span class="o">=</span><span class="default_value">12</span></em>, <em class="sig-param"><span class="n">num_buckets</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_hashes</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">pad_token_id</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">vocab_size</span><span class="o">=</span><span class="default_value">320</span></em>, <em class="sig-param"><span class="n">tie_word_embeddings</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">use_cache</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/configuration_reformer.html#ReformerConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerConfig" title="Permalink to this definition">¬∂</a></dt>
<dd><p>This is the configuration class to store the configuration of a <a class="reference internal" href="#transformers.ReformerModel" title="transformers.ReformerModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModel</span></code></a>. It is used to
instantiate a Reformer model according to the specified arguments, defining the model architecture.</p>
<p>Configuration objects inherit from <a class="reference internal" href="../main_classes/configuration.html#transformers.PretrainedConfig" title="transformers.PretrainedConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">PretrainedConfig</span></code></a> and can be used to control the model
outputs. Read the documentation from <a class="reference internal" href="../main_classes/configuration.html#transformers.PretrainedConfig" title="transformers.PretrainedConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">PretrainedConfig</span></code></a> for more information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>attention_head_size</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 64) ‚Äì Dimensionality of the projected key, query and value vectors</p></li>
<li><p><strong>attn_layers</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[str]</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">["local",</span> <span class="pre">"lsh",</span> <span class="pre">"local",</span> <span class="pre">"lsh",</span> <span class="pre">"local",</span> <span class="pre">"lsh"]</span></code>) ‚Äì <p>List of attention layer types in ascending order. It can be chosen between a LSHSelfAttention layer
(<code class="xref py py-obj docutils literal notranslate"><span class="pre">"lsh"</span></code>) and a LocalSelfAttention layer (<code class="xref py py-obj docutils literal notranslate"><span class="pre">"local"</span></code>).</p>
<p>For more information on LSHSelfAttention layer, see <a class="reference external" href="reformer.html#lsh-self-attention">LSH Self Attention</a>. For more information on LocalSelfAttention layer, see <a class="reference external" href="reformer.html#local-sensitive-hashing-self-attention">Local Self
Attention</a>.</p>
</p></li>
<li><p><strong>axial_pos_embds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>) ‚Äì Whether or not to use axial position embeddings. For more information on how axial position embeddings
work, see <a class="reference external" href="reformer.html#axial-positional-encodings">Axial Position Encodings</a>.</p></li>
<li><p><strong>axial_norm_std</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <cite>optional</cite>, defaults to 1.0) ‚Äì The standard deviation of the normal_initializer for initializing the weight matrices of the axial
positional encodings.</p></li>
<li><p><strong>axial_pos_shape</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[int]</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">[64,</span> <span class="pre">64]</span></code>) ‚Äì <p>The position dims of the axial position encodings. During training the product of the position dims has to
be equal to the sequence length.</p>
<p>For more information on how axial position embeddings work, see <a class="reference external" href="reformer.html#axial-positional-encodings">Axial Position Encodings</a>.</p>
</p></li>
<li><p><strong>axial_pos_embds_dim</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[int]</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">[64,</span> <span class="pre">192]</span></code>) ‚Äì <p>The embedding dims of the axial position encodings. The sum of the embedding dims has to be equal to the
hidden size.</p>
<p>For more information on how axial position embeddings work, see <a class="reference external" href="reformer.html#axial-positional-encodings">Axial Position Encodings</a>.</p>
</p></li>
<li><p><strong>chunk_size_lm_head</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 0) ‚Äì <p>The chunk size of the final language model feed forward head layer. A chunk size of 0 means that the feed
forward layer is not chunked. A chunk size of n means that the feed forward layer processes n &lt;
sequence_length embeddings at a time.</p>
<p>For more information on feed forward chunking, see <a class="reference external" href="../glossary.html#feed-forward-chunking">How does Feed Forward Chunking work?</a>.</p>
</p></li>
<li><p><strong>eos_token_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 2) ‚Äì The token id for the end-of-sentence token.</p></li>
<li><p><strong>feed_forward_size</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 512) ‚Äì Dimensionality of the feed_forward layer in the residual attention block.</p></li>
<li><p><strong>hash_seed</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>) ‚Äì Seed that can be used to make local sensitive hashing in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LSHSelfAttention</span></code> deterministic. This should
only be set for testing purposed. For evaluation and training purposes <code class="xref py py-obj docutils literal notranslate"><span class="pre">hash_seed</span></code> should be left as
<code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code> to ensure fully random rotations in local sensitive hashing scheme.</p></li>
<li><p><strong>hidden_act</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">Callable</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">"relu"</span></code>) ‚Äì The non-linear activation function (function or string) in the feed forward layer in the residual attention
block. If string, <code class="xref py py-obj docutils literal notranslate"><span class="pre">"gelu"</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">"relu"</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">"silu"</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">"gelu_new"</span></code> are supported.</p></li>
<li><p><strong>hidden_dropout_prob</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <cite>optional</cite>, defaults to 0.05) ‚Äì The dropout probability for all fully connected layers in the embeddings, encoder, and pooler.</p></li>
<li><p><strong>hidden_size</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 256) ‚Äì Dimensionality of the output hidden states of the residual attention blocks.</p></li>
<li><p><strong>initializer_range</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <cite>optional</cite>, defaults to 0.02) ‚Äì The standard deviation of the truncated_normal_initializer for initializing all weight matrices.</p></li>
<li><p><strong>is_decoder</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code>) ‚Äì Whether ot not to use a causal mask in addition to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">attention_mask</span></code> passed to
<a class="reference internal" href="#transformers.ReformerModel" title="transformers.ReformerModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModel</span></code></a>. When using the Reformer for causal language modeling, this argument
should be set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>layer_norm_eps</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <cite>optional</cite>, defaults to 1e-12) ‚Äì The epsilon used by the layer normalization layers.</p></li>
<li><p><strong>local_chunk_length</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 64) ‚Äì Length of chunk which attends to itself in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LocalSelfAttention</span></code>. Chunking reduces memory complexity
from sequence length x sequence length (self attention) to chunk length x chunk length x sequence length /
chunk length (chunked self attention).</p></li>
<li><p><strong>local_num_chunks_before</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 1) ‚Äì Number of previous neighbouring chunks to attend to in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LocalSelfAttention</span></code> layer to itself.</p></li>
<li><p><strong>local_num_chunks_after</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 0) ‚Äì Number of following neighbouring chunks to attend to in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LocalSelfAttention</span></code> layer in addition to
itself.</p></li>
<li><p><strong>local_attention_probs_dropout_prob</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <cite>optional</cite>, defaults to 0.1) ‚Äì The dropout ratio for the attention probabilities in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LocalSelfAttention</span></code>.</p></li>
<li><p><strong>lsh_attn_chunk_length</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 64) ‚Äì Length of chunk which attends to itself in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LSHSelfAttention</span></code>. Chunking reduces memory complexity from
sequence length x sequence length (self attention) to chunk length x chunk length x sequence length / chunk
length (chunked self attention).</p></li>
<li><p><strong>lsh_num_chunks_before</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 1) ‚Äì Number of previous neighbouring chunks to attend to in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LSHSelfAttention</span></code> layer to itself.</p></li>
<li><p><strong>lsh_num_chunks_after</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 0) ‚Äì Number of following neighbouring chunks to attend to in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LSHSelfAttention</span></code> layer to itself.</p></li>
<li><p><strong>lsh_attention_probs_dropout_prob</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code>, <cite>optional</cite>, defaults to 0.1) ‚Äì The dropout ratio for the attention probabilities in <code class="xref py py-obj docutils literal notranslate"><span class="pre">LSHSelfAttention</span></code>.</p></li>
<li><p><strong>max_position_embeddings</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 4096) ‚Äì The maximum sequence length that this model might ever be used with. Typically set this to something large
just in case (e.g., 512 or 1024 or 2048).</p></li>
<li><p><strong>num_attention_heads</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 12) ‚Äì Number of attention heads for each attention layer in the Transformer encoder.</p></li>
<li><p><strong>num_buckets</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">List[int]</span></code>, <cite>optional</cite>) ‚Äì Number of buckets, the key query vectors can be ‚Äúhashed into‚Äù using the locality sensitive hashing scheme.
Each query key vector is hashed into a hash in <code class="xref py py-obj docutils literal notranslate"><span class="pre">1,</span> <span class="pre">...,</span> <span class="pre">num_buckets</span></code>. The number of buckets can also
be factorized into a list for improved memory complexity. In this case, each query key vector is hashed
into a hash in <code class="xref py py-obj docutils literal notranslate"><span class="pre">1-1,</span> <span class="pre">1-2,</span> <span class="pre">...,</span> <span class="pre">num_buckets[0]-1,</span> <span class="pre">...,</span> <span class="pre">num_buckets[0]-num_buckets[1]</span></code> if
<code class="xref py py-obj docutils literal notranslate"><span class="pre">num_buckets</span></code> is factorized into two factors. The number of buckets (or the product the factors)
should approximately equal sequence length / lsh_chunk_length. If <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_buckets</span></code> not set, a good value
is calculated on the fly.</p></li>
<li><p><strong>num_hashes</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 1) ‚Äì Number of hashing rounds (e.g., number of random rotations) in Local Sensitive Hashing scheme. The higher
<code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code>, the more accurate the <code class="xref py py-obj docutils literal notranslate"><span class="pre">LSHSelfAttention</span></code> becomes, but also the more memory and time
intensive the hashing becomes.</p></li>
<li><p><strong>pad_token_id</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 0) ‚Äì The token id for the padding token.</p></li>
<li><p><strong>vocab_size</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>, defaults to 320) ‚Äì <p>Vocabulary size of the BERT model. Defines the number of different tokens that can be represented by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs_ids</span></code> passed when calling <a class="reference internal" href="#transformers.ReformerModel" title="transformers.ReformerModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModel</span></code></a>.</p>
</p></li>
<li><p><strong>tie_word_embeddings</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code>) ‚Äì Whether to tie input and output embeddings.</p></li>
<li><p><strong>use_cache</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>) ‚Äì Whether or not the model should return the last key/values attentions (not used by all models).</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ReformerModel</span><span class="p">,</span> <span class="n">ReformerConfig</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initializing a Reformer configuration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">configuration</span> <span class="o">=</span> <span class="n">ReformerConfig</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initializing a Reformer model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ReformerModel</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Accessing the model configuration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">configuration</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
</dd></dl>
</div>
<div class="section" id="reformertokenizer">
<h2>ReformerTokenizer<a class="headerlink" href="#reformertokenizer" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerTokenizer"><a name="//apple_ref/cpp/Class/transformers.ReformerTokenizer"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerTokenizer</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/utils/dummy_sentencepiece_objects.html#ReformerTokenizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerTokenizer" title="Permalink to this definition">¬∂</a></dt>
<dd></dd></dl>
</div>
<div class="section" id="reformertokenizerfast">
<h2>ReformerTokenizerFast<a class="headerlink" href="#reformertokenizerfast" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerTokenizerFast"><a name="//apple_ref/cpp/Class/transformers.ReformerTokenizerFast"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerTokenizerFast</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">vocab_file</span></em>, <em class="sig-param"><span class="n">tokenizer_file</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">eos_token</span><span class="o">=</span><span class="default_value">'&lt;/s&gt;'</span></em>, <em class="sig-param"><span class="n">unk_token</span><span class="o">=</span><span class="default_value">'&lt;unk&gt;'</span></em>, <em class="sig-param"><span class="n">additional_special_tokens</span><span class="o">=</span><span class="default_value">[]</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/tokenization_reformer_fast.html#ReformerTokenizerFast"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerTokenizerFast" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Construct a ‚Äúfast‚Äù Reformer tokenizer (backed by HuggingFace‚Äôs <cite>tokenizers</cite> library). Based on <a class="reference external" href="https://huggingface.co/docs/tokenizers/python/latest/components.html?highlight=unigram#models">Unigram</a>.</p>
<p>This tokenizer inherits from <a class="reference internal" href="../main_classes/tokenizer.html#transformers.PreTrainedTokenizerFast" title="transformers.PreTrainedTokenizerFast"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreTrainedTokenizerFast</span></code></a> which contains most of the main
methods. Users should refer to this superclass for more information regarding those methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vocab_file</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) ‚Äì <a class="reference external" href="https://github.com/google/sentencepiece">SentencePiece</a> file (generally has a <cite>.spm</cite> extension) that
contains the vocabulary necessary to instantiate a tokenizer.</p></li>
<li><p><strong>eos_token</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">"&lt;/s&gt;"</span></code>) ‚Äì <p>The end of sequence token.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When building a sequence using special tokens, this is not the token that is used for the end of
sequence. The token used is the <code class="xref py py-obj docutils literal notranslate"><span class="pre">sep_token</span></code>.</p>
</div>
</p></li>
<li><p><strong>unk_token</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">"&lt;unk&gt;"</span></code>) ‚Äì The unknown token. A token that is not in the vocabulary cannot be converted to an ID and is set to be this
token instead.</p></li>
<li><p><strong>pad_token</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, <cite>optional</cite>, defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">"&lt;pad&gt;"</span></code>) ‚Äì The token used for padding, for example when batching sequences of different lengths.</p></li>
<li><p><strong>additional_special_tokens</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[str]</span></code>, <cite>optional</cite>) ‚Äì Additional special tokens used by the tokenizer.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="transformers.ReformerTokenizerFast.save_vocabulary"><a name="//apple_ref/cpp/Method/transformers.ReformerTokenizerFast.save_vocabulary"></a>
<code class="sig-name descname">save_vocabulary</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">save_directory</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">filename_prefix</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> ‚Üí Tuple<span class="p">[</span>str<span class="p">]</span><a class="reference internal" href="../_modules/transformers/models/reformer/tokenization_reformer_fast.html#ReformerTokenizerFast.save_vocabulary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerTokenizerFast.save_vocabulary" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Save only the vocabulary of the tokenizer (vocabulary + added tokens).</p>
<p>This method won‚Äôt save the configuration and special token mappings of the tokenizer. Use
<code class="xref py py-meth docutils literal notranslate"><span class="pre">_save_pretrained()</span></code> to save the whole state of the tokenizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>save_directory</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) ‚Äì The directory in which to save the vocabulary.</p></li>
<li><p><strong>filename_prefix</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, <cite>optional</cite>) ‚Äì An optional prefix to add to the named of the saved files.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Paths to the files saved.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(str)</span></code></p>
</dd>
</dl>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="reformermodel">
<h2>ReformerModel<a class="headerlink" href="#reformermodel" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerModel"><a name="//apple_ref/cpp/Class/transformers.ReformerModel"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerModel" title="Permalink to this definition">¬∂</a></dt>
<dd><p>The bare Reformer Model transformer outputting raw hidden-stateswithout any specific head on top.
Reformer was proposed in <a class="reference external" href="https://arxiv.org/abs/2001.04451">Reformer: The Efficient Transformer</a> by Nikita
Kitaev, ≈Åukasz Kaiser, Anselm Levskaya.</p>
<p>This model inherits from <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel" title="transformers.PreTrainedModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreTrainedModel</span></code></a>. Check the superclass documentation for the generic
methods the library implements for all its model (such as downloading or saving, resizing the input embeddings,
pruning heads etc.)</p>
<p>This model is also a PyTorch <a class="reference external" href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module">torch.nn.Module</a>
subclass. Use it as a regular PyTorch Module and refer to the PyTorch documentation for all matter related to
general usage and behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) ‚Äì Model configuration class with all the parameters of the model.
Initializing with a config file does not load the weights associated with the model, only the
configuration. Check out the <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel.from_pretrained" title="transformers.PreTrainedModel.from_pretrained"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pretrained()</span></code></a> method to load the model
weights.</p>
</dd>
</dl>
<dl class="py method">
<dt id="transformers.ReformerModel.forward"><a name="//apple_ref/cpp/Method/transformers.ReformerModel.forward"></a>
<code class="sig-name descname">forward</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">attention_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">position_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">head_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputs_embeds</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_hashes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">past_buckets_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_cache</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_hidden_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_attentions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">return_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerModel.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerModel.forward" title="Permalink to this definition">¬∂</a></dt>
<dd><p>The <a class="reference internal" href="#transformers.ReformerModel" title="transformers.ReformerModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModel</span></code></a> forward method, overrides the <code class="xref py py-func docutils literal notranslate"><span class="pre">__call__()</span></code> special method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within this function, one should call the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards instead of this since the former takes care of running the pre and post
processing steps while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì <p>Indices of input sequence tokens in the vocabulary. During training the input_ids sequence_length has to be
a multiple of the relevant model‚Äôs chunk lengths (lsh‚Äôs, local‚Äôs or both). During evaluation, the indices
are automatically padded to be a multiple of the chunk length.</p>
<p>Indices can be obtained using <a class="reference internal" href="#transformers.ReformerTokenizer" title="transformers.ReformerTokenizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerTokenizer</span></code></a>. See
<code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.encode()</span></code> and <a class="reference internal" href="../main_classes/tokenizer.html#transformers.PreTrainedTokenizer.__call__" title="transformers.PreTrainedTokenizer.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.__call__()</span></code></a> for
details.</p>
<p><a class="reference external" href="../glossary.html#input-ids">What are input IDs?</a></p>
</p></li>
<li><p><strong>attention_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to avoid performing attention on padding token indices. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 for tokens that are <strong>not masked</strong>,</p></li>
<li><p>0 for tokens that are <strong>masked</strong>.</p></li>
</ul>
<p><a class="reference external" href="../glossary.html#attention-mask">What are attention masks?</a></p>
</p></li>
<li><p><strong>position_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Indices of positions of each input sequence tokens in the position embeddings. Selected in the range <code class="docutils literal notranslate"><span class="pre">[0,</span>
<span class="pre">config.max_position_embeddings</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p>
<p><a class="reference external" href="../glossary.html#position-ids">What are position IDs?</a></p>
</p></li>
<li><p><strong>head_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_heads,)</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_layers,</span> <span class="pre">num_heads)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to nullify selected heads of the self-attention modules. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 indicates the head is <strong>not masked</strong>,</p></li>
<li><p>0 indicates the head is <strong>masked</strong>.</p></li>
</ul>
</p></li>
<li><p><strong>inputs_embeds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>, <cite>optional</cite>) ‚Äì Optionally, instead of passing <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> you can choose to directly pass an embedded representation.
This is useful if you want more control over how to convert <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> indices into associated
vectors than the model‚Äôs internal embedding lookup matrix.</p></li>
<li><p><strong>num_hashes</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>) ‚Äì <p>The number of hashing rounds that should be performed during bucketing. Setting this argument overwrites
the default defined in <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_hashes</span></code>.</p>
<p>For more information, see <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code> in <a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>.</p>
</p></li>
<li><p><strong>past_buckets_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor)]</span></code>, <cite>optional</cite>) ‚Äì <p>List of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor</span></code> of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.n_layers</span></code>, with the first
element being the previous <cite>buckets</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span> <span class="pre">num_hashes,</span> <span class="pre">sequence_length)</span></code>)
and the second being the previous <cite>hidden_states</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span>
<span class="pre">hidden_size)</span></code>).</p>
<p>Contains precomputed hidden-states and buckets (only relevant for LSH Self-Attention). Can be used to speed
up sequential decoding.</p>
</p></li>
<li><p><strong>use_cache</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì If set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code> key value states are returned and can be used to speed up
decoding (see <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code>).</p></li>
<li><p><strong>output_attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the attentions tensors of all attention layers. See <code class="docutils literal notranslate"><span class="pre">attentions</span></code> under returned
tensors for more detail.</p></li>
<li><p><strong>output_hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the hidden states of all layers. See <code class="docutils literal notranslate"><span class="pre">hidden_states</span></code> under returned tensors for
more detail.</p></li>
<li><p><strong>return_dict</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return a <a class="reference internal" href="../main_classes/output.html#transformers.file_utils.ModelOutput" title="transformers.file_utils.ModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelOutput</span></code></a> instead of a plain tuple.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModelOutput</span></code> (if
<code class="docutils literal notranslate"><span class="pre">return_dict=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.return_dict=True</span></code>) or a tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code>
comprising various elements depending on the configuration (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) and inputs.</p>
<ul>
<li><p><strong>last_hidden_state</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_predict,</span> <span class="pre">hidden_size)</span></code>) ‚Äì Sequence of hidden-states at the last layer of the model.</p>
<p><code class="docutils literal notranslate"><span class="pre">num_predict</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">target_mapping.shape[1]</span></code>. If <code class="docutils literal notranslate"><span class="pre">target_mapping</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then
<code class="docutils literal notranslate"><span class="pre">num_predict</span></code> corresponds to <code class="docutils literal notranslate"><span class="pre">sequence_length</span></code>.</p>
</li>
<li><p><strong>past_buckets_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor)]</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">use_cache=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.use_cache=True</span></code>) ‚Äì List of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor</span></code> of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.n_layers</span></code>, with the first
element being the previous <cite>buckets</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span> <span class="pre">num_hashes,</span> <span class="pre">sequence_length)</span></code>)
and the second being the previous <cite>hidden_states</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span>
<span class="pre">hidden_size)</span></code>).</p>
<p>Contains precomputed buckets and hidden-states that can be used (see <code class="docutils literal notranslate"><span class="pre">past_buckets_states</span></code> input) to
speed up sequential decoding.</p>
</li>
<li><p><strong>hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_hidden_states=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_hidden_states=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for the output of the embeddings and one for the output of each
layer) of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>.</p>
<p>Hidden-states of the model at the output of each layer plus the initial embedding outputs.</p>
</li>
<li><p><strong>attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_attentions=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_attentions=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for each layer) of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span>
<span class="pre">sequence_length,</span> <span class="pre">sequence_length)</span></code>.</p>
<p>Attentions weights after the attention softmax, used to compute the weighted average in the self-attention
heads.</p>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModelOutput</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ReformerTokenizer</span><span class="p">,</span> <span class="n">ReformerModel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">ReformerTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ReformerModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="s2">"Hello, my dog is cute"</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">"pt"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">last_hidden_states</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">last_hidden_state</span>
</pre></div>
</div>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="reformermodelwithlmhead">
<h2>ReformerModelWithLMHead<a class="headerlink" href="#reformermodelwithlmhead" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerModelWithLMHead"><a name="//apple_ref/cpp/Class/transformers.ReformerModelWithLMHead"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerModelWithLMHead</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerModelWithLMHead"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerModelWithLMHead" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Reformer Model with a <cite>language modeling</cite> head on top.
Reformer was proposed in <a class="reference external" href="https://arxiv.org/abs/2001.04451">Reformer: The Efficient Transformer</a> by Nikita
Kitaev, ≈Åukasz Kaiser, Anselm Levskaya.</p>
<p>This model inherits from <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel" title="transformers.PreTrainedModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreTrainedModel</span></code></a>. Check the superclass documentation for the generic
methods the library implements for all its model (such as downloading or saving, resizing the input embeddings,
pruning heads etc.)</p>
<p>This model is also a PyTorch <a class="reference external" href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module">torch.nn.Module</a>
subclass. Use it as a regular PyTorch Module and refer to the PyTorch documentation for all matter related to
general usage and behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) ‚Äì Model configuration class with all the parameters of the model.
Initializing with a config file does not load the weights associated with the model, only the
configuration. Check out the <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel.from_pretrained" title="transformers.PreTrainedModel.from_pretrained"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pretrained()</span></code></a> method to load the model
weights.</p>
</dd>
</dl>
<dl class="py method">
<dt id="transformers.ReformerModelWithLMHead.forward"><a name="//apple_ref/cpp/Method/transformers.ReformerModelWithLMHead.forward"></a>
<code class="sig-name descname">forward</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">position_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">attention_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">head_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputs_embeds</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_hashes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">past_buckets_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_cache</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_hidden_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_attentions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">return_dict</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">labels</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerModelWithLMHead.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerModelWithLMHead.forward" title="Permalink to this definition">¬∂</a></dt>
<dd><p>The <a class="reference internal" href="#transformers.ReformerModelWithLMHead" title="transformers.ReformerModelWithLMHead"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerModelWithLMHead</span></code></a> forward method, overrides the <code class="xref py py-func docutils literal notranslate"><span class="pre">__call__()</span></code> special method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within this function, one should call the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards instead of this since the former takes care of running the pre and post
processing steps while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì <p>Indices of input sequence tokens in the vocabulary. During training the input_ids sequence_length has to be
a multiple of the relevant model‚Äôs chunk lengths (lsh‚Äôs, local‚Äôs or both). During evaluation, the indices
are automatically padded to be a multiple of the chunk length.</p>
<p>Indices can be obtained using <a class="reference internal" href="#transformers.ReformerTokenizer" title="transformers.ReformerTokenizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerTokenizer</span></code></a>. See
<code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.encode()</span></code> and <a class="reference internal" href="../main_classes/tokenizer.html#transformers.PreTrainedTokenizer.__call__" title="transformers.PreTrainedTokenizer.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.__call__()</span></code></a> for
details.</p>
<p><a class="reference external" href="../glossary.html#input-ids">What are input IDs?</a></p>
</p></li>
<li><p><strong>attention_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to avoid performing attention on padding token indices. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 for tokens that are <strong>not masked</strong>,</p></li>
<li><p>0 for tokens that are <strong>masked</strong>.</p></li>
</ul>
<p><a class="reference external" href="../glossary.html#attention-mask">What are attention masks?</a></p>
</p></li>
<li><p><strong>position_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Indices of positions of each input sequence tokens in the position embeddings. Selected in the range <code class="docutils literal notranslate"><span class="pre">[0,</span>
<span class="pre">config.max_position_embeddings</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p>
<p><a class="reference external" href="../glossary.html#position-ids">What are position IDs?</a></p>
</p></li>
<li><p><strong>head_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_heads,)</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_layers,</span> <span class="pre">num_heads)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to nullify selected heads of the self-attention modules. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 indicates the head is <strong>not masked</strong>,</p></li>
<li><p>0 indicates the head is <strong>masked</strong>.</p></li>
</ul>
</p></li>
<li><p><strong>inputs_embeds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>, <cite>optional</cite>) ‚Äì Optionally, instead of passing <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> you can choose to directly pass an embedded representation.
This is useful if you want more control over how to convert <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> indices into associated
vectors than the model‚Äôs internal embedding lookup matrix.</p></li>
<li><p><strong>num_hashes</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>) ‚Äì <p>The number of hashing rounds that should be performed during bucketing. Setting this argument overwrites
the default defined in <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_hashes</span></code>.</p>
<p>For more information, see <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code> in <a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>.</p>
</p></li>
<li><p><strong>past_buckets_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor)]</span></code>, <cite>optional</cite>) ‚Äì <p>List of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor</span></code> of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.n_layers</span></code>, with the first
element being the previous <cite>buckets</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span> <span class="pre">num_hashes,</span> <span class="pre">sequence_length)</span></code>)
and the second being the previous <cite>hidden_states</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span>
<span class="pre">hidden_size)</span></code>).</p>
<p>Contains precomputed hidden-states and buckets (only relevant for LSH Self-Attention). Can be used to speed
up sequential decoding.</p>
</p></li>
<li><p><strong>use_cache</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì If set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code> key value states are returned and can be used to speed up
decoding (see <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code>).</p></li>
<li><p><strong>output_attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the attentions tensors of all attention layers. See <code class="docutils literal notranslate"><span class="pre">attentions</span></code> under returned
tensors for more detail.</p></li>
<li><p><strong>output_hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the hidden states of all layers. See <code class="docutils literal notranslate"><span class="pre">hidden_states</span></code> under returned tensors for
more detail.</p></li>
<li><p><strong>return_dict</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return a <a class="reference internal" href="../main_classes/output.html#transformers.file_utils.ModelOutput" title="transformers.file_utils.ModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelOutput</span></code></a> instead of a plain tuple.</p></li>
<li><p><strong>labels</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,)</span></code>, <cite>optional</cite>) ‚Äì Labels for computing the sequence classification/regression loss. Indices should be in <code class="xref py py-obj docutils literal notranslate"><span class="pre">[-100,</span> <span class="pre">0,</span>
<span class="pre">...,</span> <span class="pre">config.vocab_size</span> <span class="pre">-</span> <span class="pre">1]</span></code>. All labels set to <code class="docutils literal notranslate"><span class="pre">-100</span></code> are ignored (masked), the loss is only
computed for labels in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">...,</span> <span class="pre">config.vocab_size]</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.CausalLMOutput" title="transformers.modeling_outputs.CausalLMOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">CausalLMOutput</span></code></a> (if
<code class="docutils literal notranslate"><span class="pre">return_dict=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.return_dict=True</span></code>) or a tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code>
comprising various elements depending on the configuration (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) and inputs.</p>
<ul>
<li><p><strong>loss</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(1,)</span></code>, <cite>optional</cite>, returned when <code class="xref py py-obj docutils literal notranslate"><span class="pre">labels</span></code> is provided) ‚Äì Language modeling loss (for next-token prediction).</p></li>
<li><p><strong>logits</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">config.vocab_size)</span></code>) ‚Äì Prediction scores of the language modeling head (scores for each vocabulary token before SoftMax).</p></li>
<li><p><strong>hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_hidden_states=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_hidden_states=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for the output of the embeddings + one for the output of each layer)
of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>.</p>
<p>Hidden-states of the model at the output of each layer plus the initial embedding outputs.</p>
</li>
<li><p><strong>attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_attentions=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_attentions=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for each layer) of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span>
<span class="pre">sequence_length,</span> <span class="pre">sequence_length)</span></code>.</p>
<p>Attentions weights after the attention softmax, used to compute the weighted average in the self-attention
heads.</p>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.CausalLMOutput" title="transformers.modeling_outputs.CausalLMOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">CausalLMOutput</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ReformerTokenizer</span><span class="p">,</span> <span class="n">ReformerModelWithLMHead</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">ReformerTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ReformerModelWithLMHead</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="s2">"Hello, my dog is cute"</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">"pt"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="s2">"input_ids"</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logits</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">logits</span>
</pre></div>
</div>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="reformerformaskedlm">
<h2>ReformerForMaskedLM<a class="headerlink" href="#reformerformaskedlm" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerForMaskedLM"><a name="//apple_ref/cpp/Class/transformers.ReformerForMaskedLM"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerForMaskedLM</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerForMaskedLM"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerForMaskedLM" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Reformer Model with a <cite>language modeling</cite> head on top.
Reformer was proposed in <a class="reference external" href="https://arxiv.org/abs/2001.04451">Reformer: The Efficient Transformer</a> by Nikita
Kitaev, ≈Åukasz Kaiser, Anselm Levskaya.</p>
<p>This model inherits from <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel" title="transformers.PreTrainedModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreTrainedModel</span></code></a>. Check the superclass documentation for the generic
methods the library implements for all its model (such as downloading or saving, resizing the input embeddings,
pruning heads etc.)</p>
<p>This model is also a PyTorch <a class="reference external" href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module">torch.nn.Module</a>
subclass. Use it as a regular PyTorch Module and refer to the PyTorch documentation for all matter related to
general usage and behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) ‚Äì Model configuration class with all the parameters of the model.
Initializing with a config file does not load the weights associated with the model, only the
configuration. Check out the <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel.from_pretrained" title="transformers.PreTrainedModel.from_pretrained"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pretrained()</span></code></a> method to load the model
weights.</p>
</dd>
</dl>
<dl class="py method">
<dt id="transformers.ReformerForMaskedLM.forward"><a name="//apple_ref/cpp/Method/transformers.ReformerForMaskedLM.forward"></a>
<code class="sig-name descname">forward</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">position_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">attention_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">head_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputs_embeds</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_hashes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">labels</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_hidden_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_attentions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">return_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerForMaskedLM.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerForMaskedLM.forward" title="Permalink to this definition">¬∂</a></dt>
<dd><p>The <a class="reference internal" href="#transformers.ReformerForMaskedLM" title="transformers.ReformerForMaskedLM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerForMaskedLM</span></code></a> forward method, overrides the <code class="xref py py-func docutils literal notranslate"><span class="pre">__call__()</span></code> special method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within this function, one should call the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards instead of this since the former takes care of running the pre and post
processing steps while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì <p>Indices of input sequence tokens in the vocabulary. During training the input_ids sequence_length has to be
a multiple of the relevant model‚Äôs chunk lengths (lsh‚Äôs, local‚Äôs or both). During evaluation, the indices
are automatically padded to be a multiple of the chunk length.</p>
<p>Indices can be obtained using <a class="reference internal" href="#transformers.ReformerTokenizer" title="transformers.ReformerTokenizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerTokenizer</span></code></a>. See
<code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.encode()</span></code> and <a class="reference internal" href="../main_classes/tokenizer.html#transformers.PreTrainedTokenizer.__call__" title="transformers.PreTrainedTokenizer.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.__call__()</span></code></a> for
details.</p>
<p><a class="reference external" href="../glossary.html#input-ids">What are input IDs?</a></p>
</p></li>
<li><p><strong>attention_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to avoid performing attention on padding token indices. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 for tokens that are <strong>not masked</strong>,</p></li>
<li><p>0 for tokens that are <strong>masked</strong>.</p></li>
</ul>
<p><a class="reference external" href="../glossary.html#attention-mask">What are attention masks?</a></p>
</p></li>
<li><p><strong>position_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Indices of positions of each input sequence tokens in the position embeddings. Selected in the range <code class="docutils literal notranslate"><span class="pre">[0,</span>
<span class="pre">config.max_position_embeddings</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p>
<p><a class="reference external" href="../glossary.html#position-ids">What are position IDs?</a></p>
</p></li>
<li><p><strong>head_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_heads,)</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_layers,</span> <span class="pre">num_heads)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to nullify selected heads of the self-attention modules. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 indicates the head is <strong>not masked</strong>,</p></li>
<li><p>0 indicates the head is <strong>masked</strong>.</p></li>
</ul>
</p></li>
<li><p><strong>inputs_embeds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>, <cite>optional</cite>) ‚Äì Optionally, instead of passing <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> you can choose to directly pass an embedded representation.
This is useful if you want more control over how to convert <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> indices into associated
vectors than the model‚Äôs internal embedding lookup matrix.</p></li>
<li><p><strong>num_hashes</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>) ‚Äì <p>The number of hashing rounds that should be performed during bucketing. Setting this argument overwrites
the default defined in <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_hashes</span></code>.</p>
<p>For more information, see <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code> in <a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>.</p>
</p></li>
<li><p><strong>past_buckets_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor)]</span></code>, <cite>optional</cite>) ‚Äì <p>List of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor</span></code> of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.n_layers</span></code>, with the first
element being the previous <cite>buckets</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span> <span class="pre">num_hashes,</span> <span class="pre">sequence_length)</span></code>)
and the second being the previous <cite>hidden_states</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span>
<span class="pre">hidden_size)</span></code>).</p>
<p>Contains precomputed hidden-states and buckets (only relevant for LSH Self-Attention). Can be used to speed
up sequential decoding.</p>
</p></li>
<li><p><strong>use_cache</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì If set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code> key value states are returned and can be used to speed up
decoding (see <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code>).</p></li>
<li><p><strong>output_attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the attentions tensors of all attention layers. See <code class="docutils literal notranslate"><span class="pre">attentions</span></code> under returned
tensors for more detail.</p></li>
<li><p><strong>output_hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the hidden states of all layers. See <code class="docutils literal notranslate"><span class="pre">hidden_states</span></code> under returned tensors for
more detail.</p></li>
<li><p><strong>return_dict</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return a <a class="reference internal" href="../main_classes/output.html#transformers.file_utils.ModelOutput" title="transformers.file_utils.ModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelOutput</span></code></a> instead of a plain tuple.</p></li>
<li><p><strong>labels</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì Labels for computing the masked language modeling loss. Indices should be in <code class="docutils literal notranslate"><span class="pre">[-100,</span> <span class="pre">0,</span> <span class="pre">...,</span>
<span class="pre">config.vocab_size]</span></code> (see <code class="docutils literal notranslate"><span class="pre">input_ids</span></code> docstring) Tokens with indices set to <code class="docutils literal notranslate"><span class="pre">-100</span></code> are ignored
(masked), the loss is only computed for the tokens with labels</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.MaskedLMOutput" title="transformers.modeling_outputs.MaskedLMOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaskedLMOutput</span></code></a> (if
<code class="docutils literal notranslate"><span class="pre">return_dict=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.return_dict=True</span></code>) or a tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code>
comprising various elements depending on the configuration (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) and inputs.</p>
<ul>
<li><p><strong>loss</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(1,)</span></code>, <cite>optional</cite>, returned when <code class="xref py py-obj docutils literal notranslate"><span class="pre">labels</span></code> is provided) ‚Äì Masked language modeling (MLM) loss.</p></li>
<li><p><strong>logits</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">config.vocab_size)</span></code>) ‚Äì Prediction scores of the language modeling head (scores for each vocabulary token before SoftMax).</p></li>
<li><p><strong>hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_hidden_states=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_hidden_states=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for the output of the embeddings + one for the output of each layer)
of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>.</p>
<p>Hidden-states of the model at the output of each layer plus the initial embedding outputs.</p>
</li>
<li><p><strong>attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_attentions=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_attentions=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for each layer) of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span>
<span class="pre">sequence_length,</span> <span class="pre">sequence_length)</span></code>.</p>
<p>Attentions weights after the attention softmax, used to compute the weighted average in the self-attention
heads.</p>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.MaskedLMOutput" title="transformers.modeling_outputs.MaskedLMOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaskedLMOutput</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ReformerTokenizer</span><span class="p">,</span> <span class="n">ReformerForMaskedLM</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">ReformerTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ReformerForMaskedLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="s2">"The capital of France is [MASK]."</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">"pt"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="s2">"The capital of France is Paris."</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">"pt"</span><span class="p">)[</span><span class="s2">"input_ids"</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logits</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">logits</span>
</pre></div>
</div>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="reformerforsequenceclassification">
<h2>ReformerForSequenceClassification<a class="headerlink" href="#reformerforsequenceclassification" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerForSequenceClassification"><a name="//apple_ref/cpp/Class/transformers.ReformerForSequenceClassification"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerForSequenceClassification</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerForSequenceClassification"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerForSequenceClassification" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Reformer Model transformer with a sequence classification/regression head on top (a linear layer on top of the
pooled output) e.g. for GLUE tasks.</p>
<p>Reformer was proposed in <a class="reference external" href="https://arxiv.org/abs/2001.04451">Reformer: The Efficient Transformer</a> by Nikita
Kitaev, ≈Åukasz Kaiser, Anselm Levskaya.</p>
<p>This model inherits from <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel" title="transformers.PreTrainedModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreTrainedModel</span></code></a>. Check the superclass documentation for the generic
methods the library implements for all its model (such as downloading or saving, resizing the input embeddings,
pruning heads etc.)</p>
<p>This model is also a PyTorch <a class="reference external" href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module">torch.nn.Module</a>
subclass. Use it as a regular PyTorch Module and refer to the PyTorch documentation for all matter related to
general usage and behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) ‚Äì Model configuration class with all the parameters of the model.
Initializing with a config file does not load the weights associated with the model, only the
configuration. Check out the <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel.from_pretrained" title="transformers.PreTrainedModel.from_pretrained"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pretrained()</span></code></a> method to load the model
weights.</p>
</dd>
</dl>
<dl class="py method">
<dt id="transformers.ReformerForSequenceClassification.forward"><a name="//apple_ref/cpp/Method/transformers.ReformerForSequenceClassification.forward"></a>
<code class="sig-name descname">forward</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">position_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">attention_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">head_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputs_embeds</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_hashes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">labels</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_hidden_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_attentions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">return_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerForSequenceClassification.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerForSequenceClassification.forward" title="Permalink to this definition">¬∂</a></dt>
<dd><p>The <a class="reference internal" href="#transformers.ReformerForSequenceClassification" title="transformers.ReformerForSequenceClassification"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerForSequenceClassification</span></code></a> forward method, overrides the <code class="xref py py-func docutils literal notranslate"><span class="pre">__call__()</span></code> special method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within this function, one should call the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards instead of this since the former takes care of running the pre and post
processing steps while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì <p>Indices of input sequence tokens in the vocabulary. During training the input_ids sequence_length has to be
a multiple of the relevant model‚Äôs chunk lengths (lsh‚Äôs, local‚Äôs or both). During evaluation, the indices
are automatically padded to be a multiple of the chunk length.</p>
<p>Indices can be obtained using <a class="reference internal" href="#transformers.ReformerTokenizer" title="transformers.ReformerTokenizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerTokenizer</span></code></a>. See
<code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.encode()</span></code> and <a class="reference internal" href="../main_classes/tokenizer.html#transformers.PreTrainedTokenizer.__call__" title="transformers.PreTrainedTokenizer.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.__call__()</span></code></a> for
details.</p>
<p><a class="reference external" href="../glossary.html#input-ids">What are input IDs?</a></p>
</p></li>
<li><p><strong>attention_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to avoid performing attention on padding token indices. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 for tokens that are <strong>not masked</strong>,</p></li>
<li><p>0 for tokens that are <strong>masked</strong>.</p></li>
</ul>
<p><a class="reference external" href="../glossary.html#attention-mask">What are attention masks?</a></p>
</p></li>
<li><p><strong>position_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Indices of positions of each input sequence tokens in the position embeddings. Selected in the range <code class="docutils literal notranslate"><span class="pre">[0,</span>
<span class="pre">config.max_position_embeddings</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p>
<p><a class="reference external" href="../glossary.html#position-ids">What are position IDs?</a></p>
</p></li>
<li><p><strong>head_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_heads,)</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_layers,</span> <span class="pre">num_heads)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to nullify selected heads of the self-attention modules. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 indicates the head is <strong>not masked</strong>,</p></li>
<li><p>0 indicates the head is <strong>masked</strong>.</p></li>
</ul>
</p></li>
<li><p><strong>inputs_embeds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>, <cite>optional</cite>) ‚Äì Optionally, instead of passing <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> you can choose to directly pass an embedded representation.
This is useful if you want more control over how to convert <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> indices into associated
vectors than the model‚Äôs internal embedding lookup matrix.</p></li>
<li><p><strong>num_hashes</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>) ‚Äì <p>The number of hashing rounds that should be performed during bucketing. Setting this argument overwrites
the default defined in <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_hashes</span></code>.</p>
<p>For more information, see <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code> in <a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>.</p>
</p></li>
<li><p><strong>past_buckets_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor)]</span></code>, <cite>optional</cite>) ‚Äì <p>List of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor</span></code> of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.n_layers</span></code>, with the first
element being the previous <cite>buckets</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span> <span class="pre">num_hashes,</span> <span class="pre">sequence_length)</span></code>)
and the second being the previous <cite>hidden_states</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span>
<span class="pre">hidden_size)</span></code>).</p>
<p>Contains precomputed hidden-states and buckets (only relevant for LSH Self-Attention). Can be used to speed
up sequential decoding.</p>
</p></li>
<li><p><strong>use_cache</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì If set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code> key value states are returned and can be used to speed up
decoding (see <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code>).</p></li>
<li><p><strong>output_attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the attentions tensors of all attention layers. See <code class="docutils literal notranslate"><span class="pre">attentions</span></code> under returned
tensors for more detail.</p></li>
<li><p><strong>output_hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the hidden states of all layers. See <code class="docutils literal notranslate"><span class="pre">hidden_states</span></code> under returned tensors for
more detail.</p></li>
<li><p><strong>return_dict</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return a <a class="reference internal" href="../main_classes/output.html#transformers.file_utils.ModelOutput" title="transformers.file_utils.ModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelOutput</span></code></a> instead of a plain tuple.</p></li>
<li><p><strong>labels</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,)</span></code>, <cite>optional</cite>) ‚Äì Labels for computing the sequence classification/regression loss. Indices should be in <code class="xref py py-obj docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">...,</span>
<span class="pre">config.num_labels</span> <span class="pre">-</span> <span class="pre">1]</span></code>. If <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_labels</span> <span class="pre">==</span> <span class="pre">1</span></code> a regression loss is computed (Mean-Square loss),
If <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_labels</span> <span class="pre">&gt;</span> <span class="pre">1</span></code> a classification loss is computed (Cross-Entropy).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.SequenceClassifierOutput" title="transformers.modeling_outputs.SequenceClassifierOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">SequenceClassifierOutput</span></code></a> (if
<code class="docutils literal notranslate"><span class="pre">return_dict=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.return_dict=True</span></code>) or a tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code>
comprising various elements depending on the configuration (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) and inputs.</p>
<ul>
<li><p><strong>loss</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(1,)</span></code>, <cite>optional</cite>, returned when <code class="xref py py-obj docutils literal notranslate"><span class="pre">labels</span></code> is provided) ‚Äì Classification (or regression if config.num_labels==1) loss.</p></li>
<li><p><strong>logits</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">config.num_labels)</span></code>) ‚Äì Classification (or regression if config.num_labels==1) scores (before SoftMax).</p></li>
<li><p><strong>hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_hidden_states=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_hidden_states=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for the output of the embeddings + one for the output of each layer)
of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>.</p>
<p>Hidden-states of the model at the output of each layer plus the initial embedding outputs.</p>
</li>
<li><p><strong>attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_attentions=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_attentions=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for each layer) of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span>
<span class="pre">sequence_length,</span> <span class="pre">sequence_length)</span></code>.</p>
<p>Attentions weights after the attention softmax, used to compute the weighted average in the self-attention
heads.</p>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.SequenceClassifierOutput" title="transformers.modeling_outputs.SequenceClassifierOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">SequenceClassifierOutput</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ReformerTokenizer</span><span class="p">,</span> <span class="n">ReformerForSequenceClassification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">ReformerTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ReformerForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="s2">"Hello, my dog is cute"</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">"pt"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Batch size 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logits</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">logits</span>
</pre></div>
</div>
</dd></dl>
</dd></dl>
</div>
<div class="section" id="reformerforquestionanswering">
<h2>ReformerForQuestionAnswering<a class="headerlink" href="#reformerforquestionanswering" title="Permalink to this headline">¬∂</a></h2>
<dl class="py class">
<dt id="transformers.ReformerForQuestionAnswering"><a name="//apple_ref/cpp/Class/transformers.ReformerForQuestionAnswering"></a>
<em class="property">class </em><code class="sig-prename descclassname">transformers.</code><code class="sig-name descname">ReformerForQuestionAnswering</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerForQuestionAnswering"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerForQuestionAnswering" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Reformer Model with a span classification head on top for extractive question-answering tasks like SQuAD / TriviaQA
( a linear layer on top of hidden-states output to compute <cite>span start logits</cite> and <cite>span end logits</cite>.</p>
<p>Reformer was proposed in <a class="reference external" href="https://arxiv.org/abs/2001.04451">Reformer: The Efficient Transformer</a> by Nikita
Kitaev, ≈Åukasz Kaiser, Anselm Levskaya.</p>
<p>This model inherits from <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel" title="transformers.PreTrainedModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreTrainedModel</span></code></a>. Check the superclass documentation for the generic
methods the library implements for all its model (such as downloading or saving, resizing the input embeddings,
pruning heads etc.)</p>
<p>This model is also a PyTorch <a class="reference external" href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module">torch.nn.Module</a>
subclass. Use it as a regular PyTorch Module and refer to the PyTorch documentation for all matter related to
general usage and behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) ‚Äì Model configuration class with all the parameters of the model.
Initializing with a config file does not load the weights associated with the model, only the
configuration. Check out the <a class="reference internal" href="../main_classes/model.html#transformers.PreTrainedModel.from_pretrained" title="transformers.PreTrainedModel.from_pretrained"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pretrained()</span></code></a> method to load the model
weights.</p>
</dd>
</dl>
<dl class="py method">
<dt id="transformers.ReformerForQuestionAnswering.forward"><a name="//apple_ref/cpp/Method/transformers.ReformerForQuestionAnswering.forward"></a>
<code class="sig-name descname">forward</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">position_ids</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">attention_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">head_mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">inputs_embeds</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_hashes</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">start_positions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">end_positions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_hidden_states</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output_attentions</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">return_dict</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/transformers/models/reformer/modeling_reformer.html#ReformerForQuestionAnswering.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#transformers.ReformerForQuestionAnswering.forward" title="Permalink to this definition">¬∂</a></dt>
<dd><p>The <a class="reference internal" href="#transformers.ReformerForQuestionAnswering" title="transformers.ReformerForQuestionAnswering"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerForQuestionAnswering</span></code></a> forward method, overrides the <code class="xref py py-func docutils literal notranslate"><span class="pre">__call__()</span></code> special method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within this function, one should call the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards instead of this since the former takes care of running the pre and post
processing steps while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì <p>Indices of input sequence tokens in the vocabulary. During training the input_ids sequence_length has to be
a multiple of the relevant model‚Äôs chunk lengths (lsh‚Äôs, local‚Äôs or both). During evaluation, the indices
are automatically padded to be a multiple of the chunk length.</p>
<p>Indices can be obtained using <a class="reference internal" href="#transformers.ReformerTokenizer" title="transformers.ReformerTokenizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerTokenizer</span></code></a>. See
<code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.encode()</span></code> and <a class="reference internal" href="../main_classes/tokenizer.html#transformers.PreTrainedTokenizer.__call__" title="transformers.PreTrainedTokenizer.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transformers.PreTrainedTokenizer.__call__()</span></code></a> for
details.</p>
<p><a class="reference external" href="../glossary.html#input-ids">What are input IDs?</a></p>
</p></li>
<li><p><strong>attention_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to avoid performing attention on padding token indices. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 for tokens that are <strong>not masked</strong>,</p></li>
<li><p>0 for tokens that are <strong>masked</strong>.</p></li>
</ul>
<p><a class="reference external" href="../glossary.html#attention-mask">What are attention masks?</a></p>
</p></li>
<li><p><strong>position_ids</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>, <cite>optional</cite>) ‚Äì <p>Indices of positions of each input sequence tokens in the position embeddings. Selected in the range <code class="docutils literal notranslate"><span class="pre">[0,</span>
<span class="pre">config.max_position_embeddings</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p>
<p><a class="reference external" href="../glossary.html#position-ids">What are position IDs?</a></p>
</p></li>
<li><p><strong>head_mask</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_heads,)</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">(num_layers,</span> <span class="pre">num_heads)</span></code>, <cite>optional</cite>) ‚Äì <p>Mask to nullify selected heads of the self-attention modules. Mask values selected in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>:</p>
<ul>
<li><p>1 indicates the head is <strong>not masked</strong>,</p></li>
<li><p>0 indicates the head is <strong>masked</strong>.</p></li>
</ul>
</p></li>
<li><p><strong>inputs_embeds</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>, <cite>optional</cite>) ‚Äì Optionally, instead of passing <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> you can choose to directly pass an embedded representation.
This is useful if you want more control over how to convert <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_ids</span></code> indices into associated
vectors than the model‚Äôs internal embedding lookup matrix.</p></li>
<li><p><strong>num_hashes</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code>, <cite>optional</cite>) ‚Äì <p>The number of hashing rounds that should be performed during bucketing. Setting this argument overwrites
the default defined in <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.num_hashes</span></code>.</p>
<p>For more information, see <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_hashes</span></code> in <a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>.</p>
</p></li>
<li><p><strong>past_buckets_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List[Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor)]</span></code>, <cite>optional</cite>) ‚Äì <p>List of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tuple(torch.LongTensor,</span> <span class="pre">torch.FloatTensor</span></code> of length <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.n_layers</span></code>, with the first
element being the previous <cite>buckets</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span> <span class="pre">num_hashes,</span> <span class="pre">sequence_length)</span></code>)
and the second being the previous <cite>hidden_states</cite> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span>
<span class="pre">hidden_size)</span></code>).</p>
<p>Contains precomputed hidden-states and buckets (only relevant for LSH Self-Attention). Can be used to speed
up sequential decoding.</p>
</p></li>
<li><p><strong>use_cache</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì If set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code> key value states are returned and can be used to speed up
decoding (see <code class="xref py py-obj docutils literal notranslate"><span class="pre">past_key_values</span></code>).</p></li>
<li><p><strong>output_attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the attentions tensors of all attention layers. See <code class="docutils literal notranslate"><span class="pre">attentions</span></code> under returned
tensors for more detail.</p></li>
<li><p><strong>output_hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return the hidden states of all layers. See <code class="docutils literal notranslate"><span class="pre">hidden_states</span></code> under returned tensors for
more detail.</p></li>
<li><p><strong>return_dict</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code>, <cite>optional</cite>) ‚Äì Whether or not to return a <a class="reference internal" href="../main_classes/output.html#transformers.file_utils.ModelOutput" title="transformers.file_utils.ModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelOutput</span></code></a> instead of a plain tuple.</p></li>
<li><p><strong>start_positions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,)</span></code>, <cite>optional</cite>) ‚Äì Labels for position (index) of the start of the labelled span for computing the token classification loss.
Positions are clamped to the length of the sequence (<code class="xref py py-obj docutils literal notranslate"><span class="pre">sequence_length</span></code>). Position outside of the
sequence are not taken into account for computing the loss.</p></li>
<li><p><strong>end_positions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.LongTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,)</span></code>, <cite>optional</cite>) ‚Äì Labels for position (index) of the end of the labelled span for computing the token classification loss.
Positions are clamped to the length of the sequence (<code class="xref py py-obj docutils literal notranslate"><span class="pre">sequence_length</span></code>). Position outside of the
sequence are not taken into account for computing the loss.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.QuestionAnsweringModelOutput" title="transformers.modeling_outputs.QuestionAnsweringModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuestionAnsweringModelOutput</span></code></a> (if
<code class="docutils literal notranslate"><span class="pre">return_dict=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.return_dict=True</span></code>) or a tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code>
comprising various elements depending on the configuration (<a class="reference internal" href="#transformers.ReformerConfig" title="transformers.ReformerConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReformerConfig</span></code></a>) and inputs.</p>
<ul>
<li><p><strong>loss</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(1,)</span></code>, <cite>optional</cite>, returned when <code class="xref py py-obj docutils literal notranslate"><span class="pre">labels</span></code> is provided) ‚Äì Total span extraction loss is the sum of a Cross-Entropy for the start and end positions.</p></li>
<li><p><strong>start_logits</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì Span-start scores (before SoftMax).</p></li>
<li><p><strong>end_logits</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length)</span></code>) ‚Äì Span-end scores (before SoftMax).</p></li>
<li><p><strong>hidden_states</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_hidden_states=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_hidden_states=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for the output of the embeddings + one for the output of each layer)
of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">sequence_length,</span> <span class="pre">hidden_size)</span></code>.</p>
<p>Hidden-states of the model at the output of each layer plus the initial embedding outputs.</p>
</li>
<li><p><strong>attentions</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code>, <cite>optional</cite>, returned when <code class="docutils literal notranslate"><span class="pre">output_attentions=True</span></code> is passed or when <code class="docutils literal notranslate"><span class="pre">config.output_attentions=True</span></code>) ‚Äì Tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.FloatTensor</span></code> (one for each layer) of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">(batch_size,</span> <span class="pre">num_heads,</span>
<span class="pre">sequence_length,</span> <span class="pre">sequence_length)</span></code>.</p>
<p>Attentions weights after the attention softmax, used to compute the weighted average in the self-attention
heads.</p>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="../main_classes/output.html#transformers.modeling_outputs.QuestionAnsweringModelOutput" title="transformers.modeling_outputs.QuestionAnsweringModelOutput"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuestionAnsweringModelOutput</span></code></a> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">tuple(torch.FloatTensor)</span></code></p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ReformerTokenizer</span><span class="p">,</span> <span class="n">ReformerForQuestionAnswering</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">torch</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">ReformerTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ReformerForQuestionAnswering</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">'google/reformer-crime-and-punishment'</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Who was Jim Henson?"</span><span class="p">,</span> <span class="s2">"Jim Henson was a nice puppet"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s1">'pt'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_positions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_positions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">,</span> <span class="n">start_positions</span><span class="o">=</span><span class="n">start_positions</span><span class="p">,</span> <span class="n">end_positions</span><span class="o">=</span><span class="n">end_positions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_scores</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">start_logits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_scores</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">end_logits</span>
</pre></div>
</div>
</dd></dl>
</dd></dl>
</div>
</div>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a accesskey="n" class="btn btn-neutral float-right" href="retribert.html" rel="next" title="RetriBERT">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
<a accesskey="p" class="btn btn-neutral float-left" href="rag.html" rel="prev" title="RAG"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<p>
        ¬© Copyright 2020, The Hugging Face Team, Licenced under the Apache License, Version 2.0.

    </p>
</div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
</div>
</div>
</section>
</div>
<script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Theme Analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-83738774-2', 'auto');
    
    ga('send', 'pageview');
    </script>
</body>
</html>