

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; transformers 2.6.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/js/custom.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/huggingface.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/code-snippets.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/hidesidebar.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Model upload and sharing" href="model_sharing.html" />
    <link rel="prev" title="Pretrained models" href="pretrained_models.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> transformers
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="pretrained_models.html">Pretrained models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sequence-classification">Sequence Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extractive-question-answering">Extractive Question Answering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#language-modeling">Language Modeling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#masked-language-modeling">Masked Language Modeling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#causal-language-modeling">Causal Language Modeling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#named-entity-recognition">Named Entity Recognition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_sharing.html">Model upload and sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="serialization.html">Loading Google AI or OpenAI pre-trained weights or PyTorch dump</a></li>
<li class="toctree-l1"><a class="reference internal" href="serialization.html#serialization-best-practices">Serialization best-practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="converting_tensorflow_models.html">Converting Tensorflow Checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migrating from pytorch-pretrained-bert</a></li>
<li class="toctree-l1"><a class="reference internal" href="bertology.html">BERTology</a></li>
<li class="toctree-l1"><a class="reference internal" href="torchscript.html">TorchScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="multilingual.html">Multi-lingual models</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption"><span class="caption-text">Main classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="main_classes/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/model.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/tokenizer.html">Tokenizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/pipelines.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/optimizer_schedules.html">Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/optimizer_schedules.html#schedules">Schedules</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/optimizer_schedules.html#gradient-strategies">Gradient Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_classes/processors.html">Processors</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="model_doc/auto.html">AutoModels</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/bert.html">BERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/gpt.html">OpenAI GPT</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/transformerxl.html">Transformer XL</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/gpt2.html">OpenAI GPT2</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/xlm.html">XLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/xlnet.html">XLNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/roberta.html">RoBERTa</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/distilbert.html">DistilBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/ctrl.html">CTRL</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/camembert.html">CamemBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/albert.html">ALBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/xlmroberta.html">XLM-RoBERTa</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/flaubert.html">FlauBERT</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/bart.html">Bart</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_doc/t5.html">T5</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">transformers</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¬∂</a></h1>
<p>This page shows the most frequent use-cases when using the library. The models available allow for many different
configurations and a great versatility in use-cases. The most simple ones are presented here, showcasing usage
for tasks such as question answering, sequence classification, named entity recognition and others.</p>
<p>These examples leverage auto-models, which are classes that will instantiate a model according to a given checkpoint,
automatically selecting the correct model architecture. Please check the <a class="reference internal" href="model_doc/auto.html#transformers.AutoModel" title="transformers.AutoModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoModel</span></code></a> documentation
for more information.
Feel free to modify the code to be more specific and adapt it to your specific use-case.</p>
<p>In order for a model to perform well on a task, it must be loaded from a checkpoint corresponding to that task. These
checkpoints are usually pre-trained on a large corpus of data and fine-tuned on a specific task. This means the
following:</p>
<ul class="simple">
<li><p>Not all models were fine-tuned on all tasks. If you want to fine-tune a model on a specific task, you can leverage
one of the <cite>run_$TASK.py</cite> script in the
<a class="reference external" href="https://github.com/huggingface/transformers/tree/master/examples">examples</a> directory.</p></li>
<li><p>Fine-tuned models were fine-tuned on a specific dataset. This dataset may or may not overlap with your use-case
and domain. As mentioned previously, you may leverage the
<a class="reference external" href="https://github.com/huggingface/transformers/tree/master/examples">examples</a> scripts to fine-tune your model, or you
may create your own training script.</p></li>
</ul>
<p>In order to do an inference on a task, several mechanisms are made available by the library:</p>
<ul class="simple">
<li><p>Pipelines: very easy-to-use abstractions, which require as little as two lines of code.</p></li>
<li><p>Using a model directly with a tokenizer (PyTorch/TensorFlow): the full inference using the model. Less abstraction,
but much more powerful.</p></li>
</ul>
<p>Both approaches are showcased here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All tasks presented here leverage pre-trained checkpoints that were fine-tuned on specific tasks. Loading a
checkpoint that was not fine-tuned on a specific task would load only the base transformer layers and not the
additional head that is used for the task, initializing the weights of that head randomly.</p>
<p>This would produce random output.</p>
</div>
<div class="section" id="sequence-classification">
<h2>Sequence Classification<a class="headerlink" href="#sequence-classification" title="Permalink to this headline">¬∂</a></h2>
<p>Sequence classification is the task of classifying sequences according to a given number of classes. An example
of sequence classification is the GLUE dataset, which is entirely based on that task. If you would like to fine-tune
a model on a GLUE sequence classification task, you may leverage the
<a class="reference external" href="https://github.com/huggingface/transformers/tree/master/examples/run_glue.py">run_glue.py</a> or
<a class="reference external" href="https://github.com/huggingface/transformers/tree/master/examples/run_tf_glue.py">run_tf_glue.py</a> scripts.</p>
<p>Here is an example using the pipelines do to sentiment analysis: identifying if a sequence is positive or negative.
It leverages a fine-tuned model on sst2, which is a GLUE task.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;sentiment-analysis&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="s2">&quot;I hate you&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="s2">&quot;I love you&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This returns a label (‚ÄúPOSITIVE‚Äù or ‚ÄúNEGATIVE‚Äù) alongside a score, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;NEGATIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9991129</span><span class="p">}]</span>
<span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;POSITIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.99986565</span><span class="p">}]</span>
</pre></div>
</div>
<p>Here is an example of doing a sequence classification using a model to determine if two sequences are paraphrases
of each other. The process is the following:</p>
<ul class="simple">
<li><p>Instantiate a tokenizer and a model from the checkpoint name. The model is identified as a BERT model and loads it
with the weights stored in the checkpoint.</p></li>
<li><p>Build a sequence from the two sentences, with the correct model-specific separators token type ids
and attention masks (<a class="reference internal" href="main_classes/tokenizer.html#transformers.PreTrainedTokenizer.encode" title="transformers.PreTrainedTokenizer.encode"><code class="xref py py-func docutils literal notranslate"><span class="pre">encode()</span></code></a> and
<a class="reference internal" href="main_classes/tokenizer.html#transformers.PreTrainedTokenizer.encode_plus" title="transformers.PreTrainedTokenizer.encode_plus"><code class="xref py py-func docutils literal notranslate"><span class="pre">encode_plus()</span></code></a> take care of this)</p></li>
<li><p>Pass this sequence through the model so that it is classified in one of the two available classes: 0
(not a paraphrase) and 1 (is a paraphrase)</p></li>
<li><p>Compute the softmax of the result to get probabilities over the classes</p></li>
<li><p>Print the results</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## PYTORCH CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">AutoModelForSequenceClassification</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased-finetuned-mrpc&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased-finetuned-mrpc&quot;</span><span class="p">)</span>

<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;not paraphrase&quot;</span><span class="p">,</span> <span class="s2">&quot;is paraphrase&quot;</span><span class="p">]</span>

<span class="n">sequence_0</span> <span class="o">=</span> <span class="s2">&quot;The company HuggingFace is based in New York City&quot;</span>
<span class="n">sequence_1</span> <span class="o">=</span> <span class="s2">&quot;Apples are especially bad for your health&quot;</span>
<span class="n">sequence_2</span> <span class="o">=</span> <span class="s2">&quot;HuggingFace&#39;s headquarters are situated in Manhattan&quot;</span>

<span class="n">paraphrase</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">sequence_0</span><span class="p">,</span> <span class="n">sequence_2</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
<span class="n">not_paraphrase</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">sequence_0</span><span class="p">,</span> <span class="n">sequence_1</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>

<span class="n">paraphrase_classification_logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">paraphrase</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">not_paraphrase_classification_logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">not_paraphrase</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">paraphrase_results</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">paraphrase_classification_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">not_paraphrase_results</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">not_paraphrase_classification_logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Should be paraphrase&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">paraphrase_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Should not be paraphrase&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">not_paraphrase_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="c1">## TENSORFLOW CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">TFAutoModelForSequenceClassification</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased-finetuned-mrpc&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TFAutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased-finetuned-mrpc&quot;</span><span class="p">)</span>

<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;not paraphrase&quot;</span><span class="p">,</span> <span class="s2">&quot;is paraphrase&quot;</span><span class="p">]</span>

<span class="n">sequence_0</span> <span class="o">=</span> <span class="s2">&quot;The company HuggingFace is based in New York City&quot;</span>
<span class="n">sequence_1</span> <span class="o">=</span> <span class="s2">&quot;Apples are especially bad for your health&quot;</span>
<span class="n">sequence_2</span> <span class="o">=</span> <span class="s2">&quot;HuggingFace&#39;s headquarters are situated in Manhattan&quot;</span>

<span class="n">paraphrase</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">sequence_0</span><span class="p">,</span> <span class="n">sequence_2</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;tf&quot;</span><span class="p">)</span>
<span class="n">not_paraphrase</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">sequence_0</span><span class="p">,</span> <span class="n">sequence_1</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;tf&quot;</span><span class="p">)</span>

<span class="n">paraphrase_classification_logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">paraphrase</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">not_paraphrase_classification_logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">not_paraphrase</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">paraphrase_results</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">paraphrase_classification_logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">not_paraphrase_results</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">not_paraphrase_classification_logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Should be paraphrase&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">paraphrase_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Should not be paraphrase&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">not_paraphrase_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This outputs the following results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Should</span> <span class="n">be</span> <span class="n">paraphrase</span>
<span class="ow">not</span> <span class="n">paraphrase</span><span class="p">:</span> <span class="mi">10</span><span class="o">%</span>
<span class="ow">is</span> <span class="n">paraphrase</span><span class="p">:</span> <span class="mi">90</span><span class="o">%</span>

<span class="n">Should</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">paraphrase</span>
<span class="ow">not</span> <span class="n">paraphrase</span><span class="p">:</span> <span class="mi">94</span><span class="o">%</span>
<span class="ow">is</span> <span class="n">paraphrase</span><span class="p">:</span> <span class="mi">6</span><span class="o">%</span>
</pre></div>
</div>
</div>
<div class="section" id="extractive-question-answering">
<h2>Extractive Question Answering<a class="headerlink" href="#extractive-question-answering" title="Permalink to this headline">¬∂</a></h2>
<p>Extractive Question Answering is the task of extracting an answer from a text given a question. An example of a
question answering dataset is the SQuAD dataset, which is entirely based on that task. If you would like to fine-tune
a model on a SQuAD task, you may leverage the <cite>run_squad.py</cite>.</p>
<p>Here is an example using the pipelines do to question answering: extracting an answer from a text given a question.
It leverages a fine-tuned model on SQuAD.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;question-answering&quot;</span><span class="p">)</span>

<span class="n">context</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Extractive Question Answering is the task of extracting an answer from a text given a question. An example of a</span>
<span class="s2">question answering dataset is the SQuAD dataset, which is entirely based on that task. If you would like to fine-tune</span>
<span class="s2">a model on a SQuAD task, you may leverage the `run_squad.py`.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s2">&quot;What is extractive question answering?&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s2">&quot;What is a good example of a question answering dataset?&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">))</span>
</pre></div>
</div>
<p>This returns an answer extracted from the text, a confidence score, alongside ‚Äústart‚Äù and ‚Äúend‚Äù values which
are the positions of the extracted answer in the text.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.622232091629833</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="s1">&#39;answer&#39;</span><span class="p">:</span> <span class="s1">&#39;the task of extracting an answer from a text given a question.&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.5115299158662765</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="mi">147</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="mi">161</span><span class="p">,</span> <span class="s1">&#39;answer&#39;</span><span class="p">:</span> <span class="s1">&#39;SQuAD dataset,&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Here is an example of question answering using a model and a tokenizer. The process is the following:</p>
<ul class="simple">
<li><p>Instantiate a tokenizer and a model from the checkpoint name. The model is identified as a BERT model and loads it
with the weights stored in the checkpoint.</p></li>
<li><p>Define a text and a few questions.</p></li>
<li><p>Iterate over the questions and build a sequence from the text and the current question, with the correct
model-specific separators token type ids and attention masks</p></li>
<li><p>Pass this sequence through the model. This outputs a range of scores across the entire sequence tokens (question and
text), for both the start and end positions.</p></li>
<li><p>Compute the softmax of the result to get probabilities over the tokens</p></li>
<li><p>Fetch the tokens from the identified start and stop values, convert those tokens to a string.</p></li>
<li><p>Print the results</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## PYTORCH CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">AutoModelForQuestionAnswering</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-large-uncased-whole-word-masking-finetuned-squad&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForQuestionAnswering</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-large-uncased-whole-word-masking-finetuned-squad&quot;</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">ü§ó Transformers (formerly known as pytorch-transformers and pytorch-pretrained-bert) provides general-purpose</span>
<span class="s2">architectures (BERT, GPT-2, RoBERTa, XLM, DistilBert, XLNet‚Ä¶) for Natural Language Understanding (NLU) and Natural</span>
<span class="s2">Language Generation (NLG) with over 32+ pretrained models in 100+ languages and deep interoperability between</span>
<span class="s2">TensorFlow 2.0 and PyTorch.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;How many pretrained models are available in Transformers?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What does Transformers provide?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Transformers provides interoperability between which frameworks?&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">:</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">add_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">text_tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span><span class="n">input_ids</span><span class="p">)</span>
    <span class="n">answer_start_scores</span><span class="p">,</span> <span class="n">answer_end_scores</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

    <span class="n">answer_start</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span>
        <span class="n">answer_start_scores</span>
    <span class="p">)</span>  <span class="c1"># Get the most likely beginning of answer with the argmax of the score</span>
    <span class="n">answer_end</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">answer_end_scores</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Get the most likely end of answer with the argmax of the score</span>

    <span class="n">answer</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">convert_tokens_to_string</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span><span class="n">input_ids</span><span class="p">[</span><span class="n">answer_start</span><span class="p">:</span><span class="n">answer_end</span><span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Question: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Answer: </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1">## TENSORFLOW CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">TFAutoModelForQuestionAnswering</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-large-uncased-whole-word-masking-finetuned-squad&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TFAutoModelForQuestionAnswering</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-large-uncased-whole-word-masking-finetuned-squad&quot;</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">ü§ó Transformers (formerly known as pytorch-transformers and pytorch-pretrained-bert) provides general-purpose</span>
<span class="s2">architectures (BERT, GPT-2, RoBERTa, XLM, DistilBert, XLNet‚Ä¶) for Natural Language Understanding (NLU) and Natural</span>
<span class="s2">Language Generation (NLG) with over 32+ pretrained models in 100+ languages and deep interoperability between</span>
<span class="s2">TensorFlow 2.0 and PyTorch.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;How many pretrained models are available in Transformers?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What does Transformers provide?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Transformers provides interoperability between which frameworks?&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">:</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">add_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;tf&quot;</span><span class="p">)</span>
    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">text_tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span><span class="n">input_ids</span><span class="p">)</span>
    <span class="n">answer_start_scores</span><span class="p">,</span> <span class="n">answer_end_scores</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="n">answer_start</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span>
        <span class="n">answer_start_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the most likely beginning of answer with the argmax of the score</span>
    <span class="n">answer_end</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">answer_end_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the most likely end of answer with the argmax of the score</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">convert_tokens_to_string</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span><span class="n">input_ids</span><span class="p">[</span><span class="n">answer_start</span><span class="p">:</span><span class="n">answer_end</span><span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Question: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Answer: </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This outputs the questions followed by the predicted answers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Question: How many pretrained models are available in Transformers?
Answer: over 32 +

Question: What does Transformers provide?
Answer: general - purpose architectures

Question: Transformers provides interoperability between which frameworks?
Answer: tensorflow 2 . 0 and pytorch
</pre></div>
</div>
</div>
<div class="section" id="language-modeling">
<h2>Language Modeling<a class="headerlink" href="#language-modeling" title="Permalink to this headline">¬∂</a></h2>
<p>Language modeling is the task of fitting a model to a corpus, which can be domain specific. All popular transformer
based models are trained using a variant of language modeling, e.g. BERT with masked language modeling, GPT-2 with
causal language modeling.</p>
<p>Language modeling can be useful outside of pre-training as well, for example to shift the model distribution to be
domain-specific: using a language model trained over a very large corpus, and then fine-tuning it to a news dataset
or on scientific papers e.g. <a class="reference external" href="https://huggingface.co/lysandre/arxiv-nlp">LysandreJik/arxiv-nlp</a>.</p>
<div class="section" id="masked-language-modeling">
<h3>Masked Language Modeling<a class="headerlink" href="#masked-language-modeling" title="Permalink to this headline">¬∂</a></h3>
<p>Masked language modeling is the task of masking tokens in a sequence with a masking token, and prompting the model to
fill that mask with an appropriate token. This allows the model to attend to both the right context (tokens on the
right of the mask) and the left context (tokens on the left of the mask). Such a training creates a strong basis
for downstream tasks requiring bi-directional context such as SQuAD (question answering,
see <a class="reference external" href="https://arxiv.org/abs/1910.13461">Lewis, Lui, Goyal et al.</a>, part 4.2).</p>
<p>Here is an example of using pipelines to replace a mask from a sequence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;fill-mask&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HuggingFace is creating a </span><span class="si">{</span><span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token</span><span class="si">}</span><span class="s2"> that the community uses to solve NLP tasks.&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This outputs the sequences with the mask filled, the confidence score as well as the token id in the tokenizer
vocabulary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;s&gt; HuggingFace is creating a tool that the community uses to solve NLP tasks.&lt;/s&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.15627853572368622</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="mi">3944</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;s&gt; HuggingFace is creating a framework that the community uses to solve NLP tasks.&lt;/s&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.11690319329500198</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="mi">7208</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;s&gt; HuggingFace is creating a library that the community uses to solve NLP tasks.&lt;/s&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.058063216507434845</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="mi">5560</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;s&gt; HuggingFace is creating a database that the community uses to solve NLP tasks.&lt;/s&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.04211743175983429</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="mi">8503</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;s&gt; HuggingFace is creating a prototype that the community uses to solve NLP tasks.&lt;/s&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.024718601256608963</span><span class="p">,</span> <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="mi">17715</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Here is an example doing masked language modeling using a model and a tokenizer. The process is the following:</p>
<ul class="simple">
<li><p>Instantiate a tokenizer and a model from the checkpoint name. The model is identified as a DistilBERT model and
loads it with the weights stored in the checkpoint.</p></li>
<li><p>Define a sequence with a masked token, placing the <code class="xref py py-obj docutils literal notranslate"><span class="pre">tokenizer.mask_token</span></code> instead of a word.</p></li>
<li><p>Encode that sequence into IDs and find the position of the masked token in that list of IDs.</p></li>
<li><p>Retrieve the predictions at the index of the mask token: this tensor has the same size as the vocabulary, and the
values are the scores attributed to each token. The model gives higher score to tokens he deems probable in that
context.</p></li>
<li><p>Retrieve the top 5 tokens using the PyTorch <code class="xref py py-obj docutils literal notranslate"><span class="pre">topk</span></code> or TensorFlow <code class="xref py py-obj docutils literal notranslate"><span class="pre">top_k</span></code> methods.</p></li>
<li><p>Replace the mask token by the tokens and print the results</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## PYTORCH CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModelWithLMHead</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;distilbert-base-cased&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelWithLMHead</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;distilbert-base-cased&quot;</span><span class="p">)</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Distilled models are smaller than the models they mimic. Using them instead of the large versions would help </span><span class="si">{</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token</span><span class="si">}</span><span class="s2"> our carbon footprint.&quot;</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
<span class="n">mask_token_index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">input</span> <span class="o">==</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token_id</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">token_logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mask_token_logits</span> <span class="o">=</span> <span class="n">token_logits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask_token_index</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">top_5_tokens</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">mask_token_logits</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">top_5_tokens</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">([</span><span class="n">token</span><span class="p">])))</span>
<span class="c1">## TENSORFLOW CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">TFAutoModelWithLMHead</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;distilbert-base-cased&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TFAutoModelWithLMHead</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;distilbert-base-cased&quot;</span><span class="p">)</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Distilled models are smaller than the models they mimic. Using them instead of the large versions would help </span><span class="si">{</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token</span><span class="si">}</span><span class="s2"> our carbon footprint.&quot;</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;tf&quot;</span><span class="p">)</span>
<span class="n">mask_token_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">input</span> <span class="o">==</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">token_logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mask_token_logits</span> <span class="o">=</span> <span class="n">token_logits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask_token_index</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">top_5_tokens</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">top_k</span><span class="p">(</span><span class="n">mask_token_logits</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">top_5_tokens</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sequence</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">mask_token</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">([</span><span class="n">token</span><span class="p">])))</span>
</pre></div>
</div>
<p>This prints five sequences, with the top 5 tokens predicted by the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Distilled</span> <span class="n">models</span> <span class="n">are</span> <span class="n">smaller</span> <span class="n">than</span> <span class="n">the</span> <span class="n">models</span> <span class="n">they</span> <span class="n">mimic</span><span class="o">.</span> <span class="n">Using</span> <span class="n">them</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">large</span> <span class="n">versions</span> <span class="n">would</span> <span class="n">help</span> <span class="n">reduce</span> <span class="n">our</span> <span class="n">carbon</span> <span class="n">footprint</span><span class="o">.</span>
<span class="n">Distilled</span> <span class="n">models</span> <span class="n">are</span> <span class="n">smaller</span> <span class="n">than</span> <span class="n">the</span> <span class="n">models</span> <span class="n">they</span> <span class="n">mimic</span><span class="o">.</span> <span class="n">Using</span> <span class="n">them</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">large</span> <span class="n">versions</span> <span class="n">would</span> <span class="n">help</span> <span class="n">increase</span> <span class="n">our</span> <span class="n">carbon</span> <span class="n">footprint</span><span class="o">.</span>
<span class="n">Distilled</span> <span class="n">models</span> <span class="n">are</span> <span class="n">smaller</span> <span class="n">than</span> <span class="n">the</span> <span class="n">models</span> <span class="n">they</span> <span class="n">mimic</span><span class="o">.</span> <span class="n">Using</span> <span class="n">them</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">large</span> <span class="n">versions</span> <span class="n">would</span> <span class="n">help</span> <span class="n">decrease</span> <span class="n">our</span> <span class="n">carbon</span> <span class="n">footprint</span><span class="o">.</span>
<span class="n">Distilled</span> <span class="n">models</span> <span class="n">are</span> <span class="n">smaller</span> <span class="n">than</span> <span class="n">the</span> <span class="n">models</span> <span class="n">they</span> <span class="n">mimic</span><span class="o">.</span> <span class="n">Using</span> <span class="n">them</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">large</span> <span class="n">versions</span> <span class="n">would</span> <span class="n">help</span> <span class="n">offset</span> <span class="n">our</span> <span class="n">carbon</span> <span class="n">footprint</span><span class="o">.</span>
<span class="n">Distilled</span> <span class="n">models</span> <span class="n">are</span> <span class="n">smaller</span> <span class="n">than</span> <span class="n">the</span> <span class="n">models</span> <span class="n">they</span> <span class="n">mimic</span><span class="o">.</span> <span class="n">Using</span> <span class="n">them</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">large</span> <span class="n">versions</span> <span class="n">would</span> <span class="n">help</span> <span class="n">improve</span> <span class="n">our</span> <span class="n">carbon</span> <span class="n">footprint</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="causal-language-modeling">
<h3>Causal Language Modeling<a class="headerlink" href="#causal-language-modeling" title="Permalink to this headline">¬∂</a></h3>
<p>Causal language modeling is the task of predicting the token following a sequence of tokens. In this situation, the
model only attends to the left context (tokens on the left of the mask). Such a training is particularly interesting
for generation tasks.</p>
<p>There is currently no pipeline to do causal language modeling/generation.</p>
<p>Here is an example using the tokenizer and model. leveraging the <a class="reference internal" href="main_classes/model.html#transformers.PreTrainedModel.generate" title="transformers.PreTrainedModel.generate"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate()</span></code></a> method
to generate the tokens following the initial sequence in PyTorch, and creating a simple loop in TensorFlow.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## PYTORCH CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModelWithLMHead</span><span class="p">,</span> <span class="n">AutoTokenizer</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;gpt2&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelWithLMHead</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;gpt2&quot;</span><span class="p">)</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Hugging Face is based in DUMBO, New York City, and is&quot;</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
<span class="n">generated</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">resulting_string</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">generated</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resulting_string</span><span class="p">)</span>
<span class="c1">## TENSORFLOW CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">TFAutoModelWithLMHead</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;gpt2&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TFAutoModelWithLMHead</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;gpt2&quot;</span><span class="p">)</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Hugging Face is based in DUMBO, New York City, and is&quot;</span>
<span class="n">generated</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="n">generated</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">generated</span> <span class="o">+=</span> <span class="p">[</span><span class="n">token</span><span class="p">]</span>

<span class="n">resulting_string</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">generated</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resulting_string</span><span class="p">)</span>
</pre></div>
</div>
<p>This outputs a (hopefully) coherent string from the original sequence, as the
<a class="reference internal" href="main_classes/model.html#transformers.PreTrainedModel.generate" title="transformers.PreTrainedModel.generate"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate()</span></code></a> samples from a top_p/tok_k distribution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Hugging Face is based in DUMBO, New York City, and is a live-action TV series based on the novel by John
Carpenter, and its producers, David Kustlin and Steve Pichar. The film is directed by!
</pre></div>
</div>
</div>
</div>
<div class="section" id="named-entity-recognition">
<h2>Named Entity Recognition<a class="headerlink" href="#named-entity-recognition" title="Permalink to this headline">¬∂</a></h2>
<p>Named Entity Recognition (NER) is the task of classifying tokens according to a class, for example identifying a
token as a person, an organisation or a location.
An example of a named entity recognition dataset is the CoNLL-2003 dataset, which is entirely based on that task.
If you would like to fine-tune a model on an NER task, you may leverage the <cite>ner/run_ner.py</cite> (PyTorch),
<cite>ner/run_pl_ner.py</cite> (leveraging pytorch-lightning) or the <cite>ner/run_tf_ner.py</cite> (TensorFlow) scripts.</p>
<p>Here is an example using the pipelines do to named entity recognition, trying to identify tokens as belonging to one
of 9 classes:</p>
<ul class="simple">
<li><p>O, Outside of a named entity</p></li>
<li><p>B-MIS, Beginning of a miscellaneous entity right after another miscellaneous entity</p></li>
<li><p>I-MIS, Miscellaneous entity</p></li>
<li><p>B-PER, Beginning of a person‚Äôs name right after another person‚Äôs name</p></li>
<li><p>I-PER, Person‚Äôs name</p></li>
<li><p>B-ORG, Beginning of an organisation right after another organisation</p></li>
<li><p>I-ORG, Organisation</p></li>
<li><p>B-LOC, Beginning of a location right after another location</p></li>
<li><p>I-LOC, Location</p></li>
</ul>
<p>It leverages a fine-tuned model on CoNLL-2003, fine-tuned by <a class="reference external" href="https://github.com/stefan-it">&#64;stefan-it</a> from
<a class="reference external" href="https://github.com/dbmdz">dbmdz</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="s2">&quot;ner&quot;</span><span class="p">)</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;Hugging Face Inc. is a company based in New York City. Its headquarters are in DUMBO, therefore very&quot;</span> \
           <span class="s2">&quot;close to the Manhattan Bridge which is visible from the window.&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nlp</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span>
</pre></div>
</div>
<p>This outputs a list of all words that have been identified as an entity from the 9 classes defined above. Here is the
expected results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;Hu&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9995632767677307</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;##gging&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9915938973426819</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;Face&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9982671737670898</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;Inc&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9994403719902039</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;New&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9994346499443054</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;York&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9993270635604858</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9993864893913269</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9825621843338013</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;##UM&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.936983048915863</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;##BO&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.8987102508544922</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;Manhattan&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.9758241176605225</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="s1">&#39;Bridge&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">0.990249514579773</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Note how the words ‚ÄúHugging Face‚Äù have been identified as an organisation, and ‚ÄúNew York City‚Äù, ‚ÄúDUMBO‚Äù and
‚ÄúManhattan Bridge‚Äù have been identified as locations.</p>
<p>Here is an example doing named entity recognition using a model and a tokenizer. The process is the following:</p>
<ul class="simple">
<li><p>Instantiate a tokenizer and a model from the checkpoint name. The model is identified as a BERT model and
loads it with the weights stored in the checkpoint.</p></li>
<li><p>Define the label list with which the model was trained on.</p></li>
<li><p>Define a sequence with known entities, such as ‚ÄúHugging Face‚Äù as an organisation and ‚ÄúNew York City‚Äù as a location.</p></li>
<li><p>Split words into tokens so that they can be mapped to the predictions. We use a small hack by firstly completely
encoding and decoding the sequence, so that we‚Äôre left with a string that contains the special tokens.</p></li>
<li><p>Encode that sequence into IDs (special tokens are added automatically).</p></li>
<li><p>Retrieve the predictions by passing the input to the model and getting the first output. This results in a
distribution over the 9 possible classes for each token. We take the argmax to retrieve the most likely class
for each token.</p></li>
<li><p>Zip together each token with its prediction and print it.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## PYTORCH CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModelForTokenClassification</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForTokenClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;dbmdz/bert-large-cased-finetuned-conll03-english&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased&quot;</span><span class="p">)</span>

<span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;O&quot;</span><span class="p">,</span>       <span class="c1"># Outside of a named entity</span>
    <span class="s2">&quot;B-MISC&quot;</span><span class="p">,</span>  <span class="c1"># Beginning of a miscellaneous entity right after another miscellaneous entity</span>
    <span class="s2">&quot;I-MISC&quot;</span><span class="p">,</span>  <span class="c1"># Miscellaneous entity</span>
    <span class="s2">&quot;B-PER&quot;</span><span class="p">,</span>   <span class="c1"># Beginning of a person&#39;s name right after another person&#39;s name</span>
    <span class="s2">&quot;I-PER&quot;</span><span class="p">,</span>   <span class="c1"># Person&#39;s name</span>
    <span class="s2">&quot;B-ORG&quot;</span><span class="p">,</span>   <span class="c1"># Beginning of an organisation right after another organisation</span>
    <span class="s2">&quot;I-ORG&quot;</span><span class="p">,</span>   <span class="c1"># Organisation</span>
    <span class="s2">&quot;B-LOC&quot;</span><span class="p">,</span>   <span class="c1"># Beginning of a location right after another location</span>
    <span class="s2">&quot;I-LOC&quot;</span>    <span class="c1"># Location</span>
<span class="p">]</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;Hugging Face Inc. is a company based in New York City. Its headquarters are in DUMBO, therefore very&quot;</span> \
           <span class="s2">&quot;close to the Manhattan Bridge.&quot;</span>

<span class="c1"># Bit of a hack to get the tokens with the special tokens</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">)))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">([(</span><span class="n">token</span><span class="p">,</span> <span class="n">label_list</span><span class="p">[</span><span class="n">prediction</span><span class="p">])</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())])</span>
<span class="c1">## TENSORFLOW CODE</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">TFAutoModelForTokenClassification</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">TFAutoModelForTokenClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;dbmdz/bert-large-cased-finetuned-conll03-english&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;bert-base-cased&quot;</span><span class="p">)</span>

<span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;O&quot;</span><span class="p">,</span>       <span class="c1"># Outside of a named entity</span>
    <span class="s2">&quot;B-MISC&quot;</span><span class="p">,</span>  <span class="c1"># Beginning of a miscellaneous entity right after another miscellaneous entity</span>
    <span class="s2">&quot;I-MISC&quot;</span><span class="p">,</span>  <span class="c1"># Miscellaneous entity</span>
    <span class="s2">&quot;B-PER&quot;</span><span class="p">,</span>   <span class="c1"># Beginning of a person&#39;s name right after another person&#39;s name</span>
    <span class="s2">&quot;I-PER&quot;</span><span class="p">,</span>   <span class="c1"># Person&#39;s name</span>
    <span class="s2">&quot;B-ORG&quot;</span><span class="p">,</span>   <span class="c1"># Beginning of an organisation right after another organisation</span>
    <span class="s2">&quot;I-ORG&quot;</span><span class="p">,</span>   <span class="c1"># Organisation</span>
    <span class="s2">&quot;B-LOC&quot;</span><span class="p">,</span>   <span class="c1"># Beginning of a location right after another location</span>
    <span class="s2">&quot;I-LOC&quot;</span>    <span class="c1"># Location</span>
<span class="p">]</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;Hugging Face Inc. is a company based in New York City. Its headquarters are in DUMBO, therefore very&quot;</span> \
           <span class="s2">&quot;close to the Manhattan Bridge.&quot;</span>

<span class="c1"># Bit of a hack to get the tokens with the special tokens</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">)))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;tf&quot;</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">([(</span><span class="n">token</span><span class="p">,</span> <span class="n">label_list</span><span class="p">[</span><span class="n">prediction</span><span class="p">])</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())])</span>
</pre></div>
</div>
<p>This outputs a list of each token mapped to their prediction. Differently from the pipeline, here every token has
a prediction as we didn‚Äôt remove the ‚Äú0‚Äù class which means that no particular entity was found on that token. The
following array should be the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;[CLS]&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Hu&#39;</span><span class="p">,</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;##gging&#39;</span><span class="p">,</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Face&#39;</span><span class="p">,</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Inc&#39;</span><span class="p">,</span> <span class="s1">&#39;I-ORG&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;company&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;based&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;New&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;York&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Its&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;headquarters&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;are&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;##UM&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;##BO&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;therefore&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;very&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;##c&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;##lose&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Manhattan&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Bridge&#39;</span><span class="p">,</span> <span class="s1">&#39;I-LOC&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;[SEP]&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="model_sharing.html" class="btn btn-neutral float-right" title="Model upload and sharing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pretrained_models.html" class="btn btn-neutral float-left" title="Pretrained models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, huggingface

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-83738774-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>