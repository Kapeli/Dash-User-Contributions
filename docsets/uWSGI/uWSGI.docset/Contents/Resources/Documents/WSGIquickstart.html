
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Quickstart for Python/WSGI applications &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Quickstart for perl/PSGI applications" href="PSGIquickstart.html" />
    <link rel="prev" title="The uWSGI project" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="PSGIquickstart.html" title="Quickstart for perl/PSGI applications"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The uWSGI project"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="quickstart-for-python-wsgi-applications">
<h1>Quickstart for Python/WSGI applications<a class="headerlink" href="#quickstart-for-python-wsgi-applications" title="Permalink to this headline">¶</a></h1>
<p>This quickstart will show you how to deploy simple WSGI applications and common web frameworks.</p>
<p>Python here is meant as CPython, for PyPy you need to use the specific plugin: <a class="reference internal" href="PyPy.html"><span class="doc">The PyPy plugin</span></a>, Jython support is under construction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need at least uWSGI 1.4 to follow the quickstart. Anything older is no longer maintained and is highly buggy!</p>
</div>
<div class="section" id="installing-uwsgi-with-python-support">
<h2>Installing uWSGI with Python support<a class="headerlink" href="#installing-uwsgi-with-python-support" title="Permalink to this headline">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you start learning uWSGI, try to build from official sources: using distribution-supplied packages may bring you
plenty of headaches. When things are clear, you can use modular builds (like the ones available in your distribution).</p>
</div>
<p>uWSGI is a (big) C application, so you need a C compiler (like gcc or clang) and the Python development headers.</p>
<p>On a Debian-based distro an</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>apt-get install build-essential python-dev
</pre></div>
</div>
<p>will be enough.</p>
<p>You have various ways to install uWSGI for Python:</p>
<ul>
<li><p>via pip</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install uwsgi
</pre></div>
</div>
</li>
<li><p>using the network installer</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl http://uwsgi.it/install <span class="p">|</span> bash -s default /tmp/uwsgi
</pre></div>
</div>
<p>(this will install the uWSGI binary into <code class="docutils literal notranslate"><span class="pre">/tmp/uwsgi</span></code>, feel free to change it).</p>
</li>
<li><p>via downloading a source tarball and “making” it</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>wget https://projects.unbit.it/downloads/uwsgi-latest.tar.gz
tar zxvf uwsgi-latest.tar.gz
<span class="nb">cd</span> &lt;dir&gt;
make
</pre></div>
</div>
<p>(after the build you will have a <code class="docutils literal notranslate"><span class="pre">uwsgi</span></code> binary in the current directory).</p>
</li>
</ul>
<p>Installing via your package distribution is not covered (would be impossible to make everyone happy), but all of the general rules apply.</p>
<p>One thing you may want to take into account when testing this quickstart with distro-supplied packages, is that very probably your distribution
has built uWSGI in modular way (every feature is a different plugin that must be loaded). To complete this quickstart,
you have to prepend <code class="docutils literal notranslate"><span class="pre">--plugin</span> <span class="pre">python,http</span></code> to the first series of examples, and <code class="docutils literal notranslate"><span class="pre">--plugin</span> <span class="pre">python</span></code> when the HTTP router is removed (if this
doesn’t make sense to you, just continue reading).</p>
</div>
<div class="section" id="the-first-wsgi-application">
<h2>The first WSGI application<a class="headerlink" href="#the-first-wsgi-application" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with a simple “Hello World” example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="s1">&#39;text/html&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Hello World&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>(save it as <code class="docutils literal notranslate"><span class="pre">foobar.py</span></code>).</p>
<p>As you can see, it is composed of a single Python function. It is called “application” as this is the default function
that the uWSGI Python loader will search for (but you can obviously customize it).</p>
</div>
<div class="section" id="deploy-it-on-http-port-9090">
<h2>Deploy it on HTTP port 9090<a class="headerlink" href="#deploy-it-on-http-port-9090" title="Permalink to this headline">¶</a></h2>
<p>Now start uWSGI to run an HTTP server/router passing requests to your WSGI application:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http :9090 --wsgi-file foobar.py
</pre></div>
</div>
<p>That’s all.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not use <code class="docutils literal notranslate"><span class="pre">--http</span></code> when you have a frontend webserver or you are doing some form of benchmark, use <code class="docutils literal notranslate"><span class="pre">--http-socket</span></code>. Continue reading the quickstart to understand why.</p>
</div>
</div>
<div class="section" id="adding-concurrency-and-monitoring">
<h2>Adding concurrency and monitoring<a class="headerlink" href="#adding-concurrency-and-monitoring" title="Permalink to this headline">¶</a></h2>
<p>The first tuning you would like to make is adding concurrency (by default uWSGI starts with a single process and a single thread).</p>
<p>You can add more processes with the <code class="docutils literal notranslate"><span class="pre">--processes</span></code> option or more threads with the <code class="docutils literal notranslate"><span class="pre">--threads</span></code> option (or you can have both).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http :9090 --wsgi-file foobar.py --master --processes <span class="m">4</span> --threads <span class="m">2</span>
</pre></div>
</div>
<p>This will spawn 4 processes (each with 2 threads), a master process (will respawn your processes when they die) and the HTTP router (seen before).</p>
<p>One important task is monitoring. Understanding what is going on is vital in production deployment. The stats subsystem allows
you to export uWSGI’s internal statistics as JSON:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http :9090 --wsgi-file foobar.py --master --processes <span class="m">4</span> --threads <span class="m">2</span> --stats <span class="m">127</span>.0.0.1:9191
</pre></div>
</div>
<p>Make some request to your app and then telnet to the port 9191, you’ll get lots of fun information. You may want to use
“uwsgitop” (just <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> it), which is a top-like tool for monitoring instances.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Bind the stats socket to a private address (unless you know what you are doing), otherwise everyone could access it!</p>
</div>
</div>
<div class="section" id="putting-behind-a-full-webserver">
<h2>Putting behind a full webserver<a class="headerlink" href="#putting-behind-a-full-webserver" title="Permalink to this headline">¶</a></h2>
<p>Even though uWSGI HTTP router is solid and high-performance, you may want to put your application behind a fully-capable webserver.</p>
<p>uWSGI natively speaks HTTP, FastCGI, SCGI and its specific protocol named “uwsgi” (yes, wrong naming choice).
The best performing protocol is obviously uwsgi, already supported by nginx and Cherokee (while various Apache modules are available).</p>
<p>A common nginx config is the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
    <span class="n">include</span> <span class="n">uwsgi_params</span><span class="p">;</span>
    <span class="n">uwsgi_pass</span> <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">3031</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This means “pass every request to the server bound to port 3031 speaking the uwsgi protocol”.</p>
<p>Now we can spawn uWSGI to natively speak the uwsgi protocol:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket <span class="m">127</span>.0.0.1:3031 --wsgi-file foobar.py --master --processes <span class="m">4</span> --threads <span class="m">2</span> --stats <span class="m">127</span>.0.0.1:9191
</pre></div>
</div>
<p>If you’ll run <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">aux</span></code>, you will see one process less. The HTTP router has been removed as our “workers” (the processes assigned to uWSGI)
natively speak the uwsgi protocol.</p>
<p>If your proxy/webserver/router speaks HTTP, you have to tell uWSGI to natively speak the http protocol (this is different from –http that will spawn a proxy by itself):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http-socket <span class="m">127</span>.0.0.1:3031 --wsgi-file foobar.py --master --processes <span class="m">4</span> --threads <span class="m">2</span> --stats <span class="m">127</span>.0.0.1:9191
</pre></div>
</div>
</div>
<div class="section" id="automatically-starting-uwsgi-on-boot">
<h2>Automatically starting uWSGI on boot<a class="headerlink" href="#automatically-starting-uwsgi-on-boot" title="Permalink to this headline">¶</a></h2>
<p>If you are thinking about firing up vi and writing an init.d script for spawning uWSGI, just sit (and calm) down and make sure your system doesn’t offer a better (more modern) approach first.</p>
<p>Each distribution has chosen a startup system (<a class="reference internal" href="Upstart.html"><span class="doc">Upstart</span></a>, <a class="reference internal" href="Systemd.html"><span class="doc">Systemd</span></a>…) and there are tons of process managers available (supervisord, god, monit, circus…).</p>
<p>uWSGI will integrate very well with all of them (we hope), but if you plan to deploy a big number of apps check the uWSGI <a class="reference internal" href="Emperor.html"><span class="doc">Emperor</span></a> - it is more or less the dream of every devops engineer.</p>
</div>
<div class="section" id="deploying-django">
<h2>Deploying Django<a class="headerlink" href="#deploying-django" title="Permalink to this headline">¶</a></h2>
<p>Django is very probably the most used Python web framework around. Deploying it is pretty easy (we continue our configuration with 4 processes with 2 threads each).</p>
<p>We suppose the Django project is in <code class="docutils literal notranslate"><span class="pre">/home/foobar/myproject</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket <span class="m">127</span>.0.0.1:3031 --chdir /home/foobar/myproject/ --wsgi-file myproject/wsgi.py --master --processes <span class="m">4</span> --threads <span class="m">2</span> --stats <span class="m">127</span>.0.0.1:9191
</pre></div>
</div>
<p>(with <code class="docutils literal notranslate"><span class="pre">--chdir</span></code> we move to a specific directory). In Django this is required to correctly load modules.</p>
<p>Argh! What the hell is this?! Yes, you’re right, you’re right… dealing with such long command lines is unpractical, foolish and error-prone.
Never fear! uWSGI supports various configuration styles. In this quickstart we will use .ini files.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">127.0.0.1:3031</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">/home/foobar/myproject/</span>
<span class="na">wsgi-file</span> <span class="o">=</span> <span class="s">myproject/wsgi.py</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">4</span>
<span class="na">threads</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">127.0.0.1:9191</span>
</pre></div>
</div>
<p>A lot better!</p>
<p>Just run it:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi yourfile.ini
</pre></div>
</div>
<p>If the file <code class="docutils literal notranslate"><span class="pre">/home/foobar/myproject/myproject/wsgi.py</span></code> (or whatever you have called your project) does not exist, you are very probably
using an old (&lt; 1.4) version of Django. In such a case you need a little bit more configuration:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket <span class="m">127</span>.0.0.1:3031 --chdir /home/foobar/myproject/ --pythonpath .. --env <span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span>myproject.settings --module <span class="s2">&quot;django.core.handlers.wsgi:WSGIHandler()&quot;</span> --processes <span class="m">4</span> --threads <span class="m">2</span> --stats <span class="m">127</span>.0.0.1:9191
</pre></div>
</div>
<p>Or, using the .ini file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">127.0.0.1:3031</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">/home/foobar/myproject/</span>
<span class="na">pythonpath</span> <span class="o">=</span> <span class="s">..</span>
<span class="na">env</span> <span class="o">=</span> <span class="s">DJANGO_SETTINGS_MODULE=myproject.settings</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">django.core.handlers.wsgi:WSGIHandler()</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">4</span>
<span class="na">threads</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">127.0.0.1:9191</span>
</pre></div>
</div>
<p>Older (&lt; 1.4) Django releases need to set <code class="docutils literal notranslate"><span class="pre">env</span></code>, <code class="docutils literal notranslate"><span class="pre">module</span></code> and the <code class="docutils literal notranslate"><span class="pre">pythonpath</span></code> (<code class="docutils literal notranslate"><span class="pre">..</span></code> allow us to reach
the <code class="docutils literal notranslate"><span class="pre">myproject.settings</span></code> module).</p>
</div>
<div class="section" id="deploying-flask">
<h2>Deploying Flask<a class="headerlink" href="#deploying-flask" title="Permalink to this headline">¶</a></h2>
<p>Flask is a popular Python web microframework.</p>
<p>Save the following example as <code class="docutils literal notranslate"><span class="pre">myflaskapp.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;span style=&#39;color:red&#39;&gt;I am app 1&lt;/span&gt;&quot;</span>
</pre></div>
</div>
<p>Flask exports its WSGI function (the one we called “application” at the beginning of this quickstart) as “app”, so we need to instruct uWSGI to use it.
We still continue to use the 4 processes/2 threads and the uwsgi socket as the base:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket <span class="m">127</span>.0.0.1:3031 --wsgi-file myflaskapp.py --callable app --processes <span class="m">4</span> --threads <span class="m">2</span> --stats <span class="m">127</span>.0.0.1:9191
</pre></div>
</div>
<p>(the only addition is the <code class="docutils literal notranslate"><span class="pre">--callable</span></code> option).</p>
</div>
<div class="section" id="deploying-web2py">
<h2>Deploying web2py<a class="headerlink" href="#deploying-web2py" title="Permalink to this headline">¶</a></h2>
<p>Again a popular choice. Unzip the web2py source distribution on a directory of choice and write a uWSGI config file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">http</span> <span class="o">=</span> <span class="s">:9090</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">path_to_web2py</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">wsgihandler</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On recent web2py releases you may need to copy the <code class="docutils literal notranslate"><span class="pre">wsgihandler.py</span></code> script out of the <code class="docutils literal notranslate"><span class="pre">handlers</span></code> directory.</p>
</div>
<p>We used the HTTP router again. Just go to port 9090 with your browser and you will see the web2py welcome page.</p>
<p>Click on the administrative interface and… oops, it does not work as it requires HTTPS. Do not worry, the uWSGI router
is HTTPS-capable (be sure you have OpenSSL development headers: install them and rebuild uWSGI, the build system
will automatically detect it).</p>
<p>First of all generate your key and certificate:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>openssl genrsa -out foobar.key <span class="m">2048</span>
openssl req -new -key foobar.key -out foobar.csr
openssl x509 -req -days <span class="m">365</span> -in foobar.csr -signkey foobar.key -out foobar.crt
</pre></div>
</div>
<p>Now you have 2 files (well 3, counting the <code class="docutils literal notranslate"><span class="pre">foobar.csr</span></code>), <code class="docutils literal notranslate"><span class="pre">foobar.key</span></code> and <code class="docutils literal notranslate"><span class="pre">foobar.crt</span></code>. Change the uWSGI config:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">:9090,foobar.crt,foobar.key</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">path_to_web2py</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">wsgihandler</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">8</span>
</pre></div>
</div>
<p>Re-run uWSGI and connect to port 9090 using <code class="docutils literal notranslate"><span class="pre">https://</span></code> with your browser.</p>
</div>
<div class="section" id="a-note-on-python-threads">
<h2>A note on Python threads<a class="headerlink" href="#a-note-on-python-threads" title="Permalink to this headline">¶</a></h2>
<p>If you start uWSGI without threads, the Python GIL will not be enabled, so threads generated by your application
will never run. You may not like that choice, but remember that uWSGI is a language-independent server, so most of its choices
are for maintaining it “agnostic”.</p>
<p>But do not worry, there are basically no choices made by the uWSGI developers that cannot be changed with an option.</p>
<p>If you want to maintain Python threads support without starting multiple threads for your application, just add
the <code class="docutils literal notranslate"><span class="pre">--enable-threads</span></code> option (or <code class="docutils literal notranslate"><span class="pre">enable-threads</span> <span class="pre">=</span> <span class="pre">true</span></code> in ini style).</p>
</div>
<div class="section" id="virtualenvs">
<h2>Virtualenvs<a class="headerlink" href="#virtualenvs" title="Permalink to this headline">¶</a></h2>
<p>uWSGI can be configured to search for Python modules in a specific virtualenv.</p>
<p>Just add <code class="docutils literal notranslate"><span class="pre">virtualenv</span> <span class="pre">=</span> <span class="pre">&lt;path&gt;</span></code> to your options.</p>
</div>
<div class="section" id="security-and-availability">
<h2>Security and availability<a class="headerlink" href="#security-and-availability" title="Permalink to this headline">¶</a></h2>
<p><strong>Always</strong> avoid running your uWSGI instances as root. You can drop privileges using the <code class="docutils literal notranslate"><span class="pre">uid</span></code> and <code class="docutils literal notranslate"><span class="pre">gid</span></code> options:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">:9090,foobar.crt,foobar.key</span>
<span class="na">uid</span> <span class="o">=</span> <span class="s">foo</span>
<span class="na">gid</span> <span class="o">=</span> <span class="s">bar</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">path_to_web2py</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">wsgihandler</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">8</span>
</pre></div>
</div>
<p>If you need to bind to privileged ports (like 443 for HTTPS), use shared sockets. They are created before dropping
privileges and can be referenced with the <code class="docutils literal notranslate"><span class="pre">=N</span></code> syntax, where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the socket number (starting from 0):</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">shared-socket</span> <span class="o">=</span> <span class="s">:443</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">=0,foobar.crt,foobar.key</span>
<span class="na">uid</span> <span class="o">=</span> <span class="s">foo</span>
<span class="na">gid</span> <span class="o">=</span> <span class="s">bar</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">path_to_web2py</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">wsgihandler</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">8</span>
</pre></div>
</div>
<p>A common problem with webapp deployment is “stuck requests”. All of your threads/workers are stuck (blocked on request) and your app cannot accept more requests.
To avoid that problem you can set a <code class="docutils literal notranslate"><span class="pre">harakiri</span></code> timer. It is a monitor (managed by the master process) that will destroy processes stuck for more than the specified number of seconds (choose <code class="docutils literal notranslate"><span class="pre">harakiri</span></code> value carefully). For example, you may want to destroy workers blocked for more than 30 seconds:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">shared-socket</span> <span class="o">=</span> <span class="s">:443</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">=0,foobar.crt,foobar.key</span>
<span class="na">uid</span> <span class="o">=</span> <span class="s">foo</span>
<span class="na">gid</span> <span class="o">=</span> <span class="s">bar</span>
<span class="na">chdir</span> <span class="o">=</span> <span class="s">path_to_web2py</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">wsgihandler</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="na">harakiri</span> <span class="o">=</span> <span class="s">30</span>
</pre></div>
</div>
<p>In addition to this, since uWSGI 1.9, the stats server exports the whole set of request variables, so you can see (in realtime) what your instance is doing (for each worker, thread or async core).</p>
</div>
<div class="section" id="offloading">
<h2>Offloading<a class="headerlink" href="#offloading" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="OffloadSubsystem.html"><span class="doc">The uWSGI offloading subsystem</span></a> allows you to free your workers as soon as possible when some specific pattern matches and can be delegated
to a pure-c thread. Examples are sending static file from the file system, transferring data from the network to the client and so on.</p>
<p>Offloading is very complex, but its use is transparent to the end user. If you want to try just add <code class="docutils literal notranslate"><span class="pre">--offload-threads</span> <span class="pre">&lt;n&gt;</span></code> where &lt;n&gt; is the number of threads to spawn (1 per CPU is a good value to start with).</p>
<p>When offload threads are enabled, all of the parts that can be optimized will be automatically detected.</p>
</div>
<div class="section" id="bonus-multiple-python-versions-for-the-same-uwsgi-binary">
<h2>Bonus: multiple Python versions for the same uWSGI binary<a class="headerlink" href="#bonus-multiple-python-versions-for-the-same-uwsgi-binary" title="Permalink to this headline">¶</a></h2>
<p>As we have seen, uWSGI is composed of a small core and various plugins. Plugins can be embedded in the binary or loaded dynamically. When you build uWSGI for Python, a series of plugins plus the Python one are embedded in the final binary.</p>
<p>This could be a problem if you want to support multiple Python versions without building a binary for each one.</p>
<p>The best approach would be having a little binary with the language-independent features built in, and one plugin for each Python version that will be loaded on-demand.</p>
<p>In the uWSGI source directory:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make <span class="nv">PROFILE</span><span class="o">=</span>nolang
</pre></div>
</div>
<p>This will build a uwsgi binary with all the default plugins built-in except the Python one.</p>
<p>Now, from the same directory, we start building Python plugins:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">PYTHON</span><span class="o">=</span>python3.4 ./uwsgi --build-plugin <span class="s2">&quot;plugins/python python34&quot;</span>
<span class="nv">PYTHON</span><span class="o">=</span>python2.7 ./uwsgi --build-plugin <span class="s2">&quot;plugins/python python27&quot;</span>
<span class="nv">PYTHON</span><span class="o">=</span>python2.6 ./uwsgi --build-plugin <span class="s2">&quot;plugins/python python26&quot;</span>
</pre></div>
</div>
<p>You will end up with three files: <code class="docutils literal notranslate"><span class="pre">python34_plugin.so</span></code>, <code class="docutils literal notranslate"><span class="pre">python27_plugin.so</span></code>, <code class="docutils literal notranslate"><span class="pre">python26_plugin.so</span></code>. Copy these into your desired directory. (By default, uWSGI searches for plugins in the current working directory.)</p>
<p>Now in your configurations files you can simply add (at the very top) the <cite>plugins-dir</cite> and <cite>plugin</cite> directives.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">plugins-dir</span> <span class="o">=</span> <span class="s">&lt;path_to_your_plugin_directory&gt;</span>
<span class="na">plugin</span> <span class="o">=</span> <span class="s">python26</span>
</pre></div>
</div>
<p>This will load the <code class="docutils literal notranslate"><span class="pre">python26_plugin.so</span></code> plugin library from the directory into which you copied the plugins.</p>
</div>
<div class="section" id="and-now">
<h2>And now…<a class="headerlink" href="#and-now" title="Permalink to this headline">¶</a></h2>
<p>You should already be able to go into production with such few concepts, but uWSGI is an enormous project with hundreds of features
and configurations. If you want to be a better sysadmin, continue reading the full docs.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quickstart for Python/WSGI applications</a><ul>
<li><a class="reference internal" href="#installing-uwsgi-with-python-support">Installing uWSGI with Python support</a></li>
<li><a class="reference internal" href="#the-first-wsgi-application">The first WSGI application</a></li>
<li><a class="reference internal" href="#deploy-it-on-http-port-9090">Deploy it on HTTP port 9090</a></li>
<li><a class="reference internal" href="#adding-concurrency-and-monitoring">Adding concurrency and monitoring</a></li>
<li><a class="reference internal" href="#putting-behind-a-full-webserver">Putting behind a full webserver</a></li>
<li><a class="reference internal" href="#automatically-starting-uwsgi-on-boot">Automatically starting uWSGI on boot</a></li>
<li><a class="reference internal" href="#deploying-django">Deploying Django</a></li>
<li><a class="reference internal" href="#deploying-flask">Deploying Flask</a></li>
<li><a class="reference internal" href="#deploying-web2py">Deploying web2py</a></li>
<li><a class="reference internal" href="#a-note-on-python-threads">A note on Python threads</a></li>
<li><a class="reference internal" href="#virtualenvs">Virtualenvs</a></li>
<li><a class="reference internal" href="#security-and-availability">Security and availability</a></li>
<li><a class="reference internal" href="#offloading">Offloading</a></li>
<li><a class="reference internal" href="#bonus-multiple-python-versions-for-the-same-uwsgi-binary">Bonus: multiple Python versions for the same uWSGI binary</a></li>
<li><a class="reference internal" href="#and-now">And now…</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">The uWSGI project</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="PSGIquickstart.html"
                        title="next chapter">Quickstart for perl/PSGI applications</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/WSGIquickstart.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="PSGIquickstart.html" title="Quickstart for perl/PSGI applications"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The uWSGI project"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>