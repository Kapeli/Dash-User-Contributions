
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>uWSGI 1.9.18 &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="uWSGI 1.9.17" href="Changelog-1.9.17.html" />
    <link rel="prev" title="uWSGI 1.9.19" href="Changelog-1.9.19.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Changelog-1.9.17.html" title="uWSGI 1.9.17"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Changelog-1.9.19.html" title="uWSGI 1.9.19"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="uwsgi-1-9-18">
<h1>uWSGI 1.9.18<a class="headerlink" href="#uwsgi-1-9-18" title="Permalink to this headline">¶</a></h1>
<p>Changelog [20131011]</p>
<div class="section" id="license-change">
<h2>License change<a class="headerlink" href="#license-change" title="Permalink to this headline">¶</a></h2>
<p>This version of uWSGI is the first of the 1.9 tree using GPL2 + linking exception instead of plain GPL2.</p>
<p>This new license should avoid any problems when using uWSGI as a shared library (or when linking it with non-GPL2 compatible libraries)</p>
<p>Remember: if you need to make closed-source modifications to uWSGI you can buy a commercial license.</p>
</div>
<div class="section" id="bugfixes">
<h2>Bugfixes<a class="headerlink" href="#bugfixes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>fixed uwsgi native protocol support on big endian machines</p></li>
<li><p>fixed jvm build system for arm (Jorge Gallegos)</p></li>
<li><p>fixed a memleak spotted by cppcheck in zlib management</p></li>
<li><p>chdir() at every emperor glob iteration</p></li>
<li><p>correctly honour –force-cwd</p></li>
<li><p>fixed ia64/Linux compilation (Jonas Smedegaard/Riccardo Magliocchetti)</p></li>
<li><p>fixed ruby rvm paths parsing order</p></li>
<li><p>added waitpid() after daemon’s SIGTERM (Łukasz Mierzwa)</p></li>
<li><p>fixed pid numbering after –idle (Łukasz Mierzwa)</p></li>
<li><p>fixed/improved cheaper memory limits (Łukasz Mierzwa)</p></li>
<li><p>correctly close inherited sockets in gateways</p></li>
<li><p>fix checks for MAP_FAILED in mmap() (instead of NULL)</p></li>
<li><p>fixed FastCGI non-blocking body read() (patch by Arkaitz Jimenez)</p></li>
<li><p>fixed attach.py script</p></li>
<li><p>avoid crashing on non-conformant PSGI response headers</p></li>
<li><p>run the python autoreloader even in non-apps mode when non-lazy</p></li>
</ul>
</div>
<div class="section" id="new-features">
<h2>New Features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="minimal-build-profiles">
<h3>Minimal build profiles<a class="headerlink" href="#minimal-build-profiles" title="Permalink to this headline">¶</a></h3>
<p>Albeit the memory usage of the uWSGI core is generally between 1.8 and 2.5 megs, there are use cases in which you want an even minimal
core and set of embedded plugins.</p>
<p>Examples are users not making use of uWSGI specific features, or cases in which the libraries used by uWSGI nameclash with others (like openssl or zeromq).</p>
<p>A bunch of ‘minimal’ build profiles have been added:</p>
<blockquote>
<div><ul class="simple">
<li><p>pyonly (build a minimal CPython WSGI server)</p></li>
<li><p>pypyonly (build a minimal PyPy WSGI server)</p></li>
<li><p>plonly (build a minimal PSGI server)</p></li>
<li><p>rbonly (build a minimal Rack server)</p></li>
</ul>
</div></blockquote>
<p>the only supported configuration format is .ini and internal routing and legion subsystem are not builtin.</p>
<p>For example if you want to install a minimal uWSGI binary via pip:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">UWSGI_PROFILE</span><span class="o">=</span>pyonly pip install uwsgi
</pre></div>
</div>
<p>IMPORTANT: minimal build profiles do not improve performance, for the way uWSGI is designed, unused features do not waste CPU. Minimal build profiles impact on final binary size only</p>
</div>
<div class="section" id="auto-fix-modifier1">
<h3>Auto-fix modifier1<a class="headerlink" href="#auto-fix-modifier1" title="Permalink to this headline">¶</a></h3>
<p>Setting the modifier1 for non-python plugin is pretty annoying (read: you always forget about it).</p>
<p>Now if the modifier1 of the request is zero, but the python plugin is not loaded (or there are no python apps loaded) the first configured app
will be set instead (unless you disable with feature with –no-default-app).</p>
<p>This means you can now run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http-socket :9090 --psgi myapp.pl
</pre></div>
</div>
<p>instead of</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http-socket :9090 --http-socket-modifier1 <span class="m">5</span> --psgi myapp.pl
</pre></div>
</div>
<p>obviously try to always set the modifier1, this is only a handy hack</p>
</div>
<div class="section" id="perl-auto-reloader">
<h3>Perl auto reloader<a class="headerlink" href="#perl-auto-reloader" title="Permalink to this headline">¶</a></h3>
<p>The –perl-auto-reload option allows the psgi plugin to check for changed modules after every request. It takes the frequency (in seconds) of the scan.</p>
<p>The scan happens after a request has been served. It is suboptimal, but it is the safest choice too.</p>
</div>
<div class="section" id="the-raw-mode-preview-technology-only-for-cpython">
<h3>The “raw” mode (preview technology, only for CPython)<a class="headerlink" href="#the-raw-mode-preview-technology-only-for-cpython" title="Permalink to this headline">¶</a></h3>
<p>While working on a new server-side project in Unbit we had the need to expose our web application using a very specific protocol (none of the ones supported by uWSGI).</p>
<p>Our first way was adding the new protocol as a plugin, but soon we realize that is was too-specific. So we decided to introduce the RAW mode.</p>
<p>Raw mode allows you to directly parse the request in your application callable. Instead of getting a list of CGI vars/headers in your callable
you only get the file descriptor soon after accept().</p>
<p>You can then read()/write() to that file descriptor in full freedom.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
   <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --raw-socket :7070 --python-raw yourapp.py
</pre></div>
</div>
<p>Raw mode disables request logging. We currently support it only for CPython, if we get reports (or interest) about it for the other languages we will add
support for sure.</p>
<p>IMPORTANT: raw mode is not a standard, so do not expect any middleware or common usage patterns will apply. Use it as a low-level socket wrapper.</p>
</div>
<div class="section" id="optional-non-standard-support-for-cpython-buffer-protocol-for-wsgi-responses">
<h3>Optional NON-standard support for CPython buffer protocol for WSGI responses<a class="headerlink" href="#optional-non-standard-support-for-cpython-buffer-protocol-for-wsgi-responses" title="Permalink to this headline">¶</a></h3>
<p>Authors: yihuang with help of INADA Naoki (methane)</p>
<p>The WSGI (PEP333/3333) is pretty clear about the type of valid objects for responses: str for python2, bytes for python3</p>
<p>uWSGI (heavily using mod_wsgi as a reference) always enforce such behaviour, so “exotic” patterns like returning bytearray
where not supported. Such uses are somewhat involuntary supported on pure-python application servers, just because they simply call write() over them or because they cast them to string
before returning (very inefficient)</p>
<p>The patch proposed by yihuang suggests the use of the low-level buffer protocol exposed by the CPython C api. Strings (in python2) and bytes (in python3) support the buffer protocol, so its use is transparent
and backward compatibility is granted too. (for the CPython C api experts: yes we support both old and new buffer protocol)</p>
<p>This is a NON-standard behaviour you have to voluntary enable with –wsgi-accept-buffer.</p>
<p>Use with care as it could mask errors and/or wrong behaviours.</p>
<p>Note: if you tried 1.9.18-dev you may note this option was enabled by default. It was an error. Thanks to Graham Dumpleton (mod_wsgi author) for pointing it out.</p>
</div>
<div class="section" id="emperor-and-config-improvements">
<h3>Emperor and config improvements<a class="headerlink" href="#emperor-and-config-improvements" title="Permalink to this headline">¶</a></h3>
<p>Credits: Matthijs Kooijman</p>
<p>The config system has been improved to be even more consistent in respect to strict mode (remainder: with –strict you basically check your config files for unknown options
avoiding headaches caused by typos).</p>
<p>New magic vars have been added exposing the name of the original config file (this simplify templating when in Emperor mode), check them at <a class="reference external" href="https://github.com/unbit/uwsgi-docs/blob/master/Configuration.rst#magic-variables">https://github.com/unbit/uwsgi-docs/blob/master/Configuration.rst#magic-variables</a></p>
<p>The Emperor got support for Linux capabilities using the –emperor-cap option. The option takes the list of capability you want to maintain
for your vassals when they start as root:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">emperor</span> <span class="o">=</span> <span class="s">/etc/uwsgi/vassals</span>
<span class="na">emperor-cap</span> <span class="o">=</span> <span class="s">setuid,net_bind_service</span>
</pre></div>
</div>
<p>with this setup your vassal will be only able to drop privileges and bind to ports &lt; 1024</p>
<p>Its best friend is the CLONE_NEWUSER flag of linux namespaces that is now fully supported on uWSGI:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">emperor</span> <span class="o">=</span> <span class="s">/etc/uwsgi/vassals</span>
<span class="na">emperor-use-clone</span> <span class="o">=</span> <span class="s">user</span>
<span class="na">emperor-cap</span> <span class="o">=</span> <span class="s">setuid,net_bind_service</span>
</pre></div>
</div>
<p>this will create a new root user for the vassal with fewer privileges (CLONE_NEWUSER is pretty hard to understand, but the best thing
to catch it is seeing it as a new root user with dedicated capabilities)</p>
</div>
<div class="section" id="build-system-improvements">
<h3>Build system improvements<a class="headerlink" href="#build-system-improvements" title="Permalink to this headline">¶</a></h3>
<p>The build system has been improved to link custom sources on the fly. This works great for low-level hooks:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// embed_me.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">hello_i_am_foobar</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I Am foobar&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we can link this file to the main uWSGI binary in one shot:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">UWSGI_ADDITIONAL_SOURCES</span><span class="o">=</span>embed_me.c make
</pre></div>
</div>
<p>and you will automatically get access for your hooks:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http-socket :9090 --call-asap hello_i_am_foobar
</pre></div>
</div>
<p>Finally, Riccardo Magliocchetti rewrote the build script to use optparse instead of raw/old-fashioned sys.argv parsing</p>
</div>
<div class="section" id="pluginized-the-schemes-management">
<h3>Pluginized the ‘schemes’ management<a class="headerlink" href="#pluginized-the-schemes-management" title="Permalink to this headline">¶</a></h3>
<p>schemes are the prefix part of uWSGI uri’s. When you do</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --ini http://foobar.local:9090/test.ini
</pre></div>
</div>
<p>the <a class="reference external" href="http://">http://</a> is the scheme, signalling uWSGI it has to download the config file via http.</p>
<p>Til now those ‘schemes’ were hardcoded. Now they are exposed as plugins, so you can add more of them (or override the default one).</p>
<p>The new system has been applied to the PSGI plugin too (sorry we are sure only perl developers will understand that kind of poetry :P) so you can do things like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --http-socket :1717 --psgi http://yourapps.local/dancer.pl
</pre></div>
</div>
<p>or</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./uwsgi --binary-append-data yourapp.pl &gt; blob001
cat blob001 &gt;&gt; ./uwsgi
./uwsgi --http-socket :1717 --psgi data://0
</pre></div>
</div>
</div>
<div class="section" id="mountpoints-checks">
<h3>mountpoints checks<a class="headerlink" href="#mountpoints-checks" title="Permalink to this headline">¶</a></h3>
<p>It could be hard to understand why an application server should check for mountpoints.</p>
<p>In the same way understanding how writing filesystem in userspace was silly few years ago.</p>
<p>So, check the article about managing Fuse filesystem with uWSGI: <a class="reference external" href="https://uwsgi-docs.readthedocs.io/en/latest/tutorials/ReliableFuse.html">https://uwsgi-docs.readthedocs.io/en/latest/tutorials/ReliableFuse.html</a></p>
</div>
<div class="section" id="preliminary-libffi-plugin">
<h3>Preliminary libffi plugin<a class="headerlink" href="#preliminary-libffi-plugin" title="Permalink to this headline">¶</a></h3>
<p>As embedding c libraries for exposing hooks is becoming more common, we have started working on libffi integration, allowing
safe (and sane) argument passing to hooks. More to came soon.</p>
</div>
<div class="section" id="official-support-for-kfreebsd">
<h3>Official support for kFreeBSD<a class="headerlink" href="#official-support-for-kfreebsd" title="Permalink to this headline">¶</a></h3>
<p>Debian/kFreeBSD is officially supported.</p>
<p>You can even use FreeBSD jails too !!!</p>
<p><a class="reference internal" href="FreeBSDJails.html"><span class="doc">FreeBSD Jails</span></a></p>
</div>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p>uWSGI 1.9.18 has been released on October 11th 2013 and can be downloaded from:</p>
<p><a class="reference external" href="https://projects.unbit.it/downloads/uwsgi-1.9.18.tar.gz">https://projects.unbit.it/downloads/uwsgi-1.9.18.tar.gz</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">uWSGI 1.9.18</a><ul>
<li><a class="reference internal" href="#license-change">License change</a></li>
<li><a class="reference internal" href="#bugfixes">Bugfixes</a></li>
<li><a class="reference internal" href="#new-features">New Features</a><ul>
<li><a class="reference internal" href="#minimal-build-profiles">Minimal build profiles</a></li>
<li><a class="reference internal" href="#auto-fix-modifier1">Auto-fix modifier1</a></li>
<li><a class="reference internal" href="#perl-auto-reloader">Perl auto reloader</a></li>
<li><a class="reference internal" href="#the-raw-mode-preview-technology-only-for-cpython">The “raw” mode (preview technology, only for CPython)</a></li>
<li><a class="reference internal" href="#optional-non-standard-support-for-cpython-buffer-protocol-for-wsgi-responses">Optional NON-standard support for CPython buffer protocol for WSGI responses</a></li>
<li><a class="reference internal" href="#emperor-and-config-improvements">Emperor and config improvements</a></li>
<li><a class="reference internal" href="#build-system-improvements">Build system improvements</a></li>
<li><a class="reference internal" href="#pluginized-the-schemes-management">Pluginized the ‘schemes’ management</a></li>
<li><a class="reference internal" href="#mountpoints-checks">mountpoints checks</a></li>
<li><a class="reference internal" href="#preliminary-libffi-plugin">Preliminary libffi plugin</a></li>
<li><a class="reference internal" href="#official-support-for-kfreebsd">Official support for kFreeBSD</a></li>
</ul>
</li>
<li><a class="reference internal" href="#availability">Availability</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Changelog-1.9.19.html"
                        title="previous chapter">uWSGI 1.9.19</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Changelog-1.9.17.html"
                        title="next chapter">uWSGI 1.9.17</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Changelog-1.9.18.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Changelog-1.9.17.html" title="uWSGI 1.9.17"
             >next</a> |</li>
        <li class="right" >
          <a href="Changelog-1.9.19.html" title="uWSGI 1.9.19"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>