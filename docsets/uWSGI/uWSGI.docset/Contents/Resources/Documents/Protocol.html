
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>The uwsgi Protocol &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Managing external daemons/services" href="AttachingDaemons.html" />
    <link rel="prev" title="uwsgi protocol magic variables" href="Vars.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="AttachingDaemons.html" title="Managing external daemons/services"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Vars.html" title="uwsgi protocol magic variables"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-uwsgi-protocol">
<h1>The uwsgi Protocol<a class="headerlink" href="#the-uwsgi-protocol" title="Permalink to this headline">¶</a></h1>
<p>The uwsgi (lowercase!) protocol is the native protocol used by the uWSGI server.</p>
<p>It is a binary protocol that can carry any type of data. The first 4 bytes of a uwsgi packet describe the type of the data contained by the packet.</p>
<p><strong>Every uwsgi request generates a response in the uwsgi format.</strong></p>
<p>Even the web server handlers obey this rule, as an HTTP response is a valid uwsgi packet (look at the <code class="docutils literal notranslate"><span class="pre">modifier1</span></code> = 72).</p>
<p>The protocol works mainly via TCP but the master process can bind to a UDP Unicast/Multicast for <a class="reference internal" href="SNMP.html"><span class="doc">The embedded SNMP server</span></a> or cluster management/messaging requests.</p>
<p>SCTP support is being worked on.</p>
<div class="section" id="uwsgi-packet-header">
<h2>uwsgi packet header<a class="headerlink" href="#uwsgi-packet-header" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">uwsgi_packet_header</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">modifier1</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">datasize</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">modifier2</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Unless otherwise specified the <code class="docutils literal notranslate"><span class="pre">datasize</span></code> value contains the size (16-bit little endian) of the packet body.</p>
</div>
<div class="section" id="packet-descriptions">
<h2>Packet descriptions<a class="headerlink" href="#packet-descriptions" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-center">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">modifier1</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">datasize</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">modifier2</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">packet</span> <span class="pre">type</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>size of WSGI block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard WSGI request followed by the HTTP request body</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>reserved for UNBIT</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>reserved for UNBIT</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>reserved for UNBIT</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>size of <a class="reference internal" href="Perl.html"><span class="doc">PSGI</span></a> block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard <a class="reference internal" href="Perl.html"><span class="doc">PSGI</span></a> request followed by the HTTP request body</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>size of LUA WSAPI block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard LUA/WSAPI request followed by the HTTP request body</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>size of RACK block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard RACK request followed by the HTTP request body</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>size of JWSGI/Ring block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard JVM request for <a class="reference internal" href="JWSGI.html"><span class="doc">The JWSGI interface</span></a> and <a class="reference internal" href="Ring.html"><span class="doc">The Clojure/Ring JVM request handler</span></a> followed by the HTTP request body</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>size of CGI block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard <a class="reference internal" href="CGI.html"><span class="doc">Running CGI scripts on uWSGI</span></a> request followed by the HTTP request body</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>size of block vars</p></td>
<td><p>0- 255</p></td>
<td><p>Management interface request: setup flag specified by modifier2. For a list of management flag look at ManagementFlag</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>size of CGI block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard <a class="reference internal" href="PHP.html"><span class="doc">Running PHP scripts in uWSGI</span></a> request followed by the HTTP request body</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>size of Mono ASP.NET block vars (HTTP request body excluded)</p></td>
<td><p>0</p></td>
<td><p>Standard <a class="reference internal" href="Mono.html"><span class="doc">The Mono ASP.NET plugin</span></a> request followed by the HTTP request body</p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td><p>size of Spooler block vars</p></td>
<td><p>0- 255</p></td>
<td><p><a class="reference internal" href="Spooler.html"><span class="doc">The uWSGI Spooler</span></a> request, the block vars is converted to a dictionary/hash/table and passed to the spooler callable. The second modifier is currently ignored.</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
<td><p>size of CGI block vars</p></td>
<td><p>0-255</p></td>
<td><p>direct call to c-like symbols</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>size of code string</p></td>
<td><p>0- 255</p></td>
<td><p>Raw Code evaluation. The interpreter is chosen by the modifier2. 0 is Python, 5 is Perl.
It does not return a valid uwsgi response, but a raw string (that may be an HTTP response)</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>size of CGI vars</p></td>
<td><p>0- 255</p></td>
<td><p>invoke the <a class="reference internal" href="XSLT.html"><span class="doc">The XSLT plugin</span></a></p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>size of CGI vars</p></td>
<td><p>0- 255</p></td>
<td><p>invoke the <a class="reference internal" href="V8.html"><span class="doc">uWSGI V8 support</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>25</p></td>
<td><p>size of CGI vars</p></td>
<td><p>0- 255</p></td>
<td><p>invoke the <a class="reference internal" href="GridFS.html"><span class="doc">The GridFS plugin</span></a></p></td>
</tr>
<tr class="row-even"><td><p>26</p></td>
<td><p>size of CGI vars</p></td>
<td><p>0- 255</p></td>
<td><p>invoke the <a class="reference internal" href="GlusterFS.html"><span class="doc">The GlusterFS plugin</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>27</p></td>
<td><p>0</p></td>
<td><p>0- 255</p></td>
<td><p>call the <span class="xref std std-doc">FastFuncs</span> specified by the modifier2 field</p></td>
</tr>
<tr class="row-even"><td><p>28</p></td>
<td><p>0</p></td>
<td><p>0- 255</p></td>
<td><p>invoke the <a class="reference internal" href="Rados.html"><span class="doc">The RADOS plugin</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>30</p></td>
<td><p>size of WSGI block vars (HTTP request body excluded)</p></td>
<td><p>0 (if defined the size of the block vars is 24bit le, for now none of the webserver handlers support this feature)</p></td>
<td><p>Standard WSGI request followed by the HTTP request body. The PATH_INFO is automatically modified, removing the SCRIPT_NAME from it</p></td>
</tr>
<tr class="row-even"><td><p>31</p></td>
<td><p>size of block vars</p></td>
<td><p>0- 255</p></td>
<td><p>Generic message passing (reserved)</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
<td><p>size of char array</p></td>
<td><p>0- 255</p></td>
<td><p>array of char passing (reserved)</p></td>
</tr>
<tr class="row-even"><td><p>33</p></td>
<td><p>size of marshal object</p></td>
<td><p>0- 255</p></td>
<td><p>marshalled/serialzed object passing (reserved)</p></td>
</tr>
<tr class="row-odd"><td><p>48</p></td>
<td><p>snmp specific</p></td>
<td><p>snmp specific</p></td>
<td><p>identify a SNMP request/response (mainly via UDP)</p></td>
</tr>
<tr class="row-even"><td><p>72</p></td>
<td><p>chr(TT)</p></td>
<td><p>chr(P)</p></td>
<td><p>Corresponds to the ‘HTTP’ string and signals that this is a raw HTTP response.</p></td>
</tr>
<tr class="row-odd"><td><p>73</p></td>
<td><p>announce message size (for sanity check)</p></td>
<td><p>announce type (0 = hostname)</p></td>
<td><p>announce message</p></td>
</tr>
<tr class="row-even"><td><p>74</p></td>
<td><p>multicast message size (for sanity check)</p></td>
<td><p>0</p></td>
<td><p>array of chars; a custom multicast message managed by <code class="docutils literal notranslate"><span class="pre">uwsgi.multicast_manager</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>95</p></td>
<td><p>cluster membership dict size</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">action</span></code></p></td>
<td><p>add/remove/enable/disable node from a cluster. Action may be 0 = add, 1 = remove, 2 = enable, 3 = disable. Add action requires a dict of at least 3 keys: <code class="docutils literal notranslate"><span class="pre">hostname</span></code>, <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">workers</span></code></p></td>
</tr>
<tr class="row-even"><td><p>96</p></td>
<td><p>log message size</p></td>
<td><p>0</p></td>
<td><p>Remote logging (clustering/multicast/unicast)</p></td>
</tr>
<tr class="row-odd"><td><p>97</p></td>
<td><p>0</p></td>
<td><p>0, 1</p></td>
<td><p>brutal reload request (0 request -  1 confirmation)</p></td>
</tr>
<tr class="row-even"><td><p>98</p></td>
<td><p>0</p></td>
<td><p>0, 1</p></td>
<td><p>graceful reload request (0 request -  1 confirmation)</p></td>
</tr>
<tr class="row-odd"><td><p>99</p></td>
<td><p>size of options dictionary (if response)</p></td>
<td><p>0, 1</p></td>
<td><p>request configuration data from a uwsgi node (even via multicast)</p></td>
</tr>
<tr class="row-even"><td><p>100</p></td>
<td><p>0</p></td>
<td><p>0, 1</p></td>
<td><p>PING- PONG if modifier2 is 0 it is a PING request otherwise it is a PONG (a response). Useful for cluster health- check</p></td>
</tr>
<tr class="row-odd"><td><p>101</p></td>
<td><p>size of packet</p></td>
<td><p>0</p></td>
<td><p>ECHO service</p></td>
</tr>
<tr class="row-even"><td><p>109</p></td>
<td><p>size of clean payload</p></td>
<td><p>0 to 255</p></td>
<td><p>legion msg (UDP, the body is encrypted)</p></td>
</tr>
<tr class="row-odd"><td><p>110</p></td>
<td><p>size of payload</p></td>
<td><p>0 to 255</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uwsgi_signal</span></code> framework (payload is optional), modifier2 is the signal num</p></td>
</tr>
<tr class="row-even"><td><p>111</p></td>
<td><p>size of packet</p></td>
<td><p>0, 1, 2, 3</p></td>
<td><p>Cache operations. 0: read, 1: write, 2: delete, 3: dict_based</p></td>
</tr>
<tr class="row-odd"><td><p>123</p></td>
<td><p>size of packet</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>special modifier for signaling corerouters about special conditions</p></td>
</tr>
<tr class="row-even"><td><p>173</p></td>
<td><p>size of packet</p></td>
<td><p>0, 1</p></td>
<td><p>RPC. The packet is an uwsgi array where the first item is the name of the function and the following are the args (if <code class="docutils literal notranslate"><span class="pre">modifier2</span></code> is 1 the RPC will be ‘raw’ and all of the response will be returned to the app, uwsgi header included, if available.</p></td>
</tr>
<tr class="row-odd"><td><p>200</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>Close mark for persistent connections</p></td>
</tr>
<tr class="row-even"><td><p>224</p></td>
<td><p>size of packet</p></td>
<td><p>0</p></td>
<td><p>Subscription packet. see SubscriptionServer</p></td>
</tr>
<tr class="row-odd"><td><p>255</p></td>
<td><p>0</p></td>
<td><p>0- 255</p></td>
<td><p>Generic response. Request dependent. For example a spooler response set 0 for a failed spool or 1 for a successful one</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-uwsgi-vars">
<h2>The uwsgi vars<a class="headerlink" href="#the-uwsgi-vars" title="Permalink to this headline">¶</a></h2>
<p>The uwsgi block vars represent a dictionary/hash. Every key-value is encoded in this way:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">uwsgi_var</span> <span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">key_size</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">key</span><span class="p">[</span><span class="n">key_size</span><span class="p">];</span>
    <span class="kt">uint16_t</span> <span class="n">val_size</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">val</span><span class="p">[</span><span class="n">val_size</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The uwsgi Protocol</a><ul>
<li><a class="reference internal" href="#uwsgi-packet-header">uwsgi packet header</a></li>
<li><a class="reference internal" href="#packet-descriptions">Packet descriptions</a></li>
<li><a class="reference internal" href="#the-uwsgi-vars">The uwsgi vars</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Vars.html"
                        title="previous chapter">uwsgi protocol magic variables</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="AttachingDaemons.html"
                        title="next chapter">Managing external daemons/services</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Protocol.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="AttachingDaemons.html" title="Managing external daemons/services"
             >next</a> |</li>
        <li class="right" >
          <a href="Vars.html" title="uwsgi protocol magic variables"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>