
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Python Tracebacker &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Aliasing Python modules" href="PythonModuleAlias.html" />
    <link rel="prev" title="Pump support" href="PythonPump.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="PythonModuleAlias.html" title="Aliasing Python modules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="PythonPump.html" title="Pump support"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Python.html" accesskey="U">Python support</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="python-tracebacker">
<h1>Python Tracebacker<a class="headerlink" href="#python-tracebacker" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3-dev.</span></p>
</div>
<p>Usually if you want to get a real-time traceback from your app you’d have to modify your code to add a hook or entry point for that as described on the <span class="xref std std-doc">TipsAndTricks</span> page.</p>
<p>Starting from 1.3-dev, uWSGI includes a similar technique allowing you to get realtime traceback via a UNIX socket.</p>
<p>To enable the tracebacker, add the option <code class="docutils literal notranslate"><span class="pre">py-tracebacker=&lt;socket&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;socket&gt;</span></code> is the _basename_ for the created UNIX sockets.</p>
<p>If you have 4 uWSGI workers and you add <code class="docutils literal notranslate"><span class="pre">py-tracebacker=/tmp/tbsocket</span></code>, four sockets named <code class="docutils literal notranslate"><span class="pre">/tmp/tbsocket1</span></code> through <code class="docutils literal notranslate"><span class="pre">/tmp/tbsocket4</span></code> will be created.</p>
<p>Connecting to one of them will return the current traceback of the threads running in the worker. To connect to those sockets you can use whatever application or method you like the best, but uWSGI includes a convenience option <code class="docutils literal notranslate"><span class="pre">connect-and-read</span></code> you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uwsgi</span> <span class="o">--</span><span class="n">connect</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">read</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tbsocket1</span>
</pre></div>
</div>
<div class="section" id="an-example">
<h2>An example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>
<p>Let’s write a silly test application called <code class="docutils literal notranslate"><span class="pre">slow.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">dormi</span><span class="p">():</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dormi2</span><span class="p">():</span>
  <span class="n">dormi</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">dormi3</span><span class="p">():</span>
  <span class="n">dormi2</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">dormi4</span><span class="p">():</span>
  <span class="n">dormi3</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">dormi5</span><span class="p">():</span>
  <span class="n">dormi4</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
  <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span><span class="p">)])</span>
  <span class="n">dormi5</span><span class="p">()</span>
  <span class="k">return</span> <span class="s2">&quot;hello&quot;</span>
</pre></div>
</div>
<p>And then run it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uwsgi</span> <span class="o">--</span><span class="n">http</span> <span class="p">:</span><span class="mi">8080</span> <span class="o">-</span><span class="n">w</span> <span class="n">slow</span> <span class="o">--</span><span class="n">master</span> <span class="o">--</span><span class="n">processes</span> <span class="mi">2</span> <span class="o">--</span><span class="n">threads</span> <span class="mi">4</span> <span class="o">--</span><span class="n">py</span><span class="o">-</span><span class="n">tracebacker</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tbsocket</span><span class="o">.</span>
</pre></div>
</div>
<p>Then make a bunch of requests into it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="o">&amp;</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="o">&amp;</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="o">&amp;</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>Now, while these requests are running (they’ll take pretty much exactly a minute to complete each), you can retrieve the traceback for, let’s say, the two first workers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">uwsgi</span> <span class="o">--</span><span class="n">connect</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">read</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tbsocket</span><span class="o">.</span><span class="mi">1</span>
<span class="o">./</span><span class="n">uwsgi</span> <span class="o">--</span><span class="n">connect</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">read</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tbsocket</span><span class="o">.</span><span class="mi">2</span>
</pre></div>
</div>
<p>The tracebacker output will be something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">***</span> <span class="n">uWSGI</span> <span class="n">Python</span> <span class="n">tracebacker</span> <span class="n">output</span> <span class="o">***</span>

<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core1</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">22</span> <span class="n">function</span> <span class="o">=</span> <span class="n">application</span> <span class="n">line</span> <span class="o">=</span> <span class="n">dormi5</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core1</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">14</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi5</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi5</span><span class="p">():</span> <span class="n">dormi4</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core1</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">13</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi4</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi4</span><span class="p">():</span> <span class="n">dormi3</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core1</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">12</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi3</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi3</span><span class="p">():</span> <span class="n">dormi2</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core1</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">11</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi2</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi2</span><span class="p">():</span> <span class="n">dormi</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core1</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">9</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi</span> <span class="n">line</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core3</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">22</span> <span class="n">function</span> <span class="o">=</span> <span class="n">application</span> <span class="n">line</span> <span class="o">=</span> <span class="n">dormi5</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core3</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">14</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi5</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi5</span><span class="p">():</span> <span class="n">dormi4</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core3</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">13</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi4</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi4</span><span class="p">():</span> <span class="n">dormi3</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core3</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">12</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi3</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi3</span><span class="p">():</span> <span class="n">dormi2</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core3</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">11</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi2</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi2</span><span class="p">():</span> <span class="n">dormi</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">uWSGIWorker1Core3</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">9</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi</span> <span class="n">line</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">thread_id</span> <span class="o">=</span> <span class="n">MainThread</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">22</span> <span class="n">function</span> <span class="o">=</span> <span class="n">application</span> <span class="n">line</span> <span class="o">=</span> <span class="n">dormi5</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">MainThread</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">14</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi5</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi5</span><span class="p">():</span> <span class="n">dormi4</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">MainThread</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">13</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi4</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi4</span><span class="p">():</span> <span class="n">dormi3</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">MainThread</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">12</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi3</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi3</span><span class="p">():</span> <span class="n">dormi2</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">MainThread</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">11</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi2</span> <span class="n">line</span> <span class="o">=</span> <span class="k">def</span> <span class="nf">dormi2</span><span class="p">():</span> <span class="n">dormi</span><span class="p">()</span>
<span class="n">thread_id</span> <span class="o">=</span> <span class="n">MainThread</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">./</span><span class="n">slow</span><span class="o">.</span><span class="n">py</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">9</span> <span class="n">function</span> <span class="o">=</span> <span class="n">dormi</span> <span class="n">line</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="combining-the-tracebacker-with-harakiri">
<h2>Combining the tracebacker with Harakiri<a class="headerlink" href="#combining-the-tracebacker-with-harakiri" title="Permalink to this headline">¶</a></h2>
<p>If a request is killed by the <a class="reference internal" href="Glossary.html#term-harakiri"><span class="xref std std-term">harakiri</span></a> feature, a traceback is automatically logged during the Harakiri phase.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Python Tracebacker</a><ul>
<li><a class="reference internal" href="#an-example">An example</a></li>
<li><a class="reference internal" href="#combining-the-tracebacker-with-harakiri">Combining the tracebacker with Harakiri</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="PythonPump.html"
                        title="previous chapter">Pump support</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="PythonModuleAlias.html"
                        title="next chapter">Aliasing Python modules</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Tracebacker.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="PythonModuleAlias.html" title="Aliasing Python modules"
             >next</a> |</li>
        <li class="right" >
          <a href="PythonPump.html" title="Pump support"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Python.html" >Python support</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>