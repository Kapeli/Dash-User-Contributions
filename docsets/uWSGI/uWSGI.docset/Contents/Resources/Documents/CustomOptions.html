
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Defining new options for your instances &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How uWSGI parses config files" href="ParsingOrder.html" />
    <link rel="prev" title="uWSGI Options" href="Options.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ParsingOrder.html" title="How uWSGI parses config files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Options.html" title="uWSGI Options"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defining-new-options-for-your-instances">
<h1>Defining new options for your instances<a class="headerlink" href="#defining-new-options-for-your-instances" title="Permalink to this headline">¶</a></h1>
<p>Sometimes the built-in options are not enough. For example, you may need to
give your customers custom options for configuring their apps on your platform.
Or you need to configure so many instances you want to simplify things such as
per-datacenter or per-server-type options.  Declaring new options for your
config files/command-line is a good way of achieving these goals.</p>
<p>To define new options use <code class="docutils literal notranslate"><span class="pre">--declare-option</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">declare</span><span class="o">-</span><span class="n">option</span> <span class="o">&lt;</span><span class="n">option_name</span><span class="o">&gt;=&lt;</span><span class="n">option1</span><span class="o">=</span><span class="n">value1</span><span class="o">&gt;</span><span class="p">[;</span><span class="o">&lt;</span><span class="n">option2</span><span class="o">=</span><span class="n">value2</span><span class="o">&gt;</span><span class="p">;</span><span class="o">&lt;</span><span class="n">option3</span><span class="o">=</span><span class="n">value3</span><span class="o">&gt;...</span><span class="p">]</span>
</pre></div>
</div>
<p>An useful example could be defining a “redirect” option, using the redirect
plugin of the InternalRouting subsystem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">declare</span><span class="o">-</span><span class="n">option</span> <span class="s2">&quot;redirect=route=\$1 redirect:\$2&quot;</span>
</pre></div>
</div>
<p>This will declare a new option called <code class="docutils literal notranslate"><span class="pre">redirect</span></code> that takes 2 arguments.
Those arguments will be expanded using the $-prefixed variables. Like shell
scripts, <em>the backslash is required to make your shell not expand these
values</em>.</p>
<p>Now you will be able to define a redirect in your config files:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --declare-option <span class="s2">&quot;redirect=route=\$1 redirect:\$2&quot;</span> --ini config.ini
</pre></div>
</div>
<p>Config.ini:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">:3031</span>
<span class="c1">; define my redirects</span>
<span class="na">redirect</span> <span class="o">=</span> <span class="s">^/foo http://unbit.it</span>
<span class="na">redirect</span> <span class="o">=</span> <span class="s">\.jpg$ http://uwsgi.it/test</span>
<span class="na">redirect</span> <span class="o">=</span> <span class="s">^/foo/bar/ /test</span>
</pre></div>
</div>
<p>or directly on the command line:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --declare-option <span class="s2">&quot;redirect=route=\$1 redirect:\$2&quot;</span> --socket :3031 --redirect <span class="s2">&quot;^/foo http://unbit.it&quot;</span> --redirect <span class="s2">&quot;\.jpg</span>$<span class="s2"> http://uwsgi.it/test&quot;</span> --redirect <span class="s2">&quot;^/foo/bar/ /test&quot;</span>
</pre></div>
</div>
<div class="section" id="more-fun-a-bunch-of-shortcuts">
<h2>More fun: a bunch of shortcuts<a class="headerlink" href="#more-fun-a-bunch-of-shortcuts" title="Permalink to this headline">¶</a></h2>
<p>Now we will define new options for frequently-used apps.</p>
<p>Shortcuts.ini:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; let&#39;s define a shortcut for trac (new syntax: trac=&lt;path_to_trac_instance&gt;)</span>
<span class="na">declare-option</span> <span class="o">=</span> <span class="s">trac=plugin=python;env=TRAC_ENV=$1;module=trac.web.main:dispach_request</span>
<span class="c1">; one for web2py (new syntax: web2py=&lt;path_to_web2_py_dir&gt;)</span>
<span class="na">declare-option</span> <span class="o">=</span> <span class="s">web2py=plugin=python;chdir=$1;module=wsgihandler</span>
<span class="c1">; another for flask (new syntax: flask=&lt;path_to_your_app_entry_point&gt;)</span>
<span class="na">declare-option</span> <span class="o">=</span> <span class="s">flask=plugin=python;wsgi-file=$1;callable=app</span>
</pre></div>
</div>
<p>To hook up a Trac instance on /var/www/trac/fooenv:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; include new shortcuts</span>
<span class="na">ini</span> <span class="o">=</span> <span class="s">shortcuts.ini</span>

<span class="c1">; classic options</span>
<span class="na">http</span> <span class="o">=</span> <span class="s">:8080</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">threads</span> <span class="o">=</span> <span class="s">4</span>

<span class="c1">; our new option</span>
<span class="na">trac</span> <span class="o">=</span> <span class="s">/var/www/trac/fooenv</span>
</pre></div>
</div>
<p>A config for Web2py, in XML:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;uwsgi&gt;</span>
  <span class="c">&lt;!-- import shortcuts --&gt;</span>
  <span class="nt">&lt;ini&gt;</span>shortcuts.ini<span class="nt">&lt;/ini&gt;</span>
  <span class="c">&lt;!-- run the https router with HIGH ciphers --&gt;</span>
  <span class="nt">&lt;https&gt;</span>:443,test.crt,test.key,HIGH<span class="nt">&lt;/https&gt;</span>

  <span class="nt">&lt;master/&gt;</span>
  <span class="nt">&lt;processes&gt;</span>4<span class="nt">&lt;/processes&gt;</span>

  <span class="c">&lt;!-- load web2py from /var/www/we2py --&gt;</span>
  <span class="nt">&lt;web2py&gt;</span>/var/www/we2py<span class="nt">&lt;/web2py&gt;</span>
<span class="nt">&lt;/uwsgi&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="a-trick-for-the-emperor-automatically-import-shortcuts-for-your-vassals">
<h2>A trick for the Emperor: automatically import shortcuts for your vassals<a class="headerlink" href="#a-trick-for-the-emperor-automatically-import-shortcuts-for-your-vassals" title="Permalink to this headline">¶</a></h2>
<p>If you manage your customers/users with the <a class="reference internal" href="Emperor.html"><span class="doc">Emperor</span></a>, you can
configure it to automatically import your shortcuts in each vassal.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --emperor /etc/uwsgi/vassals --vassals-include /etc/uwsgi/shortcuts.ini
</pre></div>
</div>
<p>For multiple shortcuts use:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --emperor /etc/uwsgi/vassals --vassals-include /etc/uwsgi/shortcuts.ini --vassals-include /etc/uwsgi/shortcuts2.ini --vassals-include /etc/uwsgi/shortcuts3.ini
</pre></div>
</div>
<p>Or (with a bit of <a class="reference internal" href="ConfigLogic.html"><span class="doc">configuration logic magic</span></a>):</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">emperor</span> <span class="o">=</span> <span class="s">/etc/uwsgi/vassals</span>

<span class="na">for</span> <span class="o">=</span> <span class="s">shortcuts shortcuts2 shortcuts3</span>
<span class="s">  vassals-include = /etc/uwsgi/%(_).ini</span>
<span class="na">endfor</span> <span class="o">=</span>
</pre></div>
</div>
</div>
<div class="section" id="an-advanced-trick-embedding-shortcuts-in-your-uwsgi-binary">
<h2>An advanced trick: embedding shortcuts in your uWSGI binary<a class="headerlink" href="#an-advanced-trick-embedding-shortcuts-in-your-uwsgi-binary" title="Permalink to this headline">¶</a></h2>
<p>uWSGI’s build system allows you to embed files, be they generic files or
configuration, in the server binary.  Abusing this feature will enable you to
embed your new option shortcuts into the server binary, automagically allowing
users to use them.  To embed your shortcuts file, edit your build profile (like
<code class="file docutils literal notranslate"><span class="pre">buildconf/base.ini</span></code>) and set <code class="docutils literal notranslate"><span class="pre">embed_config</span></code> to the path of the
shortcuts file.  Rebuild your server and your new options will be available.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><span class="xref std std-doc">BuildConf</span></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining new options for your instances</a><ul>
<li><a class="reference internal" href="#more-fun-a-bunch-of-shortcuts">More fun: a bunch of shortcuts</a></li>
<li><a class="reference internal" href="#a-trick-for-the-emperor-automatically-import-shortcuts-for-your-vassals">A trick for the Emperor: automatically import shortcuts for your vassals</a></li>
<li><a class="reference internal" href="#an-advanced-trick-embedding-shortcuts-in-your-uwsgi-binary">An advanced trick: embedding shortcuts in your uWSGI binary</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Options.html"
                        title="previous chapter">uWSGI Options</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ParsingOrder.html"
                        title="next chapter">How uWSGI parses config files</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/CustomOptions.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ParsingOrder.html" title="How uWSGI parses config files"
             >next</a> |</li>
        <li class="right" >
          <a href="Options.html" title="uWSGI Options"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>