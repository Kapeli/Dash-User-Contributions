
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Configuration logic &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="uWSGI Options" href="Options.html" />
    <link rel="prev" title="Fallback configuration" href="FallbackConfig.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Options.html" title="uWSGI Options"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="FallbackConfig.html" title="Fallback configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuration-logic">
<h1>Configuration logic<a class="headerlink" href="#configuration-logic" title="Permalink to this headline">¶</a></h1>
<p>Starting from 1.1 certain logic constructs are available.</p>
<p>The following statements are currently supported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">for</span></code> .. <code class="docutils literal notranslate"><span class="pre">endfor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-dir</span></code> / <code class="docutils literal notranslate"><span class="pre">if-not-dir</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-env</span></code> / <code class="docutils literal notranslate"><span class="pre">if-not-env</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-exists</span></code> / <code class="docutils literal notranslate"><span class="pre">if-not-exists</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-file</span></code> / <code class="docutils literal notranslate"><span class="pre">if-not-file</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-opt</span></code> / <code class="docutils literal notranslate"><span class="pre">if-not-opt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-reload</span></code> / <code class="docutils literal notranslate"><span class="pre">if-not-reload</span></code> – undocumented</p></li>
</ul>
<p>Each of these statements exports a context value you can access with the
special placeholder <code class="docutils literal notranslate"><span class="pre">%(_)</span></code>. For example, the “for” statement sets <code class="docutils literal notranslate"><span class="pre">%(_)</span></code> to
the current iterated value.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Recursive logic is not supported and will cause uWSGI to promptly exit.</p>
</div>
<div class="section" id="for">
<h2>for<a class="headerlink" href="#for" title="Permalink to this headline">¶</a></h2>
<p>For iterates over space-separated strings. The following three code blocks are equivalent.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; iterate over a list of ports</span>
<span class="na">for</span> <span class="o">=</span> <span class="s">3031 3032 3033 3034 3035</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">127.0.0.1:%(_)</span>
<span class="na">endfor</span> <span class="o">=</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">helloworld</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;uwsgi&gt;</span>
  <span class="nt">&lt;master/&gt;</span>
  <span class="nt">&lt;for&gt;</span>3031 3032 3033 3034 3035<span class="nt">&lt;/for&gt;</span>
    <span class="nt">&lt;socket&gt;</span>127.0.0.1:%(_)<span class="nt">&lt;/socket&gt;</span>
  <span class="nt">&lt;endfor/&gt;</span>
  <span class="nt">&lt;module&gt;</span>helloworld<span class="nt">&lt;/module&gt;</span>
<span class="nt">&lt;/uwsgi&gt;</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --for<span class="o">=</span><span class="s2">&quot;3031 3032 3033 3034 3035&quot;</span> --socket<span class="o">=</span><span class="s2">&quot;127.0.0.1:%(_)&quot;</span> --endfor --module helloworld
</pre></div>
</div>
<p>Note that the for-loop is applied to each line inside the block
separately, not to the block as a whole. For example, this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">for</span> <span class="o">=</span> <span class="s">a b c</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">/var/run/%(_).socket</span>
<span class="na">http-socket</span> <span class="o">=</span> <span class="s">/var/run/%(_)-http.socket</span>
<span class="na">endfor</span> <span class="o">=</span>
</pre></div>
</div>
<p>is expanded to:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">/var/run/a.socket</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">/var/run/b.socket</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">/var/run/c.socket</span>
<span class="na">http-socket</span> <span class="o">=</span> <span class="s">/var/run/a-http.socket</span>
<span class="na">http-socket</span> <span class="o">=</span> <span class="s">/var/run/b-http.socket</span>
<span class="na">http-socket</span> <span class="o">=</span> <span class="s">/var/run/c-http.socket</span>
</pre></div>
</div>
</div>
<div class="section" id="if-env">
<h2>if-env<a class="headerlink" href="#if-env" title="Permalink to this headline">¶</a></h2>
<p>Check if an environment variable is defined, putting its value in the context
placeholder.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">if-env</span> <span class="o">=</span> <span class="s">PATH</span>
<span class="na">print</span> <span class="o">=</span> <span class="s">Your path is %(_)</span>
<span class="na">check-static</span> <span class="o">=</span> <span class="s">/var/www</span>
<span class="na">endif</span> <span class="o">=</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">:3031</span>
</pre></div>
</div>
</div>
<div class="section" id="if-exists">
<h2>if-exists<a class="headerlink" href="#if-exists" title="Permalink to this headline">¶</a></h2>
<p>Check for the existence of a file or directory. The context placeholder is set
to the filename found.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">http</span> <span class="o">=</span> <span class="s">:9090</span>
<span class="c1">; redirect all requests if a file exists</span>
<span class="na">if-exists</span> <span class="o">=</span> <span class="s">/tmp/maintenance.txt</span>
<span class="na">route</span> <span class="o">=</span> <span class="s">.* redirect:/offline</span>
<span class="na">endif</span> <span class="o">=</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above example uses <a class="reference internal" href="InternalRouting.html"><span class="doc">uWSGI internal routing</span></a>.</p>
</div>
</div>
<div class="section" id="if-file">
<h2>if-file<a class="headerlink" href="#if-file" title="Permalink to this headline">¶</a></h2>
<p>Check if the given path exists and is a regular file. The context placeholder
is set to the filename found.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;uwsgi&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>python<span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;http-socket&gt;</span>:8080<span class="nt">&lt;/http-socket&gt;</span>
  <span class="nt">&lt;if-file&gt;</span>settings.py<span class="nt">&lt;/if-file&gt;</span>
    <span class="nt">&lt;module&gt;</span>django.core.handlers.wsgi:WSGIHandler()<span class="nt">&lt;/module&gt;</span>
  <span class="nt">&lt;endif/&gt;</span>
<span class="nt">&lt;/uwsgi&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="if-dir">
<h2>if-dir<a class="headerlink" href="#if-dir" title="Permalink to this headline">¶</a></h2>
<p>Check if the given path exists and is a directory. The context placeholder is
set to the filename found.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>uwsgi:
  socket: 4040
  processes: 2
  if-dir: config.ru
  rack: %(_)
  endif:
</pre></div>
</div>
</div>
<div class="section" id="if-opt">
<h2>if-opt<a class="headerlink" href="#if-opt" title="Permalink to this headline">¶</a></h2>
<p>Check if the given option is set, or has a given value. The context
placeholder is set to the value of the option reference.</p>
<p>To check if an option was set, pass just the option name to <code class="docutils literal notranslate"><span class="pre">if-opt</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">uwsgi</span><span class="p">:</span>
  <span class="nt">cheaper</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="nt">if-opt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cheaper</span>
  <span class="nt">print</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Running in cheaper mode, with initially %(_) processes</span>
  <span class="nt">endif</span><span class="p">:</span>
</pre></div>
</div>
<p>To check if an option was set to a specific value, pass
<code class="docutils literal notranslate"><span class="pre">option-name=value</span></code> to <code class="docutils literal notranslate"><span class="pre">if-opt</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">uwsgi</span><span class="p">:</span>
  <span class="c1"># Set busyness parameters if it was chosen</span>
  <span class="nt">if-opt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cheaper-algo=busyness</span>
  <span class="nt">cheaper-busyness-max</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25</span>
  <span class="nt">cheaper-busyness-min</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">endif</span><span class="p">:</span>
</pre></div>
</div>
<p>Due to the way uWSGI parses its configs, you can only refer to options
that uWSGI has previously seen. In particular, this means:</p>
<ul>
<li><p>Only options that are set above the <code class="docutils literal notranslate"><span class="pre">if-opt</span></code> option are taken into
account. This includes any options set by previous <code class="docutils literal notranslate"><span class="pre">include</span></code> (or
type specific includes like <code class="docutils literal notranslate"><span class="pre">ini</span></code>) options, but does not include
options set by previous <code class="docutils literal notranslate"><span class="pre">inherit</span></code> options).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if-opt</span></code> is processed after expanding magic variables, but before
expanding placeholders and other variables. So if you use <code class="docutils literal notranslate"><span class="pre">if-opt</span></code>
to compare the value of an option, check against the value as stated
in the config file, with only the magic variables filled in.</p>
<p>If you use the context placeholder <code class="docutils literal notranslate"><span class="pre">%(_)</span></code> inside the <code class="docutils literal notranslate"><span class="pre">if-opt</span></code>
block, you should be ok: any placeholders will later be expanded.</p>
</li>
<li><p>If an option is specified multiple times, only the value of the first
one will be seen by <code class="docutils literal notranslate"><span class="pre">if-opt</span></code>.</p></li>
<li><p>Only explicitly set values will be seen, not implicit defaults.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="ParsingOrder.html"><span class="doc">How uWSGI parses config files</span></a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration logic</a><ul>
<li><a class="reference internal" href="#for">for</a></li>
<li><a class="reference internal" href="#if-env">if-env</a></li>
<li><a class="reference internal" href="#if-exists">if-exists</a></li>
<li><a class="reference internal" href="#if-file">if-file</a></li>
<li><a class="reference internal" href="#if-dir">if-dir</a></li>
<li><a class="reference internal" href="#if-opt">if-opt</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="FallbackConfig.html"
                        title="previous chapter">Fallback configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Options.html"
                        title="next chapter">uWSGI Options</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ConfigLogic.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Options.html" title="uWSGI Options"
             >next</a> |</li>
        <li class="right" >
          <a href="FallbackConfig.html" title="Fallback configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>