
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>The uWSGI build system &#8212; uWSGI 2.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Managing the uWSGI server" href="Management.html" />
    <link rel="prev" title="Installing uWSGI" href="Install.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Management.html" title="Managing the uWSGI server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Install.html" title="Installing uWSGI"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-uwsgi-build-system">
<h1>The uWSGI build system<a class="headerlink" href="#the-uwsgi-build-system" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>This is updated to 1.9.13</p></li>
</ul>
<p>This page describes how the uWSGI build system works and how it can be customized</p>
<div class="section" id="uwsgiconfig-py">
<h2>uwsgiconfig.py<a class="headerlink" href="#uwsgiconfig-py" title="Permalink to this headline">¶</a></h2>
<p>This is the python script aimed at calling the various compile/link stage.</p>
<p>During 2009, when uWSGI guidelines (and mantra) started to be defined, people agreed that autotools, cmake and friends
was not loved by a lot of sysadmins. Albeit they are pretty standardized, the amount of packages needed and the incompatibility
between them (especially in the autotools world) was a problem for a project with fast development/evolution where “compile from sources” was, is and very probably will be the best way
to get the best from the product. In addition to this the build procedure MUST BE fast (less than 1 minute on entry level x86 is the main rule)</p>
<p>For such a reason, to compile uWSGI you only need to have a c compiler suite (gcc, clang…) and a python interpreter. Someone could argue that perl
could have been a better choice, and maybe it is the truth (it is generally installed by default in lot of operating systems), but we decided to stay with python mainly
because when uWSGI started it was a python-only application. (Obviously if you want to develop an alternative build system you are free to do it)</p>
<p>The uwsgiconfig.py basically detects the available features in the system and builds a uwsgi binary (and eventually its plugins) using the
so called ‘build profile’</p>
</div>
<div class="section" id="build-profiles">
<h2>build profiles<a class="headerlink" href="#build-profiles" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="first-example">
<h2>First example<a class="headerlink" href="#first-example" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="cc-and-cpp">
<h2>CC and CPP<a class="headerlink" href="#cc-and-cpp" title="Permalink to this headline">¶</a></h2>
<p>These 2 environment variables tell uwsgiconfig.py to use an alternative C compiler and C preprocessor.</p>
<p>If they are not defined the procedure is the following:</p>
<p>For CC -&gt; try to get the CC config_var from the python binary running uwsgiconfig.py, fallback to ‘gcc’</p>
<p>For CPP -&gt; fallback to ‘cpp’</p>
<p>As an example, on a system with both gcc and clang you will end with</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>clang <span class="nv">CPP</span><span class="o">=</span>clang-cpp python uwsgiconfig.py --build
</pre></div>
</div>
</div>
<div class="section" id="cpucount">
<h2>CPUCOUNT<a class="headerlink" href="#cpucount" title="Permalink to this headline">¶</a></h2>
<p>In the spirit of “easy and fast build even on production systems”, uwsgiconfig.py tries to use all of your cpu cores spawning multiple
instances of the c compiler (one per-core).</p>
<p>You can override this system using the CPUCOUNT environment variable, forcing the number of detected cpu cores (setting to 1 will disable parallel build).</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">CPUCOUNT</span><span class="o">=</span><span class="m">2</span> python uwsgiconfig.py --build
</pre></div>
</div>
</div>
<div class="section" id="uwsgi-force-rebuild">
<h2>UWSGI_FORCE_REBUILD<a class="headerlink" href="#uwsgi-force-rebuild" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="plugins-and-uwsgiplugin-py">
<h2>Plugins and uwsgiplugin.py<a class="headerlink" href="#plugins-and-uwsgiplugin-py" title="Permalink to this headline">¶</a></h2>
<p>A uWSGI plugin is a shared library exporting the &lt;name&gt;_plugin symbol. Where &lt;name&gt; is the name of the plugin.</p>
<p>As an example the psgi plugin will export the psgi_plugin symbol as well as pypy will export he pypy_plugin symbol and so on.</p>
<p>This symbol is a uwsgi_plugin C struct defining the hooks of the plugin.</p>
<p>When you ask uWSGI to load a plugin it simply calls dlopen() and get the uwsgi_plugin struct via dlsym().</p>
<p>The vast majority of the uWSGI project is developed as a plugin. This structure ensures a modular approach to configuration and a saner development style.</p>
<p>The sysadmin is free to embed each plugin in the server binary or to build each plugin as an external shared library.</p>
<p>Embedded plugins are defined in the ‘embedded_plugins’ directive of the build profile. You can add more embedded plugins
from the command line using the UWSGI_EMBED_PLUGINS environment variable (see below).</p>
<p>Instead, if you want to build a plugin as a shared library just run uwsgiconfig.py with the –plugin option</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python uwsgiconfig.py --plugin plugins/psgi
</pre></div>
</div>
<p>this will build the plugin in plugins/psgi to the psgi_plugin.so file</p>
<p>To specify a build profile when you build a plugin, you can pass the profile as an additional argument</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python uwsgiconfig.py --plugin plugins/psgi mybuildprofile
</pre></div>
</div>
</div>
<div class="section" id="uwsgi-includes">
<h2>UWSGI_INCLUDES<a class="headerlink" href="#uwsgi-includes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>this has been added in 1.9.13</p></li>
</ul>
<p>On startup, the CPP binary is run to detect default include paths. You can add more paths using the UWSGI_INCLUDES environment variable</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">UWSGI_INCLUDES</span><span class="o">=</span>/usr/local/include,/opt/dev/include python uwsgiconfig.py --build
</pre></div>
</div>
</div>
<div class="section" id="uwsgi-embed-plugins">
<h2>UWSGI_EMBED_PLUGINS<a class="headerlink" href="#uwsgi-embed-plugins" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="uwsgi-embed-config">
<h2>UWSGI_EMBED_CONFIG<a class="headerlink" href="#uwsgi-embed-config" title="Permalink to this headline">¶</a></h2>
<p>Allows embedding the specified .ini file in the server binary (currently Linux only)</p>
<p>On startup the server parses the embedded file as soon as possible.</p>
<p>Custom options defined in the embedded config will be available as standard ones.</p>
</div>
<div class="section" id="uwsgi-bin-name">
<h2>UWSGI_BIN_NAME<a class="headerlink" href="#uwsgi-bin-name" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="cflags-and-ldflags">
<h2>CFLAGS and LDFLAGS<a class="headerlink" href="#cflags-and-ldflags" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="uwsgiconfig-for-plugins">
<h2>UWSGICONFIG_* for plugins<a class="headerlink" href="#uwsgiconfig-for-plugins" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="libuwsgi-so">
<h2>libuwsgi.so<a class="headerlink" href="#libuwsgi-so" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="uwsgibuild-log">
<h2>uwsgibuild.log<a class="headerlink" href="#uwsgibuild-log" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="uwsgibuild-lastcflags">
<h2>uwsgibuild.lastcflags<a class="headerlink" href="#uwsgibuild-lastcflags" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="cflags-and-uwsgi-h-magic">
<h2>cflags and uwsgi.h magic<a class="headerlink" href="#cflags-and-uwsgi-h-magic" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="embedding-files">
<h2>embedding files<a class="headerlink" href="#embedding-files" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="the-fake-make">
<h2>The fake make<a class="headerlink" href="#the-fake-make" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The uWSGI build system</a><ul>
<li><a class="reference internal" href="#uwsgiconfig-py">uwsgiconfig.py</a></li>
<li><a class="reference internal" href="#build-profiles">build profiles</a></li>
<li><a class="reference internal" href="#first-example">First example</a></li>
<li><a class="reference internal" href="#cc-and-cpp">CC and CPP</a></li>
<li><a class="reference internal" href="#cpucount">CPUCOUNT</a></li>
<li><a class="reference internal" href="#uwsgi-force-rebuild">UWSGI_FORCE_REBUILD</a></li>
<li><a class="reference internal" href="#plugins-and-uwsgiplugin-py">Plugins and uwsgiplugin.py</a></li>
<li><a class="reference internal" href="#uwsgi-includes">UWSGI_INCLUDES</a></li>
<li><a class="reference internal" href="#uwsgi-embed-plugins">UWSGI_EMBED_PLUGINS</a></li>
<li><a class="reference internal" href="#uwsgi-embed-config">UWSGI_EMBED_CONFIG</a></li>
<li><a class="reference internal" href="#uwsgi-bin-name">UWSGI_BIN_NAME</a></li>
<li><a class="reference internal" href="#cflags-and-ldflags">CFLAGS and LDFLAGS</a></li>
<li><a class="reference internal" href="#uwsgiconfig-for-plugins">UWSGICONFIG_* for plugins</a></li>
<li><a class="reference internal" href="#libuwsgi-so">libuwsgi.so</a></li>
<li><a class="reference internal" href="#uwsgibuild-log">uwsgibuild.log</a></li>
<li><a class="reference internal" href="#uwsgibuild-lastcflags">uwsgibuild.lastcflags</a></li>
<li><a class="reference internal" href="#cflags-and-uwsgi-h-magic">cflags and uwsgi.h magic</a></li>
<li><a class="reference internal" href="#embedding-files">embedding files</a></li>
<li><a class="reference internal" href="#the-fake-make">The fake make</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Install.html"
                        title="previous chapter">Installing uWSGI</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Management.html"
                        title="next chapter">Managing the uWSGI server</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/BuildSystem.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Management.html" title="Managing the uWSGI server"
             >next</a> |</li>
        <li class="right" >
          <a href="Install.html" title="Installing uWSGI"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">uWSGI 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, uWSGI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>