

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    

    <title>9.1. Database Methods &mdash; Apache CouchDB 1.4 Manual</title>
<!-- RTD <head> -->
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="//media.readthedocs.org/javascript/underscore.js"></script>
<script type="text/javascript" src="//media.readthedocs.org/javascript/doctools.js"></script>

<script type="text/javascript">
  // This is included here for Javascript that doesn't have access to the templates.
  var doc_version = "1.4.x";
  var doc_slug = "couchdb";
  var page_name = "api/database";
</script>

<script type="text/javascript" src="//media.readthedocs.org/javascript/rtd.js"></script>
<!-- end RTD <head> -->

    
    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Apache CouchDB 1.4 Manual" href="../index.html" />
    <link rel="up" title="9. API Reference" href="reference.html" />
    <link rel="next" title="9.2. Document Methods" href="documents.html" />
    <link rel="prev" title="9. API Reference" href="reference.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="documents.html" title="9.2. Document Methods"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="reference.html" title="9. API Reference"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Apache CouchDB 1.4 Manual</a> &raquo;</li>
          <li><a href="reference.html" accesskey="U">9. API Reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="database-methods">
<span id="api-db"></span><h1>9.1. Database Methods<a class="headerlink" href="#database-methods" title="Permalink to this headline">¶</a></h1>
<p>The Database methods provide an interface to an entire database withing
CouchDB. These are database, rather than document, level requests.</p>
<p>A list of the available methods and URL paths are provided below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="33%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Path</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>GET</td>
<td>/db</td>
<td>Returns database information</td>
</tr>
<tr class="row-odd"><td>PUT</td>
<td>/db</td>
<td>Create a new database</td>
</tr>
<tr class="row-even"><td>DELETE</td>
<td>/db</td>
<td>Delete an existing database</td>
</tr>
<tr class="row-odd"><td>GET</td>
<td>/db/_all_docs</td>
<td>Returns a built-in view of all documents
in this database</td>
</tr>
<tr class="row-even"><td>POST</td>
<td>/db/_all_docs</td>
<td>Returns certain rows from the built-in
view of all documents</td>
</tr>
<tr class="row-odd"><td>POST</td>
<td>/db/_bulk_docs</td>
<td>Insert multiple documents in to the
database in a single request</td>
</tr>
<tr class="row-even"><td>GET</td>
<td>/db/_changes</td>
<td>Returns changes for the given database</td>
</tr>
<tr class="row-odd"><td>POST</td>
<td>/db/_compact</td>
<td>Starts a compaction for the database</td>
</tr>
<tr class="row-even"><td>POST</td>
<td>/db/_compact/design-doc</td>
<td>Starts a compaction for all the views in
the selected design document</td>
</tr>
<tr class="row-odd"><td>POST</td>
<td>/db/_ensure_full_commit</td>
<td>Makes sure all uncommitted changes are
written and synchronized to the disk</td>
</tr>
<tr class="row-even"><td>POST</td>
<td>/db/_missing_revs</td>
<td>Given a list of document revisions,
returns the document revisions that do not
exist in the database</td>
</tr>
<tr class="row-odd"><td>POST</td>
<td>/db/_purge</td>
<td>Purge some historical documents entirely
from database history</td>
</tr>
<tr class="row-even"><td>POST</td>
<td>/db/_revs_diff</td>
<td>Given a list of document revisions,
returns differences between the given
revisions and ones that are in the
database</td>
</tr>
<tr class="row-odd"><td>GET</td>
<td>/db/_revs_limit</td>
<td>Gets the limit of historical revisions to
store for a single document in the
database</td>
</tr>
<tr class="row-even"><td>PUT</td>
<td>/db/_revs_limit</td>
<td>Sets the limit of historical revisions to
store for a single document in the
database</td>
</tr>
<tr class="row-odd"><td>GET</td>
<td>/db/_security</td>
<td>Returns the special security object for
the database</td>
</tr>
<tr class="row-even"><td>PUT</td>
<td>/db/_security</td>
<td>Sets the special security object for the
database</td>
</tr>
<tr class="row-odd"><td>POST</td>
<td>/db/_temp_view</td>
<td>Execute a given view function for all
documents and return the result</td>
</tr>
<tr class="row-even"><td>POST</td>
<td>/db/_view_cleanup</td>
<td>Removes view files that are not used by
any design document</td>
</tr>
</tbody>
</table>
<p>For all the database methods, the database name within the URL path
should be the database name that you wish to perform the operation on.
For example, to obtain the meta information for the database
<tt class="docutils literal"><span class="pre">recipes</span></tt>, you would use the HTTP request:</p>
<div class="highlight-http"><pre>GET /recipes</pre>
</div>
<p>For clarity, the form below is used in the URL paths:</p>
<div class="highlight-http"><pre>GET /db</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">db</span></tt> is the name of any database.</p>
<div class="section" id="get-db">
<span id="api-get-db"></span><h2>9.1.1. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db</span></tt><a class="headerlink" href="#get-db" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: Information about the database in JSON format</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>404</strong>:
The requested content could not be found. The returned content will include
further information, as a JSON object, if available.</li>
</ul>
</li>
</ul>
<p>Gets information about the specified database. For example, to retrieve
the information for the database <tt class="docutils literal"><span class="pre">recipe</span></tt>:</p>
<div class="highlight-http"><pre>GET http://couchdb:5984/recipes
Accept: application/json</pre>
</div>
<p>The JSON response contains meta information about the database. A sample
of the JSON returned for an empty database is provided below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;compact_running&quot;</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="s2">&quot;committed_update_seq&quot;</span> <span class="o">:</span> <span class="mi">375048</span><span class="p">,</span>
   <span class="s2">&quot;disk_format_version&quot;</span> <span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
   <span class="s2">&quot;disk_size&quot;</span> <span class="o">:</span> <span class="mi">33153123</span><span class="p">,</span>
   <span class="s2">&quot;doc_count&quot;</span> <span class="o">:</span> <span class="mi">18386</span><span class="p">,</span>
   <span class="s2">&quot;doc_del_count&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
   <span class="s2">&quot;db_name&quot;</span> <span class="o">:</span> <span class="s2">&quot;recipes&quot;</span><span class="p">,</span>
   <span class="s2">&quot;instance_start_time&quot;</span> <span class="o">:</span> <span class="s2">&quot;1290700340925570&quot;</span><span class="p">,</span>
   <span class="s2">&quot;purge_seq&quot;</span> <span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
   <span class="s2">&quot;update_seq&quot;</span> <span class="o">:</span> <span class="mi">375048</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The elements of the returned structure are shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>committed_update_seq</td>
<td>The number of committed update.</td>
</tr>
<tr class="row-odd"><td>compact_running</td>
<td>Set to true if the database compaction
routine is operating on this database.</td>
</tr>
<tr class="row-even"><td>db_name</td>
<td>The name of the database.</td>
</tr>
<tr class="row-odd"><td>disk_format_version</td>
<td>The version of the physical format used
for the data when it is stored on disk.</td>
</tr>
<tr class="row-even"><td>disk_size</td>
<td>Size in bytes of the data as stored on the
disk. Views indexes are not included in
the calculation.</td>
</tr>
<tr class="row-odd"><td>doc_count</td>
<td>A count of the documents in the specified
database.</td>
</tr>
<tr class="row-even"><td>doc_del_count</td>
<td>Number of deleted documents</td>
</tr>
<tr class="row-odd"><td>instance_start_time</td>
<td>Timestamp of when the database was
opened, expressed in microseconds since
the epoch.</td>
</tr>
<tr class="row-even"><td>purge_seq</td>
<td>The number of purge operations on the
database.</td>
</tr>
<tr class="row-odd"><td>update_seq</td>
<td>The current number of updates to the
database.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="put-db">
<h2>9.1.2. <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db</span></tt><a class="headerlink" href="#put-db" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>400</strong>:
Invalid database name</li>
<li><strong>412</strong>:
Database already exists</li>
</ul>
</li>
</ul>
<p>Creates a new database. The database name must be composed of one or
more of the following characters:</p>
<ul class="simple">
<li>Lowercase characters (<tt class="docutils literal"><span class="pre">a-z</span></tt>)</li>
<li>Name must begin with a lowercase letter</li>
<li>Digits (<tt class="docutils literal"><span class="pre">0-9</span></tt>)</li>
<li>Any of the characters <tt class="docutils literal"><span class="pre">_</span></tt>, <tt class="docutils literal"><span class="pre">$</span></tt>, <tt class="docutils literal"><span class="pre">(</span></tt>, <tt class="docutils literal"><span class="pre">)</span></tt>, <tt class="docutils literal"><span class="pre">+</span></tt>, <tt class="docutils literal"><span class="pre">-</span></tt>, and
<tt class="docutils literal"><span class="pre">/</span></tt>.</li>
</ul>
<p>Trying to create a database that does not meet these requirements will
return an error quoting these restrictions.</p>
<p>To create the database <tt class="docutils literal"><span class="pre">recipes</span></tt>:</p>
<div class="highlight-http"><pre>PUT http://couchdb:5984/recipes
Content-Type: application/json</pre>
</div>
<p>The returned content contains the JSON status:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Anything should be treated as an error, and the problem should be taken
form the HTTP response code.</p>
</div>
<div class="section" id="delete-db">
<h2>9.1.3. <tt class="docutils literal"><span class="pre">DELETE</span> <span class="pre">/db</span></tt><a class="headerlink" href="#delete-db" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">DELETE</span> <span class="pre">/db</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>200</strong>:
Database has been deleted</li>
<li><strong>404</strong>:
The requested content could not be found. The returned content will include
further information, as a JSON object, if available.</li>
</ul>
</li>
</ul>
<p>Deletes the specified database, and all the documents and attachments
contained within it.</p>
<p>To delete the database <tt class="docutils literal"><span class="pre">recipes</span></tt> you would send the request:</p>
<div class="highlight-http"><pre>DELETE http://couchdb:5984/recipes
Content-Type: application/json</pre>
</div>
<p>If successful, the returned JSON will indicate success</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="get-db-changes">
<span id="api-changes"></span><h2>9.1.4. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_changes</span></tt><a class="headerlink" href="#get-db-changes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_changes</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Query Arguments</strong>:<ul>
<li><strong>Argument</strong>: doc_ids<ul>
<li><strong>Description</strong>:  Specify the list of documents IDs to be filtered</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: json</li>
<li><strong>Default</strong>: none</li>
</ul>
</li>
<li><strong>Argument</strong>: feed<ul>
<li><strong>Description</strong>:  Type of feed</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>: normal</li>
<li><strong>Supported Values</strong>:<ul>
<li><strong>continuous</strong>: Continuous (non-polling) mode</li>
<li><strong>longpoll</strong>: Long polling mode</li>
<li><strong>normal</strong>: Normal mode</li>
</ul>
</li>
</ul>
</li>
<li><strong>Argument</strong>: filter<ul>
<li><strong>Description</strong>:  Filter function from a design document to get updates</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>: none</li>
<li><strong>Supported Values</strong>:</li>
</ul>
</li>
<li><strong>Argument</strong>: heartbeat<ul>
<li><strong>Description</strong>:  Period after which an empty line is sent during longpoll
or continuous</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: numeric</li>
<li><strong>Default</strong>: 60000</li>
<li><strong>Quantity</strong>: milliseconds</li>
</ul>
</li>
<li><strong>Argument</strong>: include_docs<ul>
<li><strong>Description</strong>:  Include the document with the result</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: boolean</li>
<li><strong>Default</strong>: false</li>
</ul>
</li>
<li><strong>Argument</strong>: limit<ul>
<li><strong>Description</strong>:  Maximum number of rows rows to return</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: numeric</li>
<li><strong>Default</strong>: none</li>
</ul>
</li>
<li><strong>Argument</strong>: since<ul>
<li><strong>Description</strong>:  Start the results from changes immediately after the
specified sequence number</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: numeric</li>
<li><strong>Default</strong>: 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Obtains a list of the changes made to the database. This can be used to
monitor for update and modifications to the database for post processing
or synchronization. There are three different types of supported changes
feeds, poll, longpoll, and continuous. All requests are poll requests by
default. You can select any feed type explicitly using the <tt class="docutils literal"><span class="pre">feed</span></tt>
query argument.</p>
<ul>
<li><p class="first"><strong>Poll</strong></p>
<p>With polling you can request the changes that have occured since a
specific sequence number. This returns the JSON structure containing
the changed document information. When you perform a poll change
request, only the changes since the specific sequence number are
returned. For example, the query</p>
<div class="highlight-http"><pre>DELETE http://couchdb:5984/recipes/_changes
Content-Type: application/json</pre>
</div>
<p>Will get all of the changes in the database. You can request a
starting point using the <tt class="docutils literal"><span class="pre">since</span></tt> query argument and specifying the
sequence number. You will need to record the latest sequence number
in your client and then use this when making another request as the
new value to the <tt class="docutils literal"><span class="pre">since</span></tt> parameter.</p>
</li>
<li><p class="first"><strong>Longpoll</strong></p>
<p>With long polling the request to the server will remain open until a
change is made on the database, when the changes will be reported,
and then the connection will close. The long poll is useful when you
want to monitor for changes for a specific purpose without wanting to
monitoring continuously for changes.</p>
<p>Because the wait for a change can be significant you can set a
timeout before the connection is automatically closed (the
<tt class="docutils literal"><span class="pre">timeout</span></tt> argument). You can also set a heartbeat interval (using
the <tt class="docutils literal"><span class="pre">heartbeat</span></tt> query argument), which sends a newline to keep the
connection open.</p>
</li>
<li><p class="first"><strong>Continuous</strong></p>
<p>Continuous sends all new changes back to the client immediately,
without closing the connection. In continuous mode the format of the
changes is slightly different to accommodate the continuous nature
while ensuring that the JSON output is still valid for each change
notification.</p>
<p>As with the longpoll feed type you can set both the timeout and
heartbeat intervals to ensure that the connection is kept open for
new changes and updates.</p>
</li>
</ul>
<p>The return structure for <tt class="docutils literal"><span class="pre">normal</span></tt> and <tt class="docutils literal"><span class="pre">longpoll</span></tt> modes is a JSON
array of changes objects, and the last update sequence number. The
structure is described in the following table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>last_seq</td>
<td>Last change sequence number.</td>
</tr>
<tr class="row-odd"><td>results [array]</td>
<td>Changes made to a database</td>
</tr>
<tr class="row-even"><td>changes [array]</td>
<td>List of changes, field-by-field, for this
document</td>
</tr>
<tr class="row-odd"><td>id</td>
<td>Document ID</td>
</tr>
<tr class="row-even"><td>seq</td>
<td>Update sequence number</td>
</tr>
</tbody>
</table>
<p>The return format for <tt class="docutils literal"><span class="pre">continuous</span></tt> mode the server sends a <tt class="docutils literal"><span class="pre">CRLF</span></tt>
(carriage-return, linefeed) delimited line for each change. Each line
contains the <a class="reference external" href="#table-couchdb-api-db_db-json-changes">JSON object</a>.</p>
<p>You can also request the full contents of each document change (instead
of just the change notification) by using the <tt class="docutils literal"><span class="pre">include_docs</span></tt>
parameter.</p>
<div class="section" id="filtering">
<h3>9.1.4.1. Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h3>
<p>You can filter the contents of the changes feed in a number of ways. The
most basic way is to specify one or more document IDs to the query. This
causes the returned structure value to only contain changes for the
specified IDs. Note that the value of this query argument should be a
JSON formatted array.</p>
<p>You can also filter the <tt class="docutils literal"><span class="pre">_changes</span></tt> feed by defining a filter function
within a design document. The specification for the filter is the same
as for replication filters. You specify the name of the filter function
to the <tt class="docutils literal"><span class="pre">filter</span></tt> parameter, specifying the design document name and
filter name. For example:</p>
<div class="highlight-http"><pre>GET /db/_changes?filter=design_doc/filtername</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">_changes</span></tt> feed can be used to watch changes to specific document
ID&#8217;s or the list of <tt class="docutils literal"><span class="pre">_design</span></tt> documents in a database. If the
<tt class="docutils literal"><span class="pre">filters</span></tt> parameter is set to <tt class="docutils literal"><span class="pre">_doc_ids</span></tt> a list of doc IDs can be
passed in the <tt class="docutils literal"><span class="pre">doc_ids</span></tt> parameter as a JSON array. For more
information, see <a class="reference internal" href="../changes.html#changes"><em>Changes Feed</em></a>.</p>
</div>
</div>
<div class="section" id="post-db-compact">
<span id="api-compact"></span><h2>9.1.5. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_compact</span></tt><a class="headerlink" href="#post-db-compact" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_compact</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: yes</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>202</strong>:
Compaction request has been accepted</li>
<li><strong>404</strong>:
The requested content could not be found. The returned content will include
further information, as a JSON object, if available.</li>
</ul>
</li>
</ul>
<p>Request compaction of the specified database. Compaction compresses the
disk database file by performing the following operations:</p>
<ul class="simple">
<li>Writes a new version of the database file, removing any unused
sections from the new version during write. Because a new file is
temporary created for this purpose, you will need twice the current
storage space of the specified database in order for the compaction
routine to complete.</li>
<li>Removes old revisions of documents from the database, up to the
per-database limit specified by the <tt class="docutils literal"><span class="pre">_revs_limit</span></tt> database
parameter. See <a class="reference internal" href="#api-get-db"><em>GET /db</em></a>.</li>
</ul>
<p>Compaction can only be requested on an individual database; you cannot
compact all the databases for a CouchDB instance. The compaction process
runs as a background process.</p>
<p>You can determine if the compaction process is operating on a database
by obtaining the database meta information, the <tt class="docutils literal"><span class="pre">compact_running</span></tt>
value of the returned database structure will be set to true. See
<a class="reference internal" href="#api-get-db"><em>GET /db</em></a>.</p>
<p>You can also obtain a list of running processes to determine whether
compaction is currently running. See <a class="reference internal" href="misc.html#active-tasks"><em>GET /_active_tasks</em></a>.</p>
</div>
<div class="section" id="post-db-compact-design-doc">
<span id="api-compact-ddoc"></span><h2>9.1.6. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_compact/design-doc</span></tt><a class="headerlink" href="#post-db-compact-design-doc" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_compact/design-doc</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: yes</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>202</strong>:
Compaction request has been accepted</li>
<li><strong>404</strong>:
The requested content could not be found. The returned content will include
further information, as a JSON object, if available.</li>
</ul>
</li>
</ul>
<p>Compacts the view indexes associated with the specified design document.
You can use this in place of the full database compaction if you know a
specific set of view indexes have been affected by a recent database
change.</p>
<p>For example, to compact the views associated with the <tt class="docutils literal"><span class="pre">recipes</span></tt> design
document:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_compact/recipes
Content-Type: application/json</pre>
</div>
<p>CouchDB will immediately return with a status indicating that the
compaction request has been received (HTTP status code 202):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="post-db-view-cleanup">
<h2>9.1.7. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_view_cleanup</span></tt><a class="headerlink" href="#post-db-view-cleanup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_view_cleanup</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: yes</li>
</ul>
<p>Cleans up the cached view output on disk for a given view. For example:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_view_cleanup
Content-Type: application/json</pre>
</div>
<p>If the request is successful, a basic status message us returned:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="post-db-ensure-full-commit">
<h2>9.1.8. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_ensure_full_commit</span></tt><a class="headerlink" href="#post-db-ensure-full-commit" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_ensure_full_commit</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>202</strong>:
Commit completed successfully</li>
<li><strong>404</strong>:
The requested content could not be found. The returned content will include
further information, as a JSON object, if available.</li>
</ul>
</li>
</ul>
<p>Commits any recent changes to the specified database to disk. You should
call this if you want to ensure that recent changes have been written.
For example, to commit all the changes to disk for the database
<tt class="docutils literal"><span class="pre">recipes</span></tt> you would use:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_ensure_full_commit
Content-Type: application/json</pre>
</div>
<p>This returns a status message, containing the success message and the
timestamp for when the CouchDB instance was started:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;instance_start_time&quot;</span> <span class="o">:</span> <span class="s2">&quot;1288186189373361&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="post-db-bulk-docs">
<h2>9.1.9. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_bulk_docs</span></tt><a class="headerlink" href="#post-db-bulk-docs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_bulk_docs</span></tt></li>
<li><strong>Request</strong>: JSON of the docs and updates to be applied</li>
<li><strong>Response</strong>: JSON success statement</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Return Codes</strong>:<ul>
<li><strong>201</strong>:
Document(s) have been created or updated</li>
</ul>
</li>
</ul>
<p>The bulk document API allows you to create and update multiple documents
at the same time within a single request. The basic operation is similar
to creating or updating a single document, except that you batch the
document structure and information and . When creating new documents the
document ID is optional. For updating existing documents, you must
provide the document ID, revision information, and new document values.</p>
<p>For both inserts and updates the basic structure of the JSON is the
same:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>all_or_nothing (optional)</td>
<td>Sets the database commit mode to use
all-or-nothing semantics</td>
</tr>
<tr class="row-odd"><td>docs [array]</td>
<td>Bulk Documents Document</td>
</tr>
<tr class="row-even"><td>_id (optional)</td>
<td>List of changes, field-by-field, for this
document</td>
</tr>
<tr class="row-odd"><td>_rev (optional)</td>
<td>Document ID</td>
</tr>
<tr class="row-even"><td>_deleted (optional)</td>
<td>Update sequence number</td>
</tr>
</tbody>
</table>
<div class="section" id="inserting-documents-in-bulk">
<h3>9.1.9.1. Inserting Documents in Bulk<a class="headerlink" href="#inserting-documents-in-bulk" title="Permalink to this headline">¶</a></h3>
<p>To insert documents in bulk into a database you need to supply a JSON
structure with the array of documents that you want to add to the
database. Using this method you can either include a document ID, or
allow the document ID to be automatically generated.</p>
<p>For example, the following inserts three new documents, two with the
supplied document IDs, and one which will have a document ID generated:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;docs&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;FishStew&quot;</span><span class="p">,</span>
         <span class="s2">&quot;servings&quot;</span> <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
         <span class="s2">&quot;subtitle&quot;</span> <span class="o">:</span> <span class="s2">&quot;Delicious with fresh bread&quot;</span><span class="p">,</span>
         <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;Fish Stew&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;LambStew&quot;</span><span class="p">,</span>
         <span class="s2">&quot;servings&quot;</span> <span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
         <span class="s2">&quot;subtitle&quot;</span> <span class="o">:</span> <span class="s2">&quot;Delicious with scone topping&quot;</span><span class="p">,</span>
         <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;Lamb Stew&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;servings&quot;</span> <span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
         <span class="s2">&quot;subtitle&quot;</span> <span class="o">:</span> <span class="s2">&quot;Delicious with suet dumplings&quot;</span><span class="p">,</span>
         <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;Beef Stew&quot;</span>
      <span class="p">},</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The return type from a bulk insertion will be 201, with the content of
the returned structure indicating specific success or otherwise messages
on a per-document basis.</p>
<p>The return structure from the example above contains a list of the
documents created, here with the combination and their revision IDs:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_bulk_docs
Content-Type: application/json

[
   {
      "id" : "FishStew",
      "rev" : "1-9c65296036141e575d32ba9c034dd3ee",
   },
   {
      "id" : "LambStew",
      "rev" : "1-34c318924a8f327223eed702ddfdc66d",
   },
   {
      "id" : "7f7638c86173eb440b8890839ff35433",
      "rev" : "1-857c7cbeb6c8dd1dd34a0c73e8da3c44",
   }
]</pre>
</div>
<p>The content and structure of the returned JSON will depend on the transaction
semantics being used for the bulk update; see <a class="reference internal" href="#bulk-semantics"><em>Bulk Documents Transaction Semantics</em></a> for more
information. Conflicts and validation errors when updating documents in
bulk must be handled separately; see <a class="reference internal" href="#bulk-validation"><em>Bulk Document Validation and Conflict Errors</em></a>.</p>
</div>
<div class="section" id="updating-documents-in-bulk">
<h3>9.1.9.2. Updating Documents in Bulk<a class="headerlink" href="#updating-documents-in-bulk" title="Permalink to this headline">¶</a></h3>
<p>The bulk document update procedure is similar to the insertion
procedure, except that you must specify the document ID and current
revision for every document in the bulk update JSON string.</p>
<p>For example, you could send the following request:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_bulk_docs
Content-Type: application/json

{
   "docs" : [
      {
         "_id" : "FishStew",
         "_rev" : "1-9c65296036141e575d32ba9c034dd3ee",
         "servings" : 4,
         "subtitle" : "Delicious with freshly baked bread",
         "title" : "Fish Stew"
      },
      {
         "_id" : "LambStew",
         "_rev" : "1-34c318924a8f327223eed702ddfdc66d",
         "servings" : 6,
         "subtitle" : "Serve with a wholemeal scone topping",
         "title" : "Lamb Stew"
      },
      {
         "_id" : "7f7638c86173eb440b8890839ff35433"
         "_rev" : "1-857c7cbeb6c8dd1dd34a0c73e8da3c44",
         "servings" : 8,
         "subtitle" : "Hand-made dumplings make a great accompaniment",
         "title" : "Beef Stew"
      }
   ]
}</pre>
</div>
<p>The return structure is the JSON of the updated documents, with the new
revision and ID information:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;FishStew&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;2-e7af4c4e9981d960ecf78605d79b06d1&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;LambStew&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;2-0786321986194c92dd3b57dfbfc741ce&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;7f7638c86173eb440b8890839ff35433&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;2-bdd3bf3563bee516b96885a66c743f8e&quot;</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You can optionally delete documents during a bulk update by adding the
<tt class="docutils literal"><span class="pre">_deleted</span></tt> field with a value of <tt class="docutils literal"><span class="pre">true</span></tt> to each document ID/revision
combination within the submitted JSON structure.</p>
<p>The return type from a bulk insertion will be 201, with the content of
the returned structure indicating specific success or otherwise messages
on a per-document basis.</p>
<p>The content and structure of the returned JSON will depend on the transaction
semantics being used for the bulk update; see <a class="reference internal" href="#bulk-semantics"><em>Bulk Documents Transaction Semantics</em></a> for more
information. Conflicts and validation errors when updating documents in
bulk must be handled separately; see <a class="reference internal" href="#bulk-validation"><em>Bulk Document Validation and Conflict Errors</em></a>.</p>
</div>
<div class="section" id="bulk-documents-transaction-semantics">
<span id="bulk-semantics"></span><h3>9.1.9.3. Bulk Documents Transaction Semantics<a class="headerlink" href="#bulk-documents-transaction-semantics" title="Permalink to this headline">¶</a></h3>
<p>CouchDB supports two different modes for updating (or inserting)
documents using the bulk documentation system. Each mode affects both
the state of the documents in the event of system failure, and the level
of conflict checking performed on each document. The two modes are:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">non-atomic</span></tt></p>
<p>The default mode is non-atomic, that is, CouchDB will only guarantee
that some of the documents will be saved when you send the request.
The response will contain the list of documents successfully inserted
or updated during the process. In the event of a crash, some of the
documents may have been successfully saved, and some will have been
lost.</p>
<p>In this mode, the response structure will indicate whether the
document was updated by supplying the new <tt class="docutils literal"><span class="pre">_rev</span></tt> parameter
indicating a new document revision was created. If the update failed,
then you will get an <tt class="docutils literal"><span class="pre">error</span></tt> of type <tt class="docutils literal"><span class="pre">conflict</span></tt>. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;FishStew&quot;</span><span class="p">,</span>
      <span class="s2">&quot;error&quot;</span> <span class="o">:</span> <span class="s2">&quot;conflict&quot;</span><span class="p">,</span>
      <span class="s2">&quot;reason&quot;</span> <span class="o">:</span> <span class="s2">&quot;Document update conflict.&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;LambStew&quot;</span><span class="p">,</span>
      <span class="s2">&quot;error&quot;</span> <span class="o">:</span> <span class="s2">&quot;conflict&quot;</span><span class="p">,</span>
      <span class="s2">&quot;reason&quot;</span> <span class="o">:</span> <span class="s2">&quot;Document update conflict.&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;7f7638c86173eb440b8890839ff35433&quot;</span><span class="p">,</span>
      <span class="s2">&quot;error&quot;</span> <span class="o">:</span> <span class="s2">&quot;conflict&quot;</span><span class="p">,</span>
      <span class="s2">&quot;reason&quot;</span> <span class="o">:</span> <span class="s2">&quot;Document update conflict.&quot;</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In this case no new revision has been created and you will need to
submit the document update, with the correct revision tag, to update
the document.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">all-or-nothing</span></tt></p>
<p>In all-or-nothing mode, either all documents are written to the
database, or no documents are written to the database, in the event
of a system failure during commit.</p>
<p>In addition, the per-document conflict checking is not performed.
Instead a new revision of the document is created, even if the new
revision is in conflict with the current revision in the database.
The returned structure contains the list of documents with new
revisions:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;FishStew&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;2-e7af4c4e9981d960ecf78605d79b06d1&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;LambStew&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;2-0786321986194c92dd3b57dfbfc741ce&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;7f7638c86173eb440b8890839ff35433&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;2-bdd3bf3563bee516b96885a66c743f8e&quot;</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>When updating documents using this mode the revision of a document
included in views will be arbitrary. You can check the conflict
status for a document by using the <tt class="docutils literal"><span class="pre">conflicts=true</span></tt> query argument
when accessing the view. Conflicts should be handled individually to
ensure the consistency of your database.</p>
<p>To use this mode, you must include the <tt class="docutils literal"><span class="pre">all_or_nothing</span></tt> field (set
to true) within the main body of the JSON of the request.</p>
</li>
</ul>
<p>The effects of different database operations on the different modes are
summarized below:</p>
<ul class="simple">
<li><strong>Transaction Mode</strong>: <tt class="docutils literal"><span class="pre">Non-atomic</span></tt><ul>
<li><strong>Transaction</strong>: <tt class="docutils literal"><span class="pre">Insert</span></tt><ul>
<li><strong>Cause</strong>: Requested document ID already exists</li>
<li><strong>Resolution</strong>: Resubmit with different document ID, or update the
existing document</li>
</ul>
</li>
<li><strong>Transaction</strong>: <tt class="docutils literal"><span class="pre">Update</span></tt><ul>
<li><strong>Cause</strong>: Revision missing or incorrect</li>
<li><strong>Resolution</strong>: Resubmit with correct revision</li>
</ul>
</li>
</ul>
</li>
<li><strong>Transaction Mode</strong>: <tt class="docutils literal"><span class="pre">All-or-nothing</span></tt><ul>
<li><strong>Transaction</strong>: <tt class="docutils literal"><span class="pre">Insert</span></tt> / <tt class="docutils literal"><span class="pre">Update</span></tt><ul>
<li><strong>Cause</strong>: Additional revision inserted</li>
<li><strong>Resolution</strong>: Resolve conflicted revisions</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Replication of documents is independent of the type of insert or update.
The documents and revisions created during a bulk insert or update are
replicated in the same way as any other document. This can mean that if
you make use of the all-or-nothing mode the exact list of documents,
revisions (and their conflict state) may or may not be replicated to
other databases correctly.</p>
</div>
<div class="section" id="bulk-document-validation-and-conflict-errors">
<span id="bulk-validation"></span><h3>9.1.9.4. Bulk Document Validation and Conflict Errors<a class="headerlink" href="#bulk-document-validation-and-conflict-errors" title="Permalink to this headline">¶</a></h3>
<p>The JSON returned by the <tt class="docutils literal"><span class="pre">_bulk_docs</span></tt> operation consists of an array
of JSON structures, one for each document in the original submission.
The returned JSON structure should be examined to ensure that all of the
documents submitted in the original request were successfully added to
the database.</p>
<p>The exact structure of the returned information is:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>docs [array]</td>
<td>Bulk Documents Document</td>
</tr>
<tr class="row-odd"><td>id</td>
<td>Document ID</td>
</tr>
<tr class="row-even"><td>error</td>
<td>Error type</td>
</tr>
<tr class="row-odd"><td>reason</td>
<td>Error string with extended reason</td>
</tr>
</tbody>
</table>
<p>When a document (or document revision) is not correctly committed to the
database because of an error, you should check the <tt class="docutils literal"><span class="pre">error</span></tt> field to
determine error type and course of action. Errors will be one of the
following type:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">conflict</span></tt></p>
<p>The document as submitted is in conflict. If you used the default
bulk transaction mode then the new revision will not have been
created and you will need to re-submit the document to the database.
If you used <tt class="docutils literal"><span class="pre">all-or-nothing</span></tt> mode then you will need to manually
resolve the conflicted revisions of the document.</p>
<p>Conflict resolution of documents added using the bulk docs interface
is identical to the resolution procedures used when resolving
conflict errors during replication.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">forbidden</span></tt></p>
<p>Entries with this error type indicate that the validation routine
applied to the document during submission has returned an error.</p>
<p>For example, if your validation routine includes the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">throw</span><span class="p">({</span><span class="nx">forbidden</span><span class="o">:</span> <span class="s1">&#39;invalid recipe ingredient&#39;</span><span class="p">});</span>
</pre></div>
</div>
<p>The error returned will be:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;7f7638c86173eb440b8890839ff35433&quot;</span><span class="p">,</span>
   <span class="s2">&quot;error&quot;</span> <span class="o">:</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">,</span>
   <span class="s2">&quot;reason&quot;</span> <span class="o">:</span> <span class="s2">&quot;invalid recipe ingredient&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="post-db-temp-view">
<h2>9.1.10. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_temp_view</span></tt><a class="headerlink" href="#post-db-temp-view" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_temp_view</span></tt></li>
<li><strong>Request</strong>: JSON with the temporary view definition</li>
<li><strong>Response</strong>: Temporary view result set</li>
<li><strong>Admin Privileges Required</strong>: yes</li>
</ul>
<p>Creates (and executes) a temporary view based on the view function
supplied in the JSON request. For example:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_temp_view
Content-Type: application/json

{
   "map" : "function(doc) { if (doc.value &gt; 9995) { emit(null, doc.value); } }"
}</pre>
</div>
<p>The resulting JSON response is the result from the execution of the
temporary view:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;total_rows&quot;</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
   <span class="s2">&quot;rows&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="mf">9998.41913029012</span><span class="p">,</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;05361cc6aa42033878acc1bacb1f39c2&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="kc">null</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="mf">9998.94149934853</span><span class="p">,</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;1f443f471e5929dd7b252417625ed170&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="kc">null</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="mf">9998.01511339154</span><span class="p">,</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;1f443f471e5929dd7b252417629c102b&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="kc">null</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">&quot;offset&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The arguments also available to standard view requests also apply to
temporary views, but the execution of the view may take some time as it
relies on being executed at the time of the request. In addition to the
time taken, they are also computationally very expensive to produce. You
should use a defined view if you want to achieve the best performance.</p>
</div>
<div class="section" id="post-db-purge">
<h2>9.1.11. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_purge</span></tt><a class="headerlink" href="#post-db-purge" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_purge</span></tt></li>
<li><strong>Request</strong>: JSON of the document IDs/revisions to be purged</li>
<li><strong>Response</strong>: JSON structure with purged documents and purge sequence</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
<p>Occasionally something into ends up in your database that should never have
written to it, like a password or private key. Purge can help you here.</p>
<p>A database purge permanently removes the references to deleted documents
from the database. Deleting a document within CouchDB does not actually
remove the document from the database, instead, the document is marked as
a deleted (and a new revision is created). This is to ensure that
deleted documents are replicated to other databases as having been
deleted. This also means that you can check the status of a document and
identify that the document has been deleted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Don&#8217;t use purge as a regular operation, it is designed to be used
in exceptional cases.</p>
</div>
<p>The purge operation removes the references to the deleted documents from
the database. The purging of old documents is not replicated to other
databases. If you are replicating between databases and have deleted a
large number of documents you should run purge on each database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Purging documents does not remove the space used by them on disk. To
reclaim disk space, you should run a database compact (see
<a class="reference internal" href="#api-compact"><em>POST /db/_compact</em></a>), and compact views (see <a class="reference internal" href="#api-compact-ddoc"><em>POST /db/_compact/design-doc</em></a>).</p>
</div>
<p>To perform a purge operation you must send a request including the JSON
of the document IDs that you want to purge. For example:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_purge
Content-Type: application/json

{
  "FishStew" : [
    "17-b3eb5ac6fbaef4428d712e66483dcb79"
    ]
}</pre>
</div>
<p>The format of the request must include the document ID and one or more
revisions that must be purged.</p>
<p>The response will contain the purge sequence number, and a list of the
document IDs and revisions successfully purged.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;purged&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;FishStew&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="s2">&quot;17-b3eb5ac6fbaef4428d712e66483dcb79&quot;</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="s2">&quot;purge_seq&quot;</span> <span class="o">:</span> <span class="mi">11</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="updating-indexes">
<h3>9.1.11.1. Updating Indexes<a class="headerlink" href="#updating-indexes" title="Permalink to this headline">¶</a></h3>
<p>The number of purges on a database is tracked using a purge sequence.
This is used by the view indexer to optimize the updating of views that
contain the purged documents.</p>
<p>When the indexer identifies that the purge sequence on a database has
changed, it compares the purge sequence of the database with that stored
in the view index. If the difference between the stored sequence and
database is sequence is only 1, then the indexer uses a cached list of
the most recently purged documents, and then removes these documents
from the index individually. This prevents completely rebuilding the
index from scratch.</p>
<p>If the difference between the stored sequence number and current
database sequence is greater than 1, then the view index is entirely
rebuilt. This is an expensive operation as every document in the
database must be examined.</p>
</div>
</div>
<div class="section" id="get-db-all-docs">
<h2>9.1.12. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_all_docs</span></tt><a class="headerlink" href="#get-db-all-docs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_all_docs</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON object containing document information, ordered by the
document ID</li>
<li><strong>Admin Privileges Required</strong>: no</li>
<li><strong>Query Arguments</strong>:<ul>
<li><strong>Argument</strong>: descending<ul>
<li><strong>Description</strong>:  Return the documents in descending by key order</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: boolean</li>
<li><strong>Default</strong>: false</li>
</ul>
</li>
<li><strong>Argument</strong>: endkey<ul>
<li><strong>Description</strong>:  Stop returning records when the specified key is reached</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
</ul>
</li>
<li><strong>Argument</strong>: endkey_docid<ul>
<li><strong>Description</strong>:  Stop returning records when the specified document ID is
reached</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
</ul>
</li>
<li><strong>Argument</strong>: group<ul>
<li><strong>Description</strong>:  Group the results using the reduce function to a group
or single row</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: boolean</li>
<li><strong>Default</strong>: false</li>
</ul>
</li>
<li><strong>Argument</strong>: group_level<ul>
<li><strong>Description</strong>:  Specify the group level to be used</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: numeric</li>
</ul>
</li>
<li><strong>Argument</strong>: include_docs<ul>
<li><strong>Description</strong>:  Include the full content of the documents in the return</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: boolean</li>
<li><strong>Default</strong>: false</li>
</ul>
</li>
<li><strong>Argument</strong>: inclusive_end<ul>
<li><strong>Description</strong>:  Specifies whether the specified end key should be
included in the result</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: boolean</li>
<li><strong>Default</strong>: true</li>
</ul>
</li>
<li><strong>Argument</strong>: key<ul>
<li><strong>Description</strong>:  Return only documents that match the specified key</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
</ul>
</li>
<li><strong>Argument</strong>: limit<ul>
<li><strong>Description</strong>:  Limit the number of the returned documents to the
specified number</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: numeric</li>
</ul>
</li>
<li><strong>Argument</strong>: reduce<ul>
<li><strong>Description</strong>:  Use the reduction function</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: boolean</li>
<li><strong>Default</strong>: true</li>
</ul>
</li>
<li><strong>Argument</strong>: skip<ul>
<li><strong>Description</strong>:  Skip this number of records before starting to return
the results</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: numeric</li>
<li><strong>Default</strong>: 0</li>
</ul>
</li>
<li><strong>Argument</strong>: stale<ul>
<li><strong>Description</strong>:  Allow the results from a stale view to be used</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>:</li>
<li><strong>Supported Values</strong>:<ul>
<li><strong>ok</strong>: Allow stale views</li>
</ul>
</li>
</ul>
</li>
<li><strong>Argument</strong>: startkey<ul>
<li><strong>Description</strong>:  Return records starting with the specified key</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
</ul>
</li>
<li><strong>Argument</strong>: startkey_docid<ul>
<li><strong>Description</strong>:  Return records starting with the specified document ID</li>
<li><strong>Optional</strong>: yes</li>
<li><strong>Type</strong>: string</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Returns a JSON structure of all of the documents in a given database.
The information is returned as a JSON structure containing meta
information about the return structure, and the list documents and basic
contents, consisting the ID, revision and key. The key is generated from
the document ID.</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>offset</td>
<td>Offset where the document list started</td>
</tr>
<tr class="row-odd"><td>rows [array]</td>
<td>Array of document object</td>
</tr>
<tr class="row-even"><td>total_rows</td>
<td>Number of documents in the database/view</td>
</tr>
<tr class="row-odd"><td>update_seq</td>
<td>Current update sequence for the database</td>
</tr>
</tbody>
</table>
<p>By default the information returned contains only the document ID and
revision. For example, the request:</p>
<div class="highlight-http"><pre>GET http://couchdb:5984/recipes/_all_docs
Accept: application/json</pre>
</div>
<p>Returns the following structure:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;total_rows&quot;</span> <span class="o">:</span> <span class="mi">18386</span><span class="p">,</span>
   <span class="s2">&quot;rows&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;1-bc0d5aed1e339b1cc1f29578f3220a45&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;Aberffrawcake&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;Aberffrawcake&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;3-68a20c89a5e70357c20148f8e82ca331&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;Adukiandorangecasserole-microwave&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;Adukiandorangecasserole-microwave&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;3-9b2851ed9b6f655cc4eb087808406c60&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;Aioli-garlicmayonnaise&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;Aioli-garlicmayonnaise&quot;</span>
      <span class="p">},</span>
      <span class="p">...</span>
         <span class="p">],</span>
   <span class="s2">&quot;offset&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The information is returned in the form of a temporary view of all the
database documents, with the returned key consisting of the ID of the
document. The remainder of the interface is therefore identical to the
View query arguments and their behavior.</p>
</div>
<div class="section" id="post-db-all-docs">
<h2>9.1.13. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_all_docs</span></tt><a class="headerlink" href="#post-db-all-docs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_all_docs</span></tt></li>
<li><strong>Request</strong>: JSON of the document IDs you want included</li>
<li><strong>Response</strong>: JSON of the returned view</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">POST</span></tt> to <tt class="docutils literal"><span class="pre">_all_docs</span></tt> allows to specify multiple keys to be
selected from the database. This enables you to request multiple
documents in a single request, in place of multiple
<a class="reference internal" href="documents.html#api-get-doc"><em>GET /db/doc</em></a> requests.</p>
<p>The request body should contain a list of the keys to be returned as an
array to a <tt class="docutils literal"><span class="pre">keys</span></tt> object. For example:</p>
<div class="highlight-http"><pre>POST http://couchdb:5984/recipes/_all_docs
User-Agent: MyApp/0.1 libwww-perl/5.837

{
   "keys" : [
      "Zingylemontart",
      "Yogurtraita"
   ]
}</pre>
</div>
<p>The return JSON is the all documents structure, but with only the
selected keys in the output:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;total_rows&quot;</span> <span class="o">:</span> <span class="mi">2666</span><span class="p">,</span>
   <span class="s2">&quot;rows&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;1-a3544d296de19e6f5b932ea77d886942&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;Zingylemontart&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;Zingylemontart&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;1-91635098bfe7d40197a1b98d7ee085fc&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;Yogurtraita&quot;</span><span class="p">,</span>
         <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="s2">&quot;Yogurtraita&quot;</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">&quot;offset&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="post-db-missing-revs">
<h2>9.1.14. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_missing_revs</span></tt><a class="headerlink" href="#post-db-missing-revs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_missing_revs</span></tt></li>
<li><strong>Request</strong>: JSON list of document revisions</li>
<li><strong>Response</strong>: JSON of missing revisions</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
</div>
<div class="section" id="post-db-revs-diff">
<h2>9.1.15. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_revs_diff</span></tt><a class="headerlink" href="#post-db-revs-diff" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_revs_diff</span></tt></li>
<li><strong>Request</strong>: JSON list of document revisions</li>
<li><strong>Response</strong>: JSON list of differences from supplied document/revision list</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
</div>
<div class="section" id="get-db-security">
<h2>9.1.16. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_security</span></tt><a class="headerlink" href="#get-db-security" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_security</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: JSON of the security object</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
<p>Gets the current security object from the specified database. The
security object consists of two compulsory elements, <tt class="docutils literal"><span class="pre">admins</span></tt> and
<tt class="docutils literal"><span class="pre">readers</span></tt>, which are used to specify the list of users and/or roles
that have admin and reader rights to the database respectively. Any
additional fields in the security object are optional. The entire
security object is made available to validation and other internal
functions so that the database can control and limit functionality.</p>
<p>To get the existing security object you would send the following
request:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;admins&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;roles&quot;</span> <span class="o">:</span> <span class="p">[],</span>
      <span class="s2">&quot;names&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="s2">&quot;mc&quot;</span><span class="p">,</span>
         <span class="s2">&quot;slp&quot;</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="s2">&quot;readers&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;roles&quot;</span> <span class="o">:</span> <span class="p">[],</span>
      <span class="s2">&quot;names&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="s2">&quot;tim&quot;</span><span class="p">,</span>
         <span class="s2">&quot;brian&quot;</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Security object structure is:</p>
<ul class="simple">
<li><strong>admins</strong>: Roles/Users with admin privileges<ul>
<li><strong>roles</strong> [array]: List of roles with parent privilege</li>
<li><strong>users</strong> [array]: List of users with parent privilege</li>
</ul>
</li>
<li><strong>readers</strong>: Roles/Users with reader privileges<ul>
<li><strong>roles</strong> [array]: List of roles with parent privilege</li>
<li><strong>users</strong> [array]: List of users with parent privilege</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the security object for a database has never been set, then the
value returned will be empty.</p>
</div>
</div>
<div class="section" id="put-db-security">
<h2>9.1.17. <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db/_security</span></tt><a class="headerlink" href="#put-db-security" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db/_security</span></tt></li>
<li><strong>Request</strong>: JSON specifying the admin and user security for the database</li>
<li><strong>Response</strong>: JSON status message</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
<p>Sets the security object for the given database.For example, to set the
security object for the <tt class="docutils literal"><span class="pre">recipes</span></tt> database:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">PUT</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//couchdb:5984/recipes/_security</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">json</span>

<span class="p">{</span>
   <span class="s2">&quot;admins&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;roles&quot;</span> <span class="o">:</span> <span class="p">[],</span>
      <span class="s2">&quot;names&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="s2">&quot;mc&quot;</span><span class="p">,</span>
         <span class="s2">&quot;slp&quot;</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="s2">&quot;readers&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;roles&quot;</span> <span class="o">:</span> <span class="p">[],</span>
      <span class="s2">&quot;names&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="s2">&quot;tim&quot;</span><span class="p">,</span>
         <span class="s2">&quot;brian&quot;</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the setting was successful, a JSON status object will be returned:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="get-db-revs-limit">
<h2>9.1.18. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_revs_limit</span></tt><a class="headerlink" href="#get-db-revs-limit" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_revs_limit</span></tt></li>
<li><strong>Request</strong>: None</li>
<li><strong>Response</strong>: The current revision limit setting</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
<p>Gets the current <tt class="docutils literal"><span class="pre">revs_limit</span></tt> (revision limit) setting.</p>
<p>For example to get the current limit:</p>
<div class="highlight-http"><pre>GET http://couchdb:5984/recipes/_revs_limit
Content-Type: application/json</pre>
</div>
<p>The returned information is the current setting as a numerical scalar:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="section" id="put-db-revs-limit">
<h2>9.1.19. <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db/_revs_limit</span></tt><a class="headerlink" href="#put-db-revs-limit" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Method</strong>: <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db/_revs_limit</span></tt></li>
<li><strong>Request</strong>: A scalar integer of the revision limit setting</li>
<li><strong>Response</strong>: Confirmation of setting of the revision limit</li>
<li><strong>Admin Privileges Required</strong>: no</li>
</ul>
<p>Sets the maximum number of document revisions that will be tracked by
CouchDB, even after compaction has occurred. You can set the revision
limit on a database by using <tt class="docutils literal"><span class="pre">PUT</span></tt> with a scalar integer of the limit
that you want to set as the request body.</p>
<p>For example to set the revs limit to 100 for the <tt class="docutils literal"><span class="pre">recipes</span></tt> database:</p>
<div class="highlight-http"><pre>PUT http://couchdb:5984/recipes/_revs_limit
Content-Type: application/json

100</pre>
</div>
<p>If the setting was successful, a JSON status object will be returned:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>

<!--

Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.

-->

<div id="searchbox" style="display: none">

<h3>Quick Search</h3>

<form class="search" action="search.html" method="get">
<input type="text" name="q">
<input type="submit" value="Go">
<input type="hidden" name="check_keywords" value="yes">
<input type="hidden" name="area" value="default">
</form>

<br>

</div>

<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9.1. Database Methods</a><ul>
<li><a class="reference internal" href="#get-db">9.1.1. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db</span></tt></a></li>
<li><a class="reference internal" href="#put-db">9.1.2. <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db</span></tt></a></li>
<li><a class="reference internal" href="#delete-db">9.1.3. <tt class="docutils literal"><span class="pre">DELETE</span> <span class="pre">/db</span></tt></a></li>
<li><a class="reference internal" href="#get-db-changes">9.1.4. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_changes</span></tt></a><ul>
<li><a class="reference internal" href="#filtering">9.1.4.1. Filtering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#post-db-compact">9.1.5. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_compact</span></tt></a></li>
<li><a class="reference internal" href="#post-db-compact-design-doc">9.1.6. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_compact/design-doc</span></tt></a></li>
<li><a class="reference internal" href="#post-db-view-cleanup">9.1.7. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_view_cleanup</span></tt></a></li>
<li><a class="reference internal" href="#post-db-ensure-full-commit">9.1.8. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_ensure_full_commit</span></tt></a></li>
<li><a class="reference internal" href="#post-db-bulk-docs">9.1.9. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_bulk_docs</span></tt></a><ul>
<li><a class="reference internal" href="#inserting-documents-in-bulk">9.1.9.1. Inserting Documents in Bulk</a></li>
<li><a class="reference internal" href="#updating-documents-in-bulk">9.1.9.2. Updating Documents in Bulk</a></li>
<li><a class="reference internal" href="#bulk-documents-transaction-semantics">9.1.9.3. Bulk Documents Transaction Semantics</a></li>
<li><a class="reference internal" href="#bulk-document-validation-and-conflict-errors">9.1.9.4. Bulk Document Validation and Conflict Errors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#post-db-temp-view">9.1.10. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_temp_view</span></tt></a></li>
<li><a class="reference internal" href="#post-db-purge">9.1.11. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_purge</span></tt></a><ul>
<li><a class="reference internal" href="#updating-indexes">9.1.11.1. Updating Indexes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#get-db-all-docs">9.1.12. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_all_docs</span></tt></a></li>
<li><a class="reference internal" href="#post-db-all-docs">9.1.13. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_all_docs</span></tt></a></li>
<li><a class="reference internal" href="#post-db-missing-revs">9.1.14. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_missing_revs</span></tt></a></li>
<li><a class="reference internal" href="#post-db-revs-diff">9.1.15. <tt class="docutils literal"><span class="pre">POST</span> <span class="pre">/db/_revs_diff</span></tt></a></li>
<li><a class="reference internal" href="#get-db-security">9.1.16. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_security</span></tt></a></li>
<li><a class="reference internal" href="#put-db-security">9.1.17. <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db/_security</span></tt></a></li>
<li><a class="reference internal" href="#get-db-revs-limit">9.1.18. <tt class="docutils literal"><span class="pre">GET</span> <span class="pre">/db/_revs_limit</span></tt></a></li>
<li><a class="reference internal" href="#put-db-revs-limit">9.1.19. <tt class="docutils literal"><span class="pre">PUT</span> <span class="pre">/db/_revs_limit</span></tt></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="reference.html"
                        title="previous chapter">9. API Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="documents.html"
                        title="next chapter">9.2. Document Methods</a></p><!--

Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.

-->

<!--

Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.

-->

<h3>More Help</h3>

<ul>
<li><a href="https://couchdb.apache.org/">Homepage</a></li>
<li><a href="http://wiki.apache.org/couchdb/">Wiki</a></li>
<li><a href="https://couchdb.apache.org/#mailing-list">Mailing Lists</a></li>
<li><a href="http://webchat.freenode.net/?channels=couchdb">IRC</a></li>
<li><a href="https://issues.apache.org/jira/browse/CouchDB">Issues</a></li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="documents.html" title="9.2. Document Methods"
             >next</a> |</li>
        <li class="right" >
          <a href="reference.html" title="9. API Reference"
             >previous</a> |</li>
        <li><a href="../index.html">Apache CouchDB 1.4 Manual</a> &raquo;</li>
          <li><a href="reference.html" >9. API Reference</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, The Apache Software Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
 <!-- End original user content -->


<br/>
<br/>
<br/>


<style type="text/css">
  #version_menu, .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0.75s;
    transition: all 0.25s 0.75s;
  }
  .footer_popout:hover #version_menu, .footer_popout:hover .rtd-badge.rtd {
    -webkit-transition: all 0.25s 0s;
    transition: all 0.25s 0s;
  }
  .rtd-badge {
    position: fixed;
    display: block;
    bottom: 5px;
    height: 40px;
    text-indent: -9999em;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 rgba(255, 255, 255, 0.2) inset;
  }
  #version_menu {
    position: fixed;
    visibility: hidden;
    opacity: 0;
    bottom: 11px;
    right: 47px;
    list-style-type: none;
    margin: 0;
  }
  .footer_popout:hover #version_menu {
    visibility: visible;
    opacity: 1;
    right: 166px;
  }
  #version_menu li {
    display: block;
    float: right;
  }
  #version_menu li a {
    display: block;
    padding: 6px 10px 4px 10px;
    margin: 7px 7px 0 0;
    font-weight: bold;
    font-size: 14px;
    height: 20px;
    line-height: 17px;
    text-decoration: none;
    color: #fff;
    background: #8ca1af url(//media.readthedocs.org//images/gradient-light.png) bottom left repeat-x;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    box-shadow: 0 1px 1px #465158;
    -moz-box-shadow: 0 1px 1px #465158;
    -webkit-box-shadow: 0 1px 1px #465158;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }
  #version_menu li a:hover {
    text-decoration: none;
    background-color: #697983;
    box-shadow: 0 1px 0px #465158;
    -moz-box-shadow: 0 1px 0px #465158;
    -webkit-box-shadow: 0 1px 0px #465158;
  }
  .rtd-badge.rtd {
    background: #3b4449 url(//media.readthedocs.org//images/badge-rtd.png) scroll top left no-repeat;
    border: 1px solid #282E32;
    width: 41px;
    right: 5px;
  }
  .footer_popout:hover .rtd-badge.rtd {
    width: 160px;
  }
  .rtd-badge.revsys { background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline-sponsored {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 290px;
    right: 173px;
  }
  .rtd-badge.revsys-inline {
    position: inherit;
    margin-left: auto;
    margin-right: 175px;
    margin-bottom: 5px;
    background: #465158 url(//media.readthedocs.org//images/badge-revsys-sm.png) top left no-repeat;
    border: 1px solid #1C5871;
    width: 205px;
    right: 173px;
  }

</style>
<div class="rtd_doc_footer">
  <div class="footer_popout">
    <a href="//readthedocs.org/projects/couchdb/?fromdocs=couchdb" class="rtd-badge rtd"> Brought to you by Read the Docs</a>
    <ul id="version_menu">
      
        <li><a href="/en/latest/">latest</a></li>
      
        <li><a href="/en/1.4.x/">1.4.x</a></li>
      
        <li><a href="/en/1.3.x/">1.3.x</a></li>
      
    </ul>
  </div>
</div>
<!-- RTD Analytics Code -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




  </body>
</html>