

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from ipython.readthedocs.org/en/master/parallel/asyncresult.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 07:16:37 GMT -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The AsyncResult object &mdash; IPython 3.0.0-dev documentation</title>
  

  
  

  
  <link href='../../../../fonts.googleapis.com/css732b.css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  

  
    <link rel="stylesheet" href="../../../../media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  
    <link rel="top" title="IPython 3.0.0-dev documentation" href="../index-2.html"/>
        <link rel="up" title="Using IPython for parallel computing" href="index.html"/>
        <link rel="next" title="Using MPI with IPython" href="parallel_mpi.html"/>
        <link rel="prev" title="The IPython task interface" href="parallel_task.html"/>
 
<!-- RTD Extra Head -->



<!-- 
Read the Docs is acting as the canonical URL for your project. 
If you want to change it, more info is available in our docs:
  http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://ipython.readthedocs.org/en/latest/parallel/asyncresult.html" />

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ipython",
    version: "master",
    language: "en",
    page: "parallel/asyncresult",
    theme: "sphinx_rtd_theme",
    docroot: "/docs/source/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org"
  }
  // Old variables
  var doc_version = "master";
  var doc_slug = "ipython";
  var page_name = "parallel/asyncresult";
  var html_theme = "sphinx_rtd_theme";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->


  
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index-2.html" class="fa fa-home"> IPython</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="https://ipython.readthedocs.org/en/master/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#id1">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#enhanced-interactive-python-shell">Enhanced interactive Python shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#decoupled-two-process-model">Decoupled two-process model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#interactive-parallel-computing">Interactive parallel computing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">What&#8217;s new in IPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/development.html">Development version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version2.0.html">2.0 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-2.0.html">Issues closed in the 2.0 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version1.0.html">1.0 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-1.0.html">Issues closed in the 1.0 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.13.html">0.13 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.13.html">Issues closed in the 0.13 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.12.html">0.12 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.12.html">Issues closed in the 0.12 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.11.html">0.11 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.11.html">Issues closed in the 0.11 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.10.html">0.10 series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.9.html">0.9 series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.8.html">0.8 series</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#installing-ipython-itself">Installing IPython itself</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#basic-optional-dependencies">Basic optional dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-ipython-parallel-parallel-computing">Dependencies for IPython.parallel (parallel computing)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-ipython-kernel-zmq">Dependencies for IPython.kernel.zmq</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-the-ipython-qt-console">Dependencies for the IPython QT console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-the-ipython-html-notebook">Dependencies for the IPython HTML notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-nbconvert-converting-notebooks-to-various-formats">Dependencies for nbconvert (converting notebooks to various formats)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactive/index.html">Using IPython for interactive work</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interactive/tutorial.html">Introducing IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/tips.html">IPython Tips &amp; Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/reference.html">IPython reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/shell.html">IPython as a system shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/qtconsole.html">A Qt Console for IPython</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebook/index.html">The IPython notebook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebook/notebook.html">The IPython Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/nbconvert.html">Converting notebooks to other formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/public_server.html">Running a notebook server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/security.html">Security in IPython notebooks</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using IPython for parallel computing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="parallel_intro.html">Overview and getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_process.html">Starting the IPython controller and engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_multiengine.html">IPython&#8217;s Direct interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="magics.html">Parallel Magic Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_task.html">The IPython task interface</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The AsyncResult object</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_mpi.html">Using MPI with IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_db.html">IPython&#8217;s Task Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_security.html">Security details of IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_winhpc.html">Getting started with Windows HPC Server 2008</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_demos.html">Parallel examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag_dependencies.html">DAG Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_details.html">Details of Parallel Computing with IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_transition.html">Transitioning from IPython.kernel to IPython.parallel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Configuration and customization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config/index.html#configuring-ipython">Configuring IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config/index.html#extending-and-integrating-with-ipython">Extending and integrating with IPython</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">IPython developer&#8217;s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/messaging.html">Messaging in IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/parallel_messages.html">Messaging for Parallel Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/parallel_connections.html">Connection Diagrams of The IPython ZMQ Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/lexer.html">New IPython Console Lexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pycompat.html">Writing code for Python 2 and 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/config.html">Overview of the IPython configuration system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/inputhook_app.html">IPython GUI Support Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">The IPython API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About IPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/credits.html">Credits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/history.html">History</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/license_and_copyright.html">License and Copyright</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index-2.html">IPython</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index-2.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Using IPython for parallel computing</a> &raquo;</li>
      
    <li>The AsyncResult object</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/ipython/ipython/blob/master/docs/source/parallel/asyncresult.rst" class="fa fa-github"> Edit on GitHub</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This documentation is for a development version of IPython. There may be
significant differences from the latest stable release.</p>
</div>
</div></blockquote>
<div class="section" id="the-asyncresult-object">
<span id="parallel-asyncresult"></span><h1>The AsyncResult object<a class="headerlink" href="#the-asyncresult-object" title="Permalink to this headline">¶</a></h1>
<p>In non-blocking mode, <tt class="xref py py-meth docutils literal"><span class="pre">apply()</span></tt> submits the command to be executed and
then returns a <a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a> object immediately. The
AsyncResult object gives you a way of getting a result at a later
time through its <tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt> method, but it also collects metadata
on execution.</p>
<div class="section" id="beyond-multiprocessing-s-asyncresult">
<h2>Beyond multiprocessing&#8217;s AsyncResult<a class="headerlink" href="#beyond-multiprocessing-s-asyncresult" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a> object provides a superset of the interface in
<a class="reference external" href="http://docs.python.org/2/library/multiprocessing.html#multiprocessing.pool.AsyncResult" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">multiprocessing.pool.AsyncResult</span></tt></a>.  See the
<a class="reference external" href="http://docs.python.org/library/multiprocessing#multiprocessing.pool.AsyncResult">official Python documentation</a>
for more on the basics of this interface.</p>
</div>
<p>Our AsyncResult objects add a number of convenient features for working with
parallel results, beyond what is provided by the original AsyncResult.</p>
<div class="section" id="get-dict">
<h3>get_dict<a class="headerlink" href="#get-dict" title="Permalink to this headline">¶</a></h3>
<p>First, is <tt class="xref py py-meth docutils literal"><span class="pre">AsyncResult.get_dict()</span></tt>, which pulls results as a dictionary
keyed by engine_id, rather than a flat list.  This is useful for quickly
coordinating or distributing information about all of the engines.</p>
<p>As an example, here is a quick call that gives every engine a dict showing
the PID of every other engine:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [10]: ar = rc[:].apply_async(os.getpid)
In [11]: pids = ar.get_dict()
In [12]: rc[:][&#39;pid_map&#39;] = pids
</pre></div>
</div>
<p>This trick is particularly useful when setting up inter-engine communication,
as in IPython&#8217;s <tt class="file docutils literal"><span class="pre">examples/parallel/interengine</span></tt> examples.</p>
</div>
</div>
<div class="section" id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h2>
<p>IPython.parallel tracks some metadata about the tasks, which is stored
in the <tt class="xref py py-attr docutils literal"><span class="pre">Client.metadata</span></tt> dict.  The AsyncResult object gives you an
interface for this information as well, including timestamps stdout/err,
and engine IDs.</p>
<div class="section" id="timing">
<h3>Timing<a class="headerlink" href="#timing" title="Permalink to this headline">¶</a></h3>
<p>IPython tracks various timestamps as <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt> objects,
and the AsyncResult object has a few properties that turn these into useful
times (in seconds as floats).</p>
<p>For use while the tasks are still pending:</p>
<ul>
<li><p class="first"><tt class="xref py py-attr docutils literal"><span class="pre">ar.elapsed</span></tt> is just the elapsed seconds since submission, for use
before the AsyncResult is complete.</p>
</li>
<li><p class="first"><tt class="xref py py-attr docutils literal"><span class="pre">ar.progress</span></tt> is the number of tasks that have completed.  Fractional progress
would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">1.0</span> <span class="o">*</span> <span class="n">ar</span><span class="o">.</span><span class="n">progress</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="xref py py-meth docutils literal"><span class="pre">AsyncResult.wait_interactive()</span></tt> will wait for the result to finish, but
print out status updates on progress and elapsed time while it waits.</p>
</li>
</ul>
<p>For use after the tasks are done:</p>
<ul class="simple">
<li><tt class="xref py py-attr docutils literal"><span class="pre">ar.serial_time</span></tt> is the sum of the computation time of all of the tasks
done in parallel.</li>
<li><tt class="xref py py-attr docutils literal"><span class="pre">ar.wall_time</span></tt> is the time between the first task submitted and last result
received.  This is the actual cost of computation, including IPython overhead.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">wall_time is only precise if the Client is waiting for results when
the task finished, because the <cite>received</cite> timestamp is made when the result is
unpacked by the Client, triggered by the <tt class="xref py py-meth docutils literal"><span class="pre">spin()</span></tt> call. If you
are doing work in the Client, and not waiting/spinning, then <cite>received</cite> might
be artificially high.</p>
</div>
<p>An often interesting metric is the time it actually cost to do the work in parallel
relative to the serial computation, and this can be given simply with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">speedup</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">serial_time</span> <span class="o">/</span> <span class="n">ar</span><span class="o">.</span><span class="n">wall_time</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="map-results-are-iterable">
<h2>Map results are iterable!<a class="headerlink" href="#map-results-are-iterable" title="Permalink to this headline">¶</a></h2>
<p>When an AsyncResult object has multiple results (e.g. the <tt class="xref py py-class docutils literal"><span class="pre">AsyncMapResult</span></tt>
object), you can actually iterate through results themselves, and act on them as they arrive:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">parallel</span>

<span class="c"># create client &amp; view</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">dv</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[:]</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">load_balanced_view</span><span class="p">()</span>

<span class="c"># scatter &#39;id&#39;, so id=0,1,2 on engines 0,1,2</span>
<span class="n">dv</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">rc</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Engine IDs: &quot;</span><span class="p">,</span> <span class="n">dv</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>

<span class="c"># create a Reference to `id`. This will be a different value on each engine</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;sleeping for `id` seconds on each engine&quot;</span><span class="p">)</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">ar</span> <span class="o">=</span> <span class="n">dv</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ar</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s">: </span><span class="si">%.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">sleep_here</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">id</span><span class="p">,</span><span class="n">t</span>

<span class="c"># one call per task</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;running with one call per task&quot;</span><span class="p">)</span>
<span class="n">amr</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sleep_here</span><span class="p">,</span> <span class="p">[</span><span class="o">.</span><span class="mo">01</span><span class="o">*</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amr</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;task </span><span class="si">%i</span><span class="s"> on engine </span><span class="si">%i</span><span class="s">: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;running with four calls per task&quot;</span><span class="p">)</span>
<span class="c"># with chunksize, we can have four calls per task</span>
<span class="n">amr</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sleep_here</span><span class="p">,</span> <span class="p">[</span><span class="o">.</span><span class="mo">01</span><span class="o">*</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)],</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amr</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;task </span><span class="si">%i</span><span class="s"> on engine </span><span class="si">%i</span><span class="s">: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;running with two calls per task, with unordered results&quot;</span><span class="p">)</span>
<span class="c"># We can even iterate through faster results first, with ordered=False</span>
<span class="n">amr</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sleep_here</span><span class="p">,</span> <span class="p">[</span><span class="o">.</span><span class="mo">01</span><span class="o">*</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amr</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;slept </span><span class="si">%.2f</span><span class="s">s on engine </span><span class="si">%i</span><span class="s">: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>
</pre></div>
</div>
<p>That is to say, if you treat an AsyncMapResult as if it were a list of your actual
results, it should behave as you would expect, with the only difference being
that you can start iterating through the results before they have even been computed.</p>
<p>This lets you do a dumb version of map/reduce with the builtin Python functions,
and the only difference between doing this locally and doing it remotely in parallel
is using the asynchronous view.map instead of the builtin map.</p>
<p>Here is a simple one-line RMS (root-mean-square) implemented with Python&#8217;s builtin map/reduce.</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [38]: X = np.linspace(0,100)

In [39]: from math import sqrt

In [40]: add = lambda a,b: a+b

In [41]: sq = lambda x: x*x

In [42]: sqrt(reduce(add, map(sq, X)) / len(X))
Out[42]: 58.028845747399714

In [43]: sqrt(reduce(add, view.map(sq, X)) / len(X))
Out[43]: 58.028845747399714
</pre></div>
</div>
<p>To break that down:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">map(sq,</span> <span class="pre">X)</span></tt> Compute the square of each element in the list (locally, or in parallel)</li>
<li><tt class="docutils literal"><span class="pre">reduce(add,</span> <span class="pre">sqX)</span> <span class="pre">/</span> <span class="pre">len(X)</span></tt> compute the mean by summing over the list (or AsyncMapResult)
and dividing by the size</li>
<li>take the square root of the resulting number</li>
</ol>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>When AsyncResult or the AsyncMapResult don&#8217;t provide what you need (for instance,
handling individual results as they arrive, but with metadata), you can always
just split the original result&#8217;s <tt class="docutils literal"><span class="pre">msg_ids</span></tt> attribute, and handle them as you like.</p>
<p class="last">For an example of this, see <tt class="file docutils literal"><span class="pre">examples/parallel/customresult.py</span></tt></p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_mpi.html" class="btn btn-neutral float-right" title="Using MPI with IPython">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parallel_task.html" class="btn btn-neutral" title="The IPython task interface"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The IPython Development Team.
      Last updated on Apr 21, 2014.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../index.html">master</a></dd>
        
          <dd><a href="https://ipython.readthedocs.org/en/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://media.readthedocs.org/pdf/ipython/master/ipython.pdf">PDF</a></dd>
        
          <dd><a href="https://media.readthedocs.org/htmlzip/ipython/master/ipython.zip">HTML</a></dd>
        
          <dd><a href="https://media.readthedocs.org/epub/ipython/master/ipython.epub">Epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/ipython/?fromdocs=ipython">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/ipython/?fromdocs=ipython">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org/">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.0.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>

<!-- Mirrored from ipython.readthedocs.org/en/master/parallel/asyncresult.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 07:16:37 GMT -->
</html>