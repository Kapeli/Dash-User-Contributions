

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from ipython.readthedocs.org/en/master/parallel/dag_dependencies.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 07:16:37 GMT -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DAG Dependencies &mdash; IPython 3.0.0-dev documentation</title>
  

  
  

  
  <link href='../../../../fonts.googleapis.com/css732b.css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  

  
    <link rel="stylesheet" href="../../../../media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  
    <link rel="top" title="IPython 3.0.0-dev documentation" href="../index-2.html"/>
        <link rel="up" title="Using IPython for parallel computing" href="index.html"/>
        <link rel="next" title="Details of Parallel Computing with IPython" href="parallel_details.html"/>
        <link rel="prev" title="Parallel examples" href="parallel_demos.html"/>
 
<!-- RTD Extra Head -->



<!-- 
Read the Docs is acting as the canonical URL for your project. 
If you want to change it, more info is available in our docs:
  http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://ipython.readthedocs.org/en/latest/parallel/dag_dependencies.html" />

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ipython",
    version: "master",
    language: "en",
    page: "parallel/dag_dependencies",
    theme: "sphinx_rtd_theme",
    docroot: "/docs/source/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org"
  }
  // Old variables
  var doc_version = "master";
  var doc_slug = "ipython";
  var page_name = "parallel/dag_dependencies";
  var html_theme = "sphinx_rtd_theme";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->


  
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index-2.html" class="fa fa-home"> IPython</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="https://ipython.readthedocs.org/en/master/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#id1">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#enhanced-interactive-python-shell">Enhanced interactive Python shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#decoupled-two-process-model">Decoupled two-process model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#interactive-parallel-computing">Interactive parallel computing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">What&#8217;s new in IPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/development.html">Development version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version2.0.html">2.0 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-2.0.html">Issues closed in the 2.0 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version1.0.html">1.0 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-1.0.html">Issues closed in the 1.0 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.13.html">0.13 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.13.html">Issues closed in the 0.13 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.12.html">0.12 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.12.html">Issues closed in the 0.12 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.11.html">0.11 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.11.html">Issues closed in the 0.11 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.10.html">0.10 series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.9.html">0.9 series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.8.html">0.8 series</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#installing-ipython-itself">Installing IPython itself</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#basic-optional-dependencies">Basic optional dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-ipython-parallel-parallel-computing">Dependencies for IPython.parallel (parallel computing)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-ipython-kernel-zmq">Dependencies for IPython.kernel.zmq</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-the-ipython-qt-console">Dependencies for the IPython QT console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-the-ipython-html-notebook">Dependencies for the IPython HTML notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-nbconvert-converting-notebooks-to-various-formats">Dependencies for nbconvert (converting notebooks to various formats)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactive/index.html">Using IPython for interactive work</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interactive/tutorial.html">Introducing IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/tips.html">IPython Tips &amp; Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/reference.html">IPython reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/shell.html">IPython as a system shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/qtconsole.html">A Qt Console for IPython</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebook/index.html">The IPython notebook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebook/notebook.html">The IPython Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/nbconvert.html">Converting notebooks to other formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/public_server.html">Running a notebook server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/security.html">Security in IPython notebooks</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using IPython for parallel computing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="parallel_intro.html">Overview and getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_process.html">Starting the IPython controller and engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_multiengine.html">IPython&#8217;s Direct interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="magics.html">Parallel Magic Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_task.html">The IPython task interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="asyncresult.html">The AsyncResult object</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_mpi.html">Using MPI with IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_db.html">IPython&#8217;s Task Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_security.html">Security details of IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_winhpc.html">Getting started with Windows HPC Server 2008</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_demos.html">Parallel examples</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">DAG Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_details.html">Details of Parallel Computing with IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_transition.html">Transitioning from IPython.kernel to IPython.parallel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Configuration and customization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config/index.html#configuring-ipython">Configuring IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config/index.html#extending-and-integrating-with-ipython">Extending and integrating with IPython</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">IPython developer&#8217;s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/messaging.html">Messaging in IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/parallel_messages.html">Messaging for Parallel Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/parallel_connections.html">Connection Diagrams of The IPython ZMQ Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/lexer.html">New IPython Console Lexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pycompat.html">Writing code for Python 2 and 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/config.html">Overview of the IPython configuration system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/inputhook_app.html">IPython GUI Support Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">The IPython API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About IPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/credits.html">Credits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/history.html">History</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/license_and_copyright.html">License and Copyright</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index-2.html">IPython</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index-2.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Using IPython for parallel computing</a> &raquo;</li>
      
    <li>DAG Dependencies</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/ipython/ipython/blob/master/docs/source/parallel/dag_dependencies.rst" class="fa fa-github"> Edit on GitHub</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This documentation is for a development version of IPython. There may be
significant differences from the latest stable release.</p>
</div>
</div></blockquote>
<div class="section" id="dag-dependencies">
<span id="id1"></span><h1>DAG Dependencies<a class="headerlink" href="#dag-dependencies" title="Permalink to this headline">¶</a></h1>
<p>Often, parallel workflow is described in terms of a <a class="reference external" href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">Directed Acyclic Graph</a> or DAG.  A popular library
for working with Graphs is <a class="reference external" href="http://networkx.lanl.gov/">NetworkX</a>.  Here, we will walk through a demo mapping
a nx DAG to task dependencies.</p>
<p>The full script that runs this demo can be found in
<tt class="file docutils literal"><span class="pre">examples/parallel/dagdeps.py</span></tt>.</p>
<div class="section" id="why-are-dags-good-for-task-dependencies">
<h2>Why are DAGs good for task dependencies?<a class="headerlink" href="#why-are-dags-good-for-task-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The &#8216;G&#8217; in DAG is &#8216;Graph&#8217;. A Graph is a collection of <strong>nodes</strong> and <strong>edges</strong> that connect
the nodes. For our purposes, each node would be a task, and each edge would be a
dependency. The &#8216;D&#8217; in DAG stands for &#8216;Directed&#8217;. This means that each edge has a
direction associated with it. So we can interpret the edge (a,b) as meaning that b depends
on a, whereas the edge (b,a) would mean a depends on b. The &#8216;A&#8217; is &#8216;Acyclic&#8217;, meaning that
there must not be any closed loops in the graph. This is important for dependencies,
because if a loop were closed, then a task could ultimately depend on itself, and never be
able to run. If your workflow can be described as a DAG, then it is impossible for your
dependencies to cause a deadlock.</p>
</div>
<div class="section" id="a-sample-dag">
<h2>A Sample DAG<a class="headerlink" href="#a-sample-dag" title="Permalink to this headline">¶</a></h2>
<p>Here, we have a very simple 5-node DAG:</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/simpledag.png"><img alt="../_images/simpledag.png" src="../_images/simpledag.png" style="width: 600px;" /></a>
</div>
<p>With NetworkX, an arrow is just a fattened bit on the edge. Here, we can see that task 0
depends on nothing, and can run immediately. 1 and 2 depend on 0; 3 depends on
1 and 2; and 4 depends only on 1.</p>
<p>A possible sequence of events for this workflow:</p>
<ol class="arabic simple" start="0">
<li>Task 0 can run right away</li>
<li>0 finishes, so 1,2 can start</li>
<li>1 finishes, 3 is still waiting on 2, but 4 can start right away</li>
<li>2 finishes, and 3 can finally start</li>
</ol>
<p>Further, taking failures into account, assuming all dependencies are run with the default
<cite>success=True,failure=False</cite>, the following cases would occur for each node&#8217;s failure:</p>
<ol class="arabic simple" start="0">
<li>fails: all other tasks fail as Impossible</li>
<li>2 can still succeed, but 3,4 are unreachable</li>
<li>3 becomes unreachable, but 4 is unaffected</li>
<li>and 4. are terminal, and can have no effect on other nodes</li>
</ol>
<p>The code to generate the simple DAG:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="c"># add 5 nodes, labeled 0-4:</span>
<span class="nb">map</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="c"># 1,2 depend on 0:</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="c"># 3 depends on 1,2</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c"># 4 depends on 1</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="c"># now draw the graph:</span>
<span class="n">pos</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
        <span class="mi">3</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">4</span> <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)}</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For demonstration purposes, we have a function that generates a random DAG with a given
number of nodes and edges.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">random_dag</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a random Directed Acyclic Graph (DAG) with a given number of nodes and edges.&quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">edges</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span><span class="o">=</span><span class="n">a</span>
        <span class="k">while</span> <span class="n">b</span><span class="o">==</span><span class="n">a</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_directed_acyclic_graph</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
            <span class="n">edges</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># we closed a loop!</span>
            <span class="n">G</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
<p>So first, we start with a graph of 32 nodes, with 128 edges:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [2]: G = random_dag(32,128)
</pre></div>
</div>
<p>Now, we need to build our dict of jobs corresponding to the nodes on the graph:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [3]: jobs = {}

# in reality, each job would presumably be different
# randomwait is just a function that sleeps for a random interval
In [4]: for node in G:
   ...:     jobs[node] = randomwait
</pre></div>
</div>
<p>Once we have a dict of jobs matching the nodes on the graph, we can start submitting jobs,
and linking up the dependencies. Since we don&#8217;t know a job&#8217;s msg_id until it is submitted,
which is necessary for building dependencies, it is critical that we don&#8217;t submit any jobs
before other jobs it may depend on. Fortunately, NetworkX provides a
<tt class="xref py py-meth docutils literal"><span class="pre">topological_sort()</span></tt> method which ensures exactly this. It presents an iterable, that
guarantees that when you arrive at a node, you have already visited all the nodes it
on which it depends:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [5]: rc = Client()
In [5]: view = rc.load_balanced_view()

In [6]: results = {}

In [7]: for node in nx.topological_sort(G):
   ...:    # get list of AsyncResult objects from nodes
   ...:    # leading into this one as dependencies
   ...:    deps = [ results[n] for n in G.predecessors(node) ]
   ...:    # submit and store AsyncResult object
   ...:    with view.temp_flags(after=deps, block=False):
   ...:         results[node] = view.apply_with_flags(jobs[node])
</pre></div>
</div>
<p>Now that we have submitted all the jobs, we can wait for the results:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [8]: view.wait(results.values())
</pre></div>
</div>
<p>Now, at least we know that all the jobs ran and did not fail (<tt class="docutils literal"><span class="pre">r.get()</span></tt> would have
raised an error if a task failed).  But we don&#8217;t know that the ordering was properly
respected.  For this, we can use the <tt class="xref py py-attr docutils literal"><span class="pre">metadata</span></tt> attribute of each AsyncResult.</p>
<p>These objects store a variety of metadata about each task, including various timestamps.
We can validate that the dependencies were respected by checking that each task was
started after all of its predecessors were completed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">validate_tree</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate that jobs executed after their dependencies.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
        <span class="n">started</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">started</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">finished</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">completed</span>
            <span class="k">assert</span> <span class="n">started</span> <span class="o">&gt;</span> <span class="n">finished</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> should have happened after </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also validate the graph visually. By drawing the graph with each node&#8217;s x-position
as its start time, all arrows must be pointing to the right if dependencies were respected.
For spreading, the y-position will be the runtime of the task, so long tasks
will be at the top, and quick, small tasks will be at the bottom.</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [10]: from matplotlib.dates import date2num

In [11]: from matplotlib.cm import gist_rainbow

In [12]: pos = {}; colors = {}

In [12]: for node in G:
   ....:    md = results[node].metadata
   ....:    start = date2num(md.started)
   ....:    runtime = date2num(md.completed) - start
   ....:    pos[node] = (start, runtime)
   ....:    colors[node] = md.engine_id

In [13]: nx.draw(G, pos, node_list=colors.keys(), node_color=colors.values(),
   ....:    cmap=gist_rainbow)
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/dagdeps.png"><img alt="../_images/dagdeps.png" src="../_images/dagdeps.png" style="width: 600px;" /></a>
<p class="caption">Time started on x, runtime on y, and color-coded by engine-id (in this case there
were four engines). Edges denote dependencies.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_details.html" class="btn btn-neutral float-right" title="Details of Parallel Computing with IPython">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parallel_demos.html" class="btn btn-neutral" title="Parallel examples"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The IPython Development Team.
      Last updated on Apr 21, 2014.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../index.html">master</a></dd>
        
          <dd><a href="https://ipython.readthedocs.org/en/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://media.readthedocs.org/pdf/ipython/master/ipython.pdf">PDF</a></dd>
        
          <dd><a href="https://media.readthedocs.org/htmlzip/ipython/master/ipython.zip">HTML</a></dd>
        
          <dd><a href="https://media.readthedocs.org/epub/ipython/master/ipython.epub">Epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/ipython/?fromdocs=ipython">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/ipython/?fromdocs=ipython">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org/">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.0.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>

<!-- Mirrored from ipython.readthedocs.org/en/master/parallel/dag_dependencies.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 07:16:37 GMT -->
</html>