

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from ipython.readthedocs.org/en/master/parallel/parallel_task.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 07:16:37 GMT -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The IPython task interface &mdash; IPython 3.0.0-dev documentation</title>
  

  
  

  
  <link href='../../../../fonts.googleapis.com/css732b.css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  

  
    <link rel="stylesheet" href="../../../../media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  
    <link rel="top" title="IPython 3.0.0-dev documentation" href="../index-2.html"/>
        <link rel="up" title="Using IPython for parallel computing" href="index.html"/>
        <link rel="next" title="The AsyncResult object" href="asyncresult.html"/>
        <link rel="prev" title="Parallel Magic Commands" href="magics.html"/>
 
<!-- RTD Extra Head -->



<!-- 
Read the Docs is acting as the canonical URL for your project. 
If you want to change it, more info is available in our docs:
  http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://ipython.readthedocs.org/en/latest/parallel/parallel_task.html" />

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ipython",
    version: "master",
    language: "en",
    page: "parallel/parallel_task",
    theme: "sphinx_rtd_theme",
    docroot: "/docs/source/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org"
  }
  // Old variables
  var doc_version = "master";
  var doc_slug = "ipython";
  var page_name = "parallel/parallel_task";
  var html_theme = "sphinx_rtd_theme";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->


  
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index-2.html" class="fa fa-home"> IPython</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="https://ipython.readthedocs.org/en/master/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#id1">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#enhanced-interactive-python-shell">Enhanced interactive Python shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#decoupled-two-process-model">Decoupled two-process model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#interactive-parallel-computing">Interactive parallel computing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">What&#8217;s new in IPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/development.html">Development version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version2.0.html">2.0 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-2.0.html">Issues closed in the 2.0 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version1.0.html">1.0 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-1.0.html">Issues closed in the 1.0 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.13.html">0.13 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.13.html">Issues closed in the 0.13 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.12.html">0.12 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.12.html">Issues closed in the 0.12 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.11.html">0.11 Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/github-stats-0.11.html">Issues closed in the 0.11 development cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.10.html">0.10 series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.9.html">0.9 series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../whatsnew/version0.8.html">0.8 series</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#installing-ipython-itself">Installing IPython itself</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#basic-optional-dependencies">Basic optional dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-ipython-parallel-parallel-computing">Dependencies for IPython.parallel (parallel computing)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-ipython-kernel-zmq">Dependencies for IPython.kernel.zmq</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-the-ipython-qt-console">Dependencies for the IPython QT console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-the-ipython-html-notebook">Dependencies for the IPython HTML notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/install.html#dependencies-for-nbconvert-converting-notebooks-to-various-formats">Dependencies for nbconvert (converting notebooks to various formats)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactive/index.html">Using IPython for interactive work</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interactive/tutorial.html">Introducing IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/tips.html">IPython Tips &amp; Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/reference.html">IPython reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/shell.html">IPython as a system shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive/qtconsole.html">A Qt Console for IPython</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notebook/index.html">The IPython notebook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebook/notebook.html">The IPython Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/nbconvert.html">Converting notebooks to other formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/public_server.html">Running a notebook server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/security.html">Security in IPython notebooks</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using IPython for parallel computing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="parallel_intro.html">Overview and getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_process.html">Starting the IPython controller and engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_multiengine.html">IPython&#8217;s Direct interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="magics.html">Parallel Magic Commands</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The IPython task interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="asyncresult.html">The AsyncResult object</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_mpi.html">Using MPI with IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_db.html">IPython&#8217;s Task Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_security.html">Security details of IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_winhpc.html">Getting started with Windows HPC Server 2008</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_demos.html">Parallel examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag_dependencies.html">DAG Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_details.html">Details of Parallel Computing with IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel_transition.html">Transitioning from IPython.kernel to IPython.parallel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Configuration and customization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config/index.html#configuring-ipython">Configuring IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config/index.html#extending-and-integrating-with-ipython">Extending and integrating with IPython</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">IPython developer&#8217;s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/messaging.html">Messaging in IPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/parallel_messages.html">Messaging for Parallel Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/parallel_connections.html">Connection Diagrams of The IPython ZMQ Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/lexer.html">New IPython Console Lexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pycompat.html">Writing code for Python 2 and 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/config.html">Overview of the IPython configuration system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/inputhook_app.html">IPython GUI Support Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">The IPython API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About IPython</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/credits.html">Credits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/history.html">History</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/license_and_copyright.html">License and Copyright</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index-2.html">IPython</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index-2.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Using IPython for parallel computing</a> &raquo;</li>
      
    <li>The IPython task interface</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/ipython/ipython/blob/master/docs/source/parallel/parallel_task.rst" class="fa fa-github"> Edit on GitHub</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This documentation is for a development version of IPython. There may be
significant differences from the latest stable release.</p>
</div>
</div></blockquote>
<div class="section" id="the-ipython-task-interface">
<span id="parallel-task"></span><h1>The IPython task interface<a class="headerlink" href="#the-ipython-task-interface" title="Permalink to this headline">¶</a></h1>
<p>The task interface to the cluster presents the engines as a fault tolerant,
dynamic load-balanced system of workers. Unlike the multiengine interface, in
the task interface the user have no direct access to individual engines. By
allowing the IPython scheduler to assign work, this interface is simultaneously
simpler and more powerful.</p>
<p>Best of all, the user can use both of these interfaces running at the same time
to take advantage of their respective strengths. When the user can break up
the user&#8217;s work into segments that do not depend on previous execution, the
task interface is ideal. But it also has more power and flexibility, allowing
the user to guide the distribution of jobs, without having to assign tasks to
engines explicitly.</p>
<div class="section" id="starting-the-ipython-controller-and-engines">
<h2>Starting the IPython controller and engines<a class="headerlink" href="#starting-the-ipython-controller-and-engines" title="Permalink to this headline">¶</a></h2>
<p>To follow along with this tutorial, you will need to start the IPython
controller and four IPython engines. The simplest way of doing this is to use
the <strong class="command">ipcluster</strong> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ipcluster start -n 4
</pre></div>
</div>
<p>For more detailed information about starting the controller and engines, see
our <a class="reference internal" href="parallel_intro.html#parallel-overview"><em>introduction</em></a> to using IPython for parallel computing.</p>
</div>
<div class="section" id="creating-a-loadbalancedview-instance">
<h2>Creating a <tt class="docutils literal"><span class="pre">LoadBalancedView</span></tt> instance<a class="headerlink" href="#creating-a-loadbalancedview-instance" title="Permalink to this headline">¶</a></h2>
<p>The first step is to import the IPython <tt class="xref py py-mod docutils literal"><span class="pre">IPython.parallel</span></tt>
module and then create a <tt class="xref py py-class docutils literal"><span class="pre">Client</span></tt> instance, and we will also be using
a <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt>, here called <cite>lview</cite>:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [1]: from IPython.parallel import Client

In [2]: rc = Client()
</pre></div>
</div>
<p>This form assumes that the controller was started on localhost with default
configuration. If not, the location of the controller must be given as an
argument to the constructor:</p>
<div class="highlight-ipython"><div class="highlight"><pre># for a visible LAN controller listening on an external port:
In [2]: rc = Client(&#39;tcp://192.168.1.16:10101&#39;)
# or to connect with a specific profile you have set up:
In [3]: rc = Client(profile=&#39;mpi&#39;)
</pre></div>
</div>
<p>For load-balanced execution, we will make use of a <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt> object, which can
be constructed via the client&#8217;s <tt class="xref py py-meth docutils literal"><span class="pre">load_balanced_view()</span></tt> method:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [4]: lview = rc.load_balanced_view() # default load-balanced view
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For more information, see the in-depth explanation of <a class="reference internal" href="parallel_details.html#parallel-details"><em>Views</em></a>.</p>
</div>
</div>
<div class="section" id="quick-and-easy-parallelism">
<h2>Quick and easy parallelism<a class="headerlink" href="#quick-and-easy-parallelism" title="Permalink to this headline">¶</a></h2>
<p>In many cases, you simply want to apply a Python function to a sequence of
objects, but <em>in parallel</em>. Like the multiengine interface, these can be
implemented via the task interface. The exact same tools can perform these
actions in load-balanced ways as well as multiplexed ways: a parallel version
of <a class="reference external" href="http://docs.python.org/2/library/functions.html#map" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">map()</span></tt></a> and <tt class="xref py py-func docutils literal"><span class="pre">&#64;parallel()</span></tt> function decorator. If one specifies the
argument <cite>balanced=True</cite>, then they are dynamically load balanced. Thus, if the
execution time per item varies significantly, you should use the versions in
the task interface.</p>
<div class="section" id="parallel-map">
<h3>Parallel map<a class="headerlink" href="#parallel-map" title="Permalink to this headline">¶</a></h3>
<p>To load-balance <tt class="xref py py-meth docutils literal"><span class="pre">map()</span></tt>,simply use a LoadBalancedView:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [62]: lview.block = True

In [63]: serial_result = map(lambda x:x**10, range(32))

In [64]: parallel_result = lview.map(lambda x:x**10, range(32))

In [65]: serial_result==parallel_result
Out[65]: True
</pre></div>
</div>
</div>
<div class="section" id="parallel-function-decorator">
<h3>Parallel function decorator<a class="headerlink" href="#parallel-function-decorator" title="Permalink to this headline">¶</a></h3>
<p>Parallel functions are just like normal function, but they can be called on
sequences and <em>in parallel</em>. The multiengine interface provides a decorator
that turns any Python function into a parallel function:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [10]: @lview.parallel()
   ....: def f(x):
   ....:     return 10.0*x**4
   ....:

In [11]: f.map(range(32))    # this is done in parallel
Out[11]: [0.0,10.0,160.0,...]
</pre></div>
</div>
</div>
</div>
<div class="section" id="dependencies">
<span id="parallel-dependencies"></span><h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Often, pure atomic load-balancing is too primitive for your work. In these cases, you
may want to associate some kind of <cite>Dependency</cite> that describes when, where, or whether
a task can be run.  In IPython, we provide two types of dependencies:
<a class="reference internal" href="#functional-dependencies">Functional Dependencies</a> and <a class="reference internal" href="#graph-dependencies">Graph Dependencies</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important to note that the pure ZeroMQ scheduler does not support dependencies,
and you will see errors or warnings if you try to use dependencies with the pure
scheduler.</p>
</div>
<div class="section" id="functional-dependencies">
<h3>Functional Dependencies<a class="headerlink" href="#functional-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Functional dependencies are used to determine whether a given engine is capable of running
a particular task.  This is implemented via a special <tt class="xref py py-class docutils literal"><span class="pre">Exception</span></tt> class,
<tt class="xref py py-class docutils literal"><span class="pre">UnmetDependency</span></tt>, found in <cite>IPython.parallel.error</cite>.  Its use is very simple:
if a task fails with an UnmetDependency exception, then the scheduler, instead of relaying
the error up to the client like any other error, catches the error, and submits the task
to a different engine.  This will repeat indefinitely, and a task will never be submitted
to a given engine a second time.</p>
<p>You can manually raise the <tt class="xref py py-class docutils literal"><span class="pre">UnmetDependency</span></tt> yourself, but IPython has provided
some decorators for facilitating this behavior.</p>
<p>There are two decorators and a class used for functional dependencies:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [9]: from IPython.parallel import depend, require, dependent
</pre></div>
</div>
<div class="section" id="require">
<h4>&#64;require<a class="headerlink" href="#require" title="Permalink to this headline">¶</a></h4>
<p>The simplest sort of dependency is requiring that a Python module is available. The
<tt class="docutils literal"><span class="pre">&#64;require</span></tt> decorator lets you define a function that will only run on engines where names
you specify are importable:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [10]: @require(&#39;numpy&#39;, &#39;zmq&#39;)
   ....: def myfunc():
   ....:     return dostuff()
</pre></div>
</div>
<p>Now, any time you apply <tt class="xref py py-func docutils literal"><span class="pre">myfunc()</span></tt>, the task will only run on a machine that has
numpy and pyzmq available, and when <tt class="xref py py-func docutils literal"><span class="pre">myfunc()</span></tt> is called, numpy and zmq will be imported.</p>
</div>
<div class="section" id="depend">
<h4>&#64;depend<a class="headerlink" href="#depend" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">&#64;depend</span></tt> decorator lets you decorate any function with any <em>other</em> function to
evaluate the dependency. The dependency function will be called at the start of the task,
and if it returns <tt class="docutils literal"><span class="pre">False</span></tt>, then the dependency will be considered unmet, and the task
will be assigned to another engine. If the dependency returns <em>anything other than
``False``</em>, the rest of the task will continue.</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [10]: def platform_specific(plat):
   ....:    import sys
   ....:    return sys.platform == plat

In [11]: @depend(platform_specific, &#39;darwin&#39;)
   ....: def mactask():
   ....:    do_mac_stuff()

In [12]: @depend(platform_specific, &#39;nt&#39;)
   ....: def wintask():
   ....:    do_windows_stuff()
</pre></div>
</div>
<p>In this case, any time you apply <tt class="docutils literal"><span class="pre">mactask</span></tt>, it will only run on an OSX machine.
<tt class="docutils literal"><span class="pre">&#64;depend</span></tt> is just like <tt class="docutils literal"><span class="pre">apply</span></tt>, in that it has a <tt class="docutils literal"><span class="pre">&#64;depend(f,*args,**kwargs)</span></tt>
signature.</p>
</div>
<div class="section" id="dependents">
<h4>dependents<a class="headerlink" href="#dependents" title="Permalink to this headline">¶</a></h4>
<p>You don&#8217;t have to use the decorators on your tasks, if for instance you may want
to run tasks with a single function but varying dependencies, you can directly construct
the <tt class="xref py py-class docutils literal"><span class="pre">dependent</span></tt> object that the decorators use:</p>
</div>
</div>
<div class="section" id="graph-dependencies">
<h3>Graph Dependencies<a class="headerlink" href="#graph-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you want to restrict the time and/or location to run a given task as a function
of the time and/or location of other tasks. This is implemented via a subclass of
<a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#set" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">set</span></tt></a>, called a <tt class="xref py py-class docutils literal"><span class="pre">Dependency</span></tt>. A Dependency is just a set of <cite>msg_ids</cite>
corresponding to tasks, and a few attributes to guide how to decide when the Dependency
has been met.</p>
<p>The switches we provide for interpreting whether a given dependency set has been met:</p>
<dl class="docutils">
<dt>any|all</dt>
<dd>Whether the dependency is considered met if <em>any</em> of the dependencies are done, or
only after <em>all</em> of them have finished.  This is set by a Dependency&#8217;s <tt class="xref py py-attr docutils literal"><span class="pre">all</span></tt>
boolean attribute, which defaults to <tt class="docutils literal"><span class="pre">True</span></tt>.</dd>
<dt>success [default: True]</dt>
<dd>Whether to consider tasks that succeeded as fulfilling dependencies.</dd>
<dt>failure [default <span class="classifier-delimiter">:</span> <span class="classifier">False]</span></dt>
<dd>Whether to consider tasks that failed as fulfilling dependencies.
using <cite>failure=True,success=False</cite> is useful for setting up cleanup tasks, to be run
only when tasks have failed.</dd>
</dl>
<p>Sometimes you want to run a task after another, but only if that task succeeded. In this case,
<tt class="docutils literal"><span class="pre">success</span></tt> should be <tt class="docutils literal"><span class="pre">True</span></tt> and <tt class="docutils literal"><span class="pre">failure</span></tt> should be <tt class="docutils literal"><span class="pre">False</span></tt>. However sometimes you may
not care whether the task succeeds, and always want the second task to run, in which case you
should use <cite>success=failure=True</cite>. The default behavior is to only use successes.</p>
<p>There are other switches for interpretation that are made at the <em>task</em> level.  These are
specified via keyword arguments to the client&#8217;s <tt class="xref py py-meth docutils literal"><span class="pre">apply()</span></tt> method.</p>
<dl class="docutils">
<dt>after,follow</dt>
<dd>You may want to run a task <em>after</em> a given set of dependencies have been run and/or
run it <em>where</em> another set of dependencies are met. To support this, every task has an
<cite>after</cite> dependency to restrict time, and a <cite>follow</cite> dependency to restrict
destination.</dd>
<dt>timeout</dt>
<dd>You may also want to set a time-limit for how long the scheduler should wait before a
task&#8217;s dependencies are met. This is done via a <cite>timeout</cite>, which defaults to 0, which
indicates that the task should never timeout. If the timeout is reached, and the
scheduler still hasn&#8217;t been able to assign the task to an engine, the task will fail
with a <tt class="xref py py-class docutils literal"><span class="pre">DependencyTimeout</span></tt>.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Dependencies only work within the task scheduler. You cannot instruct a load-balanced
task to run after a job submitted via the MUX interface.</p>
</div>
<p>The simplest form of Dependencies is with <cite>all=True,success=True,failure=False</cite>. In these cases,
you can skip using Dependency objects, and just pass msg_ids or AsyncResult objects as the
<cite>follow</cite> and <cite>after</cite> keywords to <tt class="xref py py-meth docutils literal"><span class="pre">client.apply()</span></tt>:</p>
<div class="highlight-ipython"><div class="highlight"><pre>In [14]: client.block=False

In [15]: ar = lview.apply(f, args, kwargs)

In [16]: ar2 = lview.apply(f2)

In [17]: with lview.temp_flags(after=[ar,ar2]):
   ....:    ar3 = lview.apply(f3)

In [18]: with lview.temp_flags(follow=[ar], timeout=2.5)
   ....:    ar4 = lview.apply(f3)
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Some parallel workloads can be described as a <a class="reference external" href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">Directed Acyclic Graph</a>, or DAG. See <a class="reference internal" href="dag_dependencies.html#dag-dependencies"><em>DAG
Dependencies</em></a> for an example demonstrating how to use map a NetworkX DAG
onto task dependencies.</p>
</div>
<div class="section" id="impossible-dependencies">
<h4>Impossible Dependencies<a class="headerlink" href="#impossible-dependencies" title="Permalink to this headline">¶</a></h4>
<p>The schedulers do perform some analysis on graph dependencies to determine whether they
are not possible to be met. If the scheduler does discover that a dependency cannot be
met, then the task will fail with an <tt class="xref py py-class docutils literal"><span class="pre">ImpossibleDependency</span></tt> error. This way, if the
scheduler realized that a task can never be run, it won&#8217;t sit indefinitely in the
scheduler clogging the pipeline.</p>
<p>The basic cases that are checked:</p>
<ul class="simple">
<li>depending on nonexistent messages</li>
<li><cite>follow</cite> dependencies were run on more than one machine and <cite>all=True</cite></li>
<li>any dependencies failed and <cite>all=True,success=True,failures=False</cite></li>
<li>all dependencies failed and <cite>all=False,success=True,failure=False</cite></li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This analysis has not been proven to be rigorous, so it is likely possible for tasks
to become impossible to run in obscure situations, so a timeout may be a good choice.</p>
</div>
</div>
</div>
</div>
<div class="section" id="retries-and-resubmit">
<h2>Retries and Resubmit<a class="headerlink" href="#retries-and-resubmit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="retries">
<h3>Retries<a class="headerlink" href="#retries" title="Permalink to this headline">¶</a></h3>
<p>Another flag for tasks is <cite>retries</cite>.  This is an integer, specifying how many times
a task should be resubmitted after failure.  This is useful for tasks that should still run
if their engine was shutdown, or may have some statistical chance of failing.  The default
is to not retry tasks.</p>
</div>
<div class="section" id="resubmit">
<h3>Resubmit<a class="headerlink" href="#resubmit" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may want to re-run a task. This could be because it failed for some reason, and
you have fixed the error, or because you want to restore the cluster to an interrupted state.
For this, the <tt class="xref py py-class docutils literal"><span class="pre">Client</span></tt> has a <tt class="xref py py-meth docutils literal"><span class="pre">rc.resubmit()</span></tt> method.  This simply takes one or more
msg_ids, and returns an <tt class="xref py py-class docutils literal"><span class="pre">AsyncHubResult</span></tt> for the result(s).  You cannot resubmit
a task that is pending - only those that have finished, either successful or unsuccessful.</p>
</div>
</div>
<div class="section" id="schedulers">
<span id="parallel-schedulers"></span><h2>Schedulers<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h2>
<p>There are a variety of valid ways to determine where jobs should be assigned in a
load-balancing situation.  In IPython, we support several standard schemes, and
even make it easy to define your own.  The scheme can be selected via the <tt class="docutils literal"><span class="pre">scheme</span></tt>
argument to <strong class="command">ipcontroller</strong>, or in the <tt class="xref py py-attr docutils literal"><span class="pre">TaskScheduler.schemename</span></tt> attribute
of a controller config object.</p>
<p>The built-in routing schemes:</p>
<p>To select one of these schemes, simply do:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ipcontroller --scheme=&lt;schemename&gt;
for instance:
$ ipcontroller --scheme=lru
</pre></div>
</div>
<p>lru: Least Recently Used</p>
<blockquote>
<div>Always assign work to the least-recently-used engine.  A close relative of
round-robin, it will be fair with respect to the number of tasks, agnostic
with respect to runtime of each task.</div></blockquote>
<p>plainrandom: Plain Random</p>
<blockquote>
<div>Randomly picks an engine on which to run.</div></blockquote>
<p>twobin: Two-Bin Random</p>
<blockquote>
<div><p><strong>Requires numpy</strong></p>
<p>Pick two engines at random, and use the LRU of the two. This is known to be better
than plain random in many cases, but requires a small amount of computation.</p>
</div></blockquote>
<p>leastload: Least Load</p>
<blockquote>
<div><p><strong>This is the default scheme</strong></p>
<p>Always assign tasks to the engine with the fewest outstanding tasks (LRU breaks tie).</p>
</div></blockquote>
<p>weighted: Weighted Two-Bin Random</p>
<blockquote>
<div><p><strong>Requires numpy</strong></p>
<p>Pick two engines at random using the number of outstanding tasks as inverse weights,
and use the one with the lower load.</p>
</div></blockquote>
<div class="section" id="greedy-assignment">
<h3>Greedy Assignment<a class="headerlink" href="#greedy-assignment" title="Permalink to this headline">¶</a></h3>
<p>Tasks can be assigned greedily as they are submitted. If their dependencies are
met, they will be assigned to an engine right away, and multiple tasks can be
assigned to an engine at a given time. This limit is set with the
<tt class="docutils literal"><span class="pre">TaskScheduler.hwm</span></tt> (high water mark) configurable in your
<tt class="file docutils literal"><span class="pre">ipcontroller_config.py</span></tt> config file, with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># the most common choices are:</span>
<span class="n">c</span><span class="o">.</span><span class="n">TaskSheduler</span><span class="o">.</span><span class="n">hwm</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># (minimal latency, default in IPython &lt; 0.13)</span>
<span class="c"># or</span>
<span class="n">c</span><span class="o">.</span><span class="n">TaskScheduler</span><span class="o">.</span><span class="n">hwm</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># (most-informed balancing, default in ≥ 0.13)</span>
</pre></div>
</div>
<p>In IPython &lt; 0.13, the default is 0, or no-limit. That is, there is no limit to the number of
tasks that can be outstanding on a given engine. This greatly benefits the
latency of execution, because network traffic can be hidden behind computation.
However, this means that workload is assigned without knowledge of how long
each task might take, and can result in poor load-balancing, particularly for
submitting a collection of heterogeneous tasks all at once. You can limit this
effect by setting hwm to a positive integer, 1 being maximum load-balancing (a
task will never be waiting if there is an idle engine), and any larger number
being a compromise between load-balancing and latency-hiding.</p>
<p>In practice, some users have been confused by having this optimization on by
default, so the default value has been changed to 1 in IPython 0.13. This can be slower,
but has more obvious behavior and won&#8217;t result in assigning too many tasks to
some engines in heterogeneous cases.</p>
</div>
<div class="section" id="pure-zmq-scheduler">
<h3>Pure ZMQ Scheduler<a class="headerlink" href="#pure-zmq-scheduler" title="Permalink to this headline">¶</a></h3>
<p>For maximum throughput, the &#8216;pure&#8217; scheme is not Python at all, but a C-level
<tt class="xref py py-class docutils literal"><span class="pre">MonitoredQueue</span></tt> from PyZMQ, which uses a ZeroMQ <tt class="docutils literal"><span class="pre">DEALER</span></tt> socket to perform all
load-balancing. This scheduler does not support any of the advanced features of the Python
<tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>.</p>
<p>Disabled features when using the ZMQ Scheduler:</p>
<ul>
<li><dl class="first docutils">
<dt>Engine unregistration</dt>
<dd><p class="first last">Task farming will be disabled if an engine unregisters.
Further, if an engine is unregistered during computation, the scheduler may not recover.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Dependencies</dt>
<dd><p class="first last">Since there is no Python logic inside the Scheduler, routing decisions cannot be made
based on message content.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Early destination notification</dt>
<dd><p class="first last">The Python schedulers know which engine gets which task, and notify the Hub.  This
allows graceful handling of Engines coming and going.  There is no way to know
where ZeroMQ messages have gone, so there is no way to know what tasks are on which
engine until they <em>finish</em>.  This makes recovery from engine shutdown very difficult.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">TODO: performance comparisons</p>
</div>
</div>
</div>
<div class="section" id="more-details">
<h2>More details<a class="headerlink" href="#more-details" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt> has many more powerful features that allow quite a bit
of flexibility in how tasks are defined and run. The next places to look are
in the following classes:</p>
<ul class="simple">
<li><tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></li>
<li><tt class="xref py py-meth docutils literal"><span class="pre">apply()</span></tt></li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">dependency</span></tt></li>
</ul>
<p>The following is an overview of how to use these classes together:</p>
<ol class="arabic simple">
<li>Create a <tt class="xref py py-class docutils literal"><span class="pre">Client</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt></li>
<li>Define some functions to be run as tasks</li>
<li>Submit your tasks to using the <tt class="xref py py-meth docutils literal"><span class="pre">apply()</span></tt> method of your
<tt class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></tt> instance.</li>
<li>Use <tt class="xref py py-meth docutils literal"><span class="pre">Client.get_result()</span></tt> to get the results of the
tasks, or use the <a class="reference internal" href="parallel_details.html#AsyncResult.get" title="AsyncResult.get"><tt class="xref py py-meth docutils literal"><span class="pre">AsyncResult.get()</span></tt></a> method of the results to wait
for and then receive the results.</li>
</ol>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">A demo of <a class="reference internal" href="dag_dependencies.html#dag-dependencies"><em>DAG Dependencies</em></a> with NetworkX and IPython.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="asyncresult.html" class="btn btn-neutral float-right" title="The AsyncResult object">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="magics.html" class="btn btn-neutral" title="Parallel Magic Commands"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The IPython Development Team.
      Last updated on Apr 21, 2014.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../index.html">master</a></dd>
        
          <dd><a href="https://ipython.readthedocs.org/en/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://media.readthedocs.org/pdf/ipython/master/ipython.pdf">PDF</a></dd>
        
          <dd><a href="https://media.readthedocs.org/htmlzip/ipython/master/ipython.zip">HTML</a></dd>
        
          <dd><a href="https://media.readthedocs.org/epub/ipython/master/ipython.epub">Epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/ipython/?fromdocs=ipython">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/ipython/?fromdocs=ipython">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org/">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.0.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="../../../../media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>

<!-- Mirrored from ipython.readthedocs.org/en/master/parallel/parallel_task.html by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 22 Apr 2014 07:16:37 GMT -->
</html>