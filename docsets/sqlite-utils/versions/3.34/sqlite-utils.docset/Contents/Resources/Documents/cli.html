<!DOCTYPE html>

<html class="no-js" data-content_root="./" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="light dark" name="color-scheme"/><meta content="width=device-width, initial-scale=1" name="viewport">
<link href="genindex.html" rel="index" title="Index"/><link href="search.html" rel="search" title="Search"/><link href="python-api.html" rel="next" title="sqlite_utils Python library"/><link href="installation.html" rel="prev" title="Installation"/>
<!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
<script data-domain="sqlite-utils.datasette.io" defer="" src="https://plausible.io/js/plausible.js"></script>
<title>sqlite-utils command-line tool - sqlite-utils</title>
<link href="_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="_static/styles/furo.css?v=135e06be" rel="stylesheet" type="text/css"/>
<link href="_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="_static/styles/furo-extensions.css?v=36a5483c" rel="stylesheet" type="text/css"/>
<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></meta></head>
<body>
<script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<symbol id="svg-toc" viewbox="0 0 24 24">
<title>Contents</title>
<svg fill="currentColor" stroke="currentColor" stroke-width="0" viewbox="0 0 1024 1024">
<path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path>
</svg>
</symbol>
<symbol id="svg-menu" viewbox="0 0 24 24">
<title>Menu</title>
<svg class="feather-menu" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<line x1="3" x2="21" y1="12" y2="12"></line>
<line x1="3" x2="21" y1="6" y2="6"></line>
<line x1="3" x2="21" y1="18" y2="18"></line>
</svg>
</symbol>
<symbol id="svg-arrow-right" viewbox="0 0 24 24">
<title>Expand</title>
<svg class="feather-chevron-right" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</symbol>
<symbol id="svg-sun" viewbox="0 0 24 24">
<title>Light mode</title>
<svg class="feather-sun" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="5"></circle>
<line x1="12" x2="12" y1="1" y2="3"></line>
<line x1="12" x2="12" y1="21" y2="23"></line>
<line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
<line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
<line x1="1" x2="3" y1="12" y2="12"></line>
<line x1="21" x2="23" y1="12" y2="12"></line>
<line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
<line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
</svg>
</symbol>
<symbol id="svg-moon" viewbox="0 0 24 24">
<title>Dark mode</title>
<svg class="icon-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
</svg>
</symbol>
<symbol id="svg-sun-half" viewbox="0 0 24 24">
<title>Auto light/dark mode</title>
<svg class="icon-tabler-shadow" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<circle cx="12" cy="12" r="9"></circle>
<path d="M13 12h5"></path>
<path d="M13 15h4"></path>
<path d="M13 18h1"></path>
<path d="M13 9h4"></path>
<path d="M13 6h1"></path>
</svg>
</symbol>
</svg>
<input class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<input class="sidebar-toggle" id="__toc" name="__toc" type="checkbox"/>
<label class="overlay sidebar-overlay" for="__navigation">
<div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
<div class="visually-hidden">Hide table of contents sidebar</div>
</label>
<div class="page">
<header class="mobile-header">
<div class="header-left">
<label class="nav-overlay-icon" for="__navigation">
<div class="visually-hidden">Toggle site navigation sidebar</div>
<i class="icon"><svg><use href="#svg-menu"></use></svg></i>
</label>
</div>
<div class="header-center">
<a href="index.html"><div class="brand">sqlite-utils</div></a>
</div>
<div class="header-right">
<div class="theme-toggle-container theme-toggle-header">
<button class="theme-toggle">
<div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
<svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
<svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
<svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
</button>
</div>
<label class="toc-overlay-icon toc-header-icon" for="__toc">
<div class="visually-hidden">Toggle table of contents sidebar</div>
<i class="icon"><svg><use href="#svg-toc"></use></svg></i>
</label>
</div>
</header>
<aside class="sidebar-drawer">
<div class="sidebar-container">
<div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
<span class="sidebar-brand-text">sqlite-utils</span>
</a><form action="search.html" class="sidebar-search-container" method="get" role="search">
<input aria-label="Search" class="sidebar-search" name="q" placeholder="Search"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">sqlite-utils command-line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-api.html">sqlite_utils Python library</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli-reference.html">CLI reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
</div>
</div>
</div>
</div>
</aside>
<div class="main">
<div class="content">
<div class="article-container">
<a class="back-to-top muted-link" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
</svg>
<span>Back to top</span>
</a>
<div class="content-icon-container">
<div class="theme-toggle-container theme-toggle-content">
<button class="theme-toggle">
<div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
<svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
<svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
<svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
</button>
</div>
<label class="toc-overlay-icon toc-content-icon" for="__toc">
<div class="visually-hidden">Toggle table of contents sidebar</div>
<i class="icon"><svg><use href="#svg-toc"></use></svg></i>
</label>
</div>
<article role="main">
<section id="sqlite-utils-command-line-tool">
<a class="dashAnchor" name="//apple_ref/cpp/Section/sqlite-utils command-line tool"></a><span id="cli"></span><h1>sqlite-utils command-line tool<a class="headerlink" href="#sqlite-utils-command-line-tool" title="Link to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> command-line tool can be used to manipulate SQLite databases in a number of different ways.</p>
<p>Once <a class="reference internal" href="installation.html#installation"><span class="std std-ref">installed</span></a> the tool should be available as <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code>. It can also be run using <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">sqlite_utils</span></code>.</p>
<nav class="contents this-will-duplicate-information-and-it-is-still-useful-here local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#running-sql-queries" id="id1">Running SQL queries</a></p>
<ul>
<li><p><a class="reference internal" href="#returning-json" id="id2">Returning JSON</a></p>
<ul>
<li><p><a class="reference internal" href="#newline-delimited-json" id="id3">Newline-delimited JSON</a></p></li>
<li><p><a class="reference internal" href="#json-arrays" id="id4">JSON arrays</a></p></li>
<li><p><a class="reference internal" href="#binary-data-in-json" id="id5">Binary data in JSON</a></p></li>
<li><p><a class="reference internal" href="#nested-json-values" id="id6">Nested JSON values</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#returning-csv-or-tsv" id="id7">Returning CSV or TSV</a></p></li>
<li><p><a class="reference internal" href="#table-formatted-output" id="id8">Table-formatted output</a></p></li>
<li><p><a class="reference internal" href="#returning-raw-data-such-as-binary-content" id="id9">Returning raw data, such as binary content</a></p></li>
<li><p><a class="reference internal" href="#using-named-parameters" id="id10">Using named parameters</a></p></li>
<li><p><a class="reference internal" href="#update-insert-and-delete" id="id11">UPDATE, INSERT and DELETE</a></p></li>
<li><p><a class="reference internal" href="#defining-custom-sql-functions" id="id12">Defining custom SQL functions</a></p></li>
<li><p><a class="reference internal" href="#sqlite-extensions" id="id13">SQLite extensions</a></p></li>
<li><p><a class="reference internal" href="#attaching-additional-databases" id="id14">Attaching additional databases</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#querying-data-directly-using-an-in-memory-database" id="id15">Querying data directly using an in-memory database</a></p>
<ul>
<li><p><a class="reference internal" href="#running-queries-directly-against-csv-or-json" id="id16">Running queries directly against CSV or JSON</a></p></li>
<li><p><a class="reference internal" href="#explicitly-specifying-the-format" id="id17">Explicitly specifying the format</a></p></li>
<li><p><a class="reference internal" href="#joining-in-memory-data-against-existing-databases-using-attach" id="id18">Joining in-memory data against existing databases using --attach</a></p></li>
<li><p><a class="reference internal" href="#schema-analyze-dump-and-save" id="id19">--schema, --analyze, --dump and --save</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#returning-all-rows-in-a-table" id="id20">Returning all rows in a table</a></p></li>
<li><p><a class="reference internal" href="#listing-tables" id="id21">Listing tables</a></p></li>
<li><p><a class="reference internal" href="#listing-views" id="id22">Listing views</a></p></li>
<li><p><a class="reference internal" href="#listing-indexes" id="id23">Listing indexes</a></p></li>
<li><p><a class="reference internal" href="#listing-triggers" id="id24">Listing triggers</a></p></li>
<li><p><a class="reference internal" href="#showing-the-schema" id="id25">Showing the schema</a></p></li>
<li><p><a class="reference internal" href="#analyzing-tables" id="id26">Analyzing tables</a></p>
<ul>
<li><p><a class="reference internal" href="#saving-the-analyzed-table-details" id="id27">Saving the analyzed table details</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-an-empty-database" id="id28">Creating an empty database</a></p></li>
<li><p><a class="reference internal" href="#inserting-json-data" id="id29">Inserting JSON data</a></p>
<ul>
<li><p><a class="reference internal" href="#inserting-binary-data" id="id30">Inserting binary data</a></p></li>
<li><p><a class="reference internal" href="#inserting-newline-delimited-json" id="id31">Inserting newline-delimited JSON</a></p></li>
<li><p><a class="reference internal" href="#flattening-nested-json-objects" id="id32">Flattening nested JSON objects</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#inserting-csv-or-tsv-data" id="id33">Inserting CSV or TSV data</a></p>
<ul>
<li><p><a class="reference internal" href="#alternative-delimiters-and-quote-characters" id="id34">Alternative delimiters and quote characters</a></p></li>
<li><p><a class="reference internal" href="#csv-files-without-a-header-row" id="id35">CSV files without a header row</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#inserting-unstructured-data-with-lines-and-text" id="id36">Inserting unstructured data with --lines and --text</a></p></li>
<li><p><a class="reference internal" href="#applying-conversions-while-inserting-data" id="id37">Applying conversions while inserting data</a></p>
<ul>
<li><p><a class="reference internal" href="#convert-with-lines" id="id38">--convert with --lines</a></p></li>
<li><p><a class="reference internal" href="#convert-with-text" id="id39">--convert with --text</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#insert-replacing-data" id="id40">Insert-replacing data</a></p></li>
<li><p><a class="reference internal" href="#upserting-data" id="id41">Upserting data</a></p></li>
<li><p><a class="reference internal" href="#executing-sql-in-bulk" id="id42">Executing SQL in bulk</a></p></li>
<li><p><a class="reference internal" href="#inserting-data-from-files" id="id43">Inserting data from files</a></p></li>
<li><p><a class="reference internal" href="#converting-data-in-columns" id="id44">Converting data in columns</a></p>
<ul>
<li><p><a class="reference internal" href="#importing-additional-modules" id="id45">Importing additional modules</a></p></li>
<li><p><a class="reference internal" href="#using-a-convert-function-to-execute-initialization" id="id46">Using a convert() function to execute initialization</a></p></li>
<li><p><a class="reference internal" href="#sqlite-utils-convert-recipes" id="id47">sqlite-utils convert recipes</a></p></li>
<li><p><a class="reference internal" href="#saving-the-result-to-a-different-column" id="id48">Saving the result to a different column</a></p></li>
<li><p><a class="reference internal" href="#converting-a-column-into-multiple-columns" id="id49">Converting a column into multiple columns</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-tables" id="id50">Creating tables</a></p></li>
<li><p><a class="reference internal" href="#renaming-a-table" id="id51">Renaming a table</a></p></li>
<li><p><a class="reference internal" href="#duplicating-tables" id="id52">Duplicating tables</a></p></li>
<li><p><a class="reference internal" href="#dropping-tables" id="id53">Dropping tables</a></p></li>
<li><p><a class="reference internal" href="#transforming-tables" id="id54">Transforming tables</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-a-primary-key-to-a-rowid-table" id="id55">Adding a primary key to a rowid table</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#extracting-columns-into-a-separate-table" id="id56">Extracting columns into a separate table</a></p></li>
<li><p><a class="reference internal" href="#creating-views" id="id57">Creating views</a></p></li>
<li><p><a class="reference internal" href="#dropping-views" id="id58">Dropping views</a></p></li>
<li><p><a class="reference internal" href="#adding-columns" id="id59">Adding columns</a></p></li>
<li><p><a class="reference internal" href="#adding-columns-automatically-on-insert-update" id="id60">Adding columns automatically on insert/update</a></p></li>
<li><p><a class="reference internal" href="#adding-foreign-key-constraints" id="id61">Adding foreign key constraints</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-multiple-foreign-keys-at-once" id="id62">Adding multiple foreign keys at once</a></p></li>
<li><p><a class="reference internal" href="#adding-indexes-for-all-foreign-keys" id="id63">Adding indexes for all foreign keys</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#setting-defaults-and-not-null-constraints" id="id64">Setting defaults and not null constraints</a></p></li>
<li><p><a class="reference internal" href="#creating-indexes" id="id65">Creating indexes</a></p></li>
<li><p><a class="reference internal" href="#configuring-full-text-search" id="id66">Configuring full-text search</a></p></li>
<li><p><a class="reference internal" href="#executing-searches" id="id67">Executing searches</a></p></li>
<li><p><a class="reference internal" href="#enabling-cached-counts" id="id68">Enabling cached counts</a></p></li>
<li><p><a class="reference internal" href="#optimizing-index-usage-with-analyze" id="id69">Optimizing index usage with ANALYZE</a></p></li>
<li><p><a class="reference internal" href="#vacuum" id="id70">Vacuum</a></p></li>
<li><p><a class="reference internal" href="#optimize" id="id71">Optimize</a></p></li>
<li><p><a class="reference internal" href="#wal-mode" id="id72">WAL mode</a></p></li>
<li><p><a class="reference internal" href="#dumping-the-database-to-sql" id="id73">Dumping the database to SQL</a></p></li>
<li><p><a class="reference internal" href="#loading-sqlite-extensions" id="id74">Loading SQLite extensions</a></p></li>
<li><p><a class="reference internal" href="#spatialite-helpers" id="id75">SpatiaLite helpers</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-spatial-indexes" id="id76">Adding spatial indexes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installing-packages" id="id77">Installing packages</a></p></li>
<li><p><a class="reference internal" href="#uninstalling-packages" id="id78">Uninstalling packages</a></p></li>
<li><p><a class="reference internal" href="#experimental-tui" id="id79">Experimental TUI</a></p></li>
</ul>
</nav>
<section id="running-sql-queries">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Running SQL queries"></a><span id="cli-query"></span><h2><a class="toc-backref" href="#id1" role="doc-backlink">Running SQL queries</a><a class="headerlink" href="#running-sql-queries" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">query</span></code> command lets you run queries directly against a SQLite database file. This is the default subcommand, so the following two examples work the same way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>query<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-query"><span class="std std-ref">db.query()</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-query"><span class="std std-ref">sqlite-utils query</span></a></p>
</div>
<section id="returning-json">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Returning JSON"></a><span id="cli-query-json"></span><h3><a class="toc-backref" href="#id2" role="doc-backlink">Returning JSON</a><a class="headerlink" href="#returning-json" title="Link to this heading">#</a></h3>
<p>The default format returned for queries is JSON:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"id": 1, "age": 4, "name": "Cleo"},</span>
<span class="go"> {"id": 2, "age": 2, "name": "Pancakes"}]</span>
</pre></div>
</div>
<section id="newline-delimited-json">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Newline-delimited JSON"></a><span id="cli-query-nl"></span><h4><a class="toc-backref" href="#id3" role="doc-backlink">Newline-delimited JSON</a><a class="headerlink" href="#newline-delimited-json" title="Link to this heading">#</a></h4>
<p>Use <code class="docutils literal notranslate"><span class="pre">--nl</span></code> to get back newline-delimited JSON objects:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--nl
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">{"id": 1, "age": 4, "name": "Cleo"}</span>
<span class="go">{"id": 2, "age": 2, "name": "Pancakes"}</span>
</pre></div>
</div>
</section>
<section id="json-arrays">
<a class="dashAnchor" name="//apple_ref/cpp/Section/JSON arrays"></a><span id="cli-query-arrays"></span><h4><a class="toc-backref" href="#id4" role="doc-backlink">JSON arrays</a><a class="headerlink" href="#json-arrays" title="Link to this heading">#</a></h4>
<p>You can use <code class="docutils literal notranslate"><span class="pre">--arrays</span></code> to request arrays instead of objects:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--arrays
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[[1, 4, "Cleo"],</span>
<span class="go"> [2, 2, "Pancakes"]]</span>
</pre></div>
</div>
<p>You can also combine <code class="docutils literal notranslate"><span class="pre">--arrays</span></code> and <code class="docutils literal notranslate"><span class="pre">--nl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--arrays<span class="w"> </span>--nl
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[1, 4, "Cleo"]</span>
<span class="go">[2, 2, "Pancakes"]</span>
</pre></div>
</div>
<p>If you want to pretty-print the output further, you can pipe it through <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-mjson.tool</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-mjson.tool
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[</span>
<span class="go">    {</span>
<span class="go">        "id": 1,</span>
<span class="go">        "age": 4,</span>
<span class="go">        "name": "Cleo"</span>
<span class="go">    },</span>
<span class="go">    {</span>
<span class="go">        "id": 2,</span>
<span class="go">        "age": 2,</span>
<span class="go">        "name": "Pancakes"</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
</section>
<section id="binary-data-in-json">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Binary data in JSON"></a><span id="cli-query-binary-json"></span><h4><a class="toc-backref" href="#id5" role="doc-backlink">Binary data in JSON</a><a class="headerlink" href="#binary-data-in-json" title="Link to this heading">#</a></h4>
<p>Binary strings are not valid JSON, so BLOB columns containing binary data will be returned as a JSON object containing base64 encoded data, that looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select name, content from images"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-mjson.tool
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[</span>
<span class="go">    {</span>
<span class="go">        "name": "transparent.gif",</span>
<span class="go">        "content": {</span>
<span class="go">            "$base64": true,</span>
<span class="go">            "encoded": "R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
</section>
<section id="nested-json-values">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Nested JSON values"></a><span id="cli-json-values"></span><h4><a class="toc-backref" href="#id6" role="doc-backlink">Nested JSON values</a><a class="headerlink" href="#nested-json-values" title="Link to this heading">#</a></h4>
<p>If one of your columns contains JSON, by default it will be returned as an escaped string:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-mjson.tool
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[</span>
<span class="go">    {</span>
<span class="go">        "id": 1,</span>
<span class="go">        "name": "Cleo",</span>
<span class="go">        "friends": "[{\"name\": \"Pancakes\"}, {\"name\": \"Bailey\"}]"</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--json-cols</span></code> option to automatically detect these JSON columns and output them as nested JSON data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--json-cols<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-mjson.tool
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[</span>
<span class="go">    {</span>
<span class="go">        "id": 1,</span>
<span class="go">        "name": "Cleo",</span>
<span class="go">        "friends": [</span>
<span class="go">            {</span>
<span class="go">                "name": "Pancakes"</span>
<span class="go">            },</span>
<span class="go">            {</span>
<span class="go">                "name": "Bailey"</span>
<span class="go">            }</span>
<span class="go">        ]</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
</section>
</section>
<section id="returning-csv-or-tsv">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Returning CSV or TSV"></a><span id="cli-query-csv"></span><h3><a class="toc-backref" href="#id7" role="doc-backlink">Returning CSV or TSV</a><a class="headerlink" href="#returning-csv-or-tsv" title="Link to this heading">#</a></h3>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--csv</span></code> option to return results as CSV:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--csv
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">id,age,name</span>
<span class="go">1,4,Cleo</span>
<span class="go">2,2,Pancakes</span>
</pre></div>
</div>
<p>This will default to including the column names as a header row. To exclude the headers, use <code class="docutils literal notranslate"><span class="pre">--no-headers</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--csv<span class="w"> </span>--no-headers
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">1,4,Cleo</span>
<span class="go">2,2,Pancakes</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--tsv</span></code> instead of <code class="docutils literal notranslate"><span class="pre">--csv</span></code> to get back tab-separated values:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--tsv
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">id  age     name</span>
<span class="go">1   4       Cleo</span>
<span class="go">2   2       Pancakes</span>
</pre></div>
</div>
</section>
<section id="table-formatted-output">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Table-formatted output"></a><span id="cli-query-table"></span><h3><a class="toc-backref" href="#id8" role="doc-backlink">Table-formatted output</a><a class="headerlink" href="#table-formatted-output" title="Link to this heading">#</a></h3>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--table</span></code> option (or <code class="docutils literal notranslate"><span class="pre">-t</span></code> shortcut) to output query results as a table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--table
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">  id    age  name</span>
<span class="go">----  -----  --------</span>
<span class="go">   1      4  Cleo</span>
<span class="go">   2      2  Pancakes</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--fmt</span></code> option to specify different table formats, for example <code class="docutils literal notranslate"><span class="pre">rst</span></code> for reStructuredText:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select * from dogs"</span><span class="w"> </span>--fmt<span class="w"> </span>rst
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">====  =====  ========</span>
<span class="go">  id    age  name</span>
<span class="go">====  =====  ========</span>
<span class="go">   1      4  Cleo</span>
<span class="go">   2      2  Pancakes</span>
<span class="go">====  =====  ========</span>
</pre></div>
</div>
<p>Available <code class="docutils literal notranslate"><span class="pre">--fmt</span></code> options are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">asciidoc</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">double_grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">double_outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fancy_grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fancy_outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">github</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">heavy_grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">heavy_outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">html</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jira</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latex</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latex_booktabs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latex_longtable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latex_raw</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mediawiki</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mixed_grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mixed_outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">moinmoin</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orgtbl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipe</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plain</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">presto</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pretty</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psql</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rounded_grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rounded_outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rst</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple_grid</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple_outline</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">textile</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tsv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unsafehtml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">youtrack</span></code></p></li>
</ul>
<p>This list can also be found by running <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">query</span> <span class="pre">--help</span></code>.</p>
</section>
<section id="returning-raw-data-such-as-binary-content">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Returning raw data, such as binary content"></a><span id="cli-query-raw"></span><h3><a class="toc-backref" href="#id9" role="doc-backlink">Returning raw data, such as binary content</a><a class="headerlink" href="#returning-raw-data-such-as-binary-content" title="Link to this heading">#</a></h3>
<p>If your table contains binary data in a <code class="docutils literal notranslate"><span class="pre">BLOB</span></code> you can use the <code class="docutils literal notranslate"><span class="pre">--raw</span></code> option to output specific columns directly to standard out.</p>
<p>For example, to retrieve a binary image from a <code class="docutils literal notranslate"><span class="pre">BLOB</span></code> column and store it in a file you can use the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>photos.db<span class="w"> </span><span class="s2">"select contents from photos where id=1"</span><span class="w"> </span>--raw<span class="w"> </span>&gt;<span class="w"> </span>myphoto.jpg
</pre></div>
</div>
<p>To return the first column of each result as raw data, separated by newlines, use <code class="docutils literal notranslate"><span class="pre">--raw-lines</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>photos.db<span class="w"> </span><span class="s2">"select caption from photos"</span><span class="w"> </span>--raw-lines<span class="w"> </span>&gt;<span class="w"> </span>captions.txt
</pre></div>
</div>
</section>
<section id="using-named-parameters">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Using named parameters"></a><span id="cli-query-parameters"></span><h3><a class="toc-backref" href="#id10" role="doc-backlink">Using named parameters</a><a class="headerlink" href="#using-named-parameters" title="Link to this heading">#</a></h3>
<p>You can pass named parameters to the query using <code class="docutils literal notranslate"><span class="pre">-p</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>query<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select :num * :num2"</span><span class="w"> </span>-p<span class="w"> </span>num<span class="w"> </span><span class="m">5</span><span class="w"> </span>-p<span class="w"> </span>num2<span class="w"> </span><span class="m">6</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{":num * :num2": 30}]</span>
</pre></div>
</div>
<p>These will be correctly quoted and escaped in the SQL query, providing a safe way to combine other values with SQL.</p>
</section>
<section id="update-insert-and-delete">
<a class="dashAnchor" name="//apple_ref/cpp/Section/UPDATE, INSERT and DELETE"></a><span id="cli-query-update-insert-delete"></span><h3><a class="toc-backref" href="#id11" role="doc-backlink">UPDATE, INSERT and DELETE</a><a class="headerlink" href="#update-insert-and-delete" title="Link to this heading">#</a></h3>
<p>If you execute an <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> or <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> query the command will return the number of affected rows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"update dogs set age = 5 where name = 'Cleo'"</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"rows_affected": 1}]</span>
</pre></div>
</div>
</section>
<section id="defining-custom-sql-functions">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Defining custom SQL functions"></a><span id="cli-query-functions"></span><h3><a class="toc-backref" href="#id12" role="doc-backlink">Defining custom SQL functions</a><a class="headerlink" href="#defining-custom-sql-functions" title="Link to this heading">#</a></h3>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--functions</span></code> option to pass a block of Python code that defines additional functions which can then be called by your SQL query.</p>
<p>This example defines a function which extracts the domain from a URL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>query<span class="w"> </span>sites.db<span class="w"> </span><span class="s2">"select url, domain(url) from urls"</span><span class="w"> </span>--functions<span class="w"> </span><span class="s1">'</span>
<span class="s1">from urllib.parse import urlparse</span>

<span class="s1">def domain(url):</span>
<span class="s1">    return urlparse(url).netloc</span>
<span class="s1">'</span>
</pre></div>
</div>
<p>Every callable object defined in the block will be registered as a SQL function with the same name, with the exception of functions with names that begin with an underscore.</p>
</section>
<section id="sqlite-extensions">
<a class="dashAnchor" name="//apple_ref/cpp/Section/SQLite extensions"></a><span id="cli-query-extensions"></span><h3><a class="toc-backref" href="#id13" role="doc-backlink">SQLite extensions</a><a class="headerlink" href="#sqlite-extensions" title="Link to this heading">#</a></h3>
<p>You can load SQLite extension modules using the <code class="docutils literal notranslate"><span class="pre">--load-extension</span></code> option, see <a class="reference internal" href="#cli-load-extension"><span class="std std-ref">Loading SQLite extensions</span></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span><span class="s2">"select spatialite_version()"</span><span class="w"> </span>--load-extension<span class="o">=</span>spatialite
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"spatialite_version()": "4.3.0a"}]</span>
</pre></div>
</div>
</section>
<section id="attaching-additional-databases">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Attaching additional databases"></a><span id="cli-query-attach"></span><h3><a class="toc-backref" href="#id14" role="doc-backlink">Attaching additional databases</a><a class="headerlink" href="#attaching-additional-databases" title="Link to this heading">#</a></h3>
<p>SQLite supports cross-database SQL queries, which can join data from tables in more than one database file.</p>
<p>You can attach one or more additional databases using the <code class="docutils literal notranslate"><span class="pre">--attach</span></code> option, providing an alias to use for that database and the path to the SQLite file on disk.</p>
<p>This example attaches the <code class="docutils literal notranslate"><span class="pre">books.db</span></code> database under the alias <code class="docutils literal notranslate"><span class="pre">books</span></code> and then runs a query that combines data from that database with the default <code class="docutils literal notranslate"><span class="pre">dogs.db</span></code> database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dogs.db<span class="w"> </span>--attach<span class="w"> </span>books<span class="w"> </span>books.db<span class="w"> </span><span class="se">\</span>
<span class="w">   </span><span class="s1">'select * from sqlite_master union all select * from books.sqlite_master'</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-attach"><span class="std std-ref">db.attach()</span></a></p>
</div>
</section>
</section>
<section id="querying-data-directly-using-an-in-memory-database">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Querying data directly using an in-memory database"></a><span id="cli-memory"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink">Querying data directly using an in-memory database</a><a class="headerlink" href="#querying-data-directly-using-an-in-memory-database" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">memory</span></code> command works similar to <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">query</span></code>, but allows you to execute queries against an in-memory database.</p>
<p>You can also pass this command CSV or JSON files which will be loaded into a temporary in-memory table, allowing you to execute SQL against that data without a separate step to first convert it to SQLite.</p>
<p>Without any extra arguments, this command executes SQL against the in-memory database directly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span><span class="s1">'select sqlite_version()'</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"sqlite_version()": "3.35.5"}]</span>
</pre></div>
</div>
<p>It takes all of the same output formatting options as <a class="reference internal" href="#cli-query"><span class="std std-ref">sqlite-utils query</span></a>: <code class="docutils literal notranslate"><span class="pre">--csv</span></code> and <code class="docutils literal notranslate"><span class="pre">--csv</span></code> and <code class="docutils literal notranslate"><span class="pre">--table</span></code> and <code class="docutils literal notranslate"><span class="pre">--nl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span><span class="s1">'select sqlite_version()'</span><span class="w"> </span>--csv
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">sqlite_version()</span>
<span class="go">3.35.5</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span><span class="s1">'select sqlite_version()'</span><span class="w"> </span>--fmt<span class="w"> </span>grid
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">+--------------------+</span>
<span class="go">| sqlite_version()   |</span>
<span class="go">+====================+</span>
<span class="go">| 3.35.5             |</span>
<span class="go">+--------------------+</span>
</pre></div>
</div>
<section id="running-queries-directly-against-csv-or-json">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Running queries directly against CSV or JSON"></a><span id="cli-memory-csv-json"></span><h3><a class="toc-backref" href="#id16" role="doc-backlink">Running queries directly against CSV or JSON</a><a class="headerlink" href="#running-queries-directly-against-csv-or-json" title="Link to this heading">#</a></h3>
<p>If you have data in CSV or JSON format you can load it into an in-memory SQLite database and run queries against it directly in a single command using <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">memory</span></code> like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>data.csv<span class="w"> </span><span class="s2">"select * from data"</span>
</pre></div>
</div>
<p>You can pass multiple files to the command if you want to run joins between data from different files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>one.csv<span class="w"> </span>two.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">"select * from one join two on one.id = two.other_id"</span>
</pre></div>
</div>
<p>If your data is JSON it should be the same format supported by the <a class="reference internal" href="#cli-inserting-data"><span class="std std-ref">sqlite-utils insert command</span></a> - so either a single JSON object (treated as a single row) or a list of JSON objects.</p>
<p>CSV data can be comma- or tab- delimited.</p>
<p>The in-memory tables will be named after the files without their extensions. The tool also sets up aliases for those tables (using SQL views) as <code class="docutils literal notranslate"><span class="pre">t1</span></code>, <code class="docutils literal notranslate"><span class="pre">t2</span></code> and so on, or you can use the alias <code class="docutils literal notranslate"><span class="pre">t</span></code> to refer to the first table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>example.csv<span class="w"> </span><span class="s2">"select * from t"</span>
</pre></div>
</div>
<p>If two files have the same name they will be assigned a numeric suffix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>foo/data.csv<span class="w"> </span>bar/data.csv<span class="w"> </span><span class="s2">"select * from data_2"</span>
</pre></div>
</div>
<p>To read from standard input, use either <code class="docutils literal notranslate"><span class="pre">-</span></code> or <code class="docutils literal notranslate"><span class="pre">stdin</span></code> as the filename - then use <code class="docutils literal notranslate"><span class="pre">stdin</span></code> or <code class="docutils literal notranslate"><span class="pre">t</span></code> or <code class="docutils literal notranslate"><span class="pre">t1</span></code> as the table name:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>example.csv<span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>-<span class="w"> </span><span class="s2">"select * from stdin"</span>
</pre></div>
</div>
<p>Incoming CSV data will be assumed to use <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>. If your data uses a different character encoding you can specify that with <code class="docutils literal notranslate"><span class="pre">--encoding</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>example.csv<span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>-<span class="w"> </span><span class="s2">"select * from stdin"</span><span class="w"> </span>--encoding<span class="o">=</span>latin-1
</pre></div>
</div>
<p>If you are joining across multiple CSV files they must all use the same encoding.</p>
<p>Column types will be automatically detected in CSV or TSV data, using the same mechanism as <code class="docutils literal notranslate"><span class="pre">--detect-types</span></code> described in <a class="reference internal" href="#cli-insert-csv-tsv"><span class="std std-ref">Inserting CSV or TSV data</span></a>. You can pass the <code class="docutils literal notranslate"><span class="pre">--no-detect-types</span></code> option to disable this automatic type detection and treat all CSV and TSV columns as <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>.</p>
</section>
<section id="explicitly-specifying-the-format">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Explicitly specifying the format"></a><span id="cli-memory-explicit"></span><h3><a class="toc-backref" href="#id17" role="doc-backlink">Explicitly specifying the format</a><a class="headerlink" href="#explicitly-specifying-the-format" title="Link to this heading">#</a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">memory</span></code> will attempt to detect the incoming data format (JSON, TSV or CSV) automatically.</p>
<p>You can instead specify an explicit format by adding a <code class="docutils literal notranslate"><span class="pre">:csv</span></code>, <code class="docutils literal notranslate"><span class="pre">:tsv</span></code>, <code class="docutils literal notranslate"><span class="pre">:json</span></code> or <code class="docutils literal notranslate"><span class="pre">:nl</span></code> (for newline-delimited JSON) suffix to the filename. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>one.dat:csv<span class="w"> </span>two.dat:nl<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">"select * from one union select * from two"</span>
</pre></div>
</div>
<p>Here the contents of <code class="docutils literal notranslate"><span class="pre">one.dat</span></code> will be treated as CSV and the contents of <code class="docutils literal notranslate"><span class="pre">two.dat</span></code> will be treated as newline-delimited JSON.</p>
<p>To explicitly specify the format for data piped into the tool on standard input, use <code class="docutils literal notranslate"><span class="pre">stdin:format</span></code> - for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>one.dat<span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>stdin:csv<span class="w"> </span><span class="s2">"select * from stdin"</span>
</pre></div>
</div>
</section>
<section id="joining-in-memory-data-against-existing-databases-using-attach">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Joining in-memory data against existing databases using --attach"></a><span id="cli-memory-attach"></span><h3><a class="toc-backref" href="#id18" role="doc-backlink">Joining in-memory data against existing databases using --attach</a><a class="headerlink" href="#joining-in-memory-data-against-existing-databases-using-attach" title="Link to this heading">#</a></h3>
<p>The <a class="reference internal" href="#cli-query-attach"><span class="std std-ref">attach option</span></a> can be used to attach database files to the in-memory connection, enabling joins between in-memory data loaded from a file and tables in existing SQLite database files. An example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">"id\n1\n3\n5"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>-<span class="w"> </span>--attach<span class="w"> </span>trees<span class="w"> </span>trees.db<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">"select * from trees.trees where rowid in (select id from stdin)"</span>
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">--attach</span> <span class="pre">trees</span> <span class="pre">trees.db</span></code> option makes the <code class="docutils literal notranslate"><span class="pre">trees.db</span></code> database available with an alias of <code class="docutils literal notranslate"><span class="pre">trees</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">trees.trees</span> <span class="pre">where</span> <span class="pre">...</span></code> can then query the <code class="docutils literal notranslate"><span class="pre">trees</span></code> table in that database.</p>
<p>The CSV data that was piped into the script is available in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> table, so  <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">where</span> <span class="pre">rowid</span> <span class="pre">in</span> <span class="pre">(select</span> <span class="pre">id</span> <span class="pre">from</span> <span class="pre">stdin)</span></code> can be used to return rows from the <code class="docutils literal notranslate"><span class="pre">trees</span></code> table that match IDs that were piped in as CSV content.</p>
</section>
<section id="schema-analyze-dump-and-save">
<a class="dashAnchor" name="//apple_ref/cpp/Section/--schema, --analyze, --dump and --save"></a><span id="cli-memory-schema-dump-save"></span><h3><a class="toc-backref" href="#id19" role="doc-backlink">--schema, --analyze, --dump and --save</a><a class="headerlink" href="#schema-analyze-dump-and-save" title="Link to this heading">#</a></h3>
<p>To see the in-memory database schema that would be used for a file or for multiple files, use <code class="docutils literal notranslate"><span class="pre">--schema</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>dogs.csv<span class="w"> </span>--schema
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE TABLE [dogs] (</span>
<span class="go">    [id] INTEGER,</span>
<span class="go">    [age] INTEGER,</span>
<span class="go">    [name] TEXT</span>
<span class="go">);</span>
<span class="go">CREATE VIEW t1 AS select * from [dogs];</span>
<span class="go">CREATE VIEW t AS select * from [dogs];</span>
</pre></div>
</div>
<p>You can run the equivalent of the <a class="reference internal" href="#cli-analyze-tables"><span class="std std-ref">analyze-tables</span></a> command using <code class="docutils literal notranslate"><span class="pre">--analyze</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>dogs.csv<span class="w"> </span>--analyze
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">dogs.id: (1/3)</span>

<span class="go">  Total rows: 2</span>
<span class="go">  Null rows: 0</span>
<span class="go">  Blank rows: 0</span>

<span class="go">  Distinct values: 2</span>

<span class="go">dogs.name: (2/3)</span>

<span class="go">  Total rows: 2</span>
<span class="go">  Null rows: 0</span>
<span class="go">  Blank rows: 0</span>

<span class="go">  Distinct values: 2</span>

<span class="go">dogs.age: (3/3)</span>

<span class="go">  Total rows: 2</span>
<span class="go">  Null rows: 0</span>
<span class="go">  Blank rows: 0</span>

<span class="go">  Distinct values: 2</span>
</pre></div>
</div>
<p>You can output SQL that will both create the tables and insert the full data used to populate the in-memory database using <code class="docutils literal notranslate"><span class="pre">--dump</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>dogs.csv<span class="w"> </span>--dump
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">BEGIN TRANSACTION;</span>
<span class="go">CREATE TABLE [dogs] (</span>
<span class="go">    [id] INTEGER,</span>
<span class="go">    [age] INTEGER,</span>
<span class="go">    [name] TEXT</span>
<span class="go">);</span>
<span class="go">INSERT INTO "dogs" VALUES('1','4','Cleo');</span>
<span class="go">INSERT INTO "dogs" VALUES('2','2','Pancakes');</span>
<span class="go">CREATE VIEW t1 AS select * from [dogs];</span>
<span class="go">CREATE VIEW t AS select * from [dogs];</span>
<span class="go">COMMIT;</span>
</pre></div>
</div>
<p>Passing <code class="docutils literal notranslate"><span class="pre">--save</span> <span class="pre">other.db</span></code> will instead use that SQL to populate a new database file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span>dogs.csv<span class="w"> </span>--save<span class="w"> </span>dogs.db
</pre></div>
</div>
<p>These features are mainly intended as debugging tools - for much more finely grained control over how data is inserted into a SQLite database file see <a class="reference internal" href="#cli-inserting-data"><span class="std std-ref">Inserting JSON data</span></a> and <a class="reference internal" href="#cli-insert-csv-tsv"><span class="std std-ref">Inserting CSV or TSV data</span></a>.</p>
</section>
</section>
<section id="returning-all-rows-in-a-table">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Returning all rows in a table"></a><span id="cli-rows"></span><h2><a class="toc-backref" href="#id20" role="doc-backlink">Returning all rows in a table</a><a class="headerlink" href="#returning-all-rows-in-a-table" title="Link to this heading">#</a></h2>
<p>You can return every row in a specified table using the <code class="docutils literal notranslate"><span class="pre">rows</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rows<span class="w"> </span>dogs.db<span class="w"> </span>dogs
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"id": 1, "age": 4, "name": "Cleo"},</span>
<span class="go"> {"id": 2, "age": 2, "name": "Pancakes"}]</span>
</pre></div>
</div>
<p>This command accepts the same output options as <code class="docutils literal notranslate"><span class="pre">query</span></code> - so you can pass <code class="docutils literal notranslate"><span class="pre">--nl</span></code>, <code class="docutils literal notranslate"><span class="pre">--csv</span></code>, <code class="docutils literal notranslate"><span class="pre">--tsv</span></code>, <code class="docutils literal notranslate"><span class="pre">--no-headers</span></code>, <code class="docutils literal notranslate"><span class="pre">--table</span></code> and <code class="docutils literal notranslate"><span class="pre">--fmt</span></code>.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option to specify a subset of columns to return:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rows<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>-c<span class="w"> </span>age<span class="w"> </span>-c<span class="w"> </span>name
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"age": 4, "name": "Cleo"},</span>
<span class="go"> {"age": 2, "name": "Pancakes"}]</span>
</pre></div>
</div>
<p>You can filter rows using a where clause with the <code class="docutils literal notranslate"><span class="pre">--where</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rows<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>-c<span class="w"> </span>name<span class="w"> </span>--where<span class="w"> </span><span class="s1">'name = "Cleo"'</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"name": "Cleo"}]</span>
</pre></div>
</div>
<p>Or pass named parameters using <code class="docutils literal notranslate"><span class="pre">--where</span></code> in combination with <code class="docutils literal notranslate"><span class="pre">-p</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rows<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>-c<span class="w"> </span>name<span class="w"> </span>--where<span class="w"> </span><span class="s1">'name = :name'</span><span class="w"> </span>-p<span class="w"> </span>name<span class="w"> </span>Cleo
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"name": "Cleo"}]</span>
</pre></div>
</div>
<p>You can define a sort order using <code class="docutils literal notranslate"><span class="pre">--order</span> <span class="pre">column</span></code> or <code class="docutils literal notranslate"><span class="pre">--order</span> <span class="pre">'column</span> <span class="pre">desc'</span></code>.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">--limit</span> <span class="pre">N</span></code> to only return the first <code class="docutils literal notranslate"><span class="pre">N</span></code> rows. Use <code class="docutils literal notranslate"><span class="pre">--offset</span> <span class="pre">N</span></code> to return rows starting from the specified offset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-rows"><span class="std std-ref">table.rows</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-rows"><span class="std std-ref">sqlite-utils rows</span></a></p>
</div>
</section>
<section id="listing-tables">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Listing tables"></a><span id="cli-tables"></span><h2><a class="toc-backref" href="#id21" role="doc-backlink">Listing tables</a><a class="headerlink" href="#listing-tables" title="Link to this heading">#</a></h2>
<p>You can list the names of tables in a database using the <code class="docutils literal notranslate"><span class="pre">tables</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>mydb.db
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"table": "dogs"},</span>
<span class="go"> {"table": "cats"},</span>
<span class="go"> {"table": "chickens"}]</span>
</pre></div>
</div>
<p>You can output this list in CSV using the <code class="docutils literal notranslate"><span class="pre">--csv</span></code> or <code class="docutils literal notranslate"><span class="pre">--tsv</span></code> options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>mydb.db<span class="w"> </span>--csv<span class="w"> </span>--no-headers
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">dogs</span>
<span class="go">cats</span>
<span class="go">chickens</span>
</pre></div>
</div>
<p>If you just want to see the FTS4 tables, you can use <code class="docutils literal notranslate"><span class="pre">--fts4</span></code> (or <code class="docutils literal notranslate"><span class="pre">--fts5</span></code> for FTS5 tables):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>docs.db<span class="w"> </span>--fts4
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"table": "docs_fts"}]</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--counts</span></code> to include a count of the number of rows in each table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>mydb.db<span class="w"> </span>--counts
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"table": "dogs", "count": 12},</span>
<span class="go"> {"table": "cats", "count": 332},</span>
<span class="go"> {"table": "chickens", "count": 9}]</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--columns</span></code> to include a list of columns in each table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>dogs.db<span class="w"> </span>--counts<span class="w"> </span>--columns
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"table": "Gosh", "count": 0, "columns": ["c1", "c2", "c3"]},</span>
<span class="go"> {"table": "Gosh2", "count": 0, "columns": ["c1", "c2", "c3"]},</span>
<span class="go"> {"table": "dogs", "count": 2, "columns": ["id", "age", "name"]}]</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--schema</span></code> to include the schema of each table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>dogs.db<span class="w"> </span>--schema<span class="w"> </span>--table
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">table    schema</span>
<span class="go">-------  -----------------------------------------------</span>
<span class="go">Gosh     CREATE TABLE Gosh (c1 text, c2 text, c3 text)</span>
<span class="go">Gosh2    CREATE TABLE Gosh2 (c1 text, c2 text, c3 text)</span>
<span class="go">dogs     CREATE TABLE [dogs] (</span>
<span class="go">           [id] INTEGER,</span>
<span class="go">           [age] INTEGER,</span>
<span class="go">           [name] TEXT)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--nl</span></code>, <code class="docutils literal notranslate"><span class="pre">--csv</span></code>, <code class="docutils literal notranslate"><span class="pre">--tsv</span></code>, <code class="docutils literal notranslate"><span class="pre">--table</span></code> and <code class="docutils literal notranslate"><span class="pre">--fmt</span></code> options are also available.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-tables"><span class="std std-ref">db.tables or db.table_names()</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-tables"><span class="std std-ref">sqlite-utils tables</span></a></p>
</div>
</section>
<section id="listing-views">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Listing views"></a><span id="cli-views"></span><h2><a class="toc-backref" href="#id22" role="doc-backlink">Listing views</a><a class="headerlink" href="#listing-views" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">views</span></code> command shows any views defined in the database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>views<span class="w"> </span>sf-trees.db<span class="w"> </span>--table<span class="w"> </span>--counts<span class="w"> </span>--columns<span class="w"> </span>--schema
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">view         count  columns               schema</span>
<span class="go">---------  -------  --------------------  --------------------------------------------------------------</span>
<span class="go">demo_view   189144  ['qSpecies']          CREATE VIEW demo_view AS select qSpecies from Street_Tree_List</span>
<span class="go">hello            1  ['sqlite_version()']  CREATE VIEW hello as select sqlite_version()</span>
</pre></div>
</div>
<p>It takes the same options as the <code class="docutils literal notranslate"><span class="pre">tables</span></code> command:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--columns</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--schema</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--counts</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--nl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--csv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--tsv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--table</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-views"><span class="std std-ref">db.views or db.view_names()</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-views"><span class="std std-ref">sqlite-utils views</span></a></p>
</div>
</section>
<section id="listing-indexes">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Listing indexes"></a><span id="cli-indexes"></span><h2><a class="toc-backref" href="#id23" role="doc-backlink">Listing indexes</a><a class="headerlink" href="#listing-indexes" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">indexes</span></code> command lists any indexes configured for the database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>indexes<span class="w"> </span>covid.db<span class="w"> </span>--table
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">table                             index_name                                                seqno    cid  name                 desc  coll      key</span>
<span class="go">--------------------------------  ------------------------------------------------------  -------  -----  -----------------  ------  ------  -----</span>
<span class="go">johns_hopkins_csse_daily_reports  idx_johns_hopkins_csse_daily_reports_combined_key             0     12  combined_key            0  BINARY      1</span>
<span class="go">johns_hopkins_csse_daily_reports  idx_johns_hopkins_csse_daily_reports_country_or_region        0      1  country_or_region       0  BINARY      1</span>
<span class="go">johns_hopkins_csse_daily_reports  idx_johns_hopkins_csse_daily_reports_province_or_state        0      2  province_or_state       0  BINARY      1</span>
<span class="go">johns_hopkins_csse_daily_reports  idx_johns_hopkins_csse_daily_reports_day                      0      0  day                     0  BINARY      1</span>
<span class="go">ny_times_us_counties              idx_ny_times_us_counties_date                                 0      0  date                    1  BINARY      1</span>
<span class="go">ny_times_us_counties              idx_ny_times_us_counties_fips                                 0      3  fips                    0  BINARY      1</span>
<span class="go">ny_times_us_counties              idx_ny_times_us_counties_county                               0      1  county                  0  BINARY      1</span>
<span class="go">ny_times_us_counties              idx_ny_times_us_counties_state                                0      2  state                   0  BINARY      1</span>
</pre></div>
</div>
<p>It shows indexes across all tables. To see indexes for specific tables, list those after the database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>indexes<span class="w"> </span>covid.db<span class="w"> </span>johns_hopkins_csse_daily_reports<span class="w"> </span>--table
</pre></div>
</div>
<p>The command defaults to only showing the columns that are explicitly part of the index. To also include auxiliary columns use the <code class="docutils literal notranslate"><span class="pre">--aux</span></code> option - these columns will be listed with a <code class="docutils literal notranslate"><span class="pre">key</span></code> of <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>The command takes the same format options as the <code class="docutils literal notranslate"><span class="pre">tables</span></code> and <code class="docutils literal notranslate"><span class="pre">views</span></code> commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-introspection-indexes"><span class="std std-ref">table.indexes</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-indexes"><span class="std std-ref">sqlite-utils indexes</span></a></p>
</div>
</section>
<section id="listing-triggers">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Listing triggers"></a><span id="cli-triggers"></span><h2><a class="toc-backref" href="#id24" role="doc-backlink">Listing triggers</a><a class="headerlink" href="#listing-triggers" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">triggers</span></code> command shows any triggers configured for the database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>triggers<span class="w"> </span>global-power-plants.db<span class="w"> </span>--table
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">name             table      sql</span>
<span class="go">---------------  ---------  -----------------------------------------------------------------</span>
<span class="go">plants_insert    plants     CREATE TRIGGER [plants_insert] AFTER INSERT ON [plants]</span>
<span class="go">                            BEGIN</span>
<span class="go">                                INSERT OR REPLACE INTO [_counts]</span>
<span class="go">                                VALUES (</span>
<span class="go">                                  'plants',</span>
<span class="go">                                  COALESCE(</span>
<span class="go">                                    (SELECT count FROM [_counts] WHERE [table] = 'plants'),</span>
<span class="go">                                  0</span>
<span class="go">                                  ) + 1</span>
<span class="go">                                );</span>
<span class="go">                            END</span>
</pre></div>
</div>
<p>It defaults to showing triggers for all tables. To see triggers for one or more specific tables pass their names as arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>triggers<span class="w"> </span>global-power-plants.db<span class="w"> </span>plants
</pre></div>
</div>
<p>The command takes the same format options as the <code class="docutils literal notranslate"><span class="pre">tables</span></code> and <code class="docutils literal notranslate"><span class="pre">views</span></code> commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-introspection-triggers"><span class="std std-ref">table.triggers or db.triggers</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-triggers"><span class="std std-ref">sqlite-utils triggers</span></a></p>
</div>
</section>
<section id="showing-the-schema">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Showing the schema"></a><span id="cli-schema"></span><h2><a class="toc-backref" href="#id25" role="doc-backlink">Showing the schema</a><a class="headerlink" href="#showing-the-schema" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">schema</span></code> command shows the full SQL schema for the database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>schema<span class="w"> </span>dogs.db
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE TABLE "dogs" (</span>
<span class="go">    [id] INTEGER PRIMARY KEY,</span>
<span class="go">    [name] TEXT</span>
<span class="go">);</span>
</pre></div>
</div>
<p>This will show the schema for every table and index in the database. To view the schema just for a specified subset of tables pass those as additional arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>schema<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>chickens
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Python: <a class="reference internal" href="python-api.html#python-api-introspection-schema"><span class="std std-ref">table.schema</span></a> or <a class="reference internal" href="python-api.html#python-api-schema"><span class="std std-ref">db.schema</span></a>  CLI reference: <a class="reference internal" href="cli-reference.html#cli-ref-schema"><span class="std std-ref">sqlite-utils schema</span></a></p>
</div>
</section>
<section id="analyzing-tables">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Analyzing tables"></a><span id="cli-analyze-tables"></span><h2><a class="toc-backref" href="#id26" role="doc-backlink">Analyzing tables</a><a class="headerlink" href="#analyzing-tables" title="Link to this heading">#</a></h2>
<p>When working with a new database it can be useful to get an idea of the shape of the data. The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">analyze-tables</span></code> command inspects specified tables (or all tables) and calculates some useful details about each of the columns in those tables.</p>
<p>To inspect the <code class="docutils literal notranslate"><span class="pre">tags</span></code> table in the <code class="docutils literal notranslate"><span class="pre">github.db</span></code> database, run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze-tables<span class="w"> </span>github.db<span class="w"> </span>tags
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">tags.repo: (1/3)</span>

<span class="go">  Total rows: 261</span>
<span class="go">  Null rows: 0</span>
<span class="go">  Blank rows: 0</span>

<span class="go">  Distinct values: 14</span>

<span class="go">  Most common:</span>
<span class="go">    88: 107914493</span>
<span class="go">    75: 140912432</span>
<span class="go">    27: 206156866</span>

<span class="go">  Least common:</span>
<span class="go">    1: 209590345</span>
<span class="go">    2: 206649770</span>
<span class="go">    2: 303218369</span>

<span class="go">tags.name: (2/3)</span>

<span class="go">  Total rows: 261</span>
<span class="go">  Null rows: 0</span>
<span class="go">  Blank rows: 0</span>

<span class="go">  Distinct values: 175</span>

<span class="go">  Most common:</span>
<span class="go">    10: 0.2</span>
<span class="go">    9: 0.1</span>
<span class="go">    7: 0.3</span>

<span class="go">  Least common:</span>
<span class="go">    1: 0.1.1</span>
<span class="go">    1: 0.11.1</span>
<span class="go">    1: 0.1a2</span>

<span class="go">tags.sha: (3/3)</span>

<span class="go">  Total rows: 261</span>
<span class="go">  Null rows: 0</span>
<span class="go">  Blank rows: 0</span>

<span class="go">  Distinct values: 261</span>
</pre></div>
</div>
<p>For each column this tool displays the number of null rows, the number of blank rows (rows that contain an empty string), the number of distinct values and, for columns that are not entirely distinct, the most common and least common values.</p>
<p>If you do not specify any tables every table in the database will be analyzed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze-tables<span class="w"> </span>github.db
</pre></div>
</div>
<p>If you wish to analyze one or more specific columns, use the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze-tables<span class="w"> </span>github.db<span class="w"> </span>tags<span class="w"> </span>-c<span class="w"> </span>sha
</pre></div>
</div>
<p>To show more than 10 common values, use <code class="docutils literal notranslate"><span class="pre">--common-limit</span> <span class="pre">20</span></code>.  To skip the most common or least common value analysis, use <code class="docutils literal notranslate"><span class="pre">--no-most</span></code> or <code class="docutils literal notranslate"><span class="pre">--no-least</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze-tables<span class="w"> </span>github.db<span class="w"> </span>tags<span class="w"> </span>--common-limit<span class="w"> </span><span class="m">20</span><span class="w"> </span>--no-least
</pre></div>
</div>
<section id="saving-the-analyzed-table-details">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Saving the analyzed table details"></a><span id="cli-analyze-tables-save"></span><h3><a class="toc-backref" href="#id27" role="doc-backlink">Saving the analyzed table details</a><a class="headerlink" href="#saving-the-analyzed-table-details" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">analyze-tables</span></code> can take quite a while to run for large database files. You can save the results of the analysis to a database table called <code class="docutils literal notranslate"><span class="pre">_analyze_tables_</span></code> using the <code class="docutils literal notranslate"><span class="pre">--save</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze-tables<span class="w"> </span>github.db<span class="w"> </span>--save
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">_analyze_tables_</span></code> table has the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">_analyze_tables_</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">[</span><span class="k">table</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="k">column</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">total_rows</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">num_null</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">num_blank</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">num_distinct</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">most_common</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">least_common</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">([</span><span class="k">table</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="k">column</span><span class="p">])</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">most_common</span></code> and <code class="docutils literal notranslate"><span class="pre">least_common</span></code> columns will contain nested JSON arrays of the most common and least common values that look like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Del Libertador, Av"</span><span class="p">,</span><span class="w"> </span><span class="mi">5068</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Alberdi Juan Bautista Av."</span><span class="p">,</span><span class="w"> </span><span class="mi">4612</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Directorio Av."</span><span class="p">,</span><span class="w"> </span><span class="mi">4552</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Rivadavia, Av"</span><span class="p">,</span><span class="w"> </span><span class="mi">4532</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Yerbal"</span><span class="p">,</span><span class="w"> </span><span class="mi">4512</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Cosqun"</span><span class="p">,</span><span class="w"> </span><span class="mi">4472</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Estado Plurinacional de Bolivia"</span><span class="p">,</span><span class="w"> </span><span class="mi">4440</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Gordillo Timoteo"</span><span class="p">,</span><span class="w"> </span><span class="mi">4424</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Montiel"</span><span class="p">,</span><span class="w"> </span><span class="mi">4360</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="s2">"Condarco"</span><span class="p">,</span><span class="w"> </span><span class="mi">4288</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-an-empty-database">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating an empty database"></a><span id="cli-create-database"></span><h2><a class="toc-backref" href="#id28" role="doc-backlink">Creating an empty database</a><a class="headerlink" href="#creating-an-empty-database" title="Link to this heading">#</a></h2>
<p>You can create a new empty database file using the <code class="docutils literal notranslate"><span class="pre">create-database</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-database<span class="w"> </span>empty.db
</pre></div>
</div>
<p>To enable <a class="reference internal" href="#cli-wal"><span class="std std-ref">WAL mode</span></a> on the newly created database add the <code class="docutils literal notranslate"><span class="pre">--enable-wal</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-database<span class="w"> </span>empty.db<span class="w"> </span>--enable-wal
</pre></div>
</div>
<p>To enable SpatiaLite metadata on a newly created database, add the <code class="docutils literal notranslate"><span class="pre">--init-spatialite</span></code> flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-database<span class="w"> </span>empty.db<span class="w"> </span>--init-spatialite
</pre></div>
</div>
<p>That will look for SpatiaLite in a set of predictable locations. To load it from somewhere else, use the <code class="docutils literal notranslate"><span class="pre">--load-extension</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-database<span class="w"> </span>empty.db<span class="w"> </span>--init-spatialite<span class="w"> </span>--load-extension<span class="w"> </span>/path/to/spatialite.so
</pre></div>
</div>
</section>
<section id="inserting-json-data">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Inserting JSON data"></a><span id="cli-inserting-data"></span><h2><a class="toc-backref" href="#id29" role="doc-backlink">Inserting JSON data</a><a class="headerlink" href="#inserting-json-data" title="Link to this heading">#</a></h2>
<p>If you have data as JSON, you can use <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">insert</span> <span class="pre">tablename</span></code> to insert it into a database. The table will be created with the correct (automatically detected) columns if it does not already exist.</p>
<p>You can pass in a single JSON object or a list of JSON objects, either as a filename or piped directly to standard-in (by using <code class="docutils literal notranslate"><span class="pre">-</span></code> as the filename).</p>
<p>Heres the simplest possible example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"name": "Cleo", "age": 4}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>-
</pre></div>
</div>
<p>To specify a column as the primary key, use <code class="docutils literal notranslate"><span class="pre">--pk=column_name</span></code>.</p>
<p>To create a compound primary key across more than one column, use <code class="docutils literal notranslate"><span class="pre">--pk</span></code> multiple times.</p>
<p>If you feed it a JSON list it will insert multiple records. For example, if <code class="docutils literal notranslate"><span class="pre">dogs.json</span></code> looks like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cleo"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pancakes"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Toby"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You can import all three records into an automatically created <code class="docutils literal notranslate"><span class="pre">dogs</span></code> table and set the <code class="docutils literal notranslate"><span class="pre">id</span></code> column as the primary key like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.json<span class="w"> </span>--pk<span class="o">=</span>id
</pre></div>
</div>
<p>You can skip inserting any records that have a primary key that already exists using <code class="docutils literal notranslate"><span class="pre">--ignore</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.json<span class="w"> </span>--ignore
</pre></div>
</div>
<p>You can delete all the existing rows in the table before inserting the new records using <code class="docutils literal notranslate"><span class="pre">--truncate</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.json<span class="w"> </span>--truncate
</pre></div>
</div>
<p>You can add the <code class="docutils literal notranslate"><span class="pre">--analyze</span></code> option to run <code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code> against the table after the rows have been inserted.</p>
<section id="inserting-binary-data">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Inserting binary data"></a><span id="cli-inserting-data-binary"></span><h3><a class="toc-backref" href="#id30" role="doc-backlink">Inserting binary data</a><a class="headerlink" href="#inserting-binary-data" title="Link to this heading">#</a></h3>
<p>You can insert binary data into a BLOB column by first encoding it using base64 and then structuring it like this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"transparent.gif"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"content"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"$base64"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"encoded"</span><span class="p">:</span><span class="w"> </span><span class="s2">"R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="inserting-newline-delimited-json">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Inserting newline-delimited JSON"></a><span id="cli-inserting-data-nl-json"></span><h3><a class="toc-backref" href="#id31" role="doc-backlink">Inserting newline-delimited JSON</a><a class="headerlink" href="#inserting-newline-delimited-json" title="Link to this heading">#</a></h3>
<p>You can also import <a class="reference external" href="http://ndjson.org/">newline-delimited JSON</a> using the <code class="docutils literal notranslate"><span class="pre">--nl</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"id": 1, "name": "Cleo"}</span>
<span class="s1">{"id": 2, "name": "Suna"}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>creatures.db<span class="w"> </span>creatures<span class="w"> </span>-<span class="w"> </span>--nl
</pre></div>
</div>
<p>Newline-delimited JSON consists of full JSON objects separated by newlines.</p>
<p>If you are processing data using <code class="docutils literal notranslate"><span class="pre">jq</span></code> you can use the <code class="docutils literal notranslate"><span class="pre">jq</span> <span class="pre">-c</span></code> option to output valid newline-delimited JSON.</p>
<p>Since <a class="reference external" href="https://datasette.io/">Datasette</a> can export newline-delimited JSON, you can combine the Datasette and <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-L<span class="w"> </span><span class="s2">"https://latest.datasette.io/fixtures/facetable.json?_shape=array&amp;_nl=on"</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>nl-demo.db<span class="w"> </span>facetable<span class="w"> </span>-<span class="w"> </span>--pk<span class="o">=</span>id<span class="w"> </span>--nl
</pre></div>
</div>
<p>You can also pipe <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> together to create a new SQLite database file containing the results of a SQL query against another database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>sf-trees.db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">"select TreeID, qAddress, Latitude, Longitude from Street_Tree_List"</span><span class="w"> </span>--nl<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>saved.db<span class="w"> </span>trees<span class="w"> </span>-<span class="w"> </span>--nl
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>saved.db<span class="w"> </span><span class="s2">"select * from trees limit 5"</span><span class="w"> </span>--csv
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">TreeID,qAddress,Latitude,Longitude</span>
<span class="go">141565,501X Baker St,37.7759676911831,-122.441396661871</span>
<span class="go">232565,940 Elizabeth St,37.7517102172731,-122.441498017841</span>
<span class="go">119263,495X Lakeshore Dr,,</span>
<span class="go">207368,920 Kirkham St,37.760210314285,-122.47073935813</span>
<span class="go">188702,1501 Evans Ave,37.7422086702947,-122.387293152263</span>
</pre></div>
</div>
</section>
<section id="flattening-nested-json-objects">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Flattening nested JSON objects"></a><span id="cli-inserting-data-flatten"></span><h3><a class="toc-backref" href="#id32" role="doc-backlink">Flattening nested JSON objects</a><a class="headerlink" href="#flattening-nested-json-objects" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">insert</span></code> and <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">memory</span></code> both expect incoming JSON data to consist of an array of JSON objects, where the top-level keys of each object will become columns in the created database table.</p>
<p>If your data is nested you can use the <code class="docutils literal notranslate"><span class="pre">--flatten</span></code> option to create columns that are derived from the nested data.</p>
<p>Consider this example document, in a file called <code class="docutils literal notranslate"><span class="pre">log.json</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">"httpRequest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"latency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.112114537s"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"requestMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"requestSize"</span><span class="p">:</span><span class="w"> </span><span class="s2">"534"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"insertId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6111722f000b5b4c4d4071e2"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"labels"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"service"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasette-io"</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Inserting this into a table using <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">insert</span> <span class="pre">logs.db</span> <span class="pre">logs</span> <span class="pre">log.json</span></code> will create a table with the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">logs</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="p">[</span><span class="n">httpRequest</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">insertId</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">labels</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
</pre></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">--flatten</span></code> option columns will be created using <code class="docutils literal notranslate"><span class="pre">topkey_nextkey</span></code> column names - so running <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">insert</span> <span class="pre">logs.db</span> <span class="pre">logs</span> <span class="pre">log.json</span> <span class="pre">--flatten</span></code> will create the following schema instead:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">logs</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="p">[</span><span class="n">httpRequest_latency</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">httpRequest_requestMethod</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">httpRequest_requestSize</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">httpRequest_status</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">insertId</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">labels_service</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="inserting-csv-or-tsv-data">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Inserting CSV or TSV data"></a><span id="cli-insert-csv-tsv"></span><h2><a class="toc-backref" href="#id33" role="doc-backlink">Inserting CSV or TSV data</a><a class="headerlink" href="#inserting-csv-or-tsv-data" title="Link to this heading">#</a></h2>
<p>If your data is in CSV format, you can insert it using the <code class="docutils literal notranslate"><span class="pre">--csv</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.csv<span class="w"> </span>--csv
</pre></div>
</div>
<p>For tab-delimited data, use <code class="docutils literal notranslate"><span class="pre">--tsv</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.tsv<span class="w"> </span>--tsv
</pre></div>
</div>
<p>Data is expected to be encoded as Unicode UTF-8. If your data is an another character encoding you can specify it using the <code class="docutils literal notranslate"><span class="pre">--encoding</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.tsv<span class="w"> </span>--tsv<span class="w"> </span>--encoding<span class="o">=</span>latin-1
</pre></div>
</div>
<p>To stop inserting after a specified number of records - useful for getting a faster preview of a large file - use the <code class="docutils literal notranslate"><span class="pre">--stop-after</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.csv<span class="w"> </span>--csv<span class="w"> </span>--stop-after<span class="o">=</span><span class="m">10</span>
</pre></div>
</div>
<p>A progress bar is displayed when inserting data from a file. You can hide the progress bar using the <code class="docutils literal notranslate"><span class="pre">--silent</span></code> option.</p>
<p>By default every column inserted from a CSV or TSV file will be of type <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>. To automatically detect column types - resulting in a mix of <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code> and <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> columns, use the <code class="docutils literal notranslate"><span class="pre">--detect-types</span></code> option (or its shortcut <code class="docutils literal notranslate"><span class="pre">-d</span></code>).</p>
<p>For example, given a <code class="docutils literal notranslate"><span class="pre">creatures.csv</span></code> file containing this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>name,age,weight
Cleo,6,45.5
Dori,1,3.5
</pre></div>
</div>
<p>The following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>creatures.db<span class="w"> </span>creatures<span class="w"> </span>creatures.csv<span class="w"> </span>--csv<span class="w"> </span>--detect-types
</pre></div>
</div>
<p>Will produce this schema:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>schema<span class="w"> </span>creatures.db
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE TABLE "creatures" (</span>
<span class="go">   [name] TEXT,</span>
<span class="go">   [age] INTEGER,</span>
<span class="go">   [weight] FLOAT</span>
<span class="go">);</span>
</pre></div>
</div>
<p>You can set the <code class="docutils literal notranslate"><span class="pre">SQLITE_UTILS_DETECT_TYPES</span></code> environment variable if you want <code class="docutils literal notranslate"><span class="pre">--detect-types</span></code> to be the default behavior:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SQLITE_UTILS_DETECT_TYPES</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>If a CSV or TSV file includes empty cells, like this one:</p>
<div class="highlight-csv notranslate"><div class="highlight"><pre><span></span><span class="o">name</span><span class="p">,</span><span class="m">age</span><span class="p">,</span><span class="k">weight</span>
<span class="o">Cleo</span><span class="p">,</span><span class="m">6</span><span class="p">,</span>
<span class="o">Dori</span><span class="p">,,</span><span class="k">3.5</span>
</pre></div>
</div>
<p>They will be imported into SQLite as empty string values, <code class="docutils literal notranslate"><span class="pre">""</span></code>.</p>
<p>To import them as <code class="docutils literal notranslate"><span class="pre">NULL</span></code> values instead, use the <code class="docutils literal notranslate"><span class="pre">--empty-null</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>creatures.db<span class="w"> </span>creatures<span class="w"> </span>creatures.csv<span class="w"> </span>--csv<span class="w"> </span>--empty-null
</pre></div>
</div>
<section id="alternative-delimiters-and-quote-characters">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Alternative delimiters and quote characters"></a><span id="cli-insert-csv-tsv-delimiter"></span><h3><a class="toc-backref" href="#id34" role="doc-backlink">Alternative delimiters and quote characters</a><a class="headerlink" href="#alternative-delimiters-and-quote-characters" title="Link to this heading">#</a></h3>
<p>If your file uses a delimiter other than <code class="docutils literal notranslate"><span class="pre">,</span></code> or a quote character other than <code class="docutils literal notranslate"><span class="pre">"</span></code> you can attempt to detect delimiters or you can specify them explicitly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--sniff</span></code> option can be used to attempt to detect the delimiters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.csv<span class="w"> </span>--sniff
</pre></div>
</div>
<p>Alternatively, you can specify them using the <code class="docutils literal notranslate"><span class="pre">--delimiter</span></code> and <code class="docutils literal notranslate"><span class="pre">--quotechar</span></code> options.</p>
<p>Heres a CSV file that uses <code class="docutils literal notranslate"><span class="pre">;</span></code> for delimiters and the <code class="docutils literal notranslate"><span class="pre">|</span></code> symbol for quote characters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>name;description
Cleo;|Very fine; a friendly dog|
Pancakes;A local corgi
</pre></div>
</div>
<p>You can import that using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.csv<span class="w"> </span>--delimiter<span class="o">=</span><span class="s2">";"</span><span class="w"> </span>--quotechar<span class="o">=</span><span class="s2">"|"</span>
</pre></div>
</div>
<p>Passing <code class="docutils literal notranslate"><span class="pre">--delimiter</span></code>, <code class="docutils literal notranslate"><span class="pre">--quotechar</span></code> or <code class="docutils literal notranslate"><span class="pre">--sniff</span></code> implies <code class="docutils literal notranslate"><span class="pre">--csv</span></code>, so you can omit the <code class="docutils literal notranslate"><span class="pre">--csv</span></code> option.</p>
</section>
<section id="csv-files-without-a-header-row">
<a class="dashAnchor" name="//apple_ref/cpp/Section/CSV files without a header row"></a><span id="cli-insert-csv-tsv-no-header"></span><h3><a class="toc-backref" href="#id35" role="doc-backlink">CSV files without a header row</a><a class="headerlink" href="#csv-files-without-a-header-row" title="Link to this heading">#</a></h3>
<p>The first row of any CSV or TSV file is expected to contain the names of the columns in that file.</p>
<p>If your file does not include this row, you can use the <code class="docutils literal notranslate"><span class="pre">--no-headers</span></code> option to specify that the tool should not use that fist row as headers.</p>
<p>If you do this, the table will be created with column names called <code class="docutils literal notranslate"><span class="pre">untitled_1</span></code> and <code class="docutils literal notranslate"><span class="pre">untitled_2</span></code> and so on. You can then rename them using the <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">transform</span> <span class="pre">...</span> <span class="pre">--rename</span></code> command, see <a class="reference internal" href="#cli-transform-table"><span class="std std-ref">Transforming tables</span></a>.</p>
</section>
</section>
<section id="inserting-unstructured-data-with-lines-and-text">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Inserting unstructured data with --lines and --text"></a><span id="cli-insert-unstructured"></span><h2><a class="toc-backref" href="#id36" role="doc-backlink">Inserting unstructured data with --lines and --text</a><a class="headerlink" href="#inserting-unstructured-data-with-lines-and-text" title="Link to this heading">#</a></h2>
<p>If you have an unstructured file you can insert its contents into a table with a single <code class="docutils literal notranslate"><span class="pre">line</span></code> column containing each line from the file using <code class="docutils literal notranslate"><span class="pre">--lines</span></code>. This can be useful if you intend to further analyze those lines using SQL string functions or <a class="reference internal" href="#cli-convert"><span class="std std-ref">sqlite-utils convert</span></a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>logs.db<span class="w"> </span>loglines<span class="w"> </span>logfile.log<span class="w"> </span>--lines
</pre></div>
</div>
<p>This will produce the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">loglines</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
</pre></div>
</div>
<p>You can also insert the entire contents of the file into a single column called <code class="docutils literal notranslate"><span class="pre">text</span></code> using <code class="docutils literal notranslate"><span class="pre">--text</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>content.db<span class="w"> </span>content<span class="w"> </span>file.txt<span class="w"> </span>--text
</pre></div>
</div>
<p>The schema here will be:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">content</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="p">[</span><span class="nb">text</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="applying-conversions-while-inserting-data">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Applying conversions while inserting data"></a><span id="cli-insert-convert"></span><h2><a class="toc-backref" href="#id37" role="doc-backlink">Applying conversions while inserting data</a><a class="headerlink" href="#applying-conversions-while-inserting-data" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">--convert</span></code> option can be used to apply a Python conversion function to imported data before it is inserted into the database. It works in a similar way to <a class="reference internal" href="#cli-convert"><span class="std std-ref">sqlite-utils convert</span></a>.</p>
<p>Your Python function will be passed a dictionary called <code class="docutils literal notranslate"><span class="pre">row</span></code> for each item that is being imported. You can modify that dictionary and return it - or return a fresh dictionary - to change the data that will be inserted.</p>
<p>Given a JSON file called <code class="docutils literal notranslate"><span class="pre">dogs.json</span></code> containing this:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cleo"</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pancakes"</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The following command will insert that data and add an <code class="docutils literal notranslate"><span class="pre">is_good</span></code> column set to <code class="docutils literal notranslate"><span class="pre">1</span></code> for each dog:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>dogs.json<span class="w"> </span>--convert<span class="w"> </span><span class="s1">'row["is_good"] = 1'</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--convert</span></code> option also works with the <code class="docutils literal notranslate"><span class="pre">--csv</span></code>, <code class="docutils literal notranslate"><span class="pre">--tsv</span></code> and <code class="docutils literal notranslate"><span class="pre">--nl</span></code> insert options.</p>
<p>As with <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">convert</span></code> you can use <code class="docutils literal notranslate"><span class="pre">--import</span></code> to import additional Python modules, see <a class="reference internal" href="#cli-convert-import"><span class="std std-ref">Importing additional modules</span></a> for details.</p>
<p>You can also pass code that runs some initialization steps and defines a <code class="docutils literal notranslate"><span class="pre">convert(value)</span></code> function, see <a class="reference internal" href="#cli-convert-complex"><span class="std std-ref">Using a convert() function to execute initialization</span></a>.</p>
<section id="convert-with-lines">
<a class="dashAnchor" name="//apple_ref/cpp/Section/--convert with --lines"></a><span id="cli-insert-convert-lines"></span><h3><a class="toc-backref" href="#id38" role="doc-backlink">--convert with --lines</a><a class="headerlink" href="#convert-with-lines" title="Link to this heading">#</a></h3>
<p>Things work slightly differently when combined with the <code class="docutils literal notranslate"><span class="pre">--lines</span></code> or <code class="docutils literal notranslate"><span class="pre">--text</span></code> options.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">--lines</span></code>, instead of being passed a <code class="docutils literal notranslate"><span class="pre">row</span></code> dictionary your function will be passed a <code class="docutils literal notranslate"><span class="pre">line</span></code> string representing each line of the input. Given a file called <code class="docutils literal notranslate"><span class="pre">access.log</span></code> containing the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>INFO:     127.0.0.1:60581 - GET / HTTP/1.1 200 OK
INFO:     127.0.0.1:60581 - GET /foo/-/static/app.css?cead5a HTTP/1.1 200 OK
</pre></div>
</div>
<p>You could convert it into structured data like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>logs.db<span class="w"> </span>loglines<span class="w"> </span>access.log<span class="w"> </span>--convert<span class="w"> </span><span class="s1">'</span>
<span class="s1">type, source, _, verb, path, _, status, _ = line.split()</span>
<span class="s1">return {</span>
<span class="s1">    "type": type,</span>
<span class="s1">    "source": source,</span>
<span class="s1">    "verb": verb,</span>
<span class="s1">    "path": path,</span>
<span class="s1">    "status": status,</span>
<span class="s1">}'</span><span class="w"> </span>--lines
</pre></div>
</div>
<p>The resulting table would look like this:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>type</p></th>
<th class="head"><p>source</p></th>
<th class="head"><p>verb</p></th>
<th class="head"><p>path</p></th>
<th class="head"><p>status</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>INFO:</p></td>
<td><p>127.0.0.1:60581</p></td>
<td><p>GET</p></td>
<td><p>/</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p>INFO:</p></td>
<td><p>127.0.0.1:60581</p></td>
<td><p>GET</p></td>
<td><p>/foo/-/static/app.css?cead5a</p></td>
<td><p>200</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="convert-with-text">
<a class="dashAnchor" name="//apple_ref/cpp/Section/--convert with --text"></a><span id="cli-insert-convert-text"></span><h3><a class="toc-backref" href="#id39" role="doc-backlink">--convert with --text</a><a class="headerlink" href="#convert-with-text" title="Link to this heading">#</a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">--text</span></code> the entire input to the command will be made available to the function as a variable called <code class="docutils literal notranslate"><span class="pre">text</span></code>.</p>
<p>The function can return a single dictionary which will be inserted as a single row, or it can return a list or iterator of dictionaries, each of which will be inserted.</p>
<p>Heres how to use <code class="docutils literal notranslate"><span class="pre">--convert</span></code> and <code class="docutils literal notranslate"><span class="pre">--text</span></code> to insert one record per word in the input:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'A bunch of words'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>words.db<span class="w"> </span>words<span class="w"> </span>-<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--text<span class="w"> </span>--convert<span class="w"> </span><span class="s1">'({"word": w} for w in text.split())'</span>
</pre></div>
</div>
<p>The result looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dump<span class="w"> </span>words.db
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">BEGIN TRANSACTION;</span>
<span class="go">CREATE TABLE [words] (</span>
<span class="go">   [word] TEXT</span>
<span class="go">);</span>
<span class="go">INSERT INTO "words" VALUES('A');</span>
<span class="go">INSERT INTO "words" VALUES('bunch');</span>
<span class="go">INSERT INTO "words" VALUES('of');</span>
<span class="go">INSERT INTO "words" VALUES('words');</span>
<span class="go">COMMIT;</span>
</pre></div>
</div>
</section>
</section>
<section id="insert-replacing-data">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Insert-replacing data"></a><span id="cli-insert-replace"></span><h2><a class="toc-backref" href="#id40" role="doc-backlink">Insert-replacing data</a><a class="headerlink" href="#insert-replacing-data" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">--replace</span></code> option to <code class="docutils literal notranslate"><span class="pre">insert</span></code> causes any existing records with the same primary key to be replaced entirely by the new records.</p>
<p>To replace a dog with in ID of 2 with a new record, run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"id": 2, "name": "Pancakes", "age": 3}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>-<span class="w"> </span>--pk<span class="o">=</span>id<span class="w"> </span>--replace
</pre></div>
</div>
</section>
<section id="upserting-data">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Upserting data"></a><span id="cli-upsert"></span><h2><a class="toc-backref" href="#id41" role="doc-backlink">Upserting data</a><a class="headerlink" href="#upserting-data" title="Link to this heading">#</a></h2>
<p>Upserting is update-or-insert. If a row exists with the specified primary key the provided columns will be updated. If no row exists that row will be created.</p>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">insert</span> <span class="pre">--replace</span></code>, an upsert will ignore any column values that exist but are not present in the upsert document.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"id": 2, "age": 4}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sqlite-utils<span class="w"> </span>upsert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>-<span class="w"> </span>--pk<span class="o">=</span>id
</pre></div>
</div>
<p>This will update the dog with an ID of 2 to have an age of 4, creating a new record (with a null name) if one does not exist. If a row DOES exist the name will be left as-is.</p>
<p>The command will fail if you reference columns that do not exist on the table. To automatically create missing columns, use the <code class="docutils literal notranslate"><span class="pre">--alter</span></code> option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">upsert</span></code> in sqlite-utils 1.x worked like <code class="docutils literal notranslate"><span class="pre">insert</span> <span class="pre">...</span> <span class="pre">--replace</span></code> does in 2.x. See <a class="reference external" href="https://github.com/simonw/sqlite-utils/issues/66">issue #66</a> for details of this change.</p>
</div>
</section>
<section id="executing-sql-in-bulk">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Executing SQL in bulk"></a><span id="cli-bulk"></span><h2><a class="toc-backref" href="#id42" role="doc-backlink">Executing SQL in bulk</a><a class="headerlink" href="#executing-sql-in-bulk" title="Link to this heading">#</a></h2>
<p>If you have a JSON, newline-delimited JSON, CSV or TSV file you can execute a bulk SQL query using each of the records in that file using the <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">bulk</span></code> command.</p>
<p>The command takes the database file, the SQL to be executed and the file containing records to be used when evaluating the SQL query.</p>
<p>The SQL query should include <code class="docutils literal notranslate"><span class="pre">:named</span></code> parameters that match the keys in the records.</p>
<p>For example, given a <code class="docutils literal notranslate"><span class="pre">chickens.csv</span></code> CSV file containing the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>id,name
1,Blue
2,Snowy
3,Azi
4,Lila
5,Suna
6,Cardi
</pre></div>
</div>
<p>You could insert those rows into a pre-created <code class="docutils literal notranslate"><span class="pre">chickens</span></code> table like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>bulk<span class="w"> </span>chickens.db<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">'insert into chickens (id, name) values (:id, :name)'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>chickens.csv<span class="w"> </span>--csv
</pre></div>
</div>
<p>This command takes the same options as the <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">insert</span></code> command - so it defaults to expecting JSON but can accept other formats using <code class="docutils literal notranslate"><span class="pre">--csv</span></code> or <code class="docutils literal notranslate"><span class="pre">--tsv</span></code> or <code class="docutils literal notranslate"><span class="pre">--nl</span></code> or other options described above.</p>
<p>By default all of the SQL queries will be executed in a single transaction. To commit every 20 records, use <code class="docutils literal notranslate"><span class="pre">--batch-size</span> <span class="pre">20</span></code>.</p>
</section>
<section id="inserting-data-from-files">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Inserting data from files"></a><span id="cli-insert-files"></span><h2><a class="toc-backref" href="#id43" role="doc-backlink">Inserting data from files</a><a class="headerlink" href="#inserting-data-from-files" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">insert-files</span></code> command can be used to insert the content of files, along with their metadata, into a SQLite table.</p>
<p>Heres an example that inserts all of the GIF files in the current directory into a <code class="docutils literal notranslate"><span class="pre">gifs.db</span></code> database, placing the file contents in an <code class="docutils literal notranslate"><span class="pre">images</span></code> table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert-files<span class="w"> </span>gifs.db<span class="w"> </span>images<span class="w"> </span>*.gif
</pre></div>
</div>
<p>You can also pass one or more directories, in which case every file in those directories will be added recursively:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert-files<span class="w"> </span>gifs.db<span class="w"> </span>images<span class="w"> </span>path/to/my-gifs
</pre></div>
</div>
<p>By default this command will create a table with the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">images</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">content</span><span class="p">]</span><span class="w"> </span><span class="nb">BLOB</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="k">size</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Content will be treated as binary by default and stored in a <code class="docutils literal notranslate"><span class="pre">BLOB</span></code> column. You can use the <code class="docutils literal notranslate"><span class="pre">--text</span></code> option to store that content in a <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> column instead.</p>
<p>You can customize the schema using one or more <code class="docutils literal notranslate"><span class="pre">-c</span></code> options. For a table schema that includes just the path, MD5 hash and last modification time of the file, you would use this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert-files<span class="w"> </span>gifs.db<span class="w"> </span>images<span class="w"> </span>*.gif<span class="w"> </span>-c<span class="w"> </span>path<span class="w"> </span>-c<span class="w"> </span>md5<span class="w"> </span>-c<span class="w"> </span>mtime<span class="w"> </span>--pk<span class="o">=</span>path
</pre></div>
</div>
<p>This will result in the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">images</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">md5</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">mtime</span><span class="p">]</span><span class="w"> </span><span class="nb">FLOAT</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Note that theres no <code class="docutils literal notranslate"><span class="pre">content</span></code> column here at all - if you specify custom columns using <code class="docutils literal notranslate"><span class="pre">-c</span></code> you need to include <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">content</span></code> to create that column.</p>
<p>You can change the name of one of these columns using a <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">colname:coldef</span></code> parameter. To rename the <code class="docutils literal notranslate"><span class="pre">mtime</span></code> column to <code class="docutils literal notranslate"><span class="pre">last_modified</span></code> you would use this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert-files<span class="w"> </span>gifs.db<span class="w"> </span>images<span class="w"> </span>*.gif<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-c<span class="w"> </span>path<span class="w"> </span>-c<span class="w"> </span>md5<span class="w"> </span>-c<span class="w"> </span>last_modified:mtime<span class="w"> </span>--pk<span class="o">=</span>path
</pre></div>
</div>
<p>You can pass <code class="docutils literal notranslate"><span class="pre">--replace</span></code> or <code class="docutils literal notranslate"><span class="pre">--upsert</span></code> to indicate what should happen if you try to insert a file with an existing primary key. Pass <code class="docutils literal notranslate"><span class="pre">--alter</span></code> to cause any missing columns to be added to the table.</p>
<p>The full list of column definitions you can use is as follows:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>The name of the file, e.g. <code class="docutils literal notranslate"><span class="pre">cleo.jpg</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">path</span></code></dt><dd><p>The path to the file relative to the root folder, e.g. <code class="docutils literal notranslate"><span class="pre">pictures/cleo.jpg</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fullpath</span></code></dt><dd><p>The fully resolved path to the image, e.g. <code class="docutils literal notranslate"><span class="pre">/home/simonw/pictures/cleo.jpg</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sha256</span></code></dt><dd><p>The SHA256 hash of the file contents</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">md5</span></code></dt><dd><p>The MD5 hash of the file contents</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code></dt><dd><p>The permission bits of the file, as an integer - you may want to convert this to octal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">content</span></code></dt><dd><p>The binary file contents, which will be stored as a BLOB</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">content_text</span></code></dt><dd><p>The text file contents, which will be stored as TEXT</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mtime</span></code></dt><dd><p>The modification time of the file, as floating point seconds since the Unix epoch</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctime</span></code></dt><dd><p>The creation time of the file, as floating point seconds since the Unix epoch</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mtime_int</span></code></dt><dd><p>The modification time as an integer rather than a float</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctime_int</span></code></dt><dd><p>The creation time as an integer rather than a float</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mtime_iso</span></code></dt><dd><p>The modification time as an ISO timestamp, e.g. <code class="docutils literal notranslate"><span class="pre">2020-07-27T04:24:06.654246</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctime_iso</span></code></dt><dd><p>The creation time is an ISO timestamp</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>The integer size of the file in bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stem</span></code></dt><dd><p>The filename without the extension - for <code class="docutils literal notranslate"><span class="pre">file.txt.gz</span></code> this would be <code class="docutils literal notranslate"><span class="pre">file.txt</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suffix</span></code></dt><dd><p>The file extension - for <code class="docutils literal notranslate"><span class="pre">file.txt.gz</span></code> this would be <code class="docutils literal notranslate"><span class="pre">.gz</span></code></p>
</dd>
</dl>
<p>You can insert data piped from standard input like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>dog.jpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert-files<span class="w"> </span>dogs.db<span class="w"> </span>pics<span class="w"> </span>-<span class="w"> </span>--name<span class="o">=</span>dog.jpg
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-</span></code> argument indicates data should be read from standard input. The string passed using the <code class="docutils literal notranslate"><span class="pre">--name</span></code> option will be used for the file name and path values.</p>
<p>When inserting data from standard input only the following column definitions are supported: <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">content</span></code>, <code class="docutils literal notranslate"><span class="pre">content_text</span></code>, <code class="docutils literal notranslate"><span class="pre">sha256</span></code>, <code class="docutils literal notranslate"><span class="pre">md5</span></code> and <code class="docutils literal notranslate"><span class="pre">size</span></code>.</p>
</section>
<section id="converting-data-in-columns">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Converting data in columns"></a><span id="cli-convert"></span><h2><a class="toc-backref" href="#id44" role="doc-backlink">Converting data in columns</a><a class="headerlink" href="#converting-data-in-columns" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">convert</span></code> command can be used to transform the data in a specified column - for example to parse a date string into an ISO timestamp, or to split a string of tags into a JSON array.</p>
<p>The command accepts a database, table, one or more columns and a string of Python code to be executed against the values from those columns. The following example would replace the values in the <code class="docutils literal notranslate"><span class="pre">headline</span></code> column in the <code class="docutils literal notranslate"><span class="pre">articles</span></code> table with an upper-case version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span><span class="s1">'value.upper()'</span>
</pre></div>
</div>
<p>The Python code is passed as a string. Within that Python code the <code class="docutils literal notranslate"><span class="pre">value</span></code> variable will be the value of the current column.</p>
<p>The code you provide will be compiled into a function that takes <code class="docutils literal notranslate"><span class="pre">value</span></code> as a single argument. If you break your function body into multiple lines the last line should be a <code class="docutils literal notranslate"><span class="pre">return</span></code> statement:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span><span class="s1">'</span>
<span class="s1">value = str(value)</span>
<span class="s1">return value.upper()'</span>
</pre></div>
</div>
<p>Your code will be automatically wrapped in a function, but you can also define a function called <code class="docutils literal notranslate"><span class="pre">convert(value)</span></code> which will be called, if available:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span><span class="s1">'</span>
<span class="s1">def convert(value):</span>
<span class="s1">    return value.upper()'</span>
</pre></div>
</div>
<p>Use a <code class="docutils literal notranslate"><span class="pre">CODE</span></code> value of <code class="docutils literal notranslate"><span class="pre">-</span></code> to read from standard input:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>mycode.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span>-
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">mycode.py</span></code> contains a fragment of Python code that looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
<p>The conversion will be applied to every row in the specified table. You can limit that to just rows that match a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause using <code class="docutils literal notranslate"><span class="pre">--where</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span><span class="s1">'value.upper()'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--where<span class="w"> </span><span class="s2">"headline like '%cat%'"</span>
</pre></div>
</div>
<p>You can include named parameters in your where clause and populate them using one or more <code class="docutils literal notranslate"><span class="pre">--param</span></code> options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span><span class="s1">'value.upper()'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--where<span class="w"> </span><span class="s2">"headline like :query"</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--param<span class="w"> </span>query<span class="w"> </span><span class="s1">'%cat%'</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> option will output a preview of the conversion against the first ten rows, without modifying the database.</p>
<p>By default any rows with a falsey value for the column - such as <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">null</span></code> - will be skipped. Use the <code class="docutils literal notranslate"><span class="pre">--no-skip-false</span></code> option to disable this behaviour.</p>
<section id="importing-additional-modules">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Importing additional modules"></a><span id="cli-convert-import"></span><h3><a class="toc-backref" href="#id45" role="doc-backlink">Importing additional modules</a><a class="headerlink" href="#importing-additional-modules" title="Link to this heading">#</a></h3>
<p>You can specify Python modules that should be imported and made available to your code using one or more <code class="docutils literal notranslate"><span class="pre">--import</span></code> options. This example uses the <code class="docutils literal notranslate"><span class="pre">textwrap</span></code> module to wrap the <code class="docutils literal notranslate"><span class="pre">content</span></code> column at 100 characters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s1">'"\n".join(textwrap.wrap(value, 100))'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--import<span class="o">=</span>textwrap
</pre></div>
</div>
<p>This supports nested imports as well, for example to use <a class="reference external" href="https://docs.python.org/3/library/xml.etree.elementtree.html">ElementTree</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s1">'xml.etree.ElementTree.fromstring(value).attrib["title"]'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--import<span class="o">=</span>xml.etree.ElementTree
</pre></div>
</div>
</section>
<section id="using-a-convert-function-to-execute-initialization">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Using a convert() function to execute initialization"></a><span id="cli-convert-complex"></span><h3><a class="toc-backref" href="#id46" role="doc-backlink">Using a convert() function to execute initialization</a><a class="headerlink" href="#using-a-convert-function-to-execute-initialization" title="Link to this heading">#</a></h3>
<p>In some cases you may need to execute one-off initialization code at the start of the run. You can do that by providing code that runs before defining your <code class="docutils literal notranslate"><span class="pre">convert(value)</span></code> function.</p>
<p>The following example adds a new <code class="docutils literal notranslate"><span class="pre">score</span></code> column, then updates it to list a random number - after first seeding the random number generator to ensure that multiple runs produce the same results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-column<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>score<span class="w"> </span>float<span class="w"> </span>--not-null-default<span class="w"> </span><span class="m">1</span>.0
sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>score<span class="w"> </span><span class="s1">'</span>
<span class="s1">import random</span>
<span class="s1">random.seed(10)</span>

<span class="s1">def convert(value):</span>
<span class="s1">    return random.random()</span>
<span class="s1">'</span>
</pre></div>
</div>
</section>
<section id="sqlite-utils-convert-recipes">
<a class="dashAnchor" name="//apple_ref/cpp/Section/sqlite-utils convert recipes"></a><span id="cli-convert-recipes"></span><h3><a class="toc-backref" href="#id47" role="doc-backlink">sqlite-utils convert recipes</a><a class="headerlink" href="#sqlite-utils-convert-recipes" title="Link to this heading">#</a></h3>
<p>Various built-in recipe functions are available for common operations. These are:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">r.jsonsplit(value,</span> <span class="pre">delimiter=',',</span> <span class="pre">type=&lt;class</span> <span class="pre">'str'&gt;)</span></code></dt><dd><p>Convert a string like <code class="docutils literal notranslate"><span class="pre">a,b,c</span></code> into a JSON array <code class="docutils literal notranslate"><span class="pre">["a",</span> <span class="pre">"b",</span> <span class="pre">"c"]</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">delimiter</span></code> parameter can be used to specify a different delimiter.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> parameter can be set to <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code> to produce a JSON array of different types, for example if the columns string value was <code class="docutils literal notranslate"><span class="pre">1.2,3,4.5</span></code> the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>r.jsonsplit(value, type=float)
</pre></div>
</div>
<p>Would produce an array like this: <code class="docutils literal notranslate"><span class="pre">[1.2,</span> <span class="pre">3.0,</span> <span class="pre">4.5]</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">r.parsedate(value,</span> <span class="pre">dayfirst=False,</span> <span class="pre">yearfirst=False,</span> <span class="pre">errors=None)</span></code></dt><dd><p>Parse a date and convert it to ISO date format: <code class="docutils literal notranslate"><span class="pre">yyyy-mm-dd</span></code></p>
<p>In the case of dates such as <code class="docutils literal notranslate"><span class="pre">03/04/05</span></code> U.S. <code class="docutils literal notranslate"><span class="pre">MM/DD/YY</span></code> format is assumed - you can use <code class="docutils literal notranslate"><span class="pre">dayfirst=True</span></code> or <code class="docutils literal notranslate"><span class="pre">yearfirst=True</span></code> to change how these ambiguous dates are interpreted.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">errors=</span></code> parameter to specify what should happen if a value cannot be parsed.</p>
<p>By default, if any value cannot be parsed an error will be occurred and all values will be left as they were.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">errors=r.IGNORE</span></code> to ignore any values that cannot be parsed, leaving them unchanged.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">errors=r.SET_NULL</span></code> to set any values that cannot be parsed to <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">r.parsedatetime(value,</span> <span class="pre">dayfirst=False,</span> <span class="pre">yearfirst=False,</span> <span class="pre">errors=None)</span></code></dt><dd><p>Parse a datetime and convert it to ISO datetime format: <code class="docutils literal notranslate"><span class="pre">yyyy-mm-ddTHH:MM:SS</span></code></p>
</dd>
</dl>
<p>These recipes can be used in the code passed to <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">convert</span></code> like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>my.db<span class="w"> </span>mytable<span class="w"> </span>mycolumn<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">'r.jsonsplit(value)'</span>
</pre></div>
</div>
<p>To use any of the documented parameters, do this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>my.db<span class="w"> </span>mytable<span class="w"> </span>mycolumn<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">'r.jsonsplit(value, delimiter=":")'</span>
</pre></div>
</div>
</section>
<section id="saving-the-result-to-a-different-column">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Saving the result to a different column"></a><span id="cli-convert-output"></span><h3><a class="toc-backref" href="#id48" role="doc-backlink">Saving the result to a different column</a><a class="headerlink" href="#saving-the-result-to-a-different-column" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">--output</span></code> and <code class="docutils literal notranslate"><span class="pre">--output-type</span></code> options can be used to save the result of the conversion to a separate column, which will be created if that column does not already exist:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>headline<span class="w"> </span><span class="s1">'value.upper()'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>headline_upper
</pre></div>
</div>
<p>The type of the created column defaults to <code class="docutils literal notranslate"><span class="pre">text</span></code>, but a different column type can be specified using <code class="docutils literal notranslate"><span class="pre">--output-type</span></code>. This example will create a new floating point column called <code class="docutils literal notranslate"><span class="pre">id_as_a_float</span></code> with a copy of each items ID increased by 0.5:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>content.db<span class="w"> </span>articles<span class="w"> </span>id<span class="w"> </span><span class="s1">'float(value) + 0.5'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>id_as_a_float<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output-type<span class="w"> </span>float
</pre></div>
</div>
<p>You can drop the original column at the end of the operation by adding <code class="docutils literal notranslate"><span class="pre">--drop</span></code>.</p>
</section>
<section id="converting-a-column-into-multiple-columns">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Converting a column into multiple columns"></a><span id="cli-convert-multi"></span><h3><a class="toc-backref" href="#id49" role="doc-backlink">Converting a column into multiple columns</a><a class="headerlink" href="#converting-a-column-into-multiple-columns" title="Link to this heading">#</a></h3>
<p>Sometimes you may wish to convert a single column into multiple derived columns. For example, you may have a <code class="docutils literal notranslate"><span class="pre">location</span></code> column containing <code class="docutils literal notranslate"><span class="pre">latitude,longitude</span></code> values which you wish to split out into separate <code class="docutils literal notranslate"><span class="pre">latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">longitude</span></code> columns.</p>
<p>You can achieve this using the <code class="docutils literal notranslate"><span class="pre">--multi</span></code> option to <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">convert</span></code>. This option expects your Python code to return a Python dictionary: new columns well be created and populated for each of the keys in that dictionary.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">latitude,longitude</span></code> example you would use the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>convert<span class="w"> </span>demo.db<span class="w"> </span>places<span class="w"> </span>location<span class="w"> </span><span class="se">\</span>
<span class="s1">'bits = value.split(",")</span>
<span class="s1">return {</span>
<span class="s1">  "latitude": float(bits[0]),</span>
<span class="s1">  "longitude": float(bits[1]),</span>
<span class="s1">}'</span><span class="w"> </span>--multi
</pre></div>
</div>
<p>The type of the returned values will be taken into account when creating the new columns. In this example, the resulting database schema will look like this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">places</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">[</span><span class="k">location</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">latitude</span><span class="p">]</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">longitude</span><span class="p">]</span><span class="w"> </span><span class="nb">FLOAT</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The code function can also return <code class="docutils literal notranslate"><span class="pre">None</span></code>, in which case its output will be ignored. You can drop the original column at the end of the operation by adding <code class="docutils literal notranslate"><span class="pre">--drop</span></code>.</p>
</section>
</section>
<section id="creating-tables">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating tables"></a><span id="cli-create-table"></span><h2><a class="toc-backref" href="#id50" role="doc-backlink">Creating tables</a><a class="headerlink" href="#creating-tables" title="Link to this heading">#</a></h2>
<p>Most of the time creating tables by inserting example data is the quickest approach. If you need to create an empty table in advance of inserting data you can do so using the <code class="docutils literal notranslate"><span class="pre">create-table</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-table<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span>id<span class="w"> </span>integer<span class="w"> </span>name<span class="w"> </span>text<span class="w"> </span>--pk<span class="o">=</span>id
</pre></div>
</div>
<p>This will create a table called <code class="docutils literal notranslate"><span class="pre">mytable</span></code> with two columns - an integer <code class="docutils literal notranslate"><span class="pre">id</span></code> column and a text <code class="docutils literal notranslate"><span class="pre">name</span></code> column. It will set the <code class="docutils literal notranslate"><span class="pre">id</span></code> column to be the primary key.</p>
<p>You can pass as many column-name column-type pairs as you like. Valid types are <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">blob</span></code>.</p>
<p>You can specify columns that should be NOT NULL using <code class="docutils literal notranslate"><span class="pre">--not-null</span> <span class="pre">colname</span></code>. You can specify default values for columns using <code class="docutils literal notranslate"><span class="pre">--default</span> <span class="pre">colname</span> <span class="pre">defaultvalue</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-table<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>id<span class="w"> </span>integer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>name<span class="w"> </span>text<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>age<span class="w"> </span>integer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>is_good<span class="w"> </span>integer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--not-null<span class="w"> </span>name<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--not-null<span class="w"> </span>age<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--default<span class="w"> </span>is_good<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pk<span class="o">=</span>id
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>mydb.db<span class="w"> </span>--schema<span class="w"> </span>-t
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">table    schema</span>
<span class="go">-------  --------------------------------</span>
<span class="go">mytable  CREATE TABLE [mytable] (</span>
<span class="go">            [id] INTEGER PRIMARY KEY,</span>
<span class="go">            [name] TEXT NOT NULL,</span>
<span class="go">            [age] INTEGER NOT NULL,</span>
<span class="go">            [is_good] INTEGER DEFAULT '1'</span>
<span class="go">        )</span>
</pre></div>
</div>
<p>You can specify foreign key relationships between the tables you are creating using <code class="docutils literal notranslate"><span class="pre">--fk</span> <span class="pre">colname</span> <span class="pre">othertable</span> <span class="pre">othercolumn</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-table<span class="w"> </span>books.db<span class="w"> </span>authors<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>id<span class="w"> </span>integer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>name<span class="w"> </span>text<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pk<span class="o">=</span>id

sqlite-utils<span class="w"> </span>create-table<span class="w"> </span>books.db<span class="w"> </span>books<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>id<span class="w"> </span>integer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>title<span class="w"> </span>text<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>author_id<span class="w"> </span>integer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pk<span class="o">=</span>id<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--fk<span class="w"> </span>author_id<span class="w"> </span>authors<span class="w"> </span>id
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tables<span class="w"> </span>books.db<span class="w"> </span>--schema<span class="w"> </span>-t
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">table    schema</span>
<span class="go">-------  -------------------------------------------------</span>
<span class="go">authors  CREATE TABLE [authors] (</span>
<span class="go">            [id] INTEGER PRIMARY KEY,</span>
<span class="go">            [name] TEXT</span>
<span class="go">         )</span>
<span class="go">books    CREATE TABLE [books] (</span>
<span class="go">            [id] INTEGER PRIMARY KEY,</span>
<span class="go">            [title] TEXT,</span>
<span class="go">            [author_id] INTEGER REFERENCES [authors]([id])</span>
<span class="go">         )</span>
</pre></div>
</div>
<p>If a table with the same name already exists, you will get an error. You can choose to silently ignore this error with <code class="docutils literal notranslate"><span class="pre">--ignore</span></code>, or you can replace the existing table with a new, empty table using <code class="docutils literal notranslate"><span class="pre">--replace</span></code>.</p>
<p>You can also pass <code class="docutils literal notranslate"><span class="pre">--transform</span></code> to transform the existing table to match the new schema. See <a class="reference internal" href="python-api.html#python-api-explicit-create"><span class="std std-ref">Explicitly creating a table</span></a> in the Python library documentation for details of how this option works.</p>
</section>
<section id="renaming-a-table">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Renaming a table"></a><span id="cli-renaming-tables"></span><h2><a class="toc-backref" href="#id51" role="doc-backlink">Renaming a table</a><a class="headerlink" href="#renaming-a-table" title="Link to this heading">#</a></h2>
<p>Yo ucan rename a table using the <code class="docutils literal notranslate"><span class="pre">rename-table</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rename-table<span class="w"> </span>mydb.db<span class="w"> </span>oldname<span class="w"> </span>newname
</pre></div>
</div>
<p>Pass <code class="docutils literal notranslate"><span class="pre">--ignore</span></code> to ignore any errors caused by the table not existing, or the new name already being in use.</p>
</section>
<section id="duplicating-tables">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Duplicating tables"></a><span id="cli-duplicate-table"></span><h2><a class="toc-backref" href="#id52" role="doc-backlink">Duplicating tables</a><a class="headerlink" href="#duplicating-tables" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">duplicate</span></code> command duplicates a table - creating a new table with the same schema and a copy of all of the rows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>duplicate<span class="w"> </span>books.db<span class="w"> </span>authors<span class="w"> </span>authors_copy
</pre></div>
</div>
</section>
<section id="dropping-tables">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Dropping tables"></a><span id="cli-drop-table"></span><h2><a class="toc-backref" href="#id53" role="doc-backlink">Dropping tables</a><a class="headerlink" href="#dropping-tables" title="Link to this heading">#</a></h2>
<p>You can drop a table using the <code class="docutils literal notranslate"><span class="pre">drop-table</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>drop-table<span class="w"> </span>mydb.db<span class="w"> </span>mytable
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--ignore</span></code> to ignore the error if the table does not exist.</p>
</section>
<section id="transforming-tables">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Transforming tables"></a><span id="cli-transform-table"></span><h2><a class="toc-backref" href="#id54" role="doc-backlink">Transforming tables</a><a class="headerlink" href="#transforming-tables" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">transform</span></code> command allows you to apply complex transformations to a table that cannot be implemented using a regular SQLite <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> command. See <a class="reference internal" href="python-api.html#python-api-transform"><span class="std std-ref">Transforming a table</span></a> for details of how this works.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>transform<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--drop<span class="w"> </span>column1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rename<span class="w"> </span>column2<span class="w"> </span>column_renamed
</pre></div>
</div>
<p>Every option for this table (with the exception of <code class="docutils literal notranslate"><span class="pre">--pk-none</span></code>) can be specified multiple times. The options are as follows:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">column-name</span> <span class="pre">new-type</span></code></dt><dd><p>Change the type of the specified column. Valid types are <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">blob</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--drop</span> <span class="pre">column-name</span></code></dt><dd><p>Drop the specified column.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--rename</span> <span class="pre">column-name</span> <span class="pre">new-name</span></code></dt><dd><p>Rename this column to a new name.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--column-order</span> <span class="pre">column</span></code></dt><dd><p>Use this multiple times to specify a new order for your columns. <code class="docutils literal notranslate"><span class="pre">-o</span></code> shortcut is also available.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--not-null</span> <span class="pre">column-name</span></code></dt><dd><p>Set this column as <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--not-null-false</span> <span class="pre">column-name</span></code></dt><dd><p>For a column that is currently set as <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code>, remove the <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--pk</span> <span class="pre">column-name</span></code></dt><dd><p>Change the primary key column for this table. Pass <code class="docutils literal notranslate"><span class="pre">--pk</span></code> multiple times if you want to create a compound primary key.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--pk-none</span></code></dt><dd><p>Remove the primary key from this table, turning it into a <code class="docutils literal notranslate"><span class="pre">rowid</span></code> table.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--default</span> <span class="pre">column-name</span> <span class="pre">value</span></code></dt><dd><p>Set the default value of this column.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--default-none</span> <span class="pre">column</span></code></dt><dd><p>Remove the default value for this column.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--drop-foreign-key</span> <span class="pre">column</span></code></dt><dd><p>Drop the specified foreign key.</p>
</dd>
</dl>
<p>If you want to see the SQL that will be executed to make the change without actually executing it, add the <code class="docutils literal notranslate"><span class="pre">--sql</span></code> flag. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>transform<span class="w"> </span>fixtures.db<span class="w"> </span>roadside_attractions<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rename<span class="w"> </span>pk<span class="w"> </span>id<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--default<span class="w"> </span>name<span class="w"> </span>Untitled<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--column-order<span class="w"> </span>id<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--column-order<span class="w"> </span>longitude<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--column-order<span class="w"> </span>latitude<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--drop<span class="w"> </span>address<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--sql
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE TABLE [roadside_attractions_new_4033a60276b9] (</span>
<span class="go">   [id] INTEGER PRIMARY KEY,</span>
<span class="go">   [longitude] FLOAT,</span>
<span class="go">   [latitude] FLOAT,</span>
<span class="go">   [name] TEXT DEFAULT 'Untitled'</span>
<span class="go">);</span>
<span class="go">INSERT INTO [roadside_attractions_new_4033a60276b9] ([longitude], [latitude], [id], [name])</span>
<span class="go">   SELECT [longitude], [latitude], [pk], [name] FROM [roadside_attractions];</span>
<span class="go">DROP TABLE [roadside_attractions];</span>
<span class="go">ALTER TABLE [roadside_attractions_new_4033a60276b9] RENAME TO [roadside_attractions];</span>
</pre></div>
</div>
<section id="adding-a-primary-key-to-a-rowid-table">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding a primary key to a rowid table"></a><span id="cli-transform-table-add-primary-key-to-rowid"></span><h3><a class="toc-backref" href="#id55" role="doc-backlink">Adding a primary key to a rowid table</a><a class="headerlink" href="#adding-a-primary-key-to-a-rowid-table" title="Link to this heading">#</a></h3>
<p>SQLite tables that are created without an explicit primary key are created as <a class="reference external" href="https://www.sqlite.org/rowidtable.html">rowid tables</a>. They still have a numeric primary key which is available in the <code class="docutils literal notranslate"><span class="pre">rowid</span></code> column, but that column is not included in the output of <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span></code>. Heres an example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'[{"name": "Azi"}, {"name": "Suna"}]'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>chickens.db<span class="w"> </span>chickens<span class="w"> </span>-
sqlite-utils<span class="w"> </span>schema<span class="w"> </span>chickens.db
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE TABLE [chickens] (</span>
<span class="go">   [name] TEXT</span>
<span class="go">);</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>chickens.db<span class="w"> </span><span class="s1">'select * from chickens'</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"name": "Azi"},</span>
<span class="go"> {"name": "Suna"}]</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>chickens.db<span class="w"> </span><span class="s1">'select rowid, * from chickens'</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"rowid": 1, "name": "Azi"},</span>
<span class="go"> {"rowid": 2, "name": "Suna"}]</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">transform</span> <span class="pre">...</span> <span class="pre">--pk</span> <span class="pre">id</span></code> to add a primary key column called <code class="docutils literal notranslate"><span class="pre">id</span></code> to the table. The primary key will be created as an <code class="docutils literal notranslate"><span class="pre">INTEGER</span> <span class="pre">PRIMARY</span> <span class="pre">KEY</span></code> and the existing <code class="docutils literal notranslate"><span class="pre">rowid</span></code> values will be copied across to it. It will automatically increment as new rows are added to the table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>transform<span class="w"> </span>chickens.db<span class="w"> </span>chickens<span class="w"> </span>--pk<span class="w"> </span>id
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>schema<span class="w"> </span>chickens.db
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE TABLE "chickens" (</span>
<span class="go">   [id] INTEGER PRIMARY KEY,</span>
<span class="go">   [name] TEXT</span>
<span class="go">);</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>chickens.db<span class="w"> </span><span class="s1">'select * from chickens'</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"id": 1, "name": "Azi"},</span>
<span class="go"> {"id": 2, "name": "Suna"}]</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"name": "Cardi"}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>chickens.db<span class="w"> </span>chickens<span class="w"> </span>-
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>chickens.db<span class="w"> </span><span class="s1">'select * from chickens'</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"id": 1, "name": "Azi"},</span>
<span class="go"> {"id": 2, "name": "Suna"},</span>
<span class="go"> {"id": 3, "name": "Cardi"}]</span>
</pre></div>
</div>
</section>
</section>
<section id="extracting-columns-into-a-separate-table">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Extracting columns into a separate table"></a><span id="cli-extract"></span><h2><a class="toc-backref" href="#id56" role="doc-backlink">Extracting columns into a separate table</a><a class="headerlink" href="#extracting-columns-into-a-separate-table" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">extract</span></code> command can be used to extract specified columns into a separate table.</p>
<p>Take a look at the Python API documentation for <a class="reference internal" href="python-api.html#python-api-extract"><span class="std std-ref">Extracting columns into a separate table</span></a> for a detailed description of how this works, including examples of table schemas before and after running an extraction operation.</p>
<p>The command takes a database, table and one or more columns that should be extracted. To extract the <code class="docutils literal notranslate"><span class="pre">species</span></code> column from the <code class="docutils literal notranslate"><span class="pre">trees</span></code> table you would run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>extract<span class="w"> </span>my.db<span class="w"> </span>trees<span class="w"> </span>species
</pre></div>
</div>
<p>This would produce the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">"trees"</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">TreeAddress</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">species_id</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">species_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">species</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="p">[</span><span class="n">idx_species_species</span><span class="p">]</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="w"> </span><span class="p">([</span><span class="n">species</span><span class="p">]);</span>
</pre></div>
</div>
<p>The command takes the following options:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">--table</span> <span class="pre">TEXT</span></code></dt><dd><p>The name of the lookup to extract columns to. This defaults to using the name of the columns that are being extracted.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--fk-column</span> <span class="pre">TEXT</span></code></dt><dd><p>The name of the foreign key column to add to the table. Defaults to <code class="docutils literal notranslate"><span class="pre">columnname_id</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--rename</span> <span class="pre">&lt;TEXT</span> <span class="pre">TEXT&gt;</span></code></dt><dd><p>Use this option to rename the columns created in the new lookup table.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--silent</span></code></dt><dd><p>Dont display the progress bar.</p>
</dd>
</dl>
<p>Heres a more complex example that makes use of these options. It converts <a class="reference external" href="https://github.com/wri/global-power-plant-database/blob/232a666653e14d803ab02717efc01cdd437e7601/output_database/global_power_plant_database.csv">this CSV file</a> full of global power plants into SQLite, then extracts the <code class="docutils literal notranslate"><span class="pre">country</span></code> and <code class="docutils literal notranslate"><span class="pre">country_long</span></code> columns into a separate <code class="docutils literal notranslate"><span class="pre">countries</span></code> table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span><span class="s1">'https://github.com/wri/global-power-plant-database/blob/232a6666/output_database/global_power_plant_database.csv?raw=true'</span>
sqlite-utils<span class="w"> </span>insert<span class="w"> </span>global.db<span class="w"> </span>power_plants<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s1">'global_power_plant_database.csv?raw=true'</span><span class="w"> </span>--csv
<span class="c1"># Extract those columns:</span>
sqlite-utils<span class="w"> </span>extract<span class="w"> </span>global.db<span class="w"> </span>power_plants<span class="w"> </span>country<span class="w"> </span>country_long<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--table<span class="w"> </span>countries<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--fk-column<span class="w"> </span>country_id<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rename<span class="w"> </span>country_long<span class="w"> </span>name
</pre></div>
</div>
<p>After running the above, the command <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">schema</span> <span class="pre">global.db</span></code> reveals the following schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">countries</span><span class="p">]</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">country</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="ss">"power_plants"</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="p">[</span><span class="n">country_id</span><span class="p">]</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">gppd_idnr</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">capacity_mw</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">latitude</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">longitude</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">primary_fuel</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">other_fuel1</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">other_fuel2</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">other_fuel3</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">commissioning_year</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="k">owner</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="k">source</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">geolocation_source</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">wepp_id</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">year_of_capacity_data</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">generation_gwh_2013</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">generation_gwh_2014</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">generation_gwh_2015</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">generation_gwh_2016</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">generation_gwh_2017</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">generation_data_source</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="p">[</span><span class="n">estimated_generation_gwh</span><span class="p">]</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">   </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="p">([</span><span class="n">country_id</span><span class="p">])</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="p">[</span><span class="n">countries</span><span class="p">]([</span><span class="n">id</span><span class="p">])</span>
<span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="p">[</span><span class="n">idx_countries_country_name</span><span class="p">]</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="p">[</span><span class="n">countries</span><span class="p">]</span><span class="w"> </span><span class="p">([</span><span class="n">country</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="creating-views">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating views"></a><span id="cli-create-view"></span><h2><a class="toc-backref" href="#id57" role="doc-backlink">Creating views</a><a class="headerlink" href="#creating-views" title="Link to this heading">#</a></h2>
<p>You can create a view using the <code class="docutils literal notranslate"><span class="pre">create-view</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-view<span class="w"> </span>mydb.db<span class="w"> </span>version<span class="w"> </span><span class="s2">"select sqlite_version()"</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>mydb.db<span class="w"> </span><span class="s2">"select * from version"</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"sqlite_version()": "3.31.1"}]</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--replace</span></code> to replace an existing view of the same name, and <code class="docutils literal notranslate"><span class="pre">--ignore</span></code> to do nothing if a view already exists.</p>
</section>
<section id="dropping-views">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Dropping views"></a><span id="cli-drop-view"></span><h2><a class="toc-backref" href="#id58" role="doc-backlink">Dropping views</a><a class="headerlink" href="#dropping-views" title="Link to this heading">#</a></h2>
<p>You can drop a view using the <code class="docutils literal notranslate"><span class="pre">drop-view</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>drop-view<span class="w"> </span>myview
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--ignore</span></code> to ignore the error if the view does not exist.</p>
</section>
<section id="adding-columns">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding columns"></a><span id="cli-add-column"></span><h2><a class="toc-backref" href="#id59" role="doc-backlink">Adding columns</a><a class="headerlink" href="#adding-columns" title="Link to this heading">#</a></h2>
<p>You can add a column using the <code class="docutils literal notranslate"><span class="pre">add-column</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-column<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span>nameofcolumn<span class="w"> </span>text
</pre></div>
</div>
<p>The last argument here is the type of the column to be created. You can use one of <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">blob</span></code>. If you leave it off, <code class="docutils literal notranslate"><span class="pre">text</span></code> will be used.</p>
<p>You can add a column that is a foreign key reference to another table using the <code class="docutils literal notranslate"><span class="pre">--fk</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-column<span class="w"> </span>mydb.db<span class="w"> </span>dogs<span class="w"> </span>species_id<span class="w"> </span>--fk<span class="w"> </span>species
</pre></div>
</div>
<p>This will automatically detect the name of the primary key on the species table and use that (and its type) for the new column.</p>
<p>You can explicitly specify the column you wish to reference using <code class="docutils literal notranslate"><span class="pre">--fk-col</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-column<span class="w"> </span>mydb.db<span class="w"> </span>dogs<span class="w"> </span>species_id<span class="w"> </span>--fk<span class="w"> </span>species<span class="w"> </span>--fk-col<span class="w"> </span>ref
</pre></div>
</div>
<p>You can set a <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span> <span class="pre">DEFAULT</span> <span class="pre">'x'</span></code> constraint on the new column using <code class="docutils literal notranslate"><span class="pre">--not-null-default</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-column<span class="w"> </span>mydb.db<span class="w"> </span>dogs<span class="w"> </span>friends_count<span class="w"> </span>integer<span class="w"> </span>--not-null-default<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="adding-columns-automatically-on-insert-update">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding columns automatically on insert/update"></a><span id="cli-add-column-alter"></span><h2><a class="toc-backref" href="#id60" role="doc-backlink">Adding columns automatically on insert/update</a><a class="headerlink" href="#adding-columns-automatically-on-insert-update" title="Link to this heading">#</a></h2>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--alter</span></code> option to automatically add new columns if the data you are inserting or upserting is of a different shape:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs<span class="w"> </span>new-dogs.json<span class="w"> </span>--pk<span class="o">=</span>id<span class="w"> </span>--alter
</pre></div>
</div>
</section>
<section id="adding-foreign-key-constraints">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding foreign key constraints"></a><span id="cli-add-foreign-key"></span><h2><a class="toc-backref" href="#id61" role="doc-backlink">Adding foreign key constraints</a><a class="headerlink" href="#adding-foreign-key-constraints" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">add-foreign-key</span></code> command can be used to add new foreign key references to an existing table - something which SQLites <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> command does not support.</p>
<p>To add a foreign key constraint pointing the <code class="docutils literal notranslate"><span class="pre">books.author_id</span></code> column to <code class="docutils literal notranslate"><span class="pre">authors.id</span></code> in another table, do this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-foreign-key<span class="w"> </span>books.db<span class="w"> </span>books<span class="w"> </span>author_id<span class="w"> </span>authors<span class="w"> </span>id
</pre></div>
</div>
<p>If you omit the other table and other column references <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> will attempt to guess them - so the above example could instead look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-foreign-key<span class="w"> </span>books.db<span class="w"> </span>books<span class="w"> </span>author_id
</pre></div>
</div>
<p>Add <code class="docutils literal notranslate"><span class="pre">--ignore</span></code> to ignore an existing foreign key (as opposed to returning an error):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-foreign-key<span class="w"> </span>books.db<span class="w"> </span>books<span class="w"> </span>author_id<span class="w"> </span>--ignore
</pre></div>
</div>
<p>See <a class="reference internal" href="python-api.html#python-api-add-foreign-key"><span class="std std-ref">Adding foreign key constraints</span></a> in the Python API documentation for further details, including how the automatic table guessing mechanism works.</p>
<section id="adding-multiple-foreign-keys-at-once">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding multiple foreign keys at once"></a><span id="cli-add-foreign-keys"></span><h3><a class="toc-backref" href="#id62" role="doc-backlink">Adding multiple foreign keys at once</a><a class="headerlink" href="#adding-multiple-foreign-keys-at-once" title="Link to this heading">#</a></h3>
<p>Adding a foreign key requires a <code class="docutils literal notranslate"><span class="pre">VACUUM</span></code>. On large databases this can be an expensive operation, so if you are adding multiple foreign keys you can combine them into one operation (and hence one <code class="docutils literal notranslate"><span class="pre">VACUUM</span></code>) using <code class="docutils literal notranslate"><span class="pre">add-foreign-keys</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-foreign-keys<span class="w"> </span>books.db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>books<span class="w"> </span>author_id<span class="w"> </span>authors<span class="w"> </span>id<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>authors<span class="w"> </span>country_id<span class="w"> </span>countries<span class="w"> </span>id
</pre></div>
</div>
<p>When you are using this command each foreign key needs to be defined in full, as four arguments - the table, column, other table and other column.</p>
</section>
<section id="adding-indexes-for-all-foreign-keys">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding indexes for all foreign keys"></a><span id="cli-index-foreign-keys"></span><h3><a class="toc-backref" href="#id63" role="doc-backlink">Adding indexes for all foreign keys</a><a class="headerlink" href="#adding-indexes-for-all-foreign-keys" title="Link to this heading">#</a></h3>
<p>If you want to ensure that every foreign key column in your database has a corresponding index, you can do so like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>index-foreign-keys<span class="w"> </span>books.db
</pre></div>
</div>
</section>
</section>
<section id="setting-defaults-and-not-null-constraints">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Setting defaults and not null constraints"></a><span id="cli-defaults-not-null"></span><h2><a class="toc-backref" href="#id64" role="doc-backlink">Setting defaults and not null constraints</a><a class="headerlink" href="#setting-defaults-and-not-null-constraints" title="Link to this heading">#</a></h2>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--not-null</span></code> and <code class="docutils literal notranslate"><span class="pre">--default</span></code> options (to both <code class="docutils literal notranslate"><span class="pre">insert</span></code> and <code class="docutils literal notranslate"><span class="pre">upsert</span></code>) to specify columns that should be <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code> or to set database defaults for one or more specific columns:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>insert<span class="w"> </span>dogs.db<span class="w"> </span>dogs_with_scores<span class="w"> </span>dogs-with-scores.json<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--not-null<span class="o">=</span>age<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--not-null<span class="o">=</span>name<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--default<span class="w"> </span>age<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--default<span class="w"> </span>score<span class="w"> </span><span class="m">5</span>
</pre></div>
</div>
</section>
<section id="creating-indexes">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating indexes"></a><span id="cli-create-index"></span><h2><a class="toc-backref" href="#id65" role="doc-backlink">Creating indexes</a><a class="headerlink" href="#creating-indexes" title="Link to this heading">#</a></h2>
<p>You can add an index to an existing table using the <code class="docutils literal notranslate"><span class="pre">create-index</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-index<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span>col1<span class="w"> </span><span class="o">[</span>col2...<span class="o">]</span>
</pre></div>
</div>
<p>This can be used to create indexes against a single column or multiple columns.</p>
<p>The name of the index will be automatically derived from the table and columns. To specify a different name, use <code class="docutils literal notranslate"><span class="pre">--name=name_of_index</span></code>.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--unique</span></code> option to create a unique index.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">--if-not-exists</span></code> to avoid attempting to create the index if one with that name already exists.</p>
<p>To add an index on a column in descending order, prefix the column with a hyphen. Since this can be confused for a command-line option you need to construct that like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-index<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span>--<span class="w"> </span>col1<span class="w"> </span>-col2<span class="w"> </span>col3
</pre></div>
</div>
<p>This will create an index on that table on <code class="docutils literal notranslate"><span class="pre">(col1,</span> <span class="pre">col2</span> <span class="pre">desc,</span> <span class="pre">col3)</span></code>.</p>
<p>If your column names are already prefixed with a hyphen youll need to manually execute a <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span></code> SQL statement to add indexes to them rather than using this tool.</p>
<p>Add the <code class="docutils literal notranslate"><span class="pre">--analyze</span></code> option to run <code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code> against the index after it has been created.</p>
</section>
<section id="configuring-full-text-search">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Configuring full-text search"></a><span id="cli-fts"></span><h2><a class="toc-backref" href="#id66" role="doc-backlink">Configuring full-text search</a><a class="headerlink" href="#configuring-full-text-search" title="Link to this heading">#</a></h2>
<p>You can enable SQLite full-text search on a table and a set of columns like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>enable-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>title<span class="w"> </span>summary
</pre></div>
</div>
<p>This will use SQLites FTS5 module by default. Use <code class="docutils literal notranslate"><span class="pre">--fts4</span></code> if you want to use FTS4:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>enable-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>title<span class="w"> </span>summary<span class="w"> </span>--fts4
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">enable-fts</span></code> command will populate the new index with all existing documents. If you later add more documents you will need to use <code class="docutils literal notranslate"><span class="pre">populate-fts</span></code> to cause them to be indexed as well:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>populate-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>title<span class="w"> </span>summary
</pre></div>
</div>
<p>A better solution here is to use database triggers. You can set up database triggers to automatically update the full-text index using the <code class="docutils literal notranslate"><span class="pre">--create-triggers</span></code> option when you first run <code class="docutils literal notranslate"><span class="pre">enable-fts</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>enable-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>title<span class="w"> </span>summary<span class="w"> </span>--create-triggers
</pre></div>
</div>
<p>To set a custom FTS tokenizer, e.g. to enable Porter stemming, use <code class="docutils literal notranslate"><span class="pre">--tokenize=</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>populate-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>title<span class="w"> </span>summary<span class="w"> </span>--tokenize<span class="o">=</span>porter
</pre></div>
</div>
<p>To remove the FTS tables and triggers you created, use <code class="docutils literal notranslate"><span class="pre">disable-fts</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>disable-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents
</pre></div>
</div>
<p>To rebuild one or more FTS tables (see <a class="reference internal" href="python-api.html#python-api-fts-rebuild"><span class="std std-ref">Rebuilding a full-text search table</span></a>), use <code class="docutils literal notranslate"><span class="pre">rebuild-fts</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rebuild-fts<span class="w"> </span>mydb.db<span class="w"> </span>documents
</pre></div>
</div>
<p>You can rebuild every FTS table by running <code class="docutils literal notranslate"><span class="pre">rebuild-fts</span></code> without passing any table names:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>rebuild-fts<span class="w"> </span>mydb.db
</pre></div>
</div>
</section>
<section id="executing-searches">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Executing searches"></a><span id="cli-search"></span><h2><a class="toc-backref" href="#id67" role="doc-backlink">Executing searches</a><a class="headerlink" href="#executing-searches" title="Link to this heading">#</a></h2>
<p>Once you have configured full-text search for a table, you can search it using <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">search</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>search<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>searchterm
</pre></div>
</div>
<p>This command accepts the same output options as <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">query</span></code>: <code class="docutils literal notranslate"><span class="pre">--table</span></code>, <code class="docutils literal notranslate"><span class="pre">--csv</span></code>, <code class="docutils literal notranslate"><span class="pre">--tsv</span></code>, <code class="docutils literal notranslate"><span class="pre">--nl</span></code> etc.</p>
<p>By default it shows the most relevant matches first. You can specify a different sort order using the <code class="docutils literal notranslate"><span class="pre">-o</span></code> option, which can take a column or a column followed by <code class="docutils literal notranslate"><span class="pre">desc</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort by rowid</span>
sqlite-utils<span class="w"> </span>search<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>searchterm<span class="w"> </span>-o<span class="w"> </span>rowid
<span class="c1"># Sort by created in descending order</span>
sqlite-utils<span class="w"> </span>search<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>searchterm<span class="w"> </span>-o<span class="w"> </span><span class="s1">'created desc'</span>
</pre></div>
</div>
<p>SQLite <a class="reference external" href="https://www.sqlite.org/fts5.html#full_text_query_syntax">advanced search syntax</a> is enabled by default. To run a search with automatic quoting applied to the terms to avoid them being potentially interpreted as advanced search syntax use the <code class="docutils literal notranslate"><span class="pre">--quote</span></code> option.</p>
<p>You can specify a subset of columns to be returned using the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option one or more times:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>search<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>searchterm<span class="w"> </span>-c<span class="w"> </span>title<span class="w"> </span>-c<span class="w"> </span>created
</pre></div>
</div>
<p>By default all search results will be returned. You can use <code class="docutils literal notranslate"><span class="pre">--limit</span> <span class="pre">20</span></code> to return just the first 20 results.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--sql</span></code> option to output the SQL that would be executed, rather than running the query:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>search<span class="w"> </span>mydb.db<span class="w"> </span>documents<span class="w"> </span>searchterm<span class="w"> </span>--sql
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">with original as (</span>
<span class="go">    select</span>
<span class="go">        rowid,</span>
<span class="go">        *</span>
<span class="go">    from [documents]</span>
<span class="go">)</span>
<span class="go">select</span>
<span class="go">    [original].*</span>
<span class="go">from</span>
<span class="go">    [original]</span>
<span class="go">    join [documents_fts] on [original].rowid = [documents_fts].rowid</span>
<span class="go">where</span>
<span class="go">    [documents_fts] match :query</span>
<span class="go">order by</span>
<span class="go">    [documents_fts].rank</span>
</pre></div>
</div>
</section>
<section id="enabling-cached-counts">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Enabling cached counts"></a><span id="cli-enable-counts"></span><h2><a class="toc-backref" href="#id68" role="doc-backlink">Enabling cached counts</a><a class="headerlink" href="#enabling-cached-counts" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">count(*)</span></code> queries can take a long time against large tables. <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> can speed these up by adding triggers to maintain a <code class="docutils literal notranslate"><span class="pre">_counts</span></code> table, see <a class="reference internal" href="python-api.html#python-api-cached-table-counts"><span class="std std-ref">Cached table counts using triggers</span></a> for details.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">enable-counts</span></code> command can be used to configure these triggers, either for every table in the database or for specific tables.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure triggers for every table in the database</span>
sqlite-utils<span class="w"> </span>enable-counts<span class="w"> </span>mydb.db

<span class="c1"># Configure triggers just for specific tables</span>
sqlite-utils<span class="w"> </span>enable-counts<span class="w"> </span>mydb.db<span class="w"> </span>table1<span class="w"> </span>table2
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">_counts</span></code> table ever becomes out-of-sync with the actual table counts you can repair it using the <code class="docutils literal notranslate"><span class="pre">reset-counts</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>reset-counts<span class="w"> </span>mydb.db
</pre></div>
</div>
</section>
<section id="optimizing-index-usage-with-analyze">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Optimizing index usage with ANALYZE"></a><span id="cli-analyze"></span><h2><a class="toc-backref" href="#id69" role="doc-backlink">Optimizing index usage with ANALYZE</a><a class="headerlink" href="#optimizing-index-usage-with-analyze" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://www.sqlite.org/lang_analyze.html">SQLite ANALYZE command</a> builds a table of statistics which the query planner can use to make better decisions about which indexes to use for a given query.</p>
<p>You should run <code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code> if your database is large and you do not think your indexes are being efficiently used.</p>
<p>To run <code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code> against every index in a database, use this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze<span class="w"> </span>mydb.db
</pre></div>
</div>
<p>You can run it against specific tables, or against specific named indexes, by passing them as optional arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>analyze<span class="w"> </span>mydb.db<span class="w"> </span>mytable<span class="w"> </span>idx_mytable_name
</pre></div>
</div>
<p>You can also run <code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code> as part of another command using the <code class="docutils literal notranslate"><span class="pre">--analyze</span></code> option. This is supported by the <code class="docutils literal notranslate"><span class="pre">create-index</span></code>, <code class="docutils literal notranslate"><span class="pre">insert</span></code> and <code class="docutils literal notranslate"><span class="pre">upsert</span></code> commands.</p>
</section>
<section id="vacuum">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Vacuum"></a><span id="cli-vacuum"></span><h2><a class="toc-backref" href="#id70" role="doc-backlink">Vacuum</a><a class="headerlink" href="#vacuum" title="Link to this heading">#</a></h2>
<p>You can run VACUUM to optimize your database like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>vacuum<span class="w"> </span>mydb.db
</pre></div>
</div>
</section>
<section id="optimize">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Optimize"></a><span id="cli-optimize"></span><h2><a class="toc-backref" href="#id71" role="doc-backlink">Optimize</a><a class="headerlink" href="#optimize" title="Link to this heading">#</a></h2>
<p>The optimize command can dramatically reduce the size of your database if you are using SQLite full-text search. It runs OPTIMIZE against all of your FTS4 and FTS5 tables, then runs VACUUM.</p>
<p>If you just want to run OPTIMIZE without the VACUUM, use the <code class="docutils literal notranslate"><span class="pre">--no-vacuum</span></code> flag.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize all FTS tables and then VACUUM</span>
sqlite-utils<span class="w"> </span>optimize<span class="w"> </span>mydb.db

<span class="c1"># Optimize but skip the VACUUM</span>
sqlite-utils<span class="w"> </span>optimize<span class="w"> </span>--no-vacuum<span class="w"> </span>mydb.db
</pre></div>
</div>
<p>To optimize specific tables rather than every FTS table, pass those tables as extra arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>optimize<span class="w"> </span>mydb.db<span class="w"> </span>table_1<span class="w"> </span>table_2
</pre></div>
</div>
</section>
<section id="wal-mode">
<a class="dashAnchor" name="//apple_ref/cpp/Section/WAL mode"></a><span id="cli-wal"></span><h2><a class="toc-backref" href="#id72" role="doc-backlink">WAL mode</a><a class="headerlink" href="#wal-mode" title="Link to this heading">#</a></h2>
<p>You can enable <a class="reference external" href="https://www.sqlite.org/wal.html">Write-Ahead Logging</a> for a database file using the <code class="docutils literal notranslate"><span class="pre">enable-wal</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>enable-wal<span class="w"> </span>mydb.db
</pre></div>
</div>
<p>You can disable WAL mode using <code class="docutils literal notranslate"><span class="pre">disable-wal</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>disable-wal<span class="w"> </span>mydb.db
</pre></div>
</div>
<p>Both of these commands accept one or more database files as arguments.</p>
</section>
<section id="dumping-the-database-to-sql">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Dumping the database to SQL"></a><span id="cli-dump"></span><h2><a class="toc-backref" href="#id73" role="doc-backlink">Dumping the database to SQL</a><a class="headerlink" href="#dumping-the-database-to-sql" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">dump</span></code> command outputs a SQL dump of the schema and full contents of the specified database file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>dump<span class="w"> </span>mydb.db
BEGIN<span class="w"> </span>TRANSACTION<span class="p">;</span>
CREATE<span class="w"> </span>TABLE<span class="w"> </span>...
...
COMMIT<span class="p">;</span>
</pre></div>
</div>
</section>
<section id="loading-sqlite-extensions">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Loading SQLite extensions"></a><span id="cli-load-extension"></span><h2><a class="toc-backref" href="#id74" role="doc-backlink">Loading SQLite extensions</a><a class="headerlink" href="#loading-sqlite-extensions" title="Link to this heading">#</a></h2>
<p>Many of these commands have the ability to load additional SQLite extensions using the <code class="docutils literal notranslate"><span class="pre">--load-extension=/path/to/extension</span></code> option - use <code class="docutils literal notranslate"><span class="pre">--help</span></code> to check for support, e.g. <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">rows</span> <span class="pre">--help</span></code>.</p>
<p>This option can be applied multiple times to load multiple extensions.</p>
<p>Since <a class="reference external" href="https://www.gaia-gis.it/fossil/libspatialite/index">SpatiaLite</a> is commonly used with SQLite, the value <code class="docutils literal notranslate"><span class="pre">spatialite</span></code> is special: it will search for SpatiaLite in the most common installation locations, saving you from needing to remember exactly where that module is located:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>memory<span class="w"> </span><span class="s2">"select spatialite_version()"</span><span class="w"> </span>--load-extension<span class="o">=</span>spatialite
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">[{"spatialite_version()": "4.3.0a"}]</span>
</pre></div>
</div>
</section>
<section id="spatialite-helpers">
<a class="dashAnchor" name="//apple_ref/cpp/Section/SpatiaLite helpers"></a><span id="cli-spatialite"></span><h2><a class="toc-backref" href="#id75" role="doc-backlink">SpatiaLite helpers</a><a class="headerlink" href="#spatialite-helpers" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://www.gaia-gis.it/fossil/libspatialite/home">SpatiaLite</a> adds geographic capability to SQLite (similar to how PostGIS builds on PostgreSQL). The <a class="reference external" href="http://www.gaia-gis.it/gaia-sins/spatialite-cookbook-5/index.html">SpatiaLite cookbook</a> is a good resource for learning whats possible with it.</p>
<p>You can convert an existing table to a geographic table by adding a geometry column, use the <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">add-geometry-column</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>add-geometry-column<span class="w"> </span>spatial.db<span class="w"> </span>locations<span class="w"> </span>geometry<span class="w"> </span>--type<span class="w"> </span>POLYGON<span class="w"> </span>--srid<span class="w"> </span><span class="m">4326</span>
</pre></div>
</div>
<p>The table (<code class="docutils literal notranslate"><span class="pre">locations</span></code> in the example above) must already exist before adding a geometry column. Use <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">create-table</span></code> first, then <code class="docutils literal notranslate"><span class="pre">add-geometry-column</span></code>.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--type</span></code> option to specify a geometry type. By default, <code class="docutils literal notranslate"><span class="pre">add-geometry-column</span></code> uses a generic <code class="docutils literal notranslate"><span class="pre">GEOMETRY</span></code>, which will work with any type, though it may not be supported by some desktop GIS applications.</p>
<p>Eight (case-insensitive) types are allowed:</p>
<ul class="simple">
<li><p>POINT</p></li>
<li><p>LINESTRING</p></li>
<li><p>POLYGON</p></li>
<li><p>MULTIPOINT</p></li>
<li><p>MULTILINESTRING</p></li>
<li><p>MULTIPOLYGON</p></li>
<li><p>GEOMETRYCOLLECTION</p></li>
<li><p>GEOMETRY</p></li>
</ul>
<section id="adding-spatial-indexes">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Adding spatial indexes"></a><span id="cli-spatialite-indexes"></span><h3><a class="toc-backref" href="#id76" role="doc-backlink">Adding spatial indexes</a><a class="headerlink" href="#adding-spatial-indexes" title="Link to this heading">#</a></h3>
<p>Once you have a geometry column, you can speed up bounding box queries by adding a spatial index:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>create-spatial-index<span class="w"> </span>spatial.db<span class="w"> </span>locations<span class="w"> </span>geometry
</pre></div>
</div>
<p>See this <a class="reference external" href="http://www.gaia-gis.it/gaia-sins/spatialite-cookbook-5/cookbook_topics.03.html#topic_Wonderful_RTree_Spatial_Index">SpatiaLite Cookbook recipe</a> for examples of how to use a spatial index.</p>
</section>
</section>
<section id="installing-packages">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Installing packages"></a><span id="cli-install"></span><h2><a class="toc-backref" href="#id77" role="doc-backlink">Installing packages</a><a class="headerlink" href="#installing-packages" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="#cli-convert"><span class="std std-ref">convert command</span></a> and the <a class="reference internal" href="#cli-insert-convert"><span class="std std-ref">insert convert</span></a> and <a class="reference internal" href="#cli-query-functions"><span class="std std-ref">query functions</span></a> options can be provided with a Python script that imports additional modules from the <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> environment.</p>
<p>You can install packages from PyPI directly into the correct environment using <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">install</span> <span class="pre">&lt;package&gt;</span></code>. This is a wrapper around <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>install<span class="w"> </span>beautifulsoup4
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">-U</span></code> to upgrade an existing package.</p>
</section>
<section id="uninstalling-packages">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Uninstalling packages"></a><span id="cli-uninstall"></span><h2><a class="toc-backref" href="#id78" role="doc-backlink">Uninstalling packages</a><a class="headerlink" href="#uninstalling-packages" title="Link to this heading">#</a></h2>
<p>You can uninstall packages that were installed using <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">install</span></code> with <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">uninstall</span> <span class="pre">&lt;package&gt;</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>uninstall<span class="w"> </span>beautifulsoup4
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">-y</span></code> to skip the request for confirmation.</p>
</section>
<section id="experimental-tui">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Experimental TUI"></a><span id="cli-tui"></span><h2><a class="toc-backref" href="#id79" role="doc-backlink">Experimental TUI</a><a class="headerlink" href="#experimental-tui" title="Link to this heading">#</a></h2>
<p>A TUI is a text user interface (or terminal user interface) - a keyboard and mouse driven graphical interface running in your terminal.</p>
<p><code class="docutils literal notranslate"><span class="pre">sqlite-utils</span></code> has experimental support for a TUI for building command-line invocations, built on top of the <a class="reference external" href="https://github.com/Textualize/trogon/">Trogon</a> TUI library.</p>
<p>To enable this feature you will need to install the <code class="docutils literal notranslate"><span class="pre">trogon</span></code> dependency. You can do that like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqite-utils<span class="w"> </span>install<span class="w"> </span>trogon
</pre></div>
</div>
<p>Once installed, running the <code class="docutils literal notranslate"><span class="pre">sqlite-utils</span> <span class="pre">tui</span></code> command will launch the TUI interface:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sqlite-utils<span class="w"> </span>tui
</pre></div>
</div>
<p>You can then construct a command by selecting options from the menus, and execute it using <code class="docutils literal notranslate"><span class="pre">Ctrl+R</span></code>.</p>
<img alt="A TUI interface for sqlite-utils - the left column shows a list of commands, while the right panel has a form for constructing arguments to the add-column command." src="_images/tui.png"/>
</section>
</section>
</article>
</div>
<footer>
<div class="related-pages">
<a class="next-page" href="python-api.html">
<div class="page-info">
<div class="context">
<span>Next</span>
</div>
<div class="title">sqlite_utils Python library</div>
</div>
<svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
</a>
<a class="prev-page" href="installation.html">
<svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
<div class="page-info">
<div class="context">
<span>Previous</span>
</div>
<div class="title">Installation</div>
</div>
</a>
</div>
<div class="bottom-of-page">
<div class="left-details">
<div class="copyright">
                Copyright  2018-2022, Simon Willison
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
</div>
<div class="right-details">
</div>
</div>
</footer>
</div>
<aside class="toc-drawer">
<div class="toc-sticky toc-scroll">
<div class="toc-title-container">
<span class="toc-title">
            On this page
          </span>
</div>
<div class="toc-tree-container">
<div class="toc-tree">
<ul>
<li><a class="reference internal" href="#">sqlite-utils command-line tool</a><ul>
<li><a class="reference internal" href="#running-sql-queries">Running SQL queries</a><ul>
<li><a class="reference internal" href="#returning-json">Returning JSON</a><ul>
<li><a class="reference internal" href="#newline-delimited-json">Newline-delimited JSON</a></li>
<li><a class="reference internal" href="#json-arrays">JSON arrays</a></li>
<li><a class="reference internal" href="#binary-data-in-json">Binary data in JSON</a></li>
<li><a class="reference internal" href="#nested-json-values">Nested JSON values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#returning-csv-or-tsv">Returning CSV or TSV</a></li>
<li><a class="reference internal" href="#table-formatted-output">Table-formatted output</a></li>
<li><a class="reference internal" href="#returning-raw-data-such-as-binary-content">Returning raw data, such as binary content</a></li>
<li><a class="reference internal" href="#using-named-parameters">Using named parameters</a></li>
<li><a class="reference internal" href="#update-insert-and-delete">UPDATE, INSERT and DELETE</a></li>
<li><a class="reference internal" href="#defining-custom-sql-functions">Defining custom SQL functions</a></li>
<li><a class="reference internal" href="#sqlite-extensions">SQLite extensions</a></li>
<li><a class="reference internal" href="#attaching-additional-databases">Attaching additional databases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#querying-data-directly-using-an-in-memory-database">Querying data directly using an in-memory database</a><ul>
<li><a class="reference internal" href="#running-queries-directly-against-csv-or-json">Running queries directly against CSV or JSON</a></li>
<li><a class="reference internal" href="#explicitly-specifying-the-format">Explicitly specifying the format</a></li>
<li><a class="reference internal" href="#joining-in-memory-data-against-existing-databases-using-attach">Joining in-memory data against existing databases using --attach</a></li>
<li><a class="reference internal" href="#schema-analyze-dump-and-save">--schema, --analyze, --dump and --save</a></li>
</ul>
</li>
<li><a class="reference internal" href="#returning-all-rows-in-a-table">Returning all rows in a table</a></li>
<li><a class="reference internal" href="#listing-tables">Listing tables</a></li>
<li><a class="reference internal" href="#listing-views">Listing views</a></li>
<li><a class="reference internal" href="#listing-indexes">Listing indexes</a></li>
<li><a class="reference internal" href="#listing-triggers">Listing triggers</a></li>
<li><a class="reference internal" href="#showing-the-schema">Showing the schema</a></li>
<li><a class="reference internal" href="#analyzing-tables">Analyzing tables</a><ul>
<li><a class="reference internal" href="#saving-the-analyzed-table-details">Saving the analyzed table details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-empty-database">Creating an empty database</a></li>
<li><a class="reference internal" href="#inserting-json-data">Inserting JSON data</a><ul>
<li><a class="reference internal" href="#inserting-binary-data">Inserting binary data</a></li>
<li><a class="reference internal" href="#inserting-newline-delimited-json">Inserting newline-delimited JSON</a></li>
<li><a class="reference internal" href="#flattening-nested-json-objects">Flattening nested JSON objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inserting-csv-or-tsv-data">Inserting CSV or TSV data</a><ul>
<li><a class="reference internal" href="#alternative-delimiters-and-quote-characters">Alternative delimiters and quote characters</a></li>
<li><a class="reference internal" href="#csv-files-without-a-header-row">CSV files without a header row</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inserting-unstructured-data-with-lines-and-text">Inserting unstructured data with --lines and --text</a></li>
<li><a class="reference internal" href="#applying-conversions-while-inserting-data">Applying conversions while inserting data</a><ul>
<li><a class="reference internal" href="#convert-with-lines">--convert with --lines</a></li>
<li><a class="reference internal" href="#convert-with-text">--convert with --text</a></li>
</ul>
</li>
<li><a class="reference internal" href="#insert-replacing-data">Insert-replacing data</a></li>
<li><a class="reference internal" href="#upserting-data">Upserting data</a></li>
<li><a class="reference internal" href="#executing-sql-in-bulk">Executing SQL in bulk</a></li>
<li><a class="reference internal" href="#inserting-data-from-files">Inserting data from files</a></li>
<li><a class="reference internal" href="#converting-data-in-columns">Converting data in columns</a><ul>
<li><a class="reference internal" href="#importing-additional-modules">Importing additional modules</a></li>
<li><a class="reference internal" href="#using-a-convert-function-to-execute-initialization">Using a convert() function to execute initialization</a></li>
<li><a class="reference internal" href="#sqlite-utils-convert-recipes">sqlite-utils convert recipes</a></li>
<li><a class="reference internal" href="#saving-the-result-to-a-different-column">Saving the result to a different column</a></li>
<li><a class="reference internal" href="#converting-a-column-into-multiple-columns">Converting a column into multiple columns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-tables">Creating tables</a></li>
<li><a class="reference internal" href="#renaming-a-table">Renaming a table</a></li>
<li><a class="reference internal" href="#duplicating-tables">Duplicating tables</a></li>
<li><a class="reference internal" href="#dropping-tables">Dropping tables</a></li>
<li><a class="reference internal" href="#transforming-tables">Transforming tables</a><ul>
<li><a class="reference internal" href="#adding-a-primary-key-to-a-rowid-table">Adding a primary key to a rowid table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extracting-columns-into-a-separate-table">Extracting columns into a separate table</a></li>
<li><a class="reference internal" href="#creating-views">Creating views</a></li>
<li><a class="reference internal" href="#dropping-views">Dropping views</a></li>
<li><a class="reference internal" href="#adding-columns">Adding columns</a></li>
<li><a class="reference internal" href="#adding-columns-automatically-on-insert-update">Adding columns automatically on insert/update</a></li>
<li><a class="reference internal" href="#adding-foreign-key-constraints">Adding foreign key constraints</a><ul>
<li><a class="reference internal" href="#adding-multiple-foreign-keys-at-once">Adding multiple foreign keys at once</a></li>
<li><a class="reference internal" href="#adding-indexes-for-all-foreign-keys">Adding indexes for all foreign keys</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-defaults-and-not-null-constraints">Setting defaults and not null constraints</a></li>
<li><a class="reference internal" href="#creating-indexes">Creating indexes</a></li>
<li><a class="reference internal" href="#configuring-full-text-search">Configuring full-text search</a></li>
<li><a class="reference internal" href="#executing-searches">Executing searches</a></li>
<li><a class="reference internal" href="#enabling-cached-counts">Enabling cached counts</a></li>
<li><a class="reference internal" href="#optimizing-index-usage-with-analyze">Optimizing index usage with ANALYZE</a></li>
<li><a class="reference internal" href="#vacuum">Vacuum</a></li>
<li><a class="reference internal" href="#optimize">Optimize</a></li>
<li><a class="reference internal" href="#wal-mode">WAL mode</a></li>
<li><a class="reference internal" href="#dumping-the-database-to-sql">Dumping the database to SQL</a></li>
<li><a class="reference internal" href="#loading-sqlite-extensions">Loading SQLite extensions</a></li>
<li><a class="reference internal" href="#spatialite-helpers">SpatiaLite helpers</a><ul>
<li><a class="reference internal" href="#adding-spatial-indexes">Adding spatial indexes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-packages">Installing packages</a></li>
<li><a class="reference internal" href="#uninstalling-packages">Uninstalling packages</a></li>
<li><a class="reference internal" href="#experimental-tui">Experimental TUI</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</aside>
</div>
</div>
<script src="_static/documentation_options.js?v=aeb06d4f"></script>
<script src="_static/doctools.js?v=888ff710"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="_static/scripts/furo.js?v=32e29ea5"></script>
<script src="_static/clipboard.min.js?v=a7894cd8"></script>
<script src="_static/copybutton.js?v=f281be69"></script>
<script src="_static/js/custom.js?v=6323a214"></script>
<style type="text/css">
.highlight-output .highlight {
  border-left: 9px solid #30c94f;
}
</style>
<script>
document.addEventListener("DOMContentLoaded", function() {
  // Show banner linking to /stable/ if this is a /latest/ page
  if (!/\/latest\//.test(location.pathname)) {
    return;
  }
  var stableUrl = location.pathname.replace("/latest/", "/stable/");
  // Check it's not a 404
  fetch(stableUrl, { method: "HEAD" }).then((response) => {
    if (response.status === 200) {
      var warning = document.createElement("div");
      warning.className = "admonition warning";
      warning.innerHTML = `
        <p class="first admonition-title">Note</p>
        <p class="last">
          This documentation covers the <strong>development version</strong> of Datasette.
        </p>
        <p>
          See <a href="${stableUrl}">this page</a> for the current stable release.
        </p>
      `;
      var mainArticle = document.querySelector("article[role=main]");
      mainArticle.insertBefore(warning, mainArticle.firstChild);
    }
  });
});
</script>
</body>
</html>